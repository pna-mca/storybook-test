/*! For license information please see 897.f0ba7cc9.iframe.bundle.js.LICENSE.txt */
(self.webpackChunkangular=self.webpackChunkangular||[]).push([[897],{"./node_modules/ng2-pdf-viewer/fesm2022/ng2-pdf-viewer.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Lk:()=>PdfViewerModule});var pdf_namespaceObject={};__webpack_require__.r(pdf_namespaceObject),__webpack_require__.d(pdf_namespaceObject,{AbortException:()=>__webpack_exports__AbortException,AnnotationEditorLayer:()=>__webpack_exports__AnnotationEditorLayer,AnnotationEditorParamsType:()=>__webpack_exports__AnnotationEditorParamsType,AnnotationEditorType:()=>__webpack_exports__AnnotationEditorType,AnnotationEditorUIManager:()=>__webpack_exports__AnnotationEditorUIManager,AnnotationLayer:()=>__webpack_exports__AnnotationLayer,AnnotationMode:()=>__webpack_exports__AnnotationMode,ColorPicker:()=>__webpack_exports__ColorPicker,DOMSVGFactory:()=>__webpack_exports__DOMSVGFactory,DrawLayer:()=>__webpack_exports__DrawLayer,FeatureTest:()=>__webpack_exports__FeatureTest,GlobalWorkerOptions:()=>__webpack_exports__GlobalWorkerOptions,ImageKind:()=>__webpack_exports__ImageKind,InvalidPDFException:()=>__webpack_exports__InvalidPDFException,MissingPDFException:()=>__webpack_exports__MissingPDFException,OPS:()=>__webpack_exports__OPS,OutputScale:()=>__webpack_exports__OutputScale,PDFDataRangeTransport:()=>__webpack_exports__PDFDataRangeTransport,PDFDateString:()=>__webpack_exports__PDFDateString,PDFWorker:()=>__webpack_exports__PDFWorker,PasswordResponses:()=>__webpack_exports__PasswordResponses,PermissionFlag:()=>__webpack_exports__PermissionFlag,PixelsPerInch:()=>__webpack_exports__PixelsPerInch,RenderingCancelledException:()=>__webpack_exports__RenderingCancelledException,TextLayer:()=>__webpack_exports__TextLayer,UnexpectedResponseException:()=>__webpack_exports__UnexpectedResponseException,Util:()=>__webpack_exports__Util,VerbosityLevel:()=>__webpack_exports__VerbosityLevel,XfaLayer:()=>__webpack_exports__XfaLayer,build:()=>__webpack_exports__build,createValidAbsoluteUrl:()=>__webpack_exports__createValidAbsoluteUrl,fetchData:()=>__webpack_exports__fetchData,getDocument:()=>__webpack_exports__getDocument,getFilenameFromUrl:()=>__webpack_exports__getFilenameFromUrl,getPdfFilenameFromUrl:()=>__webpack_exports__getPdfFilenameFromUrl,getXfaPageViewport:()=>__webpack_exports__getXfaPageViewport,isDataScheme:()=>__webpack_exports__isDataScheme,isPdfFile:()=>__webpack_exports__isPdfFile,noContextMenu:()=>__webpack_exports__noContextMenu,normalizeUnicode:()=>__webpack_exports__normalizeUnicode,setLayerDimensions:()=>__webpack_exports__setLayerDimensions,shadow:()=>__webpack_exports__shadow,version:()=>__webpack_exports__version});var pdf_viewer_namespaceObject={};__webpack_require__.r(pdf_viewer_namespaceObject),__webpack_require__.d(pdf_viewer_namespaceObject,{AnnotationLayerBuilder:()=>__webpack_exports__AnnotationLayerBuilder,DownloadManager:()=>__webpack_exports__DownloadManager,EventBus:()=>__webpack_exports__EventBus,FindState:()=>__webpack_exports__FindState,GenericL10n:()=>__webpack_exports__GenericL10n,LinkTarget:()=>__webpack_exports__LinkTarget,PDFFindController:()=>__webpack_exports__PDFFindController,PDFHistory:()=>__webpack_exports__PDFHistory,PDFLinkService:()=>__webpack_exports__PDFLinkService,PDFPageView:()=>__webpack_exports__PDFPageView,PDFScriptingManager:()=>__webpack_exports__PDFScriptingManager,PDFSinglePageViewer:()=>__webpack_exports__PDFSinglePageViewer,PDFViewer:()=>__webpack_exports__PDFViewer,ProgressBar:()=>__webpack_exports__ProgressBar,RenderingStates:()=>__webpack_exports__RenderingStates,ScrollMode:()=>__webpack_exports__ScrollMode,SimpleLinkService:()=>__webpack_exports__SimpleLinkService,SpreadMode:()=>__webpack_exports__SpreadMode,StructTreeLayerBuilder:()=>__webpack_exports__StructTreeLayerBuilder,TextLayerBuilder:()=>__webpack_exports__TextLayerBuilder,XfaLayerBuilder:()=>__webpack_exports__XfaLayerBuilder,parseQueryString:()=>__webpack_exports__parseQueryString});var core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),fromEvent=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/fromEvent.js"),Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),from=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/from.js"),takeUntil=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js"),debounceTime=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/debounceTime.js"),filter=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/filter.js"),asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),process=__webpack_require__("./node_modules/process/browser.js"),__nested_webpack_require_1033__={d:(exports,definition)=>{for(var key in definition)__nested_webpack_require_1033__.o(definition,key)&&!__nested_webpack_require_1033__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},o:(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop)},__nested_webpack_exports__=globalThis.pdfjsLib={};__nested_webpack_require_1033__.d(__nested_webpack_exports__,{AbortException:()=>AbortException,AnnotationEditorLayer:()=>AnnotationEditorLayer,AnnotationEditorParamsType:()=>AnnotationEditorParamsType,AnnotationEditorType:()=>AnnotationEditorType,AnnotationEditorUIManager:()=>AnnotationEditorUIManager,AnnotationLayer:()=>AnnotationLayer,AnnotationMode:()=>AnnotationMode,ColorPicker:()=>ColorPicker,DOMSVGFactory:()=>DOMSVGFactory,DrawLayer:()=>DrawLayer,FeatureTest:()=>util_FeatureTest,GlobalWorkerOptions:()=>GlobalWorkerOptions,ImageKind:()=>util_ImageKind,InvalidPDFException:()=>InvalidPDFException,MissingPDFException:()=>MissingPDFException,OPS:()=>OPS,OutputScale:()=>OutputScale,PDFDataRangeTransport:()=>PDFDataRangeTransport,PDFDateString:()=>PDFDateString,PDFWorker:()=>PDFWorker,PasswordResponses:()=>PasswordResponses,PermissionFlag:()=>PermissionFlag,PixelsPerInch:()=>PixelsPerInch,RenderingCancelledException:()=>RenderingCancelledException,TextLayer:()=>TextLayer,UnexpectedResponseException:()=>UnexpectedResponseException,Util:()=>Util,VerbosityLevel:()=>VerbosityLevel,XfaLayer:()=>XfaLayer,build:()=>build,createValidAbsoluteUrl:()=>createValidAbsoluteUrl,fetchData:()=>fetchData,getDocument:()=>getDocument,getFilenameFromUrl:()=>getFilenameFromUrl,getPdfFilenameFromUrl:()=>getPdfFilenameFromUrl,getXfaPageViewport:()=>getXfaPageViewport,isDataScheme:()=>isDataScheme,isPdfFile:()=>isPdfFile,noContextMenu:()=>noContextMenu,normalizeUnicode:()=>normalizeUnicode,setLayerDimensions:()=>setLayerDimensions,shadow:()=>shadow,version:()=>version});const isNodeJS=!("object"!=typeof process||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type),IDENTITY_MATRIX=[1,0,0,1,0,0],FONT_IDENTITY_MATRIX=[.001,0,0,.001,0,0],RenderingIntentFlag_ANY=1,RenderingIntentFlag_DISPLAY=2,RenderingIntentFlag_PRINT=4,RenderingIntentFlag_ANNOTATIONS_FORMS=16,RenderingIntentFlag_ANNOTATIONS_STORAGE=32,RenderingIntentFlag_ANNOTATIONS_DISABLE=64,RenderingIntentFlag_IS_EDITING=128,RenderingIntentFlag_OPLIST=256,AnnotationMode={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},AnnotationEditorType={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},AnnotationEditorParamsType={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},PermissionFlag={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},TextRenderingMode_FILL=0,TextRenderingMode_STROKE=1,TextRenderingMode_FILL_STROKE=2,TextRenderingMode_INVISIBLE=3,TextRenderingMode_FILL_STROKE_MASK=3,TextRenderingMode_ADD_TO_PATH_FLAG=4,util_ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},AnnotationType_TEXT=1,AnnotationType_LINK=2,AnnotationType_FREETEXT=3,AnnotationType_LINE=4,AnnotationType_SQUARE=5,AnnotationType_CIRCLE=6,AnnotationType_POLYGON=7,AnnotationType_POLYLINE=8,AnnotationType_HIGHLIGHT=9,AnnotationType_UNDERLINE=10,AnnotationType_SQUIGGLY=11,AnnotationType_STRIKEOUT=12,AnnotationType_STAMP=13,AnnotationType_CARET=14,AnnotationType_INK=15,AnnotationType_POPUP=16,AnnotationType_FILEATTACHMENT=17,AnnotationType_WIDGET=20,AnnotationBorderStyleType_SOLID=1,AnnotationBorderStyleType_DASHED=2,AnnotationBorderStyleType_BEVELED=3,AnnotationBorderStyleType_INSET=4,AnnotationBorderStyleType_UNDERLINE=5,VerbosityLevel={ERRORS:0,WARNINGS:1,INFOS:5},OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let verbosity=VerbosityLevel.WARNINGS;function setVerbosityLevel(level){Number.isInteger(level)&&(verbosity=level)}function getVerbosityLevel(){return verbosity}function info(msg){verbosity>=VerbosityLevel.INFOS&&console.log(`Info: ${msg}`)}function warn(msg){verbosity>=VerbosityLevel.WARNINGS&&console.log(`Warning: ${msg}`)}function unreachable(msg){throw new Error(msg)}function assert(cond,msg){cond||unreachable(msg)}function createValidAbsoluteUrl(url,baseUrl=null,options=null){if(!url)return null;try{if(options&&"string"==typeof url){if(options.addDefaultProtocol&&url.startsWith("www.")){const dots=url.match(/\./g);dots?.length>=2&&(url=`http://${url}`)}if(options.tryConvertEncoding)try{url=function stringToUTF8String(str){return decodeURIComponent(escape(str))}(url)}catch{}}const absoluteUrl=baseUrl?new URL(url,baseUrl):new URL(url);if(function _isValidProtocol(url){switch(url?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(absoluteUrl))return absoluteUrl}catch{}return null}function shadow(obj,prop,value,nonSerializable=!1){return Object.defineProperty(obj,prop,{value,enumerable:!nonSerializable,configurable:!0,writable:!1}),value}const BaseException=function BaseExceptionClosure(){function BaseException(message,name){this.message=message,this.name=name}return BaseException.prototype=new Error,BaseException.constructor=BaseException,BaseException}();class PasswordException extends BaseException{constructor(msg,code){super(msg,"PasswordException"),this.code=code}}class UnknownErrorException extends BaseException{constructor(msg,details){super(msg,"UnknownErrorException"),this.details=details}}class InvalidPDFException extends BaseException{constructor(msg){super(msg,"InvalidPDFException")}}class MissingPDFException extends BaseException{constructor(msg){super(msg,"MissingPDFException")}}class UnexpectedResponseException extends BaseException{constructor(msg,status){super(msg,"UnexpectedResponseException"),this.status=status}}class FormatError extends BaseException{constructor(msg){super(msg,"FormatError")}}class AbortException extends BaseException{constructor(msg){super(msg,"AbortException")}}function bytesToString(bytes){"object"==typeof bytes&&void 0!==bytes?.length||unreachable("Invalid argument for bytesToString");const length=bytes.length;if(length<8192)return String.fromCharCode.apply(null,bytes);const strBuf=[];for(let i=0;i<length;i+=8192){const chunkEnd=Math.min(i+8192,length),chunk=bytes.subarray(i,chunkEnd);strBuf.push(String.fromCharCode.apply(null,chunk))}return strBuf.join("")}function stringToBytes(str){"string"!=typeof str&&unreachable("Invalid argument for stringToBytes");const length=str.length,bytes=new Uint8Array(length);for(let i=0;i<length;++i)bytes[i]=255&str.charCodeAt(i);return bytes}function objectFromMap(map){const obj=Object.create(null);for(const[key,value]of map)obj[key]=value;return obj}class util_FeatureTest{static get isLittleEndian(){return shadow(this,"isLittleEndian",function isLittleEndian(){const buffer8=new Uint8Array(4);return buffer8[0]=1,1===new Uint32Array(buffer8.buffer,0,1)[0]}())}static get isEvalSupported(){return shadow(this,"isEvalSupported",function isEvalSupported(){try{return new Function(""),!0}catch{return!1}}())}static get isOffscreenCanvasSupported(){return shadow(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}static get platform(){return"undefined"!=typeof navigator&&"string"==typeof navigator?.platform?shadow(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:"string"==typeof navigator?.userAgent&&navigator.userAgent.includes("Firefox")}):shadow(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){return shadow(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const hexNumbers=Array.from(Array(256).keys(),(n=>n.toString(16).padStart(2,"0")));class Util{static makeHexColor(r,g,b){return`#${hexNumbers[r]}${hexNumbers[g]}${hexNumbers[b]}`}static scaleMinMax(transform,minMax){let temp;transform[0]?(transform[0]<0&&(temp=minMax[0],minMax[0]=minMax[2],minMax[2]=temp),minMax[0]*=transform[0],minMax[2]*=transform[0],transform[3]<0&&(temp=minMax[1],minMax[1]=minMax[3],minMax[3]=temp),minMax[1]*=transform[3],minMax[3]*=transform[3]):(temp=minMax[0],minMax[0]=minMax[1],minMax[1]=temp,temp=minMax[2],minMax[2]=minMax[3],minMax[3]=temp,transform[1]<0&&(temp=minMax[1],minMax[1]=minMax[3],minMax[3]=temp),minMax[1]*=transform[1],minMax[3]*=transform[1],transform[2]<0&&(temp=minMax[0],minMax[0]=minMax[2],minMax[2]=temp),minMax[0]*=transform[2],minMax[2]*=transform[2]),minMax[0]+=transform[4],minMax[1]+=transform[5],minMax[2]+=transform[4],minMax[3]+=transform[5]}static transform(m1,m2){return[m1[0]*m2[0]+m1[2]*m2[1],m1[1]*m2[0]+m1[3]*m2[1],m1[0]*m2[2]+m1[2]*m2[3],m1[1]*m2[2]+m1[3]*m2[3],m1[0]*m2[4]+m1[2]*m2[5]+m1[4],m1[1]*m2[4]+m1[3]*m2[5]+m1[5]]}static applyTransform(p,m){return[p[0]*m[0]+p[1]*m[2]+m[4],p[0]*m[1]+p[1]*m[3]+m[5]]}static applyInverseTransform(p,m){const d=m[0]*m[3]-m[1]*m[2];return[(p[0]*m[3]-p[1]*m[2]+m[2]*m[5]-m[4]*m[3])/d,(-p[0]*m[1]+p[1]*m[0]+m[4]*m[1]-m[5]*m[0])/d]}static getAxialAlignedBoundingBox(r,m){const p1=this.applyTransform(r,m),p2=this.applyTransform(r.slice(2,4),m),p3=this.applyTransform([r[0],r[3]],m),p4=this.applyTransform([r[2],r[1]],m);return[Math.min(p1[0],p2[0],p3[0],p4[0]),Math.min(p1[1],p2[1],p3[1],p4[1]),Math.max(p1[0],p2[0],p3[0],p4[0]),Math.max(p1[1],p2[1],p3[1],p4[1])]}static inverseTransform(m){const d=m[0]*m[3]-m[1]*m[2];return[m[3]/d,-m[1]/d,-m[2]/d,m[0]/d,(m[2]*m[5]-m[4]*m[3])/d,(m[4]*m[1]-m[5]*m[0])/d]}static singularValueDecompose2dScale(m){const transpose=[m[0],m[2],m[1],m[3]],a=m[0]*transpose[0]+m[1]*transpose[2],b=m[0]*transpose[1]+m[1]*transpose[3],c=m[2]*transpose[0]+m[3]*transpose[2],d=m[2]*transpose[1]+m[3]*transpose[3],first=(a+d)/2,second=Math.sqrt((a+d)**2-4*(a*d-c*b))/2,sx=first+second||1,sy=first-second||1;return[Math.sqrt(sx),Math.sqrt(sy)]}static normalizeRect(rect){const r=rect.slice(0);return rect[0]>rect[2]&&(r[0]=rect[2],r[2]=rect[0]),rect[1]>rect[3]&&(r[1]=rect[3],r[3]=rect[1]),r}static intersect(rect1,rect2){const xLow=Math.max(Math.min(rect1[0],rect1[2]),Math.min(rect2[0],rect2[2])),xHigh=Math.min(Math.max(rect1[0],rect1[2]),Math.max(rect2[0],rect2[2]));if(xLow>xHigh)return null;const yLow=Math.max(Math.min(rect1[1],rect1[3]),Math.min(rect2[1],rect2[3])),yHigh=Math.min(Math.max(rect1[1],rect1[3]),Math.max(rect2[1],rect2[3]));return yLow>yHigh?null:[xLow,yLow,xHigh,yHigh]}static#getExtremumOnCurve(x0,x1,x2,x3,y0,y1,y2,y3,t,minMax){if(t<=0||t>=1)return;const mt=1-t,tt=t*t,ttt=tt*t,x=mt*(mt*(mt*x0+3*t*x1)+3*tt*x2)+ttt*x3,y=mt*(mt*(mt*y0+3*t*y1)+3*tt*y2)+ttt*y3;minMax[0]=Math.min(minMax[0],x),minMax[1]=Math.min(minMax[1],y),minMax[2]=Math.max(minMax[2],x),minMax[3]=Math.max(minMax[3],y)}static#getExtremum(x0,x1,x2,x3,y0,y1,y2,y3,a,b,c,minMax){if(Math.abs(a)<1e-12)return void(Math.abs(b)>=1e-12&&this.#getExtremumOnCurve(x0,x1,x2,x3,y0,y1,y2,y3,-c/b,minMax));const delta=b**2-4*c*a;if(delta<0)return;const sqrtDelta=Math.sqrt(delta),a2=2*a;this.#getExtremumOnCurve(x0,x1,x2,x3,y0,y1,y2,y3,(-b+sqrtDelta)/a2,minMax),this.#getExtremumOnCurve(x0,x1,x2,x3,y0,y1,y2,y3,(-b-sqrtDelta)/a2,minMax)}static bezierBoundingBox(x0,y0,x1,y1,x2,y2,x3,y3,minMax){return minMax?(minMax[0]=Math.min(minMax[0],x0,x3),minMax[1]=Math.min(minMax[1],y0,y3),minMax[2]=Math.max(minMax[2],x0,x3),minMax[3]=Math.max(minMax[3],y0,y3)):minMax=[Math.min(x0,x3),Math.min(y0,y3),Math.max(x0,x3),Math.max(y0,y3)],this.#getExtremum(x0,x1,x2,x3,y0,y1,y2,y3,3*(3*(x1-x2)-x0+x3),6*(x0-2*x1+x2),3*(x1-x0),minMax),this.#getExtremum(x0,x1,x2,x3,y0,y1,y2,y3,3*(3*(y1-y2)-y0+y3),6*(y0-2*y1+y2),3*(y1-y0),minMax),minMax}}let NormalizeRegex=null,NormalizationMap=null;function normalizeUnicode(str){return NormalizeRegex||(NormalizeRegex=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,NormalizationMap=new Map([["ﬅ","ſt"]])),str.replaceAll(NormalizeRegex,((_,p1,p2)=>p1?p1.normalize("NFKC"):NormalizationMap.get(p2)))}const FontRenderOps_BEZIER_CURVE_TO=0,FontRenderOps_MOVE_TO=1,FontRenderOps_LINE_TO=2,FontRenderOps_QUADRATIC_CURVE_TO=3,FontRenderOps_RESTORE=4,FontRenderOps_SAVE=5,FontRenderOps_SCALE=6,FontRenderOps_TRANSFORM=7,FontRenderOps_TRANSLATE=8;const SVG_NS="http://www.w3.org/2000/svg";class PixelsPerInch{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}function fetchData(_x){return _fetchData.apply(this,arguments)}function _fetchData(){return(_fetchData=(0,asyncToGenerator.A)((function*(url,type="text"){if(isValidFetchUrl(url,document.baseURI)){const response=yield fetch(url);if(!response.ok)throw new Error(response.statusText);switch(type){case"arraybuffer":return response.arrayBuffer();case"blob":return response.blob();case"json":return response.json()}return response.text()}return new Promise(((resolve,reject)=>{const request=new XMLHttpRequest;request.open("GET",url,!0),request.responseType=type,request.onreadystatechange=()=>{if(request.readyState===XMLHttpRequest.DONE)if(200!==request.status&&0!==request.status)reject(new Error(request.statusText));else{switch(type){case"arraybuffer":case"blob":case"json":return void resolve(request.response)}resolve(request.responseText)}},request.send(null)}))}))).apply(this,arguments)}class PageViewport{constructor({viewBox,scale,rotation,offsetX=0,offsetY=0,dontFlip=!1}){this.viewBox=viewBox,this.scale=scale,this.rotation=rotation,this.offsetX=offsetX,this.offsetY=offsetY;const centerX=(viewBox[2]+viewBox[0])/2,centerY=(viewBox[3]+viewBox[1])/2;let rotateA,rotateB,rotateC,rotateD,offsetCanvasX,offsetCanvasY,width,height;switch((rotation%=360)<0&&(rotation+=360),rotation){case 180:rotateA=-1,rotateB=0,rotateC=0,rotateD=1;break;case 90:rotateA=0,rotateB=1,rotateC=1,rotateD=0;break;case 270:rotateA=0,rotateB=-1,rotateC=-1,rotateD=0;break;case 0:rotateA=1,rotateB=0,rotateC=0,rotateD=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}dontFlip&&(rotateC=-rotateC,rotateD=-rotateD),0===rotateA?(offsetCanvasX=Math.abs(centerY-viewBox[1])*scale+offsetX,offsetCanvasY=Math.abs(centerX-viewBox[0])*scale+offsetY,width=(viewBox[3]-viewBox[1])*scale,height=(viewBox[2]-viewBox[0])*scale):(offsetCanvasX=Math.abs(centerX-viewBox[0])*scale+offsetX,offsetCanvasY=Math.abs(centerY-viewBox[1])*scale+offsetY,width=(viewBox[2]-viewBox[0])*scale,height=(viewBox[3]-viewBox[1])*scale),this.transform=[rotateA*scale,rotateB*scale,rotateC*scale,rotateD*scale,offsetCanvasX-rotateA*scale*centerX-rotateC*scale*centerY,offsetCanvasY-rotateB*scale*centerX-rotateD*scale*centerY],this.width=width,this.height=height}get rawDims(){const{viewBox}=this;return shadow(this,"rawDims",{pageWidth:viewBox[2]-viewBox[0],pageHeight:viewBox[3]-viewBox[1],pageX:viewBox[0],pageY:viewBox[1]})}clone({scale=this.scale,rotation=this.rotation,offsetX=this.offsetX,offsetY=this.offsetY,dontFlip=!1}={}){return new PageViewport({viewBox:this.viewBox.slice(),scale,rotation,offsetX,offsetY,dontFlip})}convertToViewportPoint(x,y){return Util.applyTransform([x,y],this.transform)}convertToViewportRectangle(rect){const topLeft=Util.applyTransform([rect[0],rect[1]],this.transform),bottomRight=Util.applyTransform([rect[2],rect[3]],this.transform);return[topLeft[0],topLeft[1],bottomRight[0],bottomRight[1]]}convertToPdfPoint(x,y){return Util.applyInverseTransform([x,y],this.transform)}}class RenderingCancelledException extends BaseException{constructor(msg,extraDelay=0){super(msg,"RenderingCancelledException"),this.extraDelay=extraDelay}}function isDataScheme(url){const ii=url.length;let i=0;for(;i<ii&&""===url[i].trim();)i++;return"data:"===url.substring(i,i+5).toLowerCase()}function isPdfFile(filename){return"string"==typeof filename&&/\.pdf$/i.test(filename)}function getFilenameFromUrl(url){return[url]=url.split(/[#?]/,1),url.substring(url.lastIndexOf("/")+1)}function getPdfFilenameFromUrl(url,defaultFilename="document.pdf"){if("string"!=typeof url)return defaultFilename;if(isDataScheme(url))return warn('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),defaultFilename;const reFilename=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,splitURI=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(url);let suggestedFilename=reFilename.exec(splitURI[1])||reFilename.exec(splitURI[2])||reFilename.exec(splitURI[3]);if(suggestedFilename&&(suggestedFilename=suggestedFilename[0],suggestedFilename.includes("%")))try{suggestedFilename=reFilename.exec(decodeURIComponent(suggestedFilename))[0]}catch{}return suggestedFilename||defaultFilename}class StatTimer{started=Object.create(null);times=[];time(name){name in this.started&&warn(`Timer is already running for ${name}`),this.started[name]=Date.now()}timeEnd(name){name in this.started||warn(`Timer has not been started for ${name}`),this.times.push({name,start:this.started[name],end:Date.now()}),delete this.started[name]}toString(){const outBuf=[];let longest=0;for(const{name}of this.times)longest=Math.max(name.length,longest);for(const{name,start,end}of this.times)outBuf.push(`${name.padEnd(longest)} ${end-start}ms\n`);return outBuf.join("")}}function isValidFetchUrl(url,baseUrl){try{const{protocol}=baseUrl?new URL(url,baseUrl):new URL(url);return"http:"===protocol||"https:"===protocol}catch{return!1}}function noContextMenu(e){e.preventDefault()}function deprecated(details){console.log("Deprecated API usage: "+details)}class PDFDateString{static#regex;static toDateObject(input){if(!input||"string"!=typeof input)return null;this.#regex||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const matches=this.#regex.exec(input);if(!matches)return null;const year=parseInt(matches[1],10);let month=parseInt(matches[2],10);month=month>=1&&month<=12?month-1:0;let day=parseInt(matches[3],10);day=day>=1&&day<=31?day:1;let hour=parseInt(matches[4],10);hour=hour>=0&&hour<=23?hour:0;let minute=parseInt(matches[5],10);minute=minute>=0&&minute<=59?minute:0;let second=parseInt(matches[6],10);second=second>=0&&second<=59?second:0;const universalTimeRelation=matches[7]||"Z";let offsetHour=parseInt(matches[8],10);offsetHour=offsetHour>=0&&offsetHour<=23?offsetHour:0;let offsetMinute=parseInt(matches[9],10)||0;return offsetMinute=offsetMinute>=0&&offsetMinute<=59?offsetMinute:0,"-"===universalTimeRelation?(hour+=offsetHour,minute+=offsetMinute):"+"===universalTimeRelation&&(hour-=offsetHour,minute-=offsetMinute),new Date(Date.UTC(year,month,day,hour,minute,second))}}function getXfaPageViewport(xfaPage,{scale=1,rotation=0}){const{width,height}=xfaPage.attributes.style,viewBox=[0,0,parseInt(width),parseInt(height)];return new PageViewport({viewBox,scale,rotation})}function getRGB(color){if(color.startsWith("#")){const colorRGB=parseInt(color.slice(1),16);return[(16711680&colorRGB)>>16,(65280&colorRGB)>>8,255&colorRGB]}return color.startsWith("rgb(")?color.slice(4,-1).split(",").map((x=>parseInt(x))):color.startsWith("rgba(")?color.slice(5,-1).split(",").map((x=>parseInt(x))).slice(0,3):(warn(`Not a valid color format: "${color}"`),[0,0,0])}function getCurrentTransform(ctx){const{a,b,c,d,e,f}=ctx.getTransform();return[a,b,c,d,e,f]}function getCurrentTransformInverse(ctx){const{a,b,c,d,e,f}=ctx.getTransform().invertSelf();return[a,b,c,d,e,f]}function setLayerDimensions(div,viewport,mustFlip=!1,mustRotate=!0){if(viewport instanceof PageViewport){const{pageWidth,pageHeight}=viewport.rawDims,{style}=div,useRound=util_FeatureTest.isCSSRoundSupported,w=`var(--scale-factor) * ${pageWidth}px`,h=`var(--scale-factor) * ${pageHeight}px`,widthStr=useRound?`round(down, ${w}, var(--scale-round-x, 1px))`:`calc(${w})`,heightStr=useRound?`round(down, ${h}, var(--scale-round-y, 1px))`:`calc(${h})`;mustFlip&&viewport.rotation%180!=0?(style.width=heightStr,style.height=widthStr):(style.width=widthStr,style.height=heightStr)}mustRotate&&div.setAttribute("data-main-rotation",viewport.rotation)}class OutputScale{constructor(){const pixelRatio=window.devicePixelRatio||1;this.sx=pixelRatio,this.sy=pixelRatio}get scaled(){return 1!==this.sx||1!==this.sy}get symmetric(){return this.sx===this.sy}}class EditorToolbar{#toolbar=null;#colorPicker=null;#editor;#buttons=null;#altText=null;static#l10nRemove=null;constructor(editor){this.#editor=editor,EditorToolbar.#l10nRemove||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"})}render(){const editToolbar=this.#toolbar=document.createElement("div");editToolbar.classList.add("editToolbar","hidden"),editToolbar.setAttribute("role","toolbar");const signal=this.#editor._uiManager._signal;editToolbar.addEventListener("contextmenu",noContextMenu,{signal}),editToolbar.addEventListener("pointerdown",EditorToolbar.#pointerDown,{signal});const buttons=this.#buttons=document.createElement("div");buttons.className="buttons",editToolbar.append(buttons);const position=this.#editor.toolbarPosition;if(position){const{style}=editToolbar,x="ltr"===this.#editor._uiManager.direction?1-position[0]:position[0];style.insetInlineEnd=100*x+"%",style.top=`calc(${100*position[1]}% + var(--editor-toolbar-vert-offset))`}return this.#addDeleteButton(),editToolbar}get div(){return this.#toolbar}static#pointerDown(e){e.stopPropagation()}#focusIn(e){this.#editor._focusEventsAllowed=!1,e.preventDefault(),e.stopPropagation()}#focusOut(e){this.#editor._focusEventsAllowed=!0,e.preventDefault(),e.stopPropagation()}#addListenersToElement(element){const signal=this.#editor._uiManager._signal;element.addEventListener("focusin",this.#focusIn.bind(this),{capture:!0,signal}),element.addEventListener("focusout",this.#focusOut.bind(this),{capture:!0,signal}),element.addEventListener("contextmenu",noContextMenu,{signal})}hide(){this.#toolbar.classList.add("hidden"),this.#colorPicker?.hideDropdown()}show(){this.#toolbar.classList.remove("hidden"),this.#altText?.shown()}#addDeleteButton(){const{editorType,_uiManager}=this.#editor,button=document.createElement("button");button.className="delete",button.tabIndex=0,button.setAttribute("data-l10n-id",EditorToolbar.#l10nRemove[editorType]),this.#addListenersToElement(button),button.addEventListener("click",(e=>{_uiManager.delete()}),{signal:_uiManager._signal}),this.#buttons.append(button)}get#divider(){const divider=document.createElement("div");return divider.className="divider",divider}addAltText(altText){var _this=this;return(0,asyncToGenerator.A)((function*(){const button=yield altText.render();_this.#addListenersToElement(button),_this.#buttons.prepend(button,_this.#divider),_this.#altText=altText}))()}addColorPicker(colorPicker){this.#colorPicker=colorPicker;const button=colorPicker.renderButton();this.#addListenersToElement(button),this.#buttons.prepend(button,this.#divider)}remove(){this.#toolbar.remove(),this.#colorPicker?.destroy(),this.#colorPicker=null}}class HighlightToolbar{#buttons=null;#toolbar=null;#uiManager;constructor(uiManager){this.#uiManager=uiManager}#render(){const editToolbar=this.#toolbar=document.createElement("div");editToolbar.className="editToolbar",editToolbar.setAttribute("role","toolbar"),editToolbar.addEventListener("contextmenu",noContextMenu,{signal:this.#uiManager._signal});const buttons=this.#buttons=document.createElement("div");return buttons.className="buttons",editToolbar.append(buttons),this.#addHighlightButton(),editToolbar}#getLastPoint(boxes,isLTR){let lastY=0,lastX=0;for(const box of boxes){const y=box.y+box.height;if(y<lastY)continue;const x=box.x+(isLTR?box.width:0);y>lastY?(lastX=x,lastY=y):isLTR?x>lastX&&(lastX=x):x<lastX&&(lastX=x)}return[isLTR?1-lastX:lastX,lastY]}show(parent,boxes,isLTR){const[x,y]=this.#getLastPoint(boxes,isLTR),{style}=this.#toolbar||=this.#render();parent.append(this.#toolbar),style.insetInlineEnd=100*x+"%",style.top=`calc(${100*y}% + var(--editor-toolbar-vert-offset))`}hide(){this.#toolbar.remove()}#addHighlightButton(){const button=document.createElement("button");button.className="highlightButton",button.tabIndex=0,button.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const span=document.createElement("span");button.append(span),span.className="visuallyHidden",span.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const signal=this.#uiManager._signal;button.addEventListener("contextmenu",noContextMenu,{signal}),button.addEventListener("click",(()=>{this.#uiManager.highlightSelection("floating_button")}),{signal}),this.#buttons.append(button)}}function bindEvents(obj,element,names){for(const name of names)element.addEventListener(name,obj[name].bind(obj))}class IdManager{#id=0;get id(){return"pdfjs_internal_editor_"+this.#id++}}class ImageManager{#baseId=function getUuid(){if("undefined"!=typeof crypto&&"function"==typeof crypto?.randomUUID)return crypto.randomUUID();const buf=new Uint8Array(32);if("undefined"!=typeof crypto&&"function"==typeof crypto?.getRandomValues)crypto.getRandomValues(buf);else for(let i=0;i<32;i++)buf[i]=Math.floor(255*Math.random());return bytesToString(buf)}();#id=0;#cache=null;static get _isSVGFittingCanvas(){const ctx=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),image=new Image;image.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>';return shadow(this,"_isSVGFittingCanvas",image.decode().then((()=>(ctx.drawImage(image,0,0,1,1,0,0,1,3),0===new Uint32Array(ctx.getImageData(0,0,1,1).data.buffer)[0]))))}#get(key,rawData){var _this2=this;return(0,asyncToGenerator.A)((function*(){_this2.#cache||=new Map;let data=_this2.#cache.get(key);if(null===data)return null;if(data?.bitmap)return data.refCounter+=1,data;try{let image;if(data||={bitmap:null,id:`image_${_this2.#baseId}_${_this2.#id++}`,refCounter:0,isSvg:!1},"string"==typeof rawData?(data.url=rawData,image=yield fetchData(rawData,"blob")):rawData instanceof File?image=data.file=rawData:rawData instanceof Blob&&(image=rawData),"image/svg+xml"===image.type){const mustRemoveAspectRatioPromise=ImageManager._isSVGFittingCanvas,fileReader=new FileReader,imageElement=new Image,imagePromise=new Promise(((resolve,reject)=>{imageElement.onload=()=>{data.bitmap=imageElement,data.isSvg=!0,resolve()},fileReader.onload=(0,asyncToGenerator.A)((function*(){const url=data.svgUrl=fileReader.result;imageElement.src=(yield mustRemoveAspectRatioPromise)?`${url}#svgView(preserveAspectRatio(none))`:url})),imageElement.onerror=fileReader.onerror=reject}));fileReader.readAsDataURL(image),yield imagePromise}else data.bitmap=yield createImageBitmap(image);data.refCounter=1}catch(e){console.error(e),data=null}return _this2.#cache.set(key,data),data&&_this2.#cache.set(data.id,data),data}))()}getFromFile(file){var _this3=this;return(0,asyncToGenerator.A)((function*(){const{lastModified,name,size,type}=file;return _this3.#get(`${lastModified}_${name}_${size}_${type}`,file)}))()}getFromUrl(url){var _this4=this;return(0,asyncToGenerator.A)((function*(){return _this4.#get(url,url)}))()}getFromBlob(id,blobPromise){var _this5=this;return(0,asyncToGenerator.A)((function*(){const blob=yield blobPromise;return _this5.#get(id,blob)}))()}getFromId(id){var _this6=this;return(0,asyncToGenerator.A)((function*(){_this6.#cache||=new Map;const data=_this6.#cache.get(id);if(!data)return null;if(data.bitmap)return data.refCounter+=1,data;if(data.file)return _this6.getFromFile(data.file);if(data.blobPromise){const{blobPromise}=data;return delete data.blobPromise,_this6.getFromBlob(data.id,blobPromise)}return _this6.getFromUrl(data.url)}))()}getFromCanvas(id,canvas){this.#cache||=new Map;let data=this.#cache.get(id);if(data?.bitmap)return data.refCounter+=1,data;const offscreen=new OffscreenCanvas(canvas.width,canvas.height);return offscreen.getContext("2d").drawImage(canvas,0,0),data={bitmap:offscreen.transferToImageBitmap(),id:`image_${this.#baseId}_${this.#id++}`,refCounter:1,isSvg:!1},this.#cache.set(id,data),this.#cache.set(data.id,data),data}getSvgUrl(id){const data=this.#cache.get(id);return data?.isSvg?data.svgUrl:null}deleteId(id){this.#cache||=new Map;const data=this.#cache.get(id);if(!data)return;if(data.refCounter-=1,0!==data.refCounter)return;const{bitmap}=data;if(!data.url&&!data.file){const canvas=new OffscreenCanvas(bitmap.width,bitmap.height);canvas.getContext("bitmaprenderer").transferFromImageBitmap(bitmap),data.blobPromise=canvas.convertToBlob()}bitmap.close?.(),data.bitmap=null}isValidId(id){return id.startsWith(`image_${this.#baseId}_`)}}class CommandManager{#commands=[];#locked=!1;#maxSize;#position=-1;constructor(maxSize=128){this.#maxSize=maxSize}add({cmd,undo,post,mustExec,type=NaN,overwriteIfSameType=!1,keepUndo=!1}){if(mustExec&&cmd(),this.#locked)return;const save={cmd,undo,post,type};if(-1===this.#position)return this.#commands.length>0&&(this.#commands.length=0),this.#position=0,void this.#commands.push(save);if(overwriteIfSameType&&this.#commands[this.#position].type===type)return keepUndo&&(save.undo=this.#commands[this.#position].undo),void(this.#commands[this.#position]=save);const next=this.#position+1;next===this.#maxSize?this.#commands.splice(0,1):(this.#position=next,next<this.#commands.length&&this.#commands.splice(next)),this.#commands.push(save)}undo(){if(-1===this.#position)return;this.#locked=!0;const{undo,post}=this.#commands[this.#position];undo(),post?.(),this.#locked=!1,this.#position-=1}redo(){if(this.#position<this.#commands.length-1){this.#position+=1,this.#locked=!0;const{cmd,post}=this.#commands[this.#position];cmd(),post?.(),this.#locked=!1}}hasSomethingToUndo(){return-1!==this.#position}hasSomethingToRedo(){return this.#position<this.#commands.length-1}destroy(){this.#commands=null}}class KeyboardManager{constructor(callbacks){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac}=util_FeatureTest.platform;for(const[keys,callback,options={}]of callbacks)for(const key of keys){const isMacKey=key.startsWith("mac+");isMac&&isMacKey?(this.callbacks.set(key.slice(4),{callback,options}),this.allKeys.add(key.split("+").at(-1))):isMac||isMacKey||(this.callbacks.set(key,{callback,options}),this.allKeys.add(key.split("+").at(-1)))}}#serialize(event){event.altKey&&this.buffer.push("alt"),event.ctrlKey&&this.buffer.push("ctrl"),event.metaKey&&this.buffer.push("meta"),event.shiftKey&&this.buffer.push("shift"),this.buffer.push(event.key);const str=this.buffer.join("+");return this.buffer.length=0,str}exec(self,event){if(!this.allKeys.has(event.key))return;const info=this.callbacks.get(this.#serialize(event));if(!info)return;const{callback,options:{bubbles=!1,args=[],checker=null}}=info;checker&&!checker(self,event)||(callback.bind(self,...args,event)(),bubbles||(event.stopPropagation(),event.preventDefault()))}}class ColorManager{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const colors=new Map([["CanvasText",null],["Canvas",null]]);return function getColorValues(colors){const span=document.createElement("span");span.style.visibility="hidden",document.body.append(span);for(const name of colors.keys()){span.style.color=name;const computedColor=window.getComputedStyle(span).color;colors.set(name,getRGB(computedColor))}span.remove()}(colors),shadow(this,"_colors",colors)}convert(color){const rgb=getRGB(color);if(!window.matchMedia("(forced-colors: active)").matches)return rgb;for(const[name,RGB]of this._colors)if(RGB.every(((x,i)=>x===rgb[i])))return ColorManager._colorsMapping.get(name);return rgb}getHexCode(name){const rgb=this._colors.get(name);return rgb?Util.makeHexColor(...rgb):name}}class AnnotationEditorUIManager{#abortController=new AbortController;#activeEditor=null;#allEditors=new Map;#allLayers=new Map;#altTextManager=null;#annotationStorage=null;#changedExistingAnnotations=null;#commandManager=new CommandManager;#copyPasteAC=null;#currentPageIndex=0;#deletedAnnotationsElementIds=new Set;#draggingEditors=null;#editorTypes=null;#editorsToRescale=new Set;#enableHighlightFloatingButton=!1;#enableUpdatedAddImage=!1;#enableNewAltTextWhenAddingImage=!1;#filterFactory=null;#focusMainContainerTimeoutId=null;#focusManagerAC=null;#highlightColors=null;#highlightWhenShiftUp=!1;#highlightToolbar=null;#idManager=new IdManager;#isEnabled=!1;#isWaiting=!1;#keyboardManagerAC=null;#lastActiveElement=null;#mainHighlightColorPicker=null;#mlManager=null;#mode=AnnotationEditorType.NONE;#selectedEditors=new Set;#selectedTextNode=null;#pageColors=null;#showAllStates=null;#previousStates={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#translation=[0,0];#translationTimeoutId=null;#container=null;#viewer=null;#updateModeCapability=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const proto=AnnotationEditorUIManager.prototype,arrowChecker=self=>self.#container.contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&self.hasSomethingToControl(),textInputChecker=(_self,{target:el})=>{if(el instanceof HTMLInputElement){const{type}=el;return"text"!==type&&"number"!==type}return!0},small=this.TRANSLATE_SMALL,big=this.TRANSLATE_BIG;return shadow(this,"_keyboardManager",new KeyboardManager([[["ctrl+a","mac+meta+a"],proto.selectAll,{checker:textInputChecker}],[["ctrl+z","mac+meta+z"],proto.undo,{checker:textInputChecker}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],proto.redo,{checker:textInputChecker}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],proto.delete,{checker:textInputChecker}],[["Enter","mac+Enter"],proto.addNewEditorFromKeyboard,{checker:(self,{target:el})=>!(el instanceof HTMLButtonElement)&&self.#container.contains(el)&&!self.isEnterHandled}],[[" ","mac+ "],proto.addNewEditorFromKeyboard,{checker:(self,{target:el})=>!(el instanceof HTMLButtonElement)&&self.#container.contains(document.activeElement)}],[["Escape","mac+Escape"],proto.unselectAll],[["ArrowLeft","mac+ArrowLeft"],proto.translateSelectedEditors,{args:[-small,0],checker:arrowChecker}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],proto.translateSelectedEditors,{args:[-big,0],checker:arrowChecker}],[["ArrowRight","mac+ArrowRight"],proto.translateSelectedEditors,{args:[small,0],checker:arrowChecker}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],proto.translateSelectedEditors,{args:[big,0],checker:arrowChecker}],[["ArrowUp","mac+ArrowUp"],proto.translateSelectedEditors,{args:[0,-small],checker:arrowChecker}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],proto.translateSelectedEditors,{args:[0,-big],checker:arrowChecker}],[["ArrowDown","mac+ArrowDown"],proto.translateSelectedEditors,{args:[0,small],checker:arrowChecker}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],proto.translateSelectedEditors,{args:[0,big],checker:arrowChecker}]]))}constructor(container,viewer,altTextManager,eventBus,pdfDocument,pageColors,highlightColors,enableHighlightFloatingButton,enableUpdatedAddImage,enableNewAltTextWhenAddingImage,mlManager){const signal=this._signal=this.#abortController.signal;this.#container=container,this.#viewer=viewer,this.#altTextManager=altTextManager,this._eventBus=eventBus,eventBus._on("editingaction",this.onEditingAction.bind(this),{signal}),eventBus._on("pagechanging",this.onPageChanging.bind(this),{signal}),eventBus._on("scalechanging",this.onScaleChanging.bind(this),{signal}),eventBus._on("rotationchanging",this.onRotationChanging.bind(this),{signal}),eventBus._on("setpreference",this.onSetPreference.bind(this),{signal}),eventBus._on("switchannotationeditorparams",(evt=>this.updateParams(evt.type,evt.value)),{signal}),this.#addSelectionListener(),this.#addDragAndDropListeners(),this.#addKeyboardManager(),this.#annotationStorage=pdfDocument.annotationStorage,this.#filterFactory=pdfDocument.filterFactory,this.#pageColors=pageColors,this.#highlightColors=highlightColors||null,this.#enableHighlightFloatingButton=enableHighlightFloatingButton,this.#enableUpdatedAddImage=enableUpdatedAddImage,this.#enableNewAltTextWhenAddingImage=enableNewAltTextWhenAddingImage,this.#mlManager=mlManager||null,this.viewParameters={realScale:PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}destroy(){this.#updateModeCapability?.resolve(),this.#updateModeCapability=null,this.#abortController?.abort(),this.#abortController=null,this._signal=null;for(const layer of this.#allLayers.values())layer.destroy();this.#allLayers.clear(),this.#allEditors.clear(),this.#editorsToRescale.clear(),this.#activeEditor=null,this.#selectedEditors.clear(),this.#commandManager.destroy(),this.#altTextManager?.destroy(),this.#highlightToolbar?.hide(),this.#highlightToolbar=null,this.#focusMainContainerTimeoutId&&(clearTimeout(this.#focusMainContainerTimeoutId),this.#focusMainContainerTimeoutId=null),this.#translationTimeoutId&&(clearTimeout(this.#translationTimeoutId),this.#translationTimeoutId=null)}combinedSignal(ac){return AbortSignal.any([this._signal,ac.signal])}get mlManager(){return this.#mlManager}get useNewAltTextFlow(){return this.#enableUpdatedAddImage}get useNewAltTextWhenAddingImage(){return this.#enableNewAltTextWhenAddingImage}get hcmFilter(){return shadow(this,"hcmFilter",this.#pageColors?this.#filterFactory.addHCMFilter(this.#pageColors.foreground,this.#pageColors.background):"none")}get direction(){return shadow(this,"direction",getComputedStyle(this.#container).direction)}get highlightColors(){return shadow(this,"highlightColors",this.#highlightColors?new Map(this.#highlightColors.split(",").map((pair=>pair.split("=").map((x=>x.trim()))))):null)}get highlightColorNames(){return shadow(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,(e=>e.reverse()))):null)}setMainHighlightColorPicker(colorPicker){this.#mainHighlightColorPicker=colorPicker}editAltText(editor,firstTime=!1){this.#altTextManager?.editAltText(this,editor,firstTime)}switchToMode(mode,callback){this._eventBus.on("annotationeditormodechanged",callback,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode})}setPreference(name,value){this._eventBus.dispatch("setpreference",{source:this,name,value})}onSetPreference({name,value}){if("enableNewAltTextWhenAddingImage"===name)this.#enableNewAltTextWhenAddingImage=value}onPageChanging({pageNumber}){this.#currentPageIndex=pageNumber-1}focusMainContainer(){this.#container.focus()}findParent(x,y){for(const layer of this.#allLayers.values()){const{x:layerX,y:layerY,width,height}=layer.div.getBoundingClientRect();if(x>=layerX&&x<=layerX+width&&y>=layerY&&y<=layerY+height)return layer}return null}disableUserSelect(value=!1){this.#viewer.classList.toggle("noUserSelect",value)}addShouldRescale(editor){this.#editorsToRescale.add(editor)}removeShouldRescale(editor){this.#editorsToRescale.delete(editor)}onScaleChanging({scale}){this.commitOrRemove(),this.viewParameters.realScale=scale*PixelsPerInch.PDF_TO_CSS_UNITS;for(const editor of this.#editorsToRescale)editor.onScaleChanging()}onRotationChanging({pagesRotation}){this.commitOrRemove(),this.viewParameters.rotation=pagesRotation}#getAnchorElementForSelection({anchorNode}){return anchorNode.nodeType===Node.TEXT_NODE?anchorNode.parentElement:anchorNode}#getLayerForTextLayer(textLayer){const{currentLayer}=this;if(currentLayer.hasTextLayer(textLayer))return currentLayer;for(const layer of this.#allLayers.values())if(layer.hasTextLayer(textLayer))return layer;return null}highlightSelection(methodOfCreation=""){const selection=document.getSelection();if(!selection||selection.isCollapsed)return;const{anchorNode,anchorOffset,focusNode,focusOffset}=selection,text=selection.toString(),textLayer=this.#getAnchorElementForSelection(selection).closest(".textLayer"),boxes=this.getSelectionBoxes(textLayer);if(!boxes)return;selection.empty();const layer=this.#getLayerForTextLayer(textLayer),isNoneMode=this.#mode===AnnotationEditorType.NONE,callback=()=>{layer?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation,boxes,anchorNode,anchorOffset,focusNode,focusOffset,text}),isNoneMode&&this.showAllEditors("highlight",!0,!0)};isNoneMode?this.switchToMode(AnnotationEditorType.HIGHLIGHT,callback):callback()}#displayHighlightToolbar(){const selection=document.getSelection();if(!selection||selection.isCollapsed)return;const textLayer=this.#getAnchorElementForSelection(selection).closest(".textLayer"),boxes=this.getSelectionBoxes(textLayer);boxes&&(this.#highlightToolbar||=new HighlightToolbar(this),this.#highlightToolbar.show(textLayer,boxes,"ltr"===this.direction))}addToAnnotationStorage(editor){editor.isEmpty()||!this.#annotationStorage||this.#annotationStorage.has(editor.id)||this.#annotationStorage.setValue(editor.id,editor)}#selectionChange(){const selection=document.getSelection();if(!selection||selection.isCollapsed)return void(this.#selectedTextNode&&(this.#highlightToolbar?.hide(),this.#selectedTextNode=null,this.#dispatchUpdateStates({hasSelectedText:!1})));const{anchorNode}=selection;if(anchorNode===this.#selectedTextNode)return;const textLayer=this.#getAnchorElementForSelection(selection).closest(".textLayer");if(textLayer){if(this.#highlightToolbar?.hide(),this.#selectedTextNode=anchorNode,this.#dispatchUpdateStates({hasSelectedText:!0}),(this.#mode===AnnotationEditorType.HIGHLIGHT||this.#mode===AnnotationEditorType.NONE)&&(this.#mode===AnnotationEditorType.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#highlightWhenShiftUp=this.isShiftKeyDown,!this.isShiftKeyDown)){const activeLayer=this.#mode===AnnotationEditorType.HIGHLIGHT?this.#getLayerForTextLayer(textLayer):null;activeLayer?.toggleDrawing();const ac=new AbortController,signal=this.combinedSignal(ac),pointerup=e=>{"pointerup"===e.type&&0!==e.button||(ac.abort(),activeLayer?.toggleDrawing(!0),"pointerup"===e.type&&this.#onSelectEnd("main_toolbar"))};window.addEventListener("pointerup",pointerup,{signal}),window.addEventListener("blur",pointerup,{signal})}}else this.#selectedTextNode&&(this.#highlightToolbar?.hide(),this.#selectedTextNode=null,this.#dispatchUpdateStates({hasSelectedText:!1}))}#onSelectEnd(methodOfCreation=""){this.#mode===AnnotationEditorType.HIGHLIGHT?this.highlightSelection(methodOfCreation):this.#enableHighlightFloatingButton&&this.#displayHighlightToolbar()}#addSelectionListener(){document.addEventListener("selectionchange",this.#selectionChange.bind(this),{signal:this._signal})}#addFocusManager(){if(this.#focusManagerAC)return;this.#focusManagerAC=new AbortController;const signal=this.combinedSignal(this.#focusManagerAC);window.addEventListener("focus",this.focus.bind(this),{signal}),window.addEventListener("blur",this.blur.bind(this),{signal})}#removeFocusManager(){this.#focusManagerAC?.abort(),this.#focusManagerAC=null}blur(){if(this.isShiftKeyDown=!1,this.#highlightWhenShiftUp&&(this.#highlightWhenShiftUp=!1,this.#onSelectEnd("main_toolbar")),!this.hasSelection)return;const{activeElement}=document;for(const editor of this.#selectedEditors)if(editor.div.contains(activeElement)){this.#lastActiveElement=[editor,activeElement],editor._focusEventsAllowed=!1;break}}focus(){if(!this.#lastActiveElement)return;const[lastEditor,lastActiveElement]=this.#lastActiveElement;this.#lastActiveElement=null,lastActiveElement.addEventListener("focusin",(()=>{lastEditor._focusEventsAllowed=!0}),{once:!0,signal:this._signal}),lastActiveElement.focus()}#addKeyboardManager(){if(this.#keyboardManagerAC)return;this.#keyboardManagerAC=new AbortController;const signal=this.combinedSignal(this.#keyboardManagerAC);window.addEventListener("keydown",this.keydown.bind(this),{signal}),window.addEventListener("keyup",this.keyup.bind(this),{signal})}#removeKeyboardManager(){this.#keyboardManagerAC?.abort(),this.#keyboardManagerAC=null}#addCopyPasteListeners(){if(this.#copyPasteAC)return;this.#copyPasteAC=new AbortController;const signal=this.combinedSignal(this.#copyPasteAC);document.addEventListener("copy",this.copy.bind(this),{signal}),document.addEventListener("cut",this.cut.bind(this),{signal}),document.addEventListener("paste",this.paste.bind(this),{signal})}#removeCopyPasteListeners(){this.#copyPasteAC?.abort(),this.#copyPasteAC=null}#addDragAndDropListeners(){const signal=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal}),document.addEventListener("drop",this.drop.bind(this),{signal})}addEditListeners(){this.#addKeyboardManager(),this.#addCopyPasteListeners()}removeEditListeners(){this.#removeKeyboardManager(),this.#removeCopyPasteListeners()}dragOver(event){for(const{type}of event.dataTransfer.items)for(const editorType of this.#editorTypes)if(editorType.isHandlingMimeForPasting(type))return event.dataTransfer.dropEffect="copy",void event.preventDefault()}drop(event){for(const item of event.dataTransfer.items)for(const editorType of this.#editorTypes)if(editorType.isHandlingMimeForPasting(item.type))return editorType.paste(item,this.currentLayer),void event.preventDefault()}copy(event){if(event.preventDefault(),this.#activeEditor?.commitOrRemove(),!this.hasSelection)return;const editors=[];for(const editor of this.#selectedEditors){const serialized=editor.serialize(!0);serialized&&editors.push(serialized)}0!==editors.length&&event.clipboardData.setData("application/pdfjs",JSON.stringify(editors))}cut(event){this.copy(event),this.delete()}paste(event){var _this7=this;return(0,asyncToGenerator.A)((function*(){event.preventDefault();const{clipboardData}=event;for(const item of clipboardData.items)for(const editorType of _this7.#editorTypes)if(editorType.isHandlingMimeForPasting(item.type))return void editorType.paste(item,_this7.currentLayer);let data=clipboardData.getData("application/pdfjs");if(!data)return;try{data=JSON.parse(data)}catch(ex){return void warn(`paste: "${ex.message}".`)}if(!Array.isArray(data))return;_this7.unselectAll();const layer=_this7.currentLayer;try{const newEditors=[];for(const editor of data){const deserializedEditor=yield layer.deserialize(editor);if(!deserializedEditor)return;newEditors.push(deserializedEditor)}const cmd=()=>{for(const editor of newEditors)_this7.#addEditorToLayer(editor);_this7.#selectEditors(newEditors)},undo=()=>{for(const editor of newEditors)editor.remove()};_this7.addCommands({cmd,undo,mustExec:!0})}catch(ex){warn(`paste: "${ex.message}".`)}}))()}keydown(event){this.isShiftKeyDown||"Shift"!==event.key||(this.isShiftKeyDown=!0),this.#mode===AnnotationEditorType.NONE||this.isEditorHandlingKeyboard||AnnotationEditorUIManager._keyboardManager.exec(this,event)}keyup(event){this.isShiftKeyDown&&"Shift"===event.key&&(this.isShiftKeyDown=!1,this.#highlightWhenShiftUp&&(this.#highlightWhenShiftUp=!1,this.#onSelectEnd("main_toolbar")))}onEditingAction({name}){switch(name){case"undo":case"redo":case"delete":case"selectAll":this[name]();break;case"highlightSelection":this.highlightSelection("context_menu")}}#dispatchUpdateStates(details){Object.entries(details).some((([key,value])=>this.#previousStates[key]!==value))&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#previousStates,details)}),this.#mode===AnnotationEditorType.HIGHLIGHT&&!1===details.hasSelectedEditor&&this.#dispatchUpdateUI([[AnnotationEditorParamsType.HIGHLIGHT_FREE,!0]]))}#dispatchUpdateUI(details){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details})}setEditingState(isEditing){isEditing?(this.#addFocusManager(),this.#addCopyPasteListeners(),this.#dispatchUpdateStates({isEditing:this.#mode!==AnnotationEditorType.NONE,isEmpty:this.#isEmpty(),hasSomethingToUndo:this.#commandManager.hasSomethingToUndo(),hasSomethingToRedo:this.#commandManager.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#removeFocusManager(),this.#removeCopyPasteListeners(),this.#dispatchUpdateStates({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(types){if(!this.#editorTypes){this.#editorTypes=types;for(const editorType of this.#editorTypes)this.#dispatchUpdateUI(editorType.defaultPropertiesToUpdate)}}getId(){return this.#idManager.id}get currentLayer(){return this.#allLayers.get(this.#currentPageIndex)}getLayer(pageIndex){return this.#allLayers.get(pageIndex)}get currentPageIndex(){return this.#currentPageIndex}addLayer(layer){this.#allLayers.set(layer.pageIndex,layer),this.#isEnabled?layer.enable():layer.disable()}removeLayer(layer){this.#allLayers.delete(layer.pageIndex)}updateMode(mode,editId=null,isFromKeyboard=!1){var _this8=this;return(0,asyncToGenerator.A)((function*(){if(_this8.#mode!==mode&&(!_this8.#updateModeCapability||(yield _this8.#updateModeCapability.promise,_this8.#updateModeCapability))){if(_this8.#updateModeCapability=Promise.withResolvers(),_this8.#mode=mode,mode===AnnotationEditorType.NONE)return _this8.setEditingState(!1),_this8.#disableAll(),void _this8.#updateModeCapability.resolve();_this8.setEditingState(!0),yield _this8.#enableAll(),_this8.unselectAll();for(const layer of _this8.#allLayers.values())layer.updateMode(mode);if(!editId)return isFromKeyboard&&_this8.addNewEditorFromKeyboard(),void _this8.#updateModeCapability.resolve();for(const editor of _this8.#allEditors.values())editor.annotationElementId===editId?(_this8.setSelected(editor),editor.enterInEditMode()):editor.unselect();_this8.#updateModeCapability.resolve()}}))()}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(mode){mode!==this.#mode&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode})}updateParams(type,value){if(this.#editorTypes){switch(type){case AnnotationEditorParamsType.CREATE:return void this.currentLayer.addNewEditor();case AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:this.#mainHighlightColorPicker?.updateColor(value);break;case AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#showAllStates||=new Map).set(type,value),this.showAllEditors("highlight",value)}for(const editor of this.#selectedEditors)editor.updateParams(type,value);for(const editorType of this.#editorTypes)editorType.updateDefaultParams(type,value)}}showAllEditors(type,visible,updateButton=!1){for(const editor of this.#allEditors.values())editor.editorType===type&&editor.show(visible);(this.#showAllStates?.get(AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL)??!0)!==visible&&this.#dispatchUpdateUI([[AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL,visible]])}enableWaiting(mustWait=!1){if(this.#isWaiting!==mustWait){this.#isWaiting=mustWait;for(const layer of this.#allLayers.values())mustWait?layer.disableClick():layer.enableClick(),layer.div.classList.toggle("waiting",mustWait)}}#enableAll(){var _this9=this;return(0,asyncToGenerator.A)((function*(){if(!_this9.#isEnabled){_this9.#isEnabled=!0;const promises=[];for(const layer of _this9.#allLayers.values())promises.push(layer.enable());yield Promise.all(promises);for(const editor of _this9.#allEditors.values())editor.enable()}}))()}#disableAll(){if(this.unselectAll(),this.#isEnabled){this.#isEnabled=!1;for(const layer of this.#allLayers.values())layer.disable();for(const editor of this.#allEditors.values())editor.disable()}}getEditors(pageIndex){const editors=[];for(const editor of this.#allEditors.values())editor.pageIndex===pageIndex&&editors.push(editor);return editors}getEditor(id){return this.#allEditors.get(id)}addEditor(editor){this.#allEditors.set(editor.id,editor)}removeEditor(editor){editor.div.contains(document.activeElement)&&(this.#focusMainContainerTimeoutId&&clearTimeout(this.#focusMainContainerTimeoutId),this.#focusMainContainerTimeoutId=setTimeout((()=>{this.focusMainContainer(),this.#focusMainContainerTimeoutId=null}),0)),this.#allEditors.delete(editor.id),this.unselect(editor),editor.annotationElementId&&this.#deletedAnnotationsElementIds.has(editor.annotationElementId)||this.#annotationStorage?.remove(editor.id)}addDeletedAnnotationElement(editor){this.#deletedAnnotationsElementIds.add(editor.annotationElementId),this.addChangedExistingAnnotation(editor),editor.deleted=!0}isDeletedAnnotationElement(annotationElementId){return this.#deletedAnnotationsElementIds.has(annotationElementId)}removeDeletedAnnotationElement(editor){this.#deletedAnnotationsElementIds.delete(editor.annotationElementId),this.removeChangedExistingAnnotation(editor),editor.deleted=!1}#addEditorToLayer(editor){const layer=this.#allLayers.get(editor.pageIndex);layer?layer.addOrRebuild(editor):(this.addEditor(editor),this.addToAnnotationStorage(editor))}setActiveEditor(editor){this.#activeEditor!==editor&&(this.#activeEditor=editor,editor&&this.#dispatchUpdateUI(editor.propertiesToUpdate))}get#lastSelectedEditor(){let ed=null;for(ed of this.#selectedEditors);return ed}updateUI(editor){this.#lastSelectedEditor===editor&&this.#dispatchUpdateUI(editor.propertiesToUpdate)}toggleSelected(editor){if(this.#selectedEditors.has(editor))return this.#selectedEditors.delete(editor),editor.unselect(),void this.#dispatchUpdateStates({hasSelectedEditor:this.hasSelection});this.#selectedEditors.add(editor),editor.select(),this.#dispatchUpdateUI(editor.propertiesToUpdate),this.#dispatchUpdateStates({hasSelectedEditor:!0})}setSelected(editor){for(const ed of this.#selectedEditors)ed!==editor&&ed.unselect();this.#selectedEditors.clear(),this.#selectedEditors.add(editor),editor.select(),this.#dispatchUpdateUI(editor.propertiesToUpdate),this.#dispatchUpdateStates({hasSelectedEditor:!0})}isSelected(editor){return this.#selectedEditors.has(editor)}get firstSelectedEditor(){return this.#selectedEditors.values().next().value}unselect(editor){editor.unselect(),this.#selectedEditors.delete(editor),this.#dispatchUpdateStates({hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==this.#selectedEditors.size}get isEnterHandled(){return 1===this.#selectedEditors.size&&this.firstSelectedEditor.isEnterHandled}undo(){this.#commandManager.undo(),this.#dispatchUpdateStates({hasSomethingToUndo:this.#commandManager.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#isEmpty()})}redo(){this.#commandManager.redo(),this.#dispatchUpdateStates({hasSomethingToUndo:!0,hasSomethingToRedo:this.#commandManager.hasSomethingToRedo(),isEmpty:this.#isEmpty()})}addCommands(params){this.#commandManager.add(params),this.#dispatchUpdateStates({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#isEmpty()})}#isEmpty(){if(0===this.#allEditors.size)return!0;if(1===this.#allEditors.size)for(const editor of this.#allEditors.values())return editor.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const editors=[...this.#selectedEditors];this.addCommands({cmd:()=>{for(const editor of editors)editor.remove()},undo:()=>{for(const editor of editors)this.#addEditorToLayer(editor)},mustExec:!0})}commitOrRemove(){this.#activeEditor?.commitOrRemove()}hasSomethingToControl(){return this.#activeEditor||this.hasSelection}#selectEditors(editors){for(const editor of this.#selectedEditors)editor.unselect();this.#selectedEditors.clear();for(const editor of editors)editor.isEmpty()||(this.#selectedEditors.add(editor),editor.select());this.#dispatchUpdateStates({hasSelectedEditor:this.hasSelection})}selectAll(){for(const editor of this.#selectedEditors)editor.commit();this.#selectEditors(this.#allEditors.values())}unselectAll(){if((!this.#activeEditor||(this.#activeEditor.commitOrRemove(),this.#mode===AnnotationEditorType.NONE))&&this.hasSelection){for(const editor of this.#selectedEditors)editor.unselect();this.#selectedEditors.clear(),this.#dispatchUpdateStates({hasSelectedEditor:!1})}}translateSelectedEditors(x,y,noCommit=!1){if(noCommit||this.commitOrRemove(),!this.hasSelection)return;this.#translation[0]+=x,this.#translation[1]+=y;const[totalX,totalY]=this.#translation,editors=[...this.#selectedEditors];this.#translationTimeoutId&&clearTimeout(this.#translationTimeoutId),this.#translationTimeoutId=setTimeout((()=>{this.#translationTimeoutId=null,this.#translation[0]=this.#translation[1]=0,this.addCommands({cmd:()=>{for(const editor of editors)this.#allEditors.has(editor.id)&&editor.translateInPage(totalX,totalY)},undo:()=>{for(const editor of editors)this.#allEditors.has(editor.id)&&editor.translateInPage(-totalX,-totalY)},mustExec:!1})}),1e3);for(const editor of editors)editor.translateInPage(x,y)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#draggingEditors=new Map;for(const editor of this.#selectedEditors)this.#draggingEditors.set(editor,{savedX:editor.x,savedY:editor.y,savedPageIndex:editor.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#draggingEditors)return!1;this.disableUserSelect(!1);const map=this.#draggingEditors;this.#draggingEditors=null;let mustBeAddedInUndoStack=!1;for(const[{x,y,pageIndex},value]of map)value.newX=x,value.newY=y,value.newPageIndex=pageIndex,mustBeAddedInUndoStack||=x!==value.savedX||y!==value.savedY||pageIndex!==value.savedPageIndex;if(!mustBeAddedInUndoStack)return!1;const move=(editor,x,y,pageIndex)=>{if(this.#allEditors.has(editor.id)){const parent=this.#allLayers.get(pageIndex);parent?editor._setParentAndPosition(parent,x,y):(editor.pageIndex=pageIndex,editor.x=x,editor.y=y)}};return this.addCommands({cmd:()=>{for(const[editor,{newX,newY,newPageIndex}]of map)move(editor,newX,newY,newPageIndex)},undo:()=>{for(const[editor,{savedX,savedY,savedPageIndex}]of map)move(editor,savedX,savedY,savedPageIndex)},mustExec:!0}),!0}dragSelectedEditors(tx,ty){if(this.#draggingEditors)for(const editor of this.#draggingEditors.keys())editor.drag(tx,ty)}rebuild(editor){if(null===editor.parent){const parent=this.getLayer(editor.pageIndex);parent?(parent.changeParent(editor),parent.addOrRebuild(editor)):(this.addEditor(editor),this.addToAnnotationStorage(editor),editor.rebuild())}else editor.parent.addOrRebuild(editor)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||1===this.#selectedEditors.size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(editor){return this.#activeEditor===editor}getActive(){return this.#activeEditor}getMode(){return this.#mode}get imageManager(){return shadow(this,"imageManager",new ImageManager)}getSelectionBoxes(textLayer){if(!textLayer)return null;const selection=document.getSelection();for(let i=0,ii=selection.rangeCount;i<ii;i++)if(!textLayer.contains(selection.getRangeAt(i).commonAncestorContainer))return null;const{x:layerX,y:layerY,width:parentWidth,height:parentHeight}=textLayer.getBoundingClientRect();let rotator;switch(textLayer.getAttribute("data-main-rotation")){case"90":rotator=(x,y,w,h)=>({x:(y-layerY)/parentHeight,y:1-(x+w-layerX)/parentWidth,width:h/parentHeight,height:w/parentWidth});break;case"180":rotator=(x,y,w,h)=>({x:1-(x+w-layerX)/parentWidth,y:1-(y+h-layerY)/parentHeight,width:w/parentWidth,height:h/parentHeight});break;case"270":rotator=(x,y,w,h)=>({x:1-(y+h-layerY)/parentHeight,y:(x-layerX)/parentWidth,width:h/parentHeight,height:w/parentWidth});break;default:rotator=(x,y,w,h)=>({x:(x-layerX)/parentWidth,y:(y-layerY)/parentHeight,width:w/parentWidth,height:h/parentHeight})}const boxes=[];for(let i=0,ii=selection.rangeCount;i<ii;i++){const range=selection.getRangeAt(i);if(!range.collapsed)for(const{x,y,width,height}of range.getClientRects())0!==width&&0!==height&&boxes.push(rotator(x,y,width,height))}return 0===boxes.length?null:boxes}addChangedExistingAnnotation({annotationElementId,id}){(this.#changedExistingAnnotations||=new Map).set(annotationElementId,id)}removeChangedExistingAnnotation({annotationElementId}){this.#changedExistingAnnotations?.delete(annotationElementId)}renderAnnotationElement(annotation){const editorId=this.#changedExistingAnnotations?.get(annotation.data.id);if(!editorId)return;const editor=this.#annotationStorage.getRawValue(editorId);editor&&(this.#mode!==AnnotationEditorType.NONE||editor.hasBeenModified)&&editor.renderAnnotationElement(annotation)}}class AltText{#altText=null;#altTextDecorative=!1;#altTextButton=null;#altTextButtonLabel=null;#altTextTooltip=null;#altTextTooltipTimeout=null;#altTextWasFromKeyBoard=!1;#badge=null;#editor=null;#guessedText=null;#textWithDisclaimer=null;#useNewAltTextFlow=!1;static#l10nNewButton=null;static _l10n=null;constructor(editor){this.#editor=editor,this.#useNewAltTextFlow=editor._uiManager.useNewAltTextFlow,AltText.#l10nNewButton||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(l10n){AltText._l10n??=l10n}render(){var _this10=this;return(0,asyncToGenerator.A)((function*(){const altText=_this10.#altTextButton=document.createElement("button");altText.className="altText",altText.tabIndex="0";const label=_this10.#altTextButtonLabel=document.createElement("span");altText.append(label),_this10.#useNewAltTextFlow?(altText.classList.add("new"),altText.setAttribute("data-l10n-id",AltText.#l10nNewButton.missing),label.setAttribute("data-l10n-id",AltText.#l10nNewButton["missing-label"])):(altText.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),label.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const signal=_this10.#editor._uiManager._signal;altText.addEventListener("contextmenu",noContextMenu,{signal}),altText.addEventListener("pointerdown",(event=>event.stopPropagation()),{signal});const onClick=event=>{event.preventDefault(),_this10.#editor._uiManager.editAltText(_this10.#editor),_this10.#useNewAltTextFlow&&_this10.#editor._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:_this10.#label}})};return altText.addEventListener("click",onClick,{capture:!0,signal}),altText.addEventListener("keydown",(event=>{event.target===altText&&"Enter"===event.key&&(_this10.#altTextWasFromKeyBoard=!0,onClick(event))}),{signal}),yield _this10.#setState(),altText}))()}get#label(){return(this.#altText?"added":null===this.#altText&&this.guessedText&&"review")||"missing"}finish(){this.#altTextButton&&(this.#altTextButton.focus({focusVisible:this.#altTextWasFromKeyBoard}),this.#altTextWasFromKeyBoard=!1)}isEmpty(){return this.#useNewAltTextFlow?null===this.#altText:!this.#altText&&!this.#altTextDecorative}hasData(){return this.#useNewAltTextFlow?null!==this.#altText||!!this.#guessedText:this.isEmpty()}get guessedText(){return this.#guessedText}setGuessedText(guessedText){var _this11=this;return(0,asyncToGenerator.A)((function*(){null===_this11.#altText&&(_this11.#guessedText=guessedText,_this11.#textWithDisclaimer=yield AltText._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:guessedText}),_this11.#setState())}))()}toggleAltTextBadge(visibility=!1){if(!this.#useNewAltTextFlow||this.#altText)return this.#badge?.remove(),void(this.#badge=null);if(!this.#badge){const badge=this.#badge=document.createElement("div");badge.className="noAltTextBadge",this.#editor.div.append(badge)}this.#badge.classList.toggle("hidden",!visibility)}serialize(isForCopying){let altText=this.#altText;return isForCopying||this.#guessedText!==altText||(altText=this.#textWithDisclaimer),{altText,decorative:this.#altTextDecorative,guessedText:this.#guessedText,textWithDisclaimer:this.#textWithDisclaimer}}get data(){return{altText:this.#altText,decorative:this.#altTextDecorative}}set data({altText,decorative,guessedText,textWithDisclaimer,cancel=!1}){guessedText&&(this.#guessedText=guessedText,this.#textWithDisclaimer=textWithDisclaimer),this.#altText===altText&&this.#altTextDecorative===decorative||(cancel||(this.#altText=altText,this.#altTextDecorative=decorative),this.#setState())}toggle(enabled=!1){this.#altTextButton&&(!enabled&&this.#altTextTooltipTimeout&&(clearTimeout(this.#altTextTooltipTimeout),this.#altTextTooltipTimeout=null),this.#altTextButton.disabled=!enabled)}shown(){this.#editor._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#label}})}destroy(){this.#altTextButton?.remove(),this.#altTextButton=null,this.#altTextButtonLabel=null,this.#altTextTooltip=null,this.#badge?.remove(),this.#badge=null}#setState(){var _this12=this;return(0,asyncToGenerator.A)((function*(){const button=_this12.#altTextButton;if(!button)return;if(_this12.#useNewAltTextFlow){if(button.classList.toggle("done",!!_this12.#altText),button.setAttribute("data-l10n-id",AltText.#l10nNewButton[_this12.#label]),_this12.#altTextButtonLabel?.setAttribute("data-l10n-id",AltText.#l10nNewButton[`${_this12.#label}-label`]),!_this12.#altText)return void _this12.#altTextTooltip?.remove()}else{if(!_this12.#altText&&!_this12.#altTextDecorative)return button.classList.remove("done"),void _this12.#altTextTooltip?.remove();button.classList.add("done"),button.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let tooltip=_this12.#altTextTooltip;if(!tooltip){_this12.#altTextTooltip=tooltip=document.createElement("span"),tooltip.className="tooltip",tooltip.setAttribute("role","tooltip"),tooltip.id=`alt-text-tooltip-${_this12.#editor.id}`;const DELAY_TO_SHOW_TOOLTIP=100,signal=_this12.#editor._uiManager._signal;signal.addEventListener("abort",(()=>{clearTimeout(_this12.#altTextTooltipTimeout),_this12.#altTextTooltipTimeout=null}),{once:!0}),button.addEventListener("mouseenter",(()=>{_this12.#altTextTooltipTimeout=setTimeout((()=>{_this12.#altTextTooltipTimeout=null,_this12.#altTextTooltip.classList.add("show"),_this12.#editor._reportTelemetry({action:"alt_text_tooltip"})}),DELAY_TO_SHOW_TOOLTIP)}),{signal}),button.addEventListener("mouseleave",(()=>{_this12.#altTextTooltipTimeout&&(clearTimeout(_this12.#altTextTooltipTimeout),_this12.#altTextTooltipTimeout=null),_this12.#altTextTooltip?.classList.remove("show")}),{signal})}_this12.#altTextDecorative?tooltip.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(tooltip.removeAttribute("data-l10n-id"),tooltip.textContent=_this12.#altText),tooltip.parentNode||button.append(tooltip);const element=_this12.#editor.getImageForAltText();element?.setAttribute("aria-describedby",tooltip.id)}))()}}class AnnotationEditor{#accessibilityData=null;#allResizerDivs=null;#altText=null;#disabled=!1;#keepAspectRatio=!1;#resizersDiv=null;#savedDimensions=null;#focusAC=null;#focusedResizerName="";#hasBeenClicked=!1;#initialPosition=null;#isEditing=!1;#isInEditMode=!1;#isResizerEnabledForKeyboard=!1;#moveInDOMTimeout=null;#prevDragX=0;#prevDragY=0;#telemetryTimeouts=null;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#isDraggable=!1;#zIndex=AnnotationEditor._zIndex++;static _borderLineWidth=-1;static _colorManager=new ColorManager;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const resize=AnnotationEditor.prototype._resizeWithKeyboard,small=AnnotationEditorUIManager.TRANSLATE_SMALL,big=AnnotationEditorUIManager.TRANSLATE_BIG;return shadow(this,"_resizerKeyboardManager",new KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],resize,{args:[-small,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],resize,{args:[-big,0]}],[["ArrowRight","mac+ArrowRight"],resize,{args:[small,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],resize,{args:[big,0]}],[["ArrowUp","mac+ArrowUp"],resize,{args:[0,-small]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],resize,{args:[0,-big]}],[["ArrowDown","mac+ArrowDown"],resize,{args:[0,small]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],resize,{args:[0,big]}],[["Escape","mac+Escape"],AnnotationEditor.prototype._stopResizingWithKeyboard]]))}constructor(parameters){this.parent=parameters.parent,this.id=parameters.id,this.width=this.height=null,this.pageIndex=parameters.parent.pageIndex,this.name=parameters.name,this.div=null,this._uiManager=parameters.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=parameters.isCentered,this._structTreeParentId=null;const{rotation,rawDims:{pageWidth,pageHeight,pageX,pageY}}=this.parent.viewport;this.rotation=rotation,this.pageRotation=(360+rotation-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[pageWidth,pageHeight],this.pageTranslation=[pageX,pageY];const[width,height]=this.parentDimensions;this.x=parameters.x/width,this.y=parameters.y/height,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return shadow(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(editor){const fakeEditor=new FakeEditor({id:editor.parent.getNextId(),parent:editor.parent,uiManager:editor._uiManager});fakeEditor.annotationElementId=editor.annotationElementId,fakeEditor.deleted=!0,fakeEditor._uiManager.addToAnnotationStorage(fakeEditor)}static initialize(l10n,_uiManager){if(AnnotationEditor._l10n??=l10n,AnnotationEditor._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),-1!==AnnotationEditor._borderLineWidth)return;const style=getComputedStyle(document.documentElement);AnnotationEditor._borderLineWidth=parseFloat(style.getPropertyValue("--outline-width"))||0}static updateDefaultParams(_type,_value){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(mime){return!1}static paste(item,parent){unreachable("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#isDraggable}set _isDraggable(value){this.#isDraggable=value,this.div?.classList.toggle("draggable",value)}get isEnterHandled(){return!0}center(){const[pageWidth,pageHeight]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*pageHeight/(2*pageWidth),this.y+=this.width*pageWidth/(2*pageHeight);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*pageHeight/(2*pageWidth),this.y-=this.width*pageWidth/(2*pageHeight);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}addCommands(params){this._uiManager.addCommands(params)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#zIndex}setParent(parent){null!==parent?(this.pageIndex=parent.pageIndex,this.pageDimensions=parent.pageDimensions):this.#stopResizing(),this.parent=parent}focusin(event){this._focusEventsAllowed&&(this.#hasBeenClicked?this.#hasBeenClicked=!1:this.parent.setSelected(this))}focusout(event){if(!this._focusEventsAllowed)return;if(!this.isAttachedToDOM)return;const target=event.relatedTarget;target?.closest(`#${this.id}`)||(event.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(x,y,tx,ty){const[width,height]=this.parentDimensions;[tx,ty]=this.screenToPageTranslation(tx,ty),this.x=(x+tx)/width,this.y=(y+ty)/height,this.fixAndSetPosition()}#translate([width,height],x,y){[x,y]=this.screenToPageTranslation(x,y),this.x+=x/width,this.y+=y/height,this.fixAndSetPosition()}translate(x,y){this.#translate(this.parentDimensions,x,y)}translateInPage(x,y){this.#initialPosition||=[this.x,this.y],this.#translate(this.pageDimensions,x,y),this.div.scrollIntoView({block:"nearest"})}drag(tx,ty){this.#initialPosition||=[this.x,this.y];const[parentWidth,parentHeight]=this.parentDimensions;if(this.x+=tx/parentWidth,this.y+=ty/parentHeight,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x,y}=this.div.getBoundingClientRect();this.parent.findNewParent(this,x,y)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x,y}=this;const[bx,by]=this.getBaseTranslation();x+=bx,y+=by,this.div.style.left=`${(100*x).toFixed(2)}%`,this.div.style.top=`${(100*y).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}get _hasBeenMoved(){return!!this.#initialPosition&&(this.#initialPosition[0]!==this.x||this.#initialPosition[1]!==this.y)}getBaseTranslation(){const[parentWidth,parentHeight]=this.parentDimensions,{_borderLineWidth}=AnnotationEditor,x=_borderLineWidth/parentWidth,y=_borderLineWidth/parentHeight;switch(this.rotation){case 90:return[-x,y];case 180:return[x,y];case 270:return[x,-y];default:return[-x,-y]}}get _mustFixPosition(){return!0}fixAndSetPosition(rotation=this.rotation){const[pageWidth,pageHeight]=this.pageDimensions;let{x,y,width,height}=this;if(width*=pageWidth,height*=pageHeight,x*=pageWidth,y*=pageHeight,this._mustFixPosition)switch(rotation){case 0:x=Math.max(0,Math.min(pageWidth-width,x)),y=Math.max(0,Math.min(pageHeight-height,y));break;case 90:x=Math.max(0,Math.min(pageWidth-height,x)),y=Math.min(pageHeight,Math.max(width,y));break;case 180:x=Math.min(pageWidth,Math.max(width,x)),y=Math.min(pageHeight,Math.max(height,y));break;case 270:x=Math.min(pageWidth,Math.max(height,x)),y=Math.max(0,Math.min(pageHeight-width,y))}this.x=x/=pageWidth,this.y=y/=pageHeight;const[bx,by]=this.getBaseTranslation();x+=bx,y+=by;const{style}=this.div;style.left=`${(100*x).toFixed(2)}%`,style.top=`${(100*y).toFixed(2)}%`,this.moveInDOM()}static#rotatePoint(x,y,angle){switch(angle){case 90:return[y,-x];case 180:return[-x,-y];case 270:return[-y,x];default:return[x,y]}}screenToPageTranslation(x,y){return AnnotationEditor.#rotatePoint(x,y,this.parentRotation)}pageTranslationToScreen(x,y){return AnnotationEditor.#rotatePoint(x,y,360-this.parentRotation)}#getRotationMatrix(rotation){switch(rotation){case 90:{const[pageWidth,pageHeight]=this.pageDimensions;return[0,-pageWidth/pageHeight,pageHeight/pageWidth,0]}case 180:return[-1,0,0,-1];case 270:{const[pageWidth,pageHeight]=this.pageDimensions;return[0,pageWidth/pageHeight,-pageHeight/pageWidth,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale,pageDimensions:[pageWidth,pageHeight]}=this;return[pageWidth*parentScale,pageHeight*parentScale]}setDims(width,height){const[parentWidth,parentHeight]=this.parentDimensions;this.div.style.width=`${(100*width/parentWidth).toFixed(2)}%`,this.#keepAspectRatio||(this.div.style.height=`${(100*height/parentHeight).toFixed(2)}%`)}fixDims(){const{style}=this.div,{height,width}=style,widthPercent=width.endsWith("%"),heightPercent=!this.#keepAspectRatio&&height.endsWith("%");if(widthPercent&&heightPercent)return;const[parentWidth,parentHeight]=this.parentDimensions;widthPercent||(style.width=`${(100*parseFloat(width)/parentWidth).toFixed(2)}%`),this.#keepAspectRatio||heightPercent||(style.height=`${(100*parseFloat(height)/parentHeight).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#createResizers(){if(this.#resizersDiv)return;this.#resizersDiv=document.createElement("div"),this.#resizersDiv.classList.add("resizers");const classes=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],signal=this._uiManager._signal;for(const name of classes){const div=document.createElement("div");this.#resizersDiv.append(div),div.classList.add("resizer",name),div.setAttribute("data-resizer-name",name),div.addEventListener("pointerdown",this.#resizerPointerdown.bind(this,name),{signal}),div.addEventListener("contextmenu",noContextMenu,{signal}),div.tabIndex=-1}this.div.prepend(this.#resizersDiv)}#resizerPointerdown(name,event){event.preventDefault();const{isMac}=util_FeatureTest.platform;if(0!==event.button||event.ctrlKey&&isMac)return;this.#altText?.toggle(!1);const savedDraggable=this._isDraggable;this._isDraggable=!1;const ac=new AbortController,signal=this._uiManager.combinedSignal(ac);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#resizerPointermove.bind(this,name),{passive:!0,capture:!0,signal}),window.addEventListener("contextmenu",noContextMenu,{signal});const savedX=this.x,savedY=this.y,savedWidth=this.width,savedHeight=this.height,savedParentCursor=this.parent.div.style.cursor,savedCursor=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(event.target).cursor;const pointerUpCallback=()=>{ac.abort(),this.parent.togglePointerEvents(!0),this.#altText?.toggle(!0),this._isDraggable=savedDraggable,this.parent.div.style.cursor=savedParentCursor,this.div.style.cursor=savedCursor,this.#addResizeToUndoStack(savedX,savedY,savedWidth,savedHeight)};window.addEventListener("pointerup",pointerUpCallback,{signal}),window.addEventListener("blur",pointerUpCallback,{signal})}#addResizeToUndoStack(savedX,savedY,savedWidth,savedHeight){const newX=this.x,newY=this.y,newWidth=this.width,newHeight=this.height;newX===savedX&&newY===savedY&&newWidth===savedWidth&&newHeight===savedHeight||this.addCommands({cmd:()=>{this.width=newWidth,this.height=newHeight,this.x=newX,this.y=newY;const[parentWidth,parentHeight]=this.parentDimensions;this.setDims(parentWidth*newWidth,parentHeight*newHeight),this.fixAndSetPosition()},undo:()=>{this.width=savedWidth,this.height=savedHeight,this.x=savedX,this.y=savedY;const[parentWidth,parentHeight]=this.parentDimensions;this.setDims(parentWidth*savedWidth,parentHeight*savedHeight),this.fixAndSetPosition()},mustExec:!0})}#resizerPointermove(name,event){const[parentWidth,parentHeight]=this.parentDimensions,savedX=this.x,savedY=this.y,savedWidth=this.width,savedHeight=this.height,minWidth=AnnotationEditor.MIN_SIZE/parentWidth,minHeight=AnnotationEditor.MIN_SIZE/parentHeight,round=x=>Math.round(1e4*x)/1e4,rotationMatrix=this.#getRotationMatrix(this.rotation),transf=(x,y)=>[rotationMatrix[0]*x+rotationMatrix[2]*y,rotationMatrix[1]*x+rotationMatrix[3]*y],invRotationMatrix=this.#getRotationMatrix(360-this.rotation);let getPoint,getOpposite,isDiagonal=!1,isHorizontal=!1;switch(name){case"topLeft":isDiagonal=!0,getPoint=(w,h)=>[0,0],getOpposite=(w,h)=>[w,h];break;case"topMiddle":getPoint=(w,h)=>[w/2,0],getOpposite=(w,h)=>[w/2,h];break;case"topRight":isDiagonal=!0,getPoint=(w,h)=>[w,0],getOpposite=(w,h)=>[0,h];break;case"middleRight":isHorizontal=!0,getPoint=(w,h)=>[w,h/2],getOpposite=(w,h)=>[0,h/2];break;case"bottomRight":isDiagonal=!0,getPoint=(w,h)=>[w,h],getOpposite=(w,h)=>[0,0];break;case"bottomMiddle":getPoint=(w,h)=>[w/2,h],getOpposite=(w,h)=>[w/2,0];break;case"bottomLeft":isDiagonal=!0,getPoint=(w,h)=>[0,h],getOpposite=(w,h)=>[w,0];break;case"middleLeft":isHorizontal=!0,getPoint=(w,h)=>[0,h/2],getOpposite=(w,h)=>[w,h/2]}const point=getPoint(savedWidth,savedHeight),oppositePoint=getOpposite(savedWidth,savedHeight);let transfOppositePoint=transf(...oppositePoint);const oppositeX=round(savedX+transfOppositePoint[0]),oppositeY=round(savedY+transfOppositePoint[1]);let ratioX=1,ratioY=1,[deltaX,deltaY]=this.screenToPageTranslation(event.movementX,event.movementY);var x,y;if([deltaX,deltaY]=(x=deltaX/parentWidth,y=deltaY/parentHeight,[invRotationMatrix[0]*x+invRotationMatrix[2]*y,invRotationMatrix[1]*x+invRotationMatrix[3]*y]),isDiagonal){const oldDiag=Math.hypot(savedWidth,savedHeight);ratioX=ratioY=Math.max(Math.min(Math.hypot(oppositePoint[0]-point[0]-deltaX,oppositePoint[1]-point[1]-deltaY)/oldDiag,1/savedWidth,1/savedHeight),minWidth/savedWidth,minHeight/savedHeight)}else isHorizontal?ratioX=Math.max(minWidth,Math.min(1,Math.abs(oppositePoint[0]-point[0]-deltaX)))/savedWidth:ratioY=Math.max(minHeight,Math.min(1,Math.abs(oppositePoint[1]-point[1]-deltaY)))/savedHeight;const newWidth=round(savedWidth*ratioX),newHeight=round(savedHeight*ratioY);transfOppositePoint=transf(...getOpposite(newWidth,newHeight));const newX=oppositeX-transfOppositePoint[0],newY=oppositeY-transfOppositePoint[1];this.width=newWidth,this.height=newHeight,this.x=newX,this.y=newY,this.setDims(parentWidth*newWidth,parentHeight*newHeight),this.fixAndSetPosition()}altTextFinish(){this.#altText?.finish()}addEditToolbar(){var _this13=this;return(0,asyncToGenerator.A)((function*(){return _this13._editToolbar||_this13.#isInEditMode||(_this13._editToolbar=new EditorToolbar(_this13),_this13.div.append(_this13._editToolbar.render()),_this13.#altText&&(yield _this13._editToolbar.addAltText(_this13.#altText))),_this13._editToolbar}))()}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#altText?.destroy())}addContainer(container){const editToolbarDiv=this._editToolbar?.div;editToolbarDiv?editToolbarDiv.before(container):this.div.append(container)}getClientDimensions(){return this.div.getBoundingClientRect()}addAltTextButton(){var _this14=this;return(0,asyncToGenerator.A)((function*(){_this14.#altText||(AltText.initialize(AnnotationEditor._l10n),_this14.#altText=new AltText(_this14),_this14.#accessibilityData&&(_this14.#altText.data=_this14.#accessibilityData,_this14.#accessibilityData=null),yield _this14.addEditToolbar())}))()}get altTextData(){return this.#altText?.data}set altTextData(data){this.#altText&&(this.#altText.data=data)}get guessedAltText(){return this.#altText?.guessedText}setGuessedAltText(text){var _this15=this;return(0,asyncToGenerator.A)((function*(){yield _this15.#altText?.setGuessedText(text)}))()}serializeAltText(isForCopying){return this.#altText?.serialize(isForCopying)}hasAltText(){return!!this.#altText&&!this.#altText.isEmpty()}hasAltTextData(){return this.#altText?.hasData()??!1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#disabled?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.#addFocusListeners();const[parentWidth,parentHeight]=this.parentDimensions;this.parentRotation%180!=0&&(this.div.style.maxWidth=`${(100*parentHeight/parentWidth).toFixed(2)}%`,this.div.style.maxHeight=`${(100*parentWidth/parentHeight).toFixed(2)}%`);const[tx,ty]=this.getInitialTranslation();return this.translate(tx,ty),bindEvents(this,this.div,["pointerdown"]),this.div}pointerdown(event){const{isMac}=util_FeatureTest.platform;0!==event.button||event.ctrlKey&&isMac?event.preventDefault():(this.#hasBeenClicked=!0,this._isDraggable?this.#setUpDragSession(event):this.#selectOnPointerEvent(event))}get isSelected(){return this._uiManager.isSelected(this)}#selectOnPointerEvent(event){const{isMac}=util_FeatureTest.platform;event.ctrlKey&&!isMac||event.shiftKey||event.metaKey&&isMac?this.parent.toggleSelected(this):this.parent.setSelected(this)}#setUpDragSession(event){const{isSelected}=this;this._uiManager.setUpDragSession();const ac=new AbortController,signal=this._uiManager.combinedSignal(ac);if(isSelected){this.div.classList.add("moving"),this.#prevDragX=event.clientX,this.#prevDragY=event.clientY;const pointerMoveCallback=e=>{const{clientX:x,clientY:y}=e,[tx,ty]=this.screenToPageTranslation(x-this.#prevDragX,y-this.#prevDragY);this.#prevDragX=x,this.#prevDragY=y,this._uiManager.dragSelectedEditors(tx,ty)};window.addEventListener("pointermove",pointerMoveCallback,{passive:!0,capture:!0,signal})}const pointerUpCallback=()=>{ac.abort(),isSelected&&this.div.classList.remove("moving"),this.#hasBeenClicked=!1,this._uiManager.endDragSession()||this.#selectOnPointerEvent(event)};window.addEventListener("pointerup",pointerUpCallback,{signal}),window.addEventListener("blur",pointerUpCallback,{signal})}moveInDOM(){this.#moveInDOMTimeout&&clearTimeout(this.#moveInDOMTimeout),this.#moveInDOMTimeout=setTimeout((()=>{this.#moveInDOMTimeout=null,this.parent?.moveEditorInDOM(this)}),0)}_setParentAndPosition(parent,x,y){parent.changeParent(this),this.x=x,this.y=y,this.fixAndSetPosition()}getRect(tx,ty,rotation=this.rotation){const scale=this.parentScale,[pageWidth,pageHeight]=this.pageDimensions,[pageX,pageY]=this.pageTranslation,shiftX=tx/scale,shiftY=ty/scale,x=this.x*pageWidth,y=this.y*pageHeight,width=this.width*pageWidth,height=this.height*pageHeight;switch(rotation){case 0:return[x+shiftX+pageX,pageHeight-y-shiftY-height+pageY,x+shiftX+width+pageX,pageHeight-y-shiftY+pageY];case 90:return[x+shiftY+pageX,pageHeight-y+shiftX+pageY,x+shiftY+height+pageX,pageHeight-y+shiftX+width+pageY];case 180:return[x-shiftX-width+pageX,pageHeight-y+shiftY+pageY,x-shiftX+pageX,pageHeight-y+shiftY+height+pageY];case 270:return[x-shiftY-height+pageX,pageHeight-y-shiftX-width+pageY,x-shiftY+pageX,pageHeight-y-shiftX+pageY];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(rect,pageHeight){const[x1,y1,x2,y2]=rect,width=x2-x1,height=y2-y1;switch(this.rotation){case 0:return[x1,pageHeight-y2,width,height];case 90:return[x1,pageHeight-y1,height,width];case 180:return[x2,pageHeight-y1,width,height];case 270:return[x2,pageHeight-y2,height,width];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#isInEditMode=!0}disableEditMode(){this.#isInEditMode=!1}isInEditMode(){return this.#isInEditMode}shouldGetKeyboardEvents(){return this.#isResizerEnabledForKeyboard}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}#addFocusListeners(){if(this.#focusAC||!this.div)return;this.#focusAC=new AbortController;const signal=this._uiManager.combinedSignal(this.#focusAC);this.div.addEventListener("focusin",this.focusin.bind(this),{signal}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal})}rebuild(){this.#addFocusListeners()}rotate(_angle){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(isForCopying=!1,context=null){unreachable("An editor must be serializable")}static deserialize(data,parent,uiManager){var _this16=this;return(0,asyncToGenerator.A)((function*(){const editor=new _this16.prototype.constructor({parent,id:parent.getNextId(),uiManager});editor.rotation=data.rotation,editor.#accessibilityData=data.accessibilityData;const[pageWidth,pageHeight]=editor.pageDimensions,[x,y,width,height]=editor.getRectInCurrentCoords(data.rect,pageHeight);return editor.x=x/pageWidth,editor.y=y/pageHeight,editor.width=width/pageWidth,editor.height=height/pageHeight,editor}))()}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}remove(){if(this.#focusAC?.abort(),this.#focusAC=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#moveInDOMTimeout&&(clearTimeout(this.#moveInDOMTimeout),this.#moveInDOMTimeout=null),this.#stopResizing(),this.removeEditToolbar(),this.#telemetryTimeouts){for(const timeout of this.#telemetryTimeouts.values())clearTimeout(timeout);this.#telemetryTimeouts=null}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#createResizers(),this.#resizersDiv.classList.remove("hidden"),bindEvents(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(event){if(!this.isResizable||event.target!==this.div||"Enter"!==event.key)return;this._uiManager.setSelected(this),this.#savedDimensions={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const children=this.#resizersDiv.children;if(!this.#allResizerDivs){this.#allResizerDivs=Array.from(children);const boundResizerKeydown=this.#resizerKeydown.bind(this),boundResizerBlur=this.#resizerBlur.bind(this),signal=this._uiManager._signal;for(const div of this.#allResizerDivs){const name=div.getAttribute("data-resizer-name");div.setAttribute("role","spinbutton"),div.addEventListener("keydown",boundResizerKeydown,{signal}),div.addEventListener("blur",boundResizerBlur,{signal}),div.addEventListener("focus",this.#resizerFocus.bind(this,name),{signal}),div.setAttribute("data-l10n-id",AnnotationEditor._l10nResizer[name])}}const first=this.#allResizerDivs[0];let firstPosition=0;for(const div of children){if(div===first)break;firstPosition++}const nextFirstPosition=(360-this.rotation+this.parentRotation)%360/90*(this.#allResizerDivs.length/4);if(nextFirstPosition!==firstPosition){if(nextFirstPosition<firstPosition)for(let i=0;i<firstPosition-nextFirstPosition;i++)this.#resizersDiv.append(this.#resizersDiv.firstChild);else if(nextFirstPosition>firstPosition)for(let i=0;i<nextFirstPosition-firstPosition;i++)this.#resizersDiv.firstChild.before(this.#resizersDiv.lastChild);let i=0;for(const child of children){const name=this.#allResizerDivs[i++].getAttribute("data-resizer-name");child.setAttribute("data-l10n-id",AnnotationEditor._l10nResizer[name])}}this.#setResizerTabIndex(0),this.#isResizerEnabledForKeyboard=!0,this.#resizersDiv.firstChild.focus({focusVisible:!0}),event.preventDefault(),event.stopImmediatePropagation()}#resizerKeydown(event){AnnotationEditor._resizerKeyboardManager.exec(this,event)}#resizerBlur(event){this.#isResizerEnabledForKeyboard&&event.relatedTarget?.parentNode!==this.#resizersDiv&&this.#stopResizing()}#resizerFocus(name){this.#focusedResizerName=this.#isResizerEnabledForKeyboard?name:""}#setResizerTabIndex(value){if(this.#allResizerDivs)for(const div of this.#allResizerDivs)div.tabIndex=value}_resizeWithKeyboard(x,y){this.#isResizerEnabledForKeyboard&&this.#resizerPointermove(this.#focusedResizerName,{movementX:x,movementY:y})}#stopResizing(){if(this.#isResizerEnabledForKeyboard=!1,this.#setResizerTabIndex(-1),this.#savedDimensions){const{savedX,savedY,savedWidth,savedHeight}=this.#savedDimensions;this.#addResizeToUndoStack(savedX,savedY,savedWidth,savedHeight),this.#savedDimensions=null}}_stopResizingWithKeyboard(){this.#stopResizing(),this.div.focus()}select(){this.makeResizable(),this.div?.classList.add("selectedEditor"),this._editToolbar?(this._editToolbar?.show(),this.#altText?.toggleAltTextBadge(!1)):this.addEditToolbar().then((()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()}))}unselect(){this.#resizersDiv?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#altText?.toggleAltTextBadge(!0)}updateParams(type,value){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#isEditing}set isEditing(value){this.#isEditing=value,this.parent&&(value?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(width,height){this.#keepAspectRatio=!0;const aspectRatio=width/height,{style}=this.div;style.aspectRatio=aspectRatio,style.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(data,mustWait=!1){if(mustWait){this.#telemetryTimeouts||=new Map;const{action}=data;let timeout=this.#telemetryTimeouts.get(action);return timeout&&clearTimeout(timeout),timeout=setTimeout((()=>{this._reportTelemetry(data),this.#telemetryTimeouts.delete(action),0===this.#telemetryTimeouts.size&&(this.#telemetryTimeouts=null)}),AnnotationEditor._telemetryTimeout),void this.#telemetryTimeouts.set(action,timeout)}data.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data}})}show(visible=this._isVisible){this.div.classList.toggle("hidden",!visible),this._isVisible=visible}enable(){this.div&&(this.div.tabIndex=0),this.#disabled=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#disabled=!0}renderAnnotationElement(annotation){let content=annotation.container.querySelector(".annotationContent");if(content){if("CANVAS"===content.nodeName){const canvas=content;content=document.createElement("div"),content.classList.add("annotationContent",this.editorType),canvas.before(content)}}else content=document.createElement("div"),content.classList.add("annotationContent",this.editorType),annotation.container.prepend(content);return content}resetAnnotationElement(annotation){const{firstChild}=annotation.container;"DIV"===firstChild?.nodeName&&firstChild.classList.contains("annotationContent")&&firstChild.remove()}}class FakeEditor extends AnnotationEditor{constructor(params){super(params),this.annotationElementId=params.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}class MurmurHash3_64{constructor(seed){this.h1=seed?4294967295&seed:3285377520,this.h2=seed?4294967295&seed:3285377520}update(input){let data,length;if("string"==typeof input){data=new Uint8Array(2*input.length),length=0;for(let i=0,ii=input.length;i<ii;i++){const code=input.charCodeAt(i);code<=255?data[length++]=code:(data[length++]=code>>>8,data[length++]=255&code)}}else{if(!ArrayBuffer.isView(input))throw new Error("Invalid data format, must be a string or TypedArray.");data=input.slice(),length=data.byteLength}const blockCounts=length>>2,tailLength=length-4*blockCounts,dataUint32=new Uint32Array(data.buffer,0,blockCounts);let k1=0,k2=0,h1=this.h1,h2=this.h2;const C1=3432918353,C2=461845907;for(let i=0;i<blockCounts;i++)1&i?(k1=dataUint32[i],k1=k1*C1&4294901760|11601*k1&65535,k1=k1<<15|k1>>>17,k1=k1*C2&4294901760|13715*k1&65535,h1^=k1,h1=h1<<13|h1>>>19,h1=5*h1+3864292196):(k2=dataUint32[i],k2=k2*C1&4294901760|11601*k2&65535,k2=k2<<15|k2>>>17,k2=k2*C2&4294901760|13715*k2&65535,h2^=k2,h2=h2<<13|h2>>>19,h2=5*h2+3864292196);switch(k1=0,tailLength){case 3:k1^=data[4*blockCounts+2]<<16;case 2:k1^=data[4*blockCounts+1]<<8;case 1:k1^=data[4*blockCounts],k1=k1*C1&4294901760|11601*k1&65535,k1=k1<<15|k1>>>17,k1=k1*C2&4294901760|13715*k1&65535,1&blockCounts?h1^=k1:h2^=k1}this.h1=h1,this.h2=h2}hexdigest(){let h1=this.h1,h2=this.h2;return h1^=h2>>>1,h1=3981806797*h1&4294901760|36045*h1&65535,h2=4283543511*h2&4294901760|(2950163797*(h2<<16|h1>>>16)&4294901760)>>>16,h1^=h2>>>1,h1=444984403*h1&4294901760|60499*h1&65535,h2=3301882366*h2&4294901760|(3120437893*(h2<<16|h1>>>16)&4294901760)>>>16,h1^=h2>>>1,(h1>>>0).toString(16).padStart(8,"0")+(h2>>>0).toString(16).padStart(8,"0")}}const SerializableEmpty=Object.freeze({map:null,hash:"",transfer:void 0});class AnnotationStorage{#modified=!1;#modifiedIds=null;#storage=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(key,defaultValue){const value=this.#storage.get(key);return void 0===value?defaultValue:Object.assign(defaultValue,value)}getRawValue(key){return this.#storage.get(key)}remove(key){if(this.#storage.delete(key),0===this.#storage.size&&this.resetModified(),"function"==typeof this.onAnnotationEditor){for(const value of this.#storage.values())if(value instanceof AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(key,value){const obj=this.#storage.get(key);let modified=!1;if(void 0!==obj)for(const[entry,val]of Object.entries(value))obj[entry]!==val&&(modified=!0,obj[entry]=val);else modified=!0,this.#storage.set(key,value);modified&&this.#setModified(),value instanceof AnnotationEditor&&"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(value.constructor._type)}has(key){return this.#storage.has(key)}getAll(){return this.#storage.size>0?objectFromMap(this.#storage):null}setAll(obj){for(const[key,val]of Object.entries(obj))this.setValue(key,val)}get size(){return this.#storage.size}#setModified(){this.#modified||(this.#modified=!0,"function"==typeof this.onSetModified&&this.onSetModified())}resetModified(){this.#modified&&(this.#modified=!1,"function"==typeof this.onResetModified&&this.onResetModified())}get print(){return new PrintAnnotationStorage(this)}get serializable(){if(0===this.#storage.size)return SerializableEmpty;const map=new Map,hash=new MurmurHash3_64,transfer=[],context=Object.create(null);let hasBitmap=!1;for(const[key,val]of this.#storage){const serialized=val instanceof AnnotationEditor?val.serialize(!1,context):val;serialized&&(map.set(key,serialized),hash.update(`${key}:${JSON.stringify(serialized)}`),hasBitmap||=!!serialized.bitmap)}if(hasBitmap)for(const value of map.values())value.bitmap&&transfer.push(value.bitmap);return map.size>0?{map,hash:hash.hexdigest(),transfer}:SerializableEmpty}get editorStats(){let stats=null;const typeToEditor=new Map;for(const value of this.#storage.values()){if(!(value instanceof AnnotationEditor))continue;const editorStats=value.telemetryFinalData;if(!editorStats)continue;const{type}=editorStats;typeToEditor.has(type)||typeToEditor.set(type,Object.getPrototypeOf(value).constructor),stats||=Object.create(null);const map=stats[type]||=new Map;for(const[key,val]of Object.entries(editorStats)){if("type"===key)continue;let counters=map.get(key);counters||(counters=new Map,map.set(key,counters));const count=counters.get(val)??0;counters.set(val,count+1)}}for(const[type,editor]of typeToEditor)stats[type]=editor.computeTelemetryFinalData(stats[type]);return stats}resetModifiedIds(){this.#modifiedIds=null}get modifiedIds(){if(this.#modifiedIds)return this.#modifiedIds;const ids=[];for(const value of this.#storage.values())value instanceof AnnotationEditor&&value.annotationElementId&&value.serialize()&&ids.push(value.annotationElementId);return this.#modifiedIds={ids:new Set(ids),hash:ids.join(",")}}}class PrintAnnotationStorage extends AnnotationStorage{#serializable;constructor(parent){super();const{map,hash,transfer}=parent.serializable,clone=structuredClone(map,transfer?{transfer}:null);this.#serializable={map:clone,hash,transfer}}get print(){unreachable("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#serializable}get modifiedIds(){return shadow(this,"modifiedIds",{ids:new Set,hash:""})}}class FontLoader{#systemFonts=new Set;constructor({ownerDocument=globalThis.document,styleElement=null}){this._document=ownerDocument,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(nativeFontFace){this.nativeFontFaces.add(nativeFontFace),this._document.fonts.add(nativeFontFace)}removeNativeFontFace(nativeFontFace){this.nativeFontFaces.delete(nativeFontFace),this._document.fonts.delete(nativeFontFace)}insertRule(rule){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const styleSheet=this.styleElement.sheet;styleSheet.insertRule(rule,styleSheet.cssRules.length)}clear(){for(const nativeFontFace of this.nativeFontFaces)this._document.fonts.delete(nativeFontFace);this.nativeFontFaces.clear(),this.#systemFonts.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}loadSystemFont({systemFontInfo:info,_inspectFont}){var _this17=this;return(0,asyncToGenerator.A)((function*(){if(info&&!_this17.#systemFonts.has(info.loadedName))if(assert(!_this17.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),_this17.isFontLoadingAPISupported){const{loadedName,src,style}=info,fontFace=new FontFace(loadedName,src,style);_this17.addNativeFontFace(fontFace);try{yield fontFace.load(),_this17.#systemFonts.add(loadedName),_inspectFont?.(info)}catch{warn(`Cannot load system font: ${info.baseFontName}, installing it could help to improve PDF rendering.`),_this17.removeNativeFontFace(fontFace)}}else unreachable("Not implemented: loadSystemFont without the Font Loading API.")}))()}bind(font){var _this18=this;return(0,asyncToGenerator.A)((function*(){if(font.attached||font.missingFile&&!font.systemFontInfo)return;if(font.attached=!0,font.systemFontInfo)return void(yield _this18.loadSystemFont(font));if(_this18.isFontLoadingAPISupported){const nativeFontFace=font.createNativeFontFace();if(nativeFontFace){_this18.addNativeFontFace(nativeFontFace);try{yield nativeFontFace.loaded}catch(ex){throw warn(`Failed to load font '${nativeFontFace.family}': '${ex}'.`),font.disableFontFace=!0,ex}}return}const rule=font.createFontFaceRule();if(rule){if(_this18.insertRule(rule),_this18.isSyncFontLoadingSupported)return;yield new Promise((resolve=>{const request=_this18._queueLoadingCallback(resolve);_this18._prepareFontLoadEvent(font,request)}))}}))()}get isFontLoadingAPISupported(){return shadow(this,"isFontLoadingAPISupported",!!this._document?.fonts)}get isSyncFontLoadingSupported(){let supported=!1;return(isNodeJS||"undefined"!=typeof navigator&&"string"==typeof navigator?.userAgent&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(supported=!0),shadow(this,"isSyncFontLoadingSupported",supported)}_queueLoadingCallback(callback){const{loadingRequests}=this,request={done:!1,complete:function completeRequest(){for(assert(!request.done,"completeRequest() cannot be called twice."),request.done=!0;loadingRequests.length>0&&loadingRequests[0].done;){const otherRequest=loadingRequests.shift();setTimeout(otherRequest.callback,0)}},callback};return loadingRequests.push(request),request}get _loadTestFont(){return shadow(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(font,request){function int32(data,offset){return data.charCodeAt(offset)<<24|data.charCodeAt(offset+1)<<16|data.charCodeAt(offset+2)<<8|255&data.charCodeAt(offset+3)}function spliceString(s,offset,remove,insert){return s.substring(0,offset)+insert+s.substring(offset+remove)}let i,ii;const canvas=this._document.createElement("canvas");canvas.width=1,canvas.height=1;const ctx=canvas.getContext("2d");let called=0;const loadTestFontId=`lt${Date.now()}${this.loadTestFontId++}`;let data=this._loadTestFont;data=spliceString(data,976,loadTestFontId.length,loadTestFontId);let checksum=int32(data,16);for(i=0,ii=loadTestFontId.length-3;i<ii;i+=4)checksum=checksum-1482184792+int32(loadTestFontId,i)|0;i<loadTestFontId.length&&(checksum=checksum-1482184792+int32(loadTestFontId+"XXX",i)|0),data=spliceString(data,16,4,function string32(value){return String.fromCharCode(value>>24&255,value>>16&255,value>>8&255,255&value)}(checksum));const rule=`@font-face {font-family:"${loadTestFontId}";src:${`url(data:font/opentype;base64,${btoa(data)});`}}`;this.insertRule(rule);const div=this._document.createElement("div");div.style.visibility="hidden",div.style.width=div.style.height="10px",div.style.position="absolute",div.style.top=div.style.left="0px";for(const name of[font.loadedName,loadTestFontId]){const span=this._document.createElement("span");span.textContent="Hi",span.style.fontFamily=name,div.append(span)}this._document.body.append(div),function isFontReady(name,callback){if(++called>30)return warn("Load test font never loaded."),void callback();ctx.font="30px "+name,ctx.fillText(".",0,20),ctx.getImageData(0,0,1,1).data[3]>0?callback():setTimeout(isFontReady.bind(null,name,callback))}(loadTestFontId,(()=>{div.remove(),request.complete()}))}}class FontFaceObject{constructor(translatedData,{disableFontFace=!1,inspectFont=null}){this.compiledGlyphs=Object.create(null);for(const i in translatedData)this[i]=translatedData[i];this.disableFontFace=!0===disableFontFace,this._inspectFont=inspectFont}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let nativeFontFace;if(this.cssFontInfo){const css={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(css.style=`oblique ${this.cssFontInfo.italicAngle}deg`),nativeFontFace=new FontFace(this.cssFontInfo.fontFamily,this.data,css)}else nativeFontFace=new FontFace(this.loadedName,this.data,{});return this._inspectFont?.(this),nativeFontFace}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const url=`url(data:${this.mimetype};base64,${function toBase64Util(arr){return Uint8Array.prototype.toBase64?arr.toBase64():btoa(bytesToString(arr))}(this.data)});`;let rule;if(this.cssFontInfo){let css=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(css+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),rule=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${css}src:${url}}`}else rule=`@font-face {font-family:"${this.loadedName}";src:${url}}`;return this._inspectFont?.(this,url),rule}getPathGenerator(objs,character){if(void 0!==this.compiledGlyphs[character])return this.compiledGlyphs[character];let cmds;try{cmds=objs.get(this.loadedName+"_path_"+character)}catch(ex){warn(`getPathGenerator - ignoring character: "${ex}".`)}if(!Array.isArray(cmds)||0===cmds.length)return this.compiledGlyphs[character]=function(c,size){};const commands=[];for(let i=0,ii=cmds.length;i<ii;)switch(cmds[i++]){case FontRenderOps_BEZIER_CURVE_TO:{const[a,b,c,d,e,f]=cmds.slice(i,i+6);commands.push((ctx=>ctx.bezierCurveTo(a,b,c,d,e,f))),i+=6}break;case FontRenderOps_MOVE_TO:{const[a,b]=cmds.slice(i,i+2);commands.push((ctx=>ctx.moveTo(a,b))),i+=2}break;case FontRenderOps_LINE_TO:{const[a,b]=cmds.slice(i,i+2);commands.push((ctx=>ctx.lineTo(a,b))),i+=2}break;case FontRenderOps_QUADRATIC_CURVE_TO:{const[a,b,c,d]=cmds.slice(i,i+4);commands.push((ctx=>ctx.quadraticCurveTo(a,b,c,d))),i+=4}break;case FontRenderOps_RESTORE:commands.push((ctx=>ctx.restore()));break;case FontRenderOps_SAVE:commands.push((ctx=>ctx.save()));break;case FontRenderOps_SCALE:assert(2===commands.length,"Scale command is only valid at the third position.");break;case FontRenderOps_TRANSFORM:{const[a,b,c,d,e,f]=cmds.slice(i,i+6);commands.push((ctx=>ctx.transform(a,b,c,d,e,f))),i+=6}break;case FontRenderOps_TRANSLATE:{const[a,b]=cmds.slice(i,i+2);commands.push((ctx=>ctx.translate(a,b))),i+=2}}return this.compiledGlyphs[character]=function glyphDrawer(ctx,size){commands[0](ctx),commands[1](ctx),ctx.scale(size,-size);for(let i=2,ii=commands.length;i<ii;i++)commands[i](ctx)}}}class BaseCanvasFactory{#enableHWA=!1;constructor({enableHWA=!1}){this.#enableHWA=enableHWA}create(width,height){if(width<=0||height<=0)throw new Error("Invalid canvas size");const canvas=this._createCanvas(width,height);return{canvas,context:canvas.getContext("2d",{willReadFrequently:!this.#enableHWA})}}reset(canvasAndContext,width,height){if(!canvasAndContext.canvas)throw new Error("Canvas is not specified");if(width<=0||height<=0)throw new Error("Invalid canvas size");canvasAndContext.canvas.width=width,canvasAndContext.canvas.height=height}destroy(canvasAndContext){if(!canvasAndContext.canvas)throw new Error("Canvas is not specified");canvasAndContext.canvas.width=0,canvasAndContext.canvas.height=0,canvasAndContext.canvas=null,canvasAndContext.context=null}_createCanvas(width,height){unreachable("Abstract method `_createCanvas` called.")}}class BaseCMapReaderFactory{constructor({baseUrl=null,isCompressed=!0}){this.baseUrl=baseUrl,this.isCompressed=isCompressed}fetch({name}){var _this19=this;return(0,asyncToGenerator.A)((function*(){if(!_this19.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!name)throw new Error("CMap name must be specified.");const url=_this19.baseUrl+name+(_this19.isCompressed?".bcmap":"");return _this19._fetch(url).then((cMapData=>({cMapData,isCompressed:_this19.isCompressed}))).catch((reason=>{throw new Error(`Unable to load ${_this19.isCompressed?"binary ":""}CMap at: ${url}`)}))}))()}_fetch(url){return(0,asyncToGenerator.A)((function*(){unreachable("Abstract method `_fetch` called.")}))()}}class DOMCMapReaderFactory extends BaseCMapReaderFactory{_fetch(url){var _this20=this;return(0,asyncToGenerator.A)((function*(){const data=yield fetchData(url,_this20.isCompressed?"arraybuffer":"text");return data instanceof ArrayBuffer?new Uint8Array(data):stringToBytes(data)}))()}}class BaseFilterFactory{addFilter(maps){return"none"}addHCMFilter(fgColor,bgColor){return"none"}addAlphaFilter(map){return"none"}addLuminosityFilter(map){return"none"}addHighlightHCMFilter(filterName,fgColor,bgColor,newFgColor,newBgColor){return"none"}destroy(keepHCM=!1){}}class BaseStandardFontDataFactory{constructor({baseUrl=null}){this.baseUrl=baseUrl}fetch({filename}){var _this21=this;return(0,asyncToGenerator.A)((function*(){if(!_this21.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!filename)throw new Error("Font filename must be specified.");const url=`${_this21.baseUrl}${filename}`;return _this21._fetch(url).catch((reason=>{throw new Error(`Unable to load font data at: ${url}`)}))}))()}_fetch(url){return(0,asyncToGenerator.A)((function*(){unreachable("Abstract method `_fetch` called.")}))()}}class DOMStandardFontDataFactory extends BaseStandardFontDataFactory{_fetch(url){return(0,asyncToGenerator.A)((function*(){const data=yield fetchData(url,"arraybuffer");return new Uint8Array(data)}))()}}if(isNodeJS){var packageCapability=Promise.withResolvers(),packageMap=null;(function(){var _ref2=(0,asyncToGenerator.A)((function*(){const fs=yield import("fs"),http=yield import("http"),https=yield import("https"),url=yield import("url");return new Map(Object.entries({fs,http,https,url,canvas:undefined,path2d:undefined}))}));return function loadPackages(){return _ref2.apply(this,arguments)}})()().then((map=>{packageMap=map,packageCapability.resolve()}),(reason=>{warn(`loadPackages: ${reason}`),packageMap=new Map,packageCapability.resolve()}))}class NodePackages{static get promise(){return packageCapability.promise}static get(name){return packageMap?.get(name)}}function node_utils_fetchData(_x2){return _node_utils_fetchData.apply(this,arguments)}function _node_utils_fetchData(){return(_node_utils_fetchData=(0,asyncToGenerator.A)((function*(url){const fs=NodePackages.get("fs"),data=yield fs.promises.readFile(url);return new Uint8Array(data)}))).apply(this,arguments)}const PathType_FILL="Fill",PathType_STROKE="Stroke",PathType_SHADING="Shading";function applyBoundingBox(ctx,bbox){if(!bbox)return;const width=bbox[2]-bbox[0],height=bbox[3]-bbox[1],region=new Path2D;region.rect(bbox[0],bbox[1],width,height),ctx.clip(region)}class BaseShadingPattern{getPattern(){unreachable("Abstract method `getPattern` called.")}}class RadialAxialShadingPattern extends BaseShadingPattern{constructor(IR){super(),this._type=IR[1],this._bbox=IR[2],this._colorStops=IR[3],this._p0=IR[4],this._p1=IR[5],this._r0=IR[6],this._r1=IR[7],this.matrix=null}_createGradient(ctx){let grad;"axial"===this._type?grad=ctx.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(grad=ctx.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const colorStop of this._colorStops)grad.addColorStop(colorStop[0],colorStop[1]);return grad}getPattern(ctx,owner,inverse,pathType){let pattern;if(pathType===PathType_STROKE||pathType===PathType_FILL){const ownerBBox=owner.current.getClippedPathBoundingBox(pathType,getCurrentTransform(ctx))||[0,0,0,0],width=Math.ceil(ownerBBox[2]-ownerBBox[0])||1,height=Math.ceil(ownerBBox[3]-ownerBBox[1])||1,tmpCanvas=owner.cachedCanvases.getCanvas("pattern",width,height),tmpCtx=tmpCanvas.context;tmpCtx.clearRect(0,0,tmpCtx.canvas.width,tmpCtx.canvas.height),tmpCtx.beginPath(),tmpCtx.rect(0,0,tmpCtx.canvas.width,tmpCtx.canvas.height),tmpCtx.translate(-ownerBBox[0],-ownerBBox[1]),inverse=Util.transform(inverse,[1,0,0,1,ownerBBox[0],ownerBBox[1]]),tmpCtx.transform(...owner.baseTransform),this.matrix&&tmpCtx.transform(...this.matrix),applyBoundingBox(tmpCtx,this._bbox),tmpCtx.fillStyle=this._createGradient(tmpCtx),tmpCtx.fill(),pattern=ctx.createPattern(tmpCanvas.canvas,"no-repeat");const domMatrix=new DOMMatrix(inverse);pattern.setTransform(domMatrix)}else applyBoundingBox(ctx,this._bbox),pattern=this._createGradient(ctx);return pattern}}function drawTriangle(data,context,p1,p2,p3,c1,c2,c3){const coords=context.coords,colors=context.colors,bytes=data.data,rowSize=4*data.width;let tmp;coords[p1+1]>coords[p2+1]&&(tmp=p1,p1=p2,p2=tmp,tmp=c1,c1=c2,c2=tmp),coords[p2+1]>coords[p3+1]&&(tmp=p2,p2=p3,p3=tmp,tmp=c2,c2=c3,c3=tmp),coords[p1+1]>coords[p2+1]&&(tmp=p1,p1=p2,p2=tmp,tmp=c1,c1=c2,c2=tmp);const x1=(coords[p1]+context.offsetX)*context.scaleX,y1=(coords[p1+1]+context.offsetY)*context.scaleY,x2=(coords[p2]+context.offsetX)*context.scaleX,y2=(coords[p2+1]+context.offsetY)*context.scaleY,x3=(coords[p3]+context.offsetX)*context.scaleX,y3=(coords[p3+1]+context.offsetY)*context.scaleY;if(y1>=y3)return;const c1r=colors[c1],c1g=colors[c1+1],c1b=colors[c1+2],c2r=colors[c2],c2g=colors[c2+1],c2b=colors[c2+2],c3r=colors[c3],c3g=colors[c3+1],c3b=colors[c3+2],minY=Math.round(y1),maxY=Math.round(y3);let xa,car,cag,cab,xb,cbr,cbg,cbb;for(let y=minY;y<=maxY;y++){if(y<y2){const k=y<y1?0:(y1-y)/(y1-y2);xa=x1-(x1-x2)*k,car=c1r-(c1r-c2r)*k,cag=c1g-(c1g-c2g)*k,cab=c1b-(c1b-c2b)*k}else{let k;k=y>y3?1:y2===y3?0:(y2-y)/(y2-y3),xa=x2-(x2-x3)*k,car=c2r-(c2r-c3r)*k,cag=c2g-(c2g-c3g)*k,cab=c2b-(c2b-c3b)*k}let k;k=y<y1?0:y>y3?1:(y1-y)/(y1-y3),xb=x1-(x1-x3)*k,cbr=c1r-(c1r-c3r)*k,cbg=c1g-(c1g-c3g)*k,cbb=c1b-(c1b-c3b)*k;const x1_=Math.round(Math.min(xa,xb)),x2_=Math.round(Math.max(xa,xb));let j=rowSize*y+4*x1_;for(let x=x1_;x<=x2_;x++)k=(xa-x)/(xa-xb),k<0?k=0:k>1&&(k=1),bytes[j++]=car-(car-cbr)*k|0,bytes[j++]=cag-(cag-cbg)*k|0,bytes[j++]=cab-(cab-cbb)*k|0,bytes[j++]=255}}function drawFigure(data,figure,context){const ps=figure.coords,cs=figure.colors;let i,ii;switch(figure.type){case"lattice":const verticesPerRow=figure.verticesPerRow,rows=Math.floor(ps.length/verticesPerRow)-1,cols=verticesPerRow-1;for(i=0;i<rows;i++){let q=i*verticesPerRow;for(let j=0;j<cols;j++,q++)drawTriangle(data,context,ps[q],ps[q+1],ps[q+verticesPerRow],cs[q],cs[q+1],cs[q+verticesPerRow]),drawTriangle(data,context,ps[q+verticesPerRow+1],ps[q+1],ps[q+verticesPerRow],cs[q+verticesPerRow+1],cs[q+1],cs[q+verticesPerRow])}break;case"triangles":for(i=0,ii=ps.length;i<ii;i+=3)drawTriangle(data,context,ps[i],ps[i+1],ps[i+2],cs[i],cs[i+1],cs[i+2]);break;default:throw new Error("illegal figure")}}class MeshShadingPattern extends BaseShadingPattern{constructor(IR){super(),this._coords=IR[2],this._colors=IR[3],this._figures=IR[4],this._bounds=IR[5],this._bbox=IR[7],this._background=IR[8],this.matrix=null}_createMeshCanvas(combinedScale,backgroundColor,cachedCanvases){const offsetX=Math.floor(this._bounds[0]),offsetY=Math.floor(this._bounds[1]),boundsWidth=Math.ceil(this._bounds[2])-offsetX,boundsHeight=Math.ceil(this._bounds[3])-offsetY,width=Math.min(Math.ceil(Math.abs(boundsWidth*combinedScale[0]*1.1)),3e3),height=Math.min(Math.ceil(Math.abs(boundsHeight*combinedScale[1]*1.1)),3e3),scaleX=boundsWidth/width,scaleY=boundsHeight/height,context={coords:this._coords,colors:this._colors,offsetX:-offsetX,offsetY:-offsetY,scaleX:1/scaleX,scaleY:1/scaleY},paddedWidth=width+4,paddedHeight=height+4,tmpCanvas=cachedCanvases.getCanvas("mesh",paddedWidth,paddedHeight),tmpCtx=tmpCanvas.context,data=tmpCtx.createImageData(width,height);if(backgroundColor){const bytes=data.data;for(let i=0,ii=bytes.length;i<ii;i+=4)bytes[i]=backgroundColor[0],bytes[i+1]=backgroundColor[1],bytes[i+2]=backgroundColor[2],bytes[i+3]=255}for(const figure of this._figures)drawFigure(data,figure,context);tmpCtx.putImageData(data,2,2);return{canvas:tmpCanvas.canvas,offsetX:offsetX-2*scaleX,offsetY:offsetY-2*scaleY,scaleX,scaleY}}getPattern(ctx,owner,inverse,pathType){let scale;if(applyBoundingBox(ctx,this._bbox),pathType===PathType_SHADING)scale=Util.singularValueDecompose2dScale(getCurrentTransform(ctx));else if(scale=Util.singularValueDecompose2dScale(owner.baseTransform),this.matrix){const matrixScale=Util.singularValueDecompose2dScale(this.matrix);scale=[scale[0]*matrixScale[0],scale[1]*matrixScale[1]]}const temporaryPatternCanvas=this._createMeshCanvas(scale,pathType===PathType_SHADING?null:this._background,owner.cachedCanvases);return pathType!==PathType_SHADING&&(ctx.setTransform(...owner.baseTransform),this.matrix&&ctx.transform(...this.matrix)),ctx.translate(temporaryPatternCanvas.offsetX,temporaryPatternCanvas.offsetY),ctx.scale(temporaryPatternCanvas.scaleX,temporaryPatternCanvas.scaleY),ctx.createPattern(temporaryPatternCanvas.canvas,"no-repeat")}}class DummyShadingPattern extends BaseShadingPattern{getPattern(){return"hotpink"}}const PaintType_COLORED=1,PaintType_UNCOLORED=2;class TilingPattern{static MAX_PATTERN_SIZE=3e3;constructor(IR,color,ctx,canvasGraphicsFactory,baseTransform){this.operatorList=IR[2],this.matrix=IR[3],this.bbox=IR[4],this.xstep=IR[5],this.ystep=IR[6],this.paintType=IR[7],this.tilingType=IR[8],this.color=color,this.ctx=ctx,this.canvasGraphicsFactory=canvasGraphicsFactory,this.baseTransform=baseTransform}createPatternCanvas(owner){const{bbox,operatorList,paintType,tilingType,color,canvasGraphicsFactory}=this;let{xstep,ystep}=this;xstep=Math.abs(xstep),ystep=Math.abs(ystep),info("TilingType: "+tilingType);const x0=bbox[0],y0=bbox[1],x1=bbox[2],y1=bbox[3],width=x1-x0,height=y1-y0,matrixScale=Util.singularValueDecompose2dScale(this.matrix),curMatrixScale=Util.singularValueDecompose2dScale(this.baseTransform),combinedScaleX=matrixScale[0]*curMatrixScale[0],combinedScaleY=matrixScale[1]*curMatrixScale[1];let canvasWidth=width,canvasHeight=height,redrawHorizontally=!1,redrawVertically=!1;const xScaledStep=Math.ceil(xstep*combinedScaleX),yScaledStep=Math.ceil(ystep*combinedScaleY);xScaledStep>=Math.ceil(width*combinedScaleX)?canvasWidth=xstep:redrawHorizontally=!0,yScaledStep>=Math.ceil(height*combinedScaleY)?canvasHeight=ystep:redrawVertically=!0;const dimx=this.getSizeAndScale(canvasWidth,this.ctx.canvas.width,combinedScaleX),dimy=this.getSizeAndScale(canvasHeight,this.ctx.canvas.height,combinedScaleY),tmpCanvas=owner.cachedCanvases.getCanvas("pattern",dimx.size,dimy.size),tmpCtx=tmpCanvas.context,graphics=canvasGraphicsFactory.createCanvasGraphics(tmpCtx);if(graphics.groupLevel=owner.groupLevel,this.setFillAndStrokeStyleToContext(graphics,paintType,color),tmpCtx.translate(-dimx.scale*x0,-dimy.scale*y0),graphics.transform(dimx.scale,0,0,dimy.scale,0,0),tmpCtx.save(),this.clipBbox(graphics,x0,y0,x1,y1),graphics.baseTransform=getCurrentTransform(graphics.ctx),graphics.executeOperatorList(operatorList),graphics.endDrawing(),tmpCtx.restore(),redrawHorizontally||redrawVertically){const image=tmpCanvas.canvas;redrawHorizontally&&(canvasWidth=xstep),redrawVertically&&(canvasHeight=ystep);const dimx2=this.getSizeAndScale(canvasWidth,this.ctx.canvas.width,combinedScaleX),dimy2=this.getSizeAndScale(canvasHeight,this.ctx.canvas.height,combinedScaleY),xSize=dimx2.size,ySize=dimy2.size,tmpCanvas2=owner.cachedCanvases.getCanvas("pattern-workaround",xSize,ySize),tmpCtx2=tmpCanvas2.context,ii=redrawHorizontally?Math.floor(width/xstep):0,jj=redrawVertically?Math.floor(height/ystep):0;for(let i=0;i<=ii;i++)for(let j=0;j<=jj;j++)tmpCtx2.drawImage(image,xSize*i,ySize*j,xSize,ySize,0,0,xSize,ySize);return{canvas:tmpCanvas2.canvas,scaleX:dimx2.scale,scaleY:dimy2.scale,offsetX:x0,offsetY:y0}}return{canvas:tmpCanvas.canvas,scaleX:dimx.scale,scaleY:dimy.scale,offsetX:x0,offsetY:y0}}getSizeAndScale(step,realOutputSize,scale){const maxSize=Math.max(TilingPattern.MAX_PATTERN_SIZE,realOutputSize);let size=Math.ceil(step*scale);return size>=maxSize?size=maxSize:scale=size/step,{scale,size}}clipBbox(graphics,x0,y0,x1,y1){const bboxWidth=x1-x0,bboxHeight=y1-y0;graphics.ctx.rect(x0,y0,bboxWidth,bboxHeight),graphics.current.updateRectMinMax(getCurrentTransform(graphics.ctx),[x0,y0,x1,y1]),graphics.clip(),graphics.endPath()}setFillAndStrokeStyleToContext(graphics,paintType,color){const context=graphics.ctx,current=graphics.current;switch(paintType){case PaintType_COLORED:const ctx=this.ctx;context.fillStyle=ctx.fillStyle,context.strokeStyle=ctx.strokeStyle,current.fillColor=ctx.fillStyle,current.strokeColor=ctx.strokeStyle;break;case PaintType_UNCOLORED:const cssColor=Util.makeHexColor(color[0],color[1],color[2]);context.fillStyle=cssColor,context.strokeStyle=cssColor,current.fillColor=cssColor,current.strokeColor=cssColor;break;default:throw new FormatError(`Unsupported paint type: ${paintType}`)}}getPattern(ctx,owner,inverse,pathType){let matrix=inverse;pathType!==PathType_SHADING&&(matrix=Util.transform(matrix,owner.baseTransform),this.matrix&&(matrix=Util.transform(matrix,this.matrix)));const temporaryPatternCanvas=this.createPatternCanvas(owner);let domMatrix=new DOMMatrix(matrix);domMatrix=domMatrix.translate(temporaryPatternCanvas.offsetX,temporaryPatternCanvas.offsetY),domMatrix=domMatrix.scale(1/temporaryPatternCanvas.scaleX,1/temporaryPatternCanvas.scaleY);const pattern=ctx.createPattern(temporaryPatternCanvas.canvas,"repeat");return pattern.setTransform(domMatrix),pattern}}function convertBlackAndWhiteToRGBA({src,srcPos=0,dest,width,height,nonBlackColor=4294967295,inverseDecode=!1}){const black=util_FeatureTest.isLittleEndian?4278190080:255,[zeroMapping,oneMapping]=inverseDecode?[nonBlackColor,black]:[black,nonBlackColor],widthInSource=width>>3,widthRemainder=7&width,srcLength=src.length;dest=new Uint32Array(dest.buffer);let destPos=0;for(let i=0;i<height;i++){for(const max=srcPos+widthInSource;srcPos<max;srcPos++){const elem=srcPos<srcLength?src[srcPos]:255;dest[destPos++]=128&elem?oneMapping:zeroMapping,dest[destPos++]=64&elem?oneMapping:zeroMapping,dest[destPos++]=32&elem?oneMapping:zeroMapping,dest[destPos++]=16&elem?oneMapping:zeroMapping,dest[destPos++]=8&elem?oneMapping:zeroMapping,dest[destPos++]=4&elem?oneMapping:zeroMapping,dest[destPos++]=2&elem?oneMapping:zeroMapping,dest[destPos++]=1&elem?oneMapping:zeroMapping}if(0===widthRemainder)continue;const elem=srcPos<srcLength?src[srcPos++]:255;for(let j=0;j<widthRemainder;j++)dest[destPos++]=elem&1<<7-j?oneMapping:zeroMapping}return{srcPos,destPos}}class CachedCanvases{constructor(canvasFactory){this.canvasFactory=canvasFactory,this.cache=Object.create(null)}getCanvas(id,width,height){let canvasEntry;return void 0!==this.cache[id]?(canvasEntry=this.cache[id],this.canvasFactory.reset(canvasEntry,width,height)):(canvasEntry=this.canvasFactory.create(width,height),this.cache[id]=canvasEntry),canvasEntry}delete(id){delete this.cache[id]}clear(){for(const id in this.cache){const canvasEntry=this.cache[id];this.canvasFactory.destroy(canvasEntry),delete this.cache[id]}}}function drawImageAtIntegerCoords(ctx,srcImg,srcX,srcY,srcW,srcH,destX,destY,destW,destH){const[a,b,c,d,tx,ty]=getCurrentTransform(ctx);if(0===b&&0===c){const tlX=destX*a+tx,rTlX=Math.round(tlX),tlY=destY*d+ty,rTlY=Math.round(tlY),brX=(destX+destW)*a+tx,rWidth=Math.abs(Math.round(brX)-rTlX)||1,brY=(destY+destH)*d+ty,rHeight=Math.abs(Math.round(brY)-rTlY)||1;return ctx.setTransform(Math.sign(a),0,0,Math.sign(d),rTlX,rTlY),ctx.drawImage(srcImg,srcX,srcY,srcW,srcH,0,0,rWidth,rHeight),ctx.setTransform(a,b,c,d,tx,ty),[rWidth,rHeight]}if(0===a&&0===d){const tlX=destY*c+tx,rTlX=Math.round(tlX),tlY=destX*b+ty,rTlY=Math.round(tlY),brX=(destY+destH)*c+tx,rWidth=Math.abs(Math.round(brX)-rTlX)||1,brY=(destX+destW)*b+ty,rHeight=Math.abs(Math.round(brY)-rTlY)||1;return ctx.setTransform(0,Math.sign(b),Math.sign(c),0,rTlX,rTlY),ctx.drawImage(srcImg,srcX,srcY,srcW,srcH,0,0,rHeight,rWidth),ctx.setTransform(a,b,c,d,tx,ty),[rHeight,rWidth]}ctx.drawImage(srcImg,srcX,srcY,srcW,srcH,destX,destY,destW,destH);return[Math.hypot(a,b)*destW,Math.hypot(c,d)*destH]}class CanvasExtraState{constructor(width,height){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=TextRenderingMode_FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,width,height])}clone(){const clone=Object.create(this);return clone.clipBox=this.clipBox.slice(),clone}setCurrentPoint(x,y){this.x=x,this.y=y}updatePathMinMax(transform,x,y){[x,y]=Util.applyTransform([x,y],transform),this.minX=Math.min(this.minX,x),this.minY=Math.min(this.minY,y),this.maxX=Math.max(this.maxX,x),this.maxY=Math.max(this.maxY,y)}updateRectMinMax(transform,rect){const p1=Util.applyTransform(rect,transform),p2=Util.applyTransform(rect.slice(2),transform),p3=Util.applyTransform([rect[0],rect[3]],transform),p4=Util.applyTransform([rect[2],rect[1]],transform);this.minX=Math.min(this.minX,p1[0],p2[0],p3[0],p4[0]),this.minY=Math.min(this.minY,p1[1],p2[1],p3[1],p4[1]),this.maxX=Math.max(this.maxX,p1[0],p2[0],p3[0],p4[0]),this.maxY=Math.max(this.maxY,p1[1],p2[1],p3[1],p4[1])}updateScalingPathMinMax(transform,minMax){Util.scaleMinMax(transform,minMax),this.minX=Math.min(this.minX,minMax[0]),this.minY=Math.min(this.minY,minMax[1]),this.maxX=Math.max(this.maxX,minMax[2]),this.maxY=Math.max(this.maxY,minMax[3])}updateCurvePathMinMax(transform,x0,y0,x1,y1,x2,y2,x3,y3,minMax){const box=Util.bezierBoundingBox(x0,y0,x1,y1,x2,y2,x3,y3,minMax);minMax||this.updateRectMinMax(transform,box)}getPathBoundingBox(pathType=PathType_FILL,transform=null){const box=[this.minX,this.minY,this.maxX,this.maxY];if(pathType===PathType_STROKE){transform||unreachable("Stroke bounding box must include transform.");const scale=Util.singularValueDecompose2dScale(transform),xStrokePad=scale[0]*this.lineWidth/2,yStrokePad=scale[1]*this.lineWidth/2;box[0]-=xStrokePad,box[1]-=yStrokePad,box[2]+=xStrokePad,box[3]+=yStrokePad}return box}updateClipFromPath(){const intersect=Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(intersect||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(box){this.clipBox=box,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(pathType=PathType_FILL,transform=null){return Util.intersect(this.clipBox,this.getPathBoundingBox(pathType,transform))}}function putBinaryImageData(ctx,imgData){if("undefined"!=typeof ImageData&&imgData instanceof ImageData)return void ctx.putImageData(imgData,0,0);const height=imgData.height,width=imgData.width,partialChunkHeight=height%16,fullChunks=(height-partialChunkHeight)/16,totalChunks=0===partialChunkHeight?fullChunks:fullChunks+1,chunkImgData=ctx.createImageData(width,16);let destPos,srcPos=0;const src=imgData.data,dest=chunkImgData.data;let i,j,thisChunkHeight,elemsInThisChunk;if(imgData.kind===util_ImageKind.GRAYSCALE_1BPP){const srcLength=src.byteLength,dest32=new Uint32Array(dest.buffer,0,dest.byteLength>>2),dest32DataLength=dest32.length,fullSrcDiff=width+7>>3,white=4294967295,black=util_FeatureTest.isLittleEndian?4278190080:255;for(i=0;i<totalChunks;i++){for(thisChunkHeight=i<fullChunks?16:partialChunkHeight,destPos=0,j=0;j<thisChunkHeight;j++){const srcDiff=srcLength-srcPos;let k=0;const kEnd=srcDiff>fullSrcDiff?width:8*srcDiff-7,kEndUnrolled=-8&kEnd;let mask=0,srcByte=0;for(;k<kEndUnrolled;k+=8)srcByte=src[srcPos++],dest32[destPos++]=128&srcByte?white:black,dest32[destPos++]=64&srcByte?white:black,dest32[destPos++]=32&srcByte?white:black,dest32[destPos++]=16&srcByte?white:black,dest32[destPos++]=8&srcByte?white:black,dest32[destPos++]=4&srcByte?white:black,dest32[destPos++]=2&srcByte?white:black,dest32[destPos++]=1&srcByte?white:black;for(;k<kEnd;k++)0===mask&&(srcByte=src[srcPos++],mask=128),dest32[destPos++]=srcByte&mask?white:black,mask>>=1}for(;destPos<dest32DataLength;)dest32[destPos++]=0;ctx.putImageData(chunkImgData,0,16*i)}}else if(imgData.kind===util_ImageKind.RGBA_32BPP){for(j=0,elemsInThisChunk=16*width*4,i=0;i<fullChunks;i++)dest.set(src.subarray(srcPos,srcPos+elemsInThisChunk)),srcPos+=elemsInThisChunk,ctx.putImageData(chunkImgData,0,j),j+=16;i<totalChunks&&(elemsInThisChunk=width*partialChunkHeight*4,dest.set(src.subarray(srcPos,srcPos+elemsInThisChunk)),ctx.putImageData(chunkImgData,0,j))}else{if(imgData.kind!==util_ImageKind.RGB_24BPP)throw new Error(`bad image kind: ${imgData.kind}`);for(thisChunkHeight=16,elemsInThisChunk=width*thisChunkHeight,i=0;i<totalChunks;i++){for(i>=fullChunks&&(thisChunkHeight=partialChunkHeight,elemsInThisChunk=width*thisChunkHeight),destPos=0,j=elemsInThisChunk;j--;)dest[destPos++]=src[srcPos++],dest[destPos++]=src[srcPos++],dest[destPos++]=src[srcPos++],dest[destPos++]=255;ctx.putImageData(chunkImgData,0,16*i)}}}function putBinaryImageMask(ctx,imgData){if(imgData.bitmap)return void ctx.drawImage(imgData.bitmap,0,0);const height=imgData.height,width=imgData.width,partialChunkHeight=height%16,fullChunks=(height-partialChunkHeight)/16,totalChunks=0===partialChunkHeight?fullChunks:fullChunks+1,chunkImgData=ctx.createImageData(width,16);let srcPos=0;const src=imgData.data,dest=chunkImgData.data;for(let i=0;i<totalChunks;i++){const thisChunkHeight=i<fullChunks?16:partialChunkHeight;({srcPos}=convertBlackAndWhiteToRGBA({src,srcPos,dest,width,height:thisChunkHeight,nonBlackColor:0})),ctx.putImageData(chunkImgData,0,16*i)}}function copyCtxState(sourceCtx,destCtx){const properties=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const property of properties)void 0!==sourceCtx[property]&&(destCtx[property]=sourceCtx[property]);void 0!==sourceCtx.setLineDash&&(destCtx.setLineDash(sourceCtx.getLineDash()),destCtx.lineDashOffset=sourceCtx.lineDashOffset)}function resetCtxToDefault(ctx){if(ctx.strokeStyle=ctx.fillStyle="#000000",ctx.fillRule="nonzero",ctx.globalAlpha=1,ctx.lineWidth=1,ctx.lineCap="butt",ctx.lineJoin="miter",ctx.miterLimit=10,ctx.globalCompositeOperation="source-over",ctx.font="10px sans-serif",void 0!==ctx.setLineDash&&(ctx.setLineDash([]),ctx.lineDashOffset=0),!isNodeJS){const{filter}=ctx;"none"!==filter&&""!==filter&&(ctx.filter="none")}}function getImageSmoothingEnabled(transform,interpolate){if(interpolate)return!0;const scale=Util.singularValueDecompose2dScale(transform);scale[0]=Math.fround(scale[0]),scale[1]=Math.fround(scale[1]);const actualScale=Math.fround((globalThis.devicePixelRatio||1)*PixelsPerInch.PDF_TO_CSS_UNITS);return scale[0]<=actualScale&&scale[1]<=actualScale}const LINE_CAP_STYLES=["butt","round","square"],LINE_JOIN_STYLES=["miter","round","bevel"],NORMAL_CLIP={},EO_CLIP={};class CanvasGraphics{constructor(canvasCtx,commonObjs,objs,canvasFactory,filterFactory,{optionalContentConfig,markedContentStack=null},annotationCanvasMap,pageColors){this.ctx=canvasCtx,this.current=new CanvasExtraState(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=commonObjs,this.objs=objs,this.canvasFactory=canvasFactory,this.filterFactory=filterFactory,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=markedContentStack||[],this.optionalContentConfig=optionalContentConfig,this.cachedCanvases=new CachedCanvases(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=annotationCanvasMap,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=pageColors,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(data,fallback=null){return"string"==typeof data?data.startsWith("g_")?this.commonObjs.get(data):this.objs.get(data):fallback}beginDrawing({transform,viewport,transparency=!1,background=null}){const width=this.ctx.canvas.width,height=this.ctx.canvas.height,savedFillStyle=this.ctx.fillStyle;if(this.ctx.fillStyle=background||"#ffffff",this.ctx.fillRect(0,0,width,height),this.ctx.fillStyle=savedFillStyle,transparency){const transparentCanvas=this.cachedCanvases.getCanvas("transparent",width,height);this.compositeCtx=this.ctx,this.transparentCanvas=transparentCanvas.canvas,this.ctx=transparentCanvas.context,this.ctx.save(),this.ctx.transform(...getCurrentTransform(this.compositeCtx))}this.ctx.save(),resetCtxToDefault(this.ctx),transform&&(this.ctx.transform(...transform),this.outputScaleX=transform[0],this.outputScaleY=transform[0]),this.ctx.transform(...viewport.transform),this.viewportScale=viewport.scale,this.baseTransform=getCurrentTransform(this.ctx)}executeOperatorList(operatorList,executionStartIdx,continueCallback,stepper){const argsArray=operatorList.argsArray,fnArray=operatorList.fnArray;let i=executionStartIdx||0;const argsArrayLen=argsArray.length;if(argsArrayLen===i)return i;const chunkOperations=argsArrayLen-i>10&&"function"==typeof continueCallback,endTime=chunkOperations?Date.now()+15:0;let steps=0;const commonObjs=this.commonObjs,objs=this.objs;let fnId;for(;;){if(void 0!==stepper&&i===stepper.nextBreakPoint)return stepper.breakIt(i,continueCallback),i;if(fnId=fnArray[i],fnId!==OPS.dependency)this[fnId].apply(this,argsArray[i]);else for(const depObjId of argsArray[i]){const objsPool=depObjId.startsWith("g_")?commonObjs:objs;if(!objsPool.has(depObjId))return objsPool.get(depObjId,continueCallback),i}if(i++,i===argsArrayLen)return i;if(chunkOperations&&++steps>10){if(Date.now()>endTime)return continueCallback(),i;steps=0}}}#restoreInitialState(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#restoreInitialState(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const cache of this._cachedBitmapsMap.values()){for(const canvas of cache.values())"undefined"!=typeof HTMLCanvasElement&&canvas instanceof HTMLCanvasElement&&(canvas.width=canvas.height=0);cache.clear()}this._cachedBitmapsMap.clear(),this.#drawFilter()}#drawFilter(){if(this.pageColors){const hcmFilterId=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==hcmFilterId){const savedFilter=this.ctx.filter;this.ctx.filter=hcmFilterId,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=savedFilter}}}_scaleImage(img,inverseTransform){const width=img.width??img.displayWidth,height=img.height??img.displayHeight;let tmpCanvas,tmpCtx,widthScale=Math.max(Math.hypot(inverseTransform[0],inverseTransform[1]),1),heightScale=Math.max(Math.hypot(inverseTransform[2],inverseTransform[3]),1),paintWidth=width,paintHeight=height,tmpCanvasId="prescale1";for(;widthScale>2&&paintWidth>1||heightScale>2&&paintHeight>1;){let newWidth=paintWidth,newHeight=paintHeight;widthScale>2&&paintWidth>1&&(newWidth=paintWidth>=16384?Math.floor(paintWidth/2)-1||1:Math.ceil(paintWidth/2),widthScale/=paintWidth/newWidth),heightScale>2&&paintHeight>1&&(newHeight=paintHeight>=16384?Math.floor(paintHeight/2)-1||1:Math.ceil(paintHeight)/2,heightScale/=paintHeight/newHeight),tmpCanvas=this.cachedCanvases.getCanvas(tmpCanvasId,newWidth,newHeight),tmpCtx=tmpCanvas.context,tmpCtx.clearRect(0,0,newWidth,newHeight),tmpCtx.drawImage(img,0,0,paintWidth,paintHeight,0,0,newWidth,newHeight),img=tmpCanvas.canvas,paintWidth=newWidth,paintHeight=newHeight,tmpCanvasId="prescale1"===tmpCanvasId?"prescale2":"prescale1"}return{img,paintWidth,paintHeight}}_createMaskCanvas(img){const ctx=this.ctx,{width,height}=img,fillColor=this.current.fillColor,isPatternFill=this.current.patternFill,currentTransform=getCurrentTransform(ctx);let cache,cacheKey,scaled,maskCanvas;if((img.bitmap||img.data)&&img.count>1){const mainKey=img.bitmap||img.data.buffer;cacheKey=JSON.stringify(isPatternFill?currentTransform:[currentTransform.slice(0,4),fillColor]),cache=this._cachedBitmapsMap.get(mainKey),cache||(cache=new Map,this._cachedBitmapsMap.set(mainKey,cache));const cachedImage=cache.get(cacheKey);if(cachedImage&&!isPatternFill){return{canvas:cachedImage,offsetX:Math.round(Math.min(currentTransform[0],currentTransform[2])+currentTransform[4]),offsetY:Math.round(Math.min(currentTransform[1],currentTransform[3])+currentTransform[5])}}scaled=cachedImage}scaled||(maskCanvas=this.cachedCanvases.getCanvas("maskCanvas",width,height),putBinaryImageMask(maskCanvas.context,img));let maskToCanvas=Util.transform(currentTransform,[1/width,0,0,-1/height,0,0]);maskToCanvas=Util.transform(maskToCanvas,[1,0,0,1,0,-height]);const[minX,minY,maxX,maxY]=Util.getAxialAlignedBoundingBox([0,0,width,height],maskToCanvas),drawnWidth=Math.round(maxX-minX)||1,drawnHeight=Math.round(maxY-minY)||1,fillCanvas=this.cachedCanvases.getCanvas("fillCanvas",drawnWidth,drawnHeight),fillCtx=fillCanvas.context,offsetX=minX,offsetY=minY;fillCtx.translate(-offsetX,-offsetY),fillCtx.transform(...maskToCanvas),scaled||(scaled=this._scaleImage(maskCanvas.canvas,getCurrentTransformInverse(fillCtx)),scaled=scaled.img,cache&&isPatternFill&&cache.set(cacheKey,scaled)),fillCtx.imageSmoothingEnabled=getImageSmoothingEnabled(getCurrentTransform(fillCtx),img.interpolate),drawImageAtIntegerCoords(fillCtx,scaled,0,0,scaled.width,scaled.height,0,0,width,height),fillCtx.globalCompositeOperation="source-in";const inverse=Util.transform(getCurrentTransformInverse(fillCtx),[1,0,0,1,-offsetX,-offsetY]);return fillCtx.fillStyle=isPatternFill?fillColor.getPattern(ctx,this,inverse,PathType_FILL):fillColor,fillCtx.fillRect(0,0,width,height),cache&&!isPatternFill&&(this.cachedCanvases.delete("fillCanvas"),cache.set(cacheKey,fillCanvas.canvas)),{canvas:fillCanvas.canvas,offsetX:Math.round(offsetX),offsetY:Math.round(offsetY)}}setLineWidth(width){width!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=width,this.ctx.lineWidth=width}setLineCap(style){this.ctx.lineCap=LINE_CAP_STYLES[style]}setLineJoin(style){this.ctx.lineJoin=LINE_JOIN_STYLES[style]}setMiterLimit(limit){this.ctx.miterLimit=limit}setDash(dashArray,dashPhase){const ctx=this.ctx;void 0!==ctx.setLineDash&&(ctx.setLineDash(dashArray),ctx.lineDashOffset=dashPhase)}setRenderingIntent(intent){}setFlatness(flatness){}setGState(states){for(const[key,value]of states)switch(key){case"LW":this.setLineWidth(value);break;case"LC":this.setLineCap(value);break;case"LJ":this.setLineJoin(value);break;case"ML":this.setMiterLimit(value);break;case"D":this.setDash(value[0],value[1]);break;case"RI":this.setRenderingIntent(value);break;case"FL":this.setFlatness(value);break;case"Font":this.setFont(value[0],value[1]);break;case"CA":this.current.strokeAlpha=value;break;case"ca":this.current.fillAlpha=value,this.ctx.globalAlpha=value;break;case"BM":this.ctx.globalCompositeOperation=value;break;case"SMask":this.current.activeSMask=value?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(value)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const inSMaskMode=this.inSMaskMode;this.current.activeSMask&&!inSMaskMode?this.beginSMaskMode():!this.current.activeSMask&&inSMaskMode&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const drawnWidth=this.ctx.canvas.width,drawnHeight=this.ctx.canvas.height,cacheId="smaskGroupAt"+this.groupLevel,scratchCanvas=this.cachedCanvases.getCanvas(cacheId,drawnWidth,drawnHeight);this.suspendedCtx=this.ctx,this.ctx=scratchCanvas.context;const ctx=this.ctx;ctx.setTransform(...getCurrentTransform(this.suspendedCtx)),copyCtxState(this.suspendedCtx,ctx),function mirrorContextOperations(ctx,destCtx){if(ctx._removeMirroring)throw new Error("Context is already forwarding operations.");ctx.__originalSave=ctx.save,ctx.__originalRestore=ctx.restore,ctx.__originalRotate=ctx.rotate,ctx.__originalScale=ctx.scale,ctx.__originalTranslate=ctx.translate,ctx.__originalTransform=ctx.transform,ctx.__originalSetTransform=ctx.setTransform,ctx.__originalResetTransform=ctx.resetTransform,ctx.__originalClip=ctx.clip,ctx.__originalMoveTo=ctx.moveTo,ctx.__originalLineTo=ctx.lineTo,ctx.__originalBezierCurveTo=ctx.bezierCurveTo,ctx.__originalRect=ctx.rect,ctx.__originalClosePath=ctx.closePath,ctx.__originalBeginPath=ctx.beginPath,ctx._removeMirroring=()=>{ctx.save=ctx.__originalSave,ctx.restore=ctx.__originalRestore,ctx.rotate=ctx.__originalRotate,ctx.scale=ctx.__originalScale,ctx.translate=ctx.__originalTranslate,ctx.transform=ctx.__originalTransform,ctx.setTransform=ctx.__originalSetTransform,ctx.resetTransform=ctx.__originalResetTransform,ctx.clip=ctx.__originalClip,ctx.moveTo=ctx.__originalMoveTo,ctx.lineTo=ctx.__originalLineTo,ctx.bezierCurveTo=ctx.__originalBezierCurveTo,ctx.rect=ctx.__originalRect,ctx.closePath=ctx.__originalClosePath,ctx.beginPath=ctx.__originalBeginPath,delete ctx._removeMirroring},ctx.save=function ctxSave(){destCtx.save(),this.__originalSave()},ctx.restore=function ctxRestore(){destCtx.restore(),this.__originalRestore()},ctx.translate=function ctxTranslate(x,y){destCtx.translate(x,y),this.__originalTranslate(x,y)},ctx.scale=function ctxScale(x,y){destCtx.scale(x,y),this.__originalScale(x,y)},ctx.transform=function ctxTransform(a,b,c,d,e,f){destCtx.transform(a,b,c,d,e,f),this.__originalTransform(a,b,c,d,e,f)},ctx.setTransform=function ctxSetTransform(a,b,c,d,e,f){destCtx.setTransform(a,b,c,d,e,f),this.__originalSetTransform(a,b,c,d,e,f)},ctx.resetTransform=function ctxResetTransform(){destCtx.resetTransform(),this.__originalResetTransform()},ctx.rotate=function ctxRotate(angle){destCtx.rotate(angle),this.__originalRotate(angle)},ctx.clip=function ctxRotate(rule){destCtx.clip(rule),this.__originalClip(rule)},ctx.moveTo=function(x,y){destCtx.moveTo(x,y),this.__originalMoveTo(x,y)},ctx.lineTo=function(x,y){destCtx.lineTo(x,y),this.__originalLineTo(x,y)},ctx.bezierCurveTo=function(cp1x,cp1y,cp2x,cp2y,x,y){destCtx.bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y),this.__originalBezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y)},ctx.rect=function(x,y,width,height){destCtx.rect(x,y,width,height),this.__originalRect(x,y,width,height)},ctx.closePath=function(){destCtx.closePath(),this.__originalClosePath()},ctx.beginPath=function(){destCtx.beginPath(),this.__originalBeginPath()}}(ctx,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),copyCtxState(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(dirtyBox){if(!this.current.activeSMask)return;dirtyBox?(dirtyBox[0]=Math.floor(dirtyBox[0]),dirtyBox[1]=Math.floor(dirtyBox[1]),dirtyBox[2]=Math.ceil(dirtyBox[2]),dirtyBox[3]=Math.ceil(dirtyBox[3])):dirtyBox=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const smask=this.current.activeSMask,suspendedCtx=this.suspendedCtx;this.composeSMask(suspendedCtx,smask,this.ctx,dirtyBox),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(ctx,smask,layerCtx,layerBox){const layerOffsetX=layerBox[0],layerOffsetY=layerBox[1],layerWidth=layerBox[2]-layerOffsetX,layerHeight=layerBox[3]-layerOffsetY;0!==layerWidth&&0!==layerHeight&&(this.genericComposeSMask(smask.context,layerCtx,layerWidth,layerHeight,smask.subtype,smask.backdrop,smask.transferMap,layerOffsetX,layerOffsetY,smask.offsetX,smask.offsetY),ctx.save(),ctx.globalAlpha=1,ctx.globalCompositeOperation="source-over",ctx.setTransform(1,0,0,1,0,0),ctx.drawImage(layerCtx.canvas,0,0),ctx.restore())}genericComposeSMask(maskCtx,layerCtx,width,height,subtype,backdrop,transferMap,layerOffsetX,layerOffsetY,maskOffsetX,maskOffsetY){let maskCanvas=maskCtx.canvas,maskX=layerOffsetX-maskOffsetX,maskY=layerOffsetY-maskOffsetY;if(backdrop){const backdropRGB=Util.makeHexColor(...backdrop);if(maskX<0||maskY<0||maskX+width>maskCanvas.width||maskY+height>maskCanvas.height){const canvas=this.cachedCanvases.getCanvas("maskExtension",width,height),ctx=canvas.context;ctx.drawImage(maskCanvas,-maskX,-maskY),ctx.globalCompositeOperation="destination-atop",ctx.fillStyle=backdropRGB,ctx.fillRect(0,0,width,height),ctx.globalCompositeOperation="source-over",maskCanvas=canvas.canvas,maskX=maskY=0}else{maskCtx.save(),maskCtx.globalAlpha=1,maskCtx.setTransform(1,0,0,1,0,0);const clip=new Path2D;clip.rect(maskX,maskY,width,height),maskCtx.clip(clip),maskCtx.globalCompositeOperation="destination-atop",maskCtx.fillStyle=backdropRGB,maskCtx.fillRect(maskX,maskY,width,height),maskCtx.restore()}}layerCtx.save(),layerCtx.globalAlpha=1,layerCtx.setTransform(1,0,0,1,0,0),"Alpha"===subtype&&transferMap?layerCtx.filter=this.filterFactory.addAlphaFilter(transferMap):"Luminosity"===subtype&&(layerCtx.filter=this.filterFactory.addLuminosityFilter(transferMap));const clip=new Path2D;clip.rect(layerOffsetX,layerOffsetY,width,height),layerCtx.clip(clip),layerCtx.globalCompositeOperation="destination-in",layerCtx.drawImage(maskCanvas,maskX,maskY,width,height,layerOffsetX,layerOffsetY,width,height),layerCtx.restore()}save(){this.inSMaskMode?(copyCtxState(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const old=this.current;this.stateStack.push(old),this.current=old.clone()}restore(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),copyCtxState(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(a,b,c,d,e,f){this.ctx.transform(a,b,c,d,e,f),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(ops,args,minMax){const ctx=this.ctx,current=this.current;let startX,startY,x=current.x,y=current.y;const currentTransform=getCurrentTransform(ctx),isScalingMatrix=0===currentTransform[0]&&0===currentTransform[3]||0===currentTransform[1]&&0===currentTransform[2],minMaxForBezier=isScalingMatrix?minMax.slice(0):null;for(let i=0,j=0,ii=ops.length;i<ii;i++)switch(0|ops[i]){case OPS.rectangle:x=args[j++],y=args[j++];const width=args[j++],height=args[j++],xw=x+width,yh=y+height;ctx.moveTo(x,y),0===width||0===height?ctx.lineTo(xw,yh):(ctx.lineTo(xw,y),ctx.lineTo(xw,yh),ctx.lineTo(x,yh)),isScalingMatrix||current.updateRectMinMax(currentTransform,[x,y,xw,yh]),ctx.closePath();break;case OPS.moveTo:x=args[j++],y=args[j++],ctx.moveTo(x,y),isScalingMatrix||current.updatePathMinMax(currentTransform,x,y);break;case OPS.lineTo:x=args[j++],y=args[j++],ctx.lineTo(x,y),isScalingMatrix||current.updatePathMinMax(currentTransform,x,y);break;case OPS.curveTo:startX=x,startY=y,x=args[j+4],y=args[j+5],ctx.bezierCurveTo(args[j],args[j+1],args[j+2],args[j+3],x,y),current.updateCurvePathMinMax(currentTransform,startX,startY,args[j],args[j+1],args[j+2],args[j+3],x,y,minMaxForBezier),j+=6;break;case OPS.curveTo2:startX=x,startY=y,ctx.bezierCurveTo(x,y,args[j],args[j+1],args[j+2],args[j+3]),current.updateCurvePathMinMax(currentTransform,startX,startY,x,y,args[j],args[j+1],args[j+2],args[j+3],minMaxForBezier),x=args[j+2],y=args[j+3],j+=4;break;case OPS.curveTo3:startX=x,startY=y,x=args[j+2],y=args[j+3],ctx.bezierCurveTo(args[j],args[j+1],x,y,x,y),current.updateCurvePathMinMax(currentTransform,startX,startY,args[j],args[j+1],x,y,x,y,minMaxForBezier),j+=4;break;case OPS.closePath:ctx.closePath()}isScalingMatrix&&current.updateScalingPathMinMax(currentTransform,minMaxForBezier),current.setCurrentPoint(x,y)}closePath(){this.ctx.closePath()}stroke(consumePath=!0){const ctx=this.ctx,strokeColor=this.current.strokeColor;ctx.globalAlpha=this.current.strokeAlpha,this.contentVisible&&("object"==typeof strokeColor&&strokeColor?.getPattern?(ctx.save(),ctx.strokeStyle=strokeColor.getPattern(ctx,this,getCurrentTransformInverse(ctx),PathType_STROKE),this.rescaleAndStroke(!1),ctx.restore()):this.rescaleAndStroke(!0)),consumePath&&this.consumePath(this.current.getClippedPathBoundingBox()),ctx.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(consumePath=!0){const ctx=this.ctx,fillColor=this.current.fillColor;let needRestore=!1;this.current.patternFill&&(ctx.save(),ctx.fillStyle=fillColor.getPattern(ctx,this,getCurrentTransformInverse(ctx),PathType_FILL),needRestore=!0);const intersect=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==intersect&&(this.pendingEOFill?(ctx.fill("evenodd"),this.pendingEOFill=!1):ctx.fill()),needRestore&&ctx.restore(),consumePath&&this.consumePath(intersect)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=NORMAL_CLIP}eoClip(){this.pendingClip=EO_CLIP}beginText(){this.current.textMatrix=IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const paths=this.pendingTextPaths,ctx=this.ctx;if(void 0!==paths){ctx.save(),ctx.beginPath();for(const path of paths)ctx.setTransform(...path.transform),ctx.translate(path.x,path.y),path.addToPath(ctx,path.fontSize);ctx.restore(),ctx.clip(),ctx.beginPath(),delete this.pendingTextPaths}else ctx.beginPath()}setCharSpacing(spacing){this.current.charSpacing=spacing}setWordSpacing(spacing){this.current.wordSpacing=spacing}setHScale(scale){this.current.textHScale=scale/100}setLeading(leading){this.current.leading=-leading}setFont(fontRefName,size){const fontObj=this.commonObjs.get(fontRefName),current=this.current;if(!fontObj)throw new Error(`Can't find font for ${fontRefName}`);if(current.fontMatrix=fontObj.fontMatrix||FONT_IDENTITY_MATRIX,0!==current.fontMatrix[0]&&0!==current.fontMatrix[3]||warn("Invalid font matrix for font "+fontRefName),size<0?(size=-size,current.fontDirection=-1):current.fontDirection=1,this.current.font=fontObj,this.current.fontSize=size,fontObj.isType3Font)return;const name=fontObj.loadedName||"sans-serif",typeface=fontObj.systemFontInfo?.css||`"${name}", ${fontObj.fallbackName}`;let bold="normal";fontObj.black?bold="900":fontObj.bold&&(bold="bold");const italic=fontObj.italic?"italic":"normal";let browserFontSize=size;size<16?browserFontSize=16:size>100&&(browserFontSize=100),this.current.fontSizeScale=size/browserFontSize,this.ctx.font=`${italic} ${bold} ${browserFontSize}px ${typeface}`}setTextRenderingMode(mode){this.current.textRenderingMode=mode}setTextRise(rise){this.current.textRise=rise}moveText(x,y){this.current.x=this.current.lineX+=x,this.current.y=this.current.lineY+=y}setLeadingMoveText(x,y){this.setLeading(-y),this.moveText(x,y)}setTextMatrix(a,b,c,d,e,f){this.current.textMatrix=[a,b,c,d,e,f],this.current.textMatrixScale=Math.hypot(a,b),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(character,x,y,patternTransform){const ctx=this.ctx,current=this.current,font=current.font,textRenderingMode=current.textRenderingMode,fontSize=current.fontSize/current.fontSizeScale,fillStrokeMode=textRenderingMode&TextRenderingMode_FILL_STROKE_MASK,isAddToPathSet=!!(textRenderingMode&TextRenderingMode_ADD_TO_PATH_FLAG),patternFill=current.patternFill&&!font.missingFile;let addToPath;if((font.disableFontFace||isAddToPathSet||patternFill)&&(addToPath=font.getPathGenerator(this.commonObjs,character)),font.disableFontFace||patternFill?(ctx.save(),ctx.translate(x,y),ctx.beginPath(),addToPath(ctx,fontSize),patternTransform&&ctx.setTransform(...patternTransform),fillStrokeMode!==TextRenderingMode_FILL&&fillStrokeMode!==TextRenderingMode_FILL_STROKE||ctx.fill(),fillStrokeMode!==TextRenderingMode_STROKE&&fillStrokeMode!==TextRenderingMode_FILL_STROKE||ctx.stroke(),ctx.restore()):(fillStrokeMode!==TextRenderingMode_FILL&&fillStrokeMode!==TextRenderingMode_FILL_STROKE||ctx.fillText(character,x,y),fillStrokeMode!==TextRenderingMode_STROKE&&fillStrokeMode!==TextRenderingMode_FILL_STROKE||ctx.strokeText(character,x,y)),isAddToPathSet){(this.pendingTextPaths||=[]).push({transform:getCurrentTransform(ctx),x,y,fontSize,addToPath})}}get isFontSubpixelAAEnabled(){const{context:ctx}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);ctx.scale(1.5,1),ctx.fillText("I",0,10);const data=ctx.getImageData(0,0,10,10).data;let enabled=!1;for(let i=3;i<data.length;i+=4)if(data[i]>0&&data[i]<255){enabled=!0;break}return shadow(this,"isFontSubpixelAAEnabled",enabled)}showText(glyphs){const current=this.current,font=current.font;if(font.isType3Font)return this.showType3Text(glyphs);const fontSize=current.fontSize;if(0===fontSize)return;const ctx=this.ctx,fontSizeScale=current.fontSizeScale,charSpacing=current.charSpacing,wordSpacing=current.wordSpacing,fontDirection=current.fontDirection,textHScale=current.textHScale*fontDirection,glyphsLength=glyphs.length,vertical=font.vertical,spacingDir=vertical?1:-1,defaultVMetrics=font.defaultVMetrics,widthAdvanceScale=fontSize*current.fontMatrix[0],simpleFillText=current.textRenderingMode===TextRenderingMode_FILL&&!font.disableFontFace&&!current.patternFill;let patternTransform;if(ctx.save(),ctx.transform(...current.textMatrix),ctx.translate(current.x,current.y+current.textRise),fontDirection>0?ctx.scale(textHScale,-1):ctx.scale(textHScale,1),current.patternFill){ctx.save();const pattern=current.fillColor.getPattern(ctx,this,getCurrentTransformInverse(ctx),PathType_FILL);patternTransform=getCurrentTransform(ctx),ctx.restore(),ctx.fillStyle=pattern}let lineWidth=current.lineWidth;const scale=current.textMatrixScale;if(0===scale||0===lineWidth){const fillStrokeMode=current.textRenderingMode&TextRenderingMode_FILL_STROKE_MASK;fillStrokeMode!==TextRenderingMode_STROKE&&fillStrokeMode!==TextRenderingMode_FILL_STROKE||(lineWidth=this.getSinglePixelWidth())}else lineWidth/=scale;if(1!==fontSizeScale&&(ctx.scale(fontSizeScale,fontSizeScale),lineWidth/=fontSizeScale),ctx.lineWidth=lineWidth,font.isInvalidPDFjsFont){const chars=[];let width=0;for(const glyph of glyphs)chars.push(glyph.unicode),width+=glyph.width;return ctx.fillText(chars.join(""),0,0),current.x+=width*widthAdvanceScale*textHScale,ctx.restore(),void this.compose()}let i,x=0;for(i=0;i<glyphsLength;++i){const glyph=glyphs[i];if("number"==typeof glyph){x+=spacingDir*glyph*fontSize/1e3;continue}let restoreNeeded=!1;const spacing=(glyph.isSpace?wordSpacing:0)+charSpacing,character=glyph.fontChar,accent=glyph.accent;let scaledX,scaledY,width=glyph.width;if(vertical){const vmetric=glyph.vmetric||defaultVMetrics,vx=-(glyph.vmetric?vmetric[1]:.5*width)*widthAdvanceScale,vy=vmetric[2]*widthAdvanceScale;width=vmetric?-vmetric[0]:width,scaledX=vx/fontSizeScale,scaledY=(x+vy)/fontSizeScale}else scaledX=x/fontSizeScale,scaledY=0;if(font.remeasure&&width>0){const measuredWidth=1e3*ctx.measureText(character).width/fontSize*fontSizeScale;if(width<measuredWidth&&this.isFontSubpixelAAEnabled){const characterScaleX=width/measuredWidth;restoreNeeded=!0,ctx.save(),ctx.scale(characterScaleX,1),scaledX/=characterScaleX}else width!==measuredWidth&&(scaledX+=(width-measuredWidth)/2e3*fontSize/fontSizeScale)}if(this.contentVisible&&(glyph.isInFont||font.missingFile))if(simpleFillText&&!accent)ctx.fillText(character,scaledX,scaledY);else if(this.paintChar(character,scaledX,scaledY,patternTransform),accent){const scaledAccentX=scaledX+fontSize*accent.offset.x/fontSizeScale,scaledAccentY=scaledY-fontSize*accent.offset.y/fontSizeScale;this.paintChar(accent.fontChar,scaledAccentX,scaledAccentY,patternTransform)}x+=vertical?width*widthAdvanceScale-spacing*fontDirection:width*widthAdvanceScale+spacing*fontDirection,restoreNeeded&&ctx.restore()}vertical?current.y-=x:current.x+=x*textHScale,ctx.restore(),this.compose()}showType3Text(glyphs){const ctx=this.ctx,current=this.current,font=current.font,fontSize=current.fontSize,fontDirection=current.fontDirection,spacingDir=font.vertical?1:-1,charSpacing=current.charSpacing,wordSpacing=current.wordSpacing,textHScale=current.textHScale*fontDirection,fontMatrix=current.fontMatrix||FONT_IDENTITY_MATRIX,glyphsLength=glyphs.length;let i,glyph,width,spacingLength;if(!(current.textRenderingMode===TextRenderingMode_INVISIBLE)&&0!==fontSize){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,ctx.save(),ctx.transform(...current.textMatrix),ctx.translate(current.x,current.y),ctx.scale(textHScale,fontDirection),i=0;i<glyphsLength;++i){if(glyph=glyphs[i],"number"==typeof glyph){spacingLength=spacingDir*glyph*fontSize/1e3,this.ctx.translate(spacingLength,0),current.x+=spacingLength*textHScale;continue}const spacing=(glyph.isSpace?wordSpacing:0)+charSpacing,operatorList=font.charProcOperatorList[glyph.operatorListId];if(!operatorList){warn(`Type3 character "${glyph.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=glyph,this.save(),ctx.scale(fontSize,fontSize),ctx.transform(...fontMatrix),this.executeOperatorList(operatorList),this.restore());width=Util.applyTransform([glyph.width,0],fontMatrix)[0]*fontSize+spacing,ctx.translate(width,0),current.x+=width*textHScale}ctx.restore(),this.processingType3=null}}setCharWidth(xWidth,yWidth){}setCharWidthAndBounds(xWidth,yWidth,llx,lly,urx,ury){this.ctx.rect(llx,lly,urx-llx,ury-lly),this.ctx.clip(),this.endPath()}getColorN_Pattern(IR){let pattern;if("TilingPattern"===IR[0]){const color=IR[1],baseTransform=this.baseTransform||getCurrentTransform(this.ctx),canvasGraphicsFactory={createCanvasGraphics:ctx=>new CanvasGraphics(ctx,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};pattern=new TilingPattern(IR,color,this.ctx,canvasGraphicsFactory,baseTransform)}else pattern=this._getPattern(IR[1],IR[2]);return pattern}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(r,g,b){this.ctx.strokeStyle=this.current.strokeColor=Util.makeHexColor(r,g,b)}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent"}setFillRGBColor(r,g,b){this.ctx.fillStyle=this.current.fillColor=Util.makeHexColor(r,g,b),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(objId,matrix=null){let pattern;return this.cachedPatterns.has(objId)?pattern=this.cachedPatterns.get(objId):(pattern=function getShadingPattern(IR){switch(IR[0]){case"RadialAxial":return new RadialAxialShadingPattern(IR);case"Mesh":return new MeshShadingPattern(IR);case"Dummy":return new DummyShadingPattern}throw new Error(`Unknown IR type: ${IR[0]}`)}(this.getObject(objId)),this.cachedPatterns.set(objId,pattern)),matrix&&(pattern.matrix=matrix),pattern}shadingFill(objId){if(!this.contentVisible)return;const ctx=this.ctx;this.save();const pattern=this._getPattern(objId);ctx.fillStyle=pattern.getPattern(ctx,this,getCurrentTransformInverse(ctx),PathType_SHADING);const inv=getCurrentTransformInverse(ctx);if(inv){const{width,height}=ctx.canvas,[x0,y0,x1,y1]=Util.getAxialAlignedBoundingBox([0,0,width,height],inv);this.ctx.fillRect(x0,y0,x1-x0,y1-y0)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){unreachable("Should not call beginInlineImage")}beginImageData(){unreachable("Should not call beginImageData")}paintFormXObjectBegin(matrix,bbox){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),matrix&&this.transform(...matrix),this.baseTransform=getCurrentTransform(this.ctx),bbox)){const width=bbox[2]-bbox[0],height=bbox[3]-bbox[1];this.ctx.rect(bbox[0],bbox[1],width,height),this.current.updateRectMinMax(getCurrentTransform(this.ctx),bbox),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(group){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const currentCtx=this.ctx;group.isolated||info("TODO: Support non-isolated groups."),group.knockout&&warn("Knockout groups not supported.");const currentTransform=getCurrentTransform(currentCtx);if(group.matrix&&currentCtx.transform(...group.matrix),!group.bbox)throw new Error("Bounding box is required.");let bounds=Util.getAxialAlignedBoundingBox(group.bbox,getCurrentTransform(currentCtx));const canvasBounds=[0,0,currentCtx.canvas.width,currentCtx.canvas.height];bounds=Util.intersect(bounds,canvasBounds)||[0,0,0,0];const offsetX=Math.floor(bounds[0]),offsetY=Math.floor(bounds[1]),drawnWidth=Math.max(Math.ceil(bounds[2])-offsetX,1),drawnHeight=Math.max(Math.ceil(bounds[3])-offsetY,1);this.current.startNewPathAndClipBox([0,0,drawnWidth,drawnHeight]);let cacheId="groupAt"+this.groupLevel;group.smask&&(cacheId+="_smask_"+this.smaskCounter++%2);const scratchCanvas=this.cachedCanvases.getCanvas(cacheId,drawnWidth,drawnHeight),groupCtx=scratchCanvas.context;groupCtx.translate(-offsetX,-offsetY),groupCtx.transform(...currentTransform),group.smask?this.smaskStack.push({canvas:scratchCanvas.canvas,context:groupCtx,offsetX,offsetY,subtype:group.smask.subtype,backdrop:group.smask.backdrop,transferMap:group.smask.transferMap||null,startTransformInverse:null}):(currentCtx.setTransform(1,0,0,1,0,0),currentCtx.translate(offsetX,offsetY),currentCtx.save()),copyCtxState(currentCtx,groupCtx),this.ctx=groupCtx,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(currentCtx),this.groupLevel++}endGroup(group){if(!this.contentVisible)return;this.groupLevel--;const groupCtx=this.ctx,ctx=this.groupStack.pop();if(this.ctx=ctx,this.ctx.imageSmoothingEnabled=!1,group.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const currentMtx=getCurrentTransform(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...currentMtx);const dirtyBox=Util.getAxialAlignedBoundingBox([0,0,groupCtx.canvas.width,groupCtx.canvas.height],currentMtx);this.ctx.drawImage(groupCtx.canvas,0,0),this.ctx.restore(),this.compose(dirtyBox)}}beginAnnotation(id,rect,transform,matrix,hasOwnCanvas){if(this.#restoreInitialState(),resetCtxToDefault(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),rect){const width=rect[2]-rect[0],height=rect[3]-rect[1];if(hasOwnCanvas&&this.annotationCanvasMap){(transform=transform.slice())[4]-=rect[0],transform[5]-=rect[1],(rect=rect.slice())[0]=rect[1]=0,rect[2]=width,rect[3]=height;const[scaleX,scaleY]=Util.singularValueDecompose2dScale(getCurrentTransform(this.ctx)),{viewportScale}=this,canvasWidth=Math.ceil(width*this.outputScaleX*viewportScale),canvasHeight=Math.ceil(height*this.outputScaleY*viewportScale);this.annotationCanvas=this.canvasFactory.create(canvasWidth,canvasHeight);const{canvas,context}=this.annotationCanvas;this.annotationCanvasMap.set(id,canvas),this.annotationCanvas.savedCtx=this.ctx,this.ctx=context,this.ctx.save(),this.ctx.setTransform(scaleX,0,0,-scaleY,0,height*scaleY),resetCtxToDefault(this.ctx)}else resetCtxToDefault(this.ctx),this.endPath(),this.ctx.rect(rect[0],rect[1],width,height),this.ctx.clip(),this.ctx.beginPath()}this.current=new CanvasExtraState(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...transform),this.transform(...matrix)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#drawFilter(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(img){if(!this.contentVisible)return;const count=img.count;(img=this.getObject(img.data,img)).count=count;const ctx=this.ctx,glyph=this.processingType3;if(glyph&&(void 0===glyph.compiled&&(glyph.compiled=function compileType3Glyph(imgData){const{width,height}=imgData;if(width>1e3||height>1e3)return null;const POINT_TYPES=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),width1=width+1;let i,j,j0,points=new Uint8Array(width1*(height+1));const lineSize=width+7&-8;let data=new Uint8Array(lineSize*height),pos=0;for(const elem of imgData.data){let mask=128;for(;mask>0;)data[pos++]=elem&mask?0:255,mask>>=1}let count=0;for(pos=0,0!==data[pos]&&(points[0]=1,++count),j=1;j<width;j++)data[pos]!==data[pos+1]&&(points[j]=data[pos]?2:1,++count),pos++;for(0!==data[pos]&&(points[j]=2,++count),i=1;i<height;i++){pos=i*lineSize,j0=i*width1,data[pos-lineSize]!==data[pos]&&(points[j0]=data[pos]?1:8,++count);let sum=(data[pos]?4:0)+(data[pos-lineSize]?8:0);for(j=1;j<width;j++)sum=(sum>>2)+(data[pos+1]?4:0)+(data[pos-lineSize+1]?8:0),POINT_TYPES[sum]&&(points[j0+j]=POINT_TYPES[sum],++count),pos++;if(data[pos-lineSize]!==data[pos]&&(points[j0+j]=data[pos]?2:4,++count),count>1e3)return null}for(pos=lineSize*(height-1),j0=i*width1,0!==data[pos]&&(points[j0]=8,++count),j=1;j<width;j++)data[pos]!==data[pos+1]&&(points[j0+j]=data[pos]?4:8,++count),pos++;if(0!==data[pos]&&(points[j0+j]=4,++count),count>1e3)return null;const steps=new Int32Array([0,width1,-1,0,-width1,0,0,0,1]),path=new Path2D;for(i=0;count&&i<=height;i++){let p=i*width1;const end=p+width;for(;p<end&&!points[p];)p++;if(p===end)continue;path.moveTo(p%width1,i);const p0=p;let type=points[p];do{const step=steps[type];do{p+=step}while(!points[p]);const pp=points[p];5!==pp&&10!==pp?(type=pp,points[p]=0):(type=pp&51*type>>4,points[p]&=type>>2|type<<2),path.lineTo(p%width1,p/width1|0),points[p]||--count}while(p0!==p);--i}return data=null,points=null,function(c){c.save(),c.scale(1/width,-1/height),c.translate(0,-height),c.fill(path),c.beginPath(),c.restore()}}(img)),glyph.compiled))return void glyph.compiled(ctx);const mask=this._createMaskCanvas(img),maskCanvas=mask.canvas;ctx.save(),ctx.setTransform(1,0,0,1,0,0),ctx.drawImage(maskCanvas,mask.offsetX,mask.offsetY),ctx.restore(),this.compose()}paintImageMaskXObjectRepeat(img,scaleX,skewX=0,skewY=0,scaleY,positions){if(!this.contentVisible)return;img=this.getObject(img.data,img);const ctx=this.ctx;ctx.save();const currentTransform=getCurrentTransform(ctx);ctx.transform(scaleX,skewX,skewY,scaleY,0,0);const mask=this._createMaskCanvas(img);ctx.setTransform(1,0,0,1,mask.offsetX-currentTransform[4],mask.offsetY-currentTransform[5]);for(let i=0,ii=positions.length;i<ii;i+=2){const trans=Util.transform(currentTransform,[scaleX,skewX,skewY,scaleY,positions[i],positions[i+1]]),[x,y]=Util.applyTransform([0,0],trans);ctx.drawImage(mask.canvas,x,y)}ctx.restore(),this.compose()}paintImageMaskXObjectGroup(images){if(!this.contentVisible)return;const ctx=this.ctx,fillColor=this.current.fillColor,isPatternFill=this.current.patternFill;for(const image of images){const{data,width,height,transform}=image,maskCanvas=this.cachedCanvases.getCanvas("maskCanvas",width,height),maskCtx=maskCanvas.context;maskCtx.save();putBinaryImageMask(maskCtx,this.getObject(data,image)),maskCtx.globalCompositeOperation="source-in",maskCtx.fillStyle=isPatternFill?fillColor.getPattern(maskCtx,this,getCurrentTransformInverse(ctx),PathType_FILL):fillColor,maskCtx.fillRect(0,0,width,height),maskCtx.restore(),ctx.save(),ctx.transform(...transform),ctx.scale(1,-1),drawImageAtIntegerCoords(ctx,maskCanvas.canvas,0,0,width,height,0,-1,1,1),ctx.restore()}this.compose()}paintImageXObject(objId){if(!this.contentVisible)return;const imgData=this.getObject(objId);imgData?this.paintInlineImageXObject(imgData):warn("Dependent image isn't ready yet")}paintImageXObjectRepeat(objId,scaleX,scaleY,positions){if(!this.contentVisible)return;const imgData=this.getObject(objId);if(!imgData)return void warn("Dependent image isn't ready yet");const width=imgData.width,height=imgData.height,map=[];for(let i=0,ii=positions.length;i<ii;i+=2)map.push({transform:[scaleX,0,0,scaleY,positions[i],positions[i+1]],x:0,y:0,w:width,h:height});this.paintInlineImageXObjectGroup(imgData,map)}applyTransferMapsToCanvas(ctx){return"none"!==this.current.transferMaps&&(ctx.filter=this.current.transferMaps,ctx.drawImage(ctx.canvas,0,0),ctx.filter="none"),ctx.canvas}applyTransferMapsToBitmap(imgData){if("none"===this.current.transferMaps)return imgData.bitmap;const{bitmap,width,height}=imgData,tmpCanvas=this.cachedCanvases.getCanvas("inlineImage",width,height),tmpCtx=tmpCanvas.context;return tmpCtx.filter=this.current.transferMaps,tmpCtx.drawImage(bitmap,0,0),tmpCtx.filter="none",tmpCanvas.canvas}paintInlineImageXObject(imgData){if(!this.contentVisible)return;const width=imgData.width,height=imgData.height,ctx=this.ctx;if(this.save(),!isNodeJS){const{filter}=ctx;"none"!==filter&&""!==filter&&(ctx.filter="none")}let imgToPaint;if(ctx.scale(1/width,-1/height),imgData.bitmap)imgToPaint=this.applyTransferMapsToBitmap(imgData);else if("function"==typeof HTMLElement&&imgData instanceof HTMLElement||!imgData.data)imgToPaint=imgData;else{const tmpCtx=this.cachedCanvases.getCanvas("inlineImage",width,height).context;putBinaryImageData(tmpCtx,imgData),imgToPaint=this.applyTransferMapsToCanvas(tmpCtx)}const scaled=this._scaleImage(imgToPaint,getCurrentTransformInverse(ctx));ctx.imageSmoothingEnabled=getImageSmoothingEnabled(getCurrentTransform(ctx),imgData.interpolate),drawImageAtIntegerCoords(ctx,scaled.img,0,0,scaled.paintWidth,scaled.paintHeight,0,-height,width,height),this.compose(),this.restore()}paintInlineImageXObjectGroup(imgData,map){if(!this.contentVisible)return;const ctx=this.ctx;let imgToPaint;if(imgData.bitmap)imgToPaint=imgData.bitmap;else{const w=imgData.width,h=imgData.height,tmpCtx=this.cachedCanvases.getCanvas("inlineImage",w,h).context;putBinaryImageData(tmpCtx,imgData),imgToPaint=this.applyTransferMapsToCanvas(tmpCtx)}for(const entry of map)ctx.save(),ctx.transform(...entry.transform),ctx.scale(1,-1),drawImageAtIntegerCoords(ctx,imgToPaint,entry.x,entry.y,entry.w,entry.h,0,-1,1,1),ctx.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(tag){}markPointProps(tag,properties){}beginMarkedContent(tag){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(tag,properties){"OC"===tag?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(properties)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(clipBox){const isEmpty=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(clipBox);const ctx=this.ctx;this.pendingClip&&(isEmpty||(this.pendingClip===EO_CLIP?ctx.clip("evenodd"):ctx.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),ctx.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const m=getCurrentTransform(this.ctx);if(0===m[1]&&0===m[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(m[0]),Math.abs(m[3]));else{const absDet=Math.abs(m[0]*m[3]-m[2]*m[1]),normX=Math.hypot(m[0],m[2]),normY=Math.hypot(m[1],m[3]);this._cachedGetSinglePixelWidth=Math.max(normX,normY)/absDet}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){const{lineWidth}=this.current,{a,b,c,d}=this.ctx.getTransform();let scaleX,scaleY;if(0===b&&0===c){const normX=Math.abs(a),normY=Math.abs(d);if(normX===normY)if(0===lineWidth)scaleX=scaleY=1/normX;else{const scaledLineWidth=normX*lineWidth;scaleX=scaleY=scaledLineWidth<1?1/scaledLineWidth:1}else if(0===lineWidth)scaleX=1/normX,scaleY=1/normY;else{const scaledXLineWidth=normX*lineWidth,scaledYLineWidth=normY*lineWidth;scaleX=scaledXLineWidth<1?1/scaledXLineWidth:1,scaleY=scaledYLineWidth<1?1/scaledYLineWidth:1}}else{const absDet=Math.abs(a*d-b*c),normX=Math.hypot(a,b),normY=Math.hypot(c,d);if(0===lineWidth)scaleX=normY/absDet,scaleY=normX/absDet;else{const baseArea=lineWidth*absDet;scaleX=normY>baseArea?normY/baseArea:1,scaleY=normX>baseArea?normX/baseArea:1}}this._cachedScaleForStroking[0]=scaleX,this._cachedScaleForStroking[1]=scaleY}return this._cachedScaleForStroking}rescaleAndStroke(saveRestore){const{ctx}=this,{lineWidth}=this.current,[scaleX,scaleY]=this.getScaleForStroking();if(ctx.lineWidth=lineWidth||1,1===scaleX&&1===scaleY)return void ctx.stroke();const dashes=ctx.getLineDash();if(saveRestore&&ctx.save(),ctx.scale(scaleX,scaleY),dashes.length>0){const scale=Math.max(scaleX,scaleY);ctx.setLineDash(dashes.map((x=>x/scale))),ctx.lineDashOffset/=scale}ctx.stroke(),saveRestore&&ctx.restore()}isContentVisible(){for(let i=this.markedContentStack.length-1;i>=0;i--)if(!this.markedContentStack[i].visible)return!1;return!0}}for(const op in OPS)void 0!==CanvasGraphics.prototype[op]&&(CanvasGraphics.prototype[OPS[op]]=CanvasGraphics.prototype[op]);class GlobalWorkerOptions{static#port=null;static#src="";static get workerPort(){return this.#port}static set workerPort(val){if(!("undefined"!=typeof Worker&&val instanceof Worker)&&null!==val)throw new Error("Invalid `workerPort` type.");this.#port=val}static get workerSrc(){return this.#src}static set workerSrc(val){if("string"!=typeof val)throw new Error("Invalid `workerSrc` type.");this.#src=val}}const CallbackKind_DATA=1,CallbackKind_ERROR=2,StreamKind_CANCEL=1,StreamKind_CANCEL_COMPLETE=2,StreamKind_CLOSE=3,StreamKind_ENQUEUE=4,StreamKind_ERROR=5,StreamKind_PULL=6,StreamKind_PULL_COMPLETE=7,StreamKind_START_COMPLETE=8;function wrapReason(reason){switch(reason instanceof Error||"object"==typeof reason&&null!==reason||unreachable('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),reason.name){case"AbortException":return new AbortException(reason.message);case"MissingPDFException":return new MissingPDFException(reason.message);case"PasswordException":return new PasswordException(reason.message,reason.code);case"UnexpectedResponseException":return new UnexpectedResponseException(reason.message,reason.status);case"UnknownErrorException":return new UnknownErrorException(reason.message,reason.details);default:return new UnknownErrorException(reason.message,reason.toString())}}class MessageHandler{#messageAC=new AbortController;constructor(sourceName,targetName,comObj){this.sourceName=sourceName,this.targetName=targetName,this.comObj=comObj,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),comObj.addEventListener("message",this.#onMessage.bind(this),{signal:this.#messageAC.signal})}#onMessage({data}){if(data.targetName!==this.sourceName)return;if(data.stream)return void this.#processStreamMessage(data);if(data.callback){const callbackId=data.callbackId,capability=this.callbackCapabilities[callbackId];if(!capability)throw new Error(`Cannot resolve callback ${callbackId}`);if(delete this.callbackCapabilities[callbackId],data.callback===CallbackKind_DATA)capability.resolve(data.data);else{if(data.callback!==CallbackKind_ERROR)throw new Error("Unexpected callback case");capability.reject(wrapReason(data.reason))}return}const action=this.actionHandler[data.action];if(!action)throw new Error(`Unknown action from worker: ${data.action}`);if(data.callbackId){const sourceName=this.sourceName,targetName=data.sourceName,comObj=this.comObj;new Promise((function(resolve){resolve(action(data.data))})).then((function(result){comObj.postMessage({sourceName,targetName,callback:CallbackKind_DATA,callbackId:data.callbackId,data:result})}),(function(reason){comObj.postMessage({sourceName,targetName,callback:CallbackKind_ERROR,callbackId:data.callbackId,reason:wrapReason(reason)})}))}else data.streamId?this.#createStreamSink(data):action(data.data)}on(actionName,handler){const ah=this.actionHandler;if(ah[actionName])throw new Error(`There is already an actionName called "${actionName}"`);ah[actionName]=handler}send(actionName,data,transfers){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:actionName,data},transfers)}sendWithPromise(actionName,data,transfers){const callbackId=this.callbackId++,capability=Promise.withResolvers();this.callbackCapabilities[callbackId]=capability;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:actionName,callbackId,data},transfers)}catch(ex){capability.reject(ex)}return capability.promise}sendWithStream(actionName,data,queueingStrategy,transfers){const streamId=this.streamId++,sourceName=this.sourceName,targetName=this.targetName,comObj=this.comObj;return new ReadableStream({start:controller=>{const startCapability=Promise.withResolvers();return this.streamControllers[streamId]={controller,startCall:startCapability,pullCall:null,cancelCall:null,isClosed:!1},comObj.postMessage({sourceName,targetName,action:actionName,streamId,data,desiredSize:controller.desiredSize},transfers),startCapability.promise},pull:controller=>{const pullCapability=Promise.withResolvers();return this.streamControllers[streamId].pullCall=pullCapability,comObj.postMessage({sourceName,targetName,stream:StreamKind_PULL,streamId,desiredSize:controller.desiredSize}),pullCapability.promise},cancel:reason=>{assert(reason instanceof Error,"cancel must have a valid reason");const cancelCapability=Promise.withResolvers();return this.streamControllers[streamId].cancelCall=cancelCapability,this.streamControllers[streamId].isClosed=!0,comObj.postMessage({sourceName,targetName,stream:StreamKind_CANCEL,streamId,reason:wrapReason(reason)}),cancelCapability.promise}},queueingStrategy)}#createStreamSink(data){const streamId=data.streamId,sourceName=this.sourceName,targetName=data.sourceName,comObj=this.comObj,self=this,action=this.actionHandler[data.action],streamSink={enqueue(chunk,size=1,transfers){if(this.isCancelled)return;const lastDesiredSize=this.desiredSize;this.desiredSize-=size,lastDesiredSize>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),comObj.postMessage({sourceName,targetName,stream:StreamKind_ENQUEUE,streamId,chunk},transfers)},close(){this.isCancelled||(this.isCancelled=!0,comObj.postMessage({sourceName,targetName,stream:StreamKind_CLOSE,streamId}),delete self.streamSinks[streamId])},error(reason){assert(reason instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,comObj.postMessage({sourceName,targetName,stream:StreamKind_ERROR,streamId,reason:wrapReason(reason)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:data.desiredSize,ready:null};streamSink.sinkCapability.resolve(),streamSink.ready=streamSink.sinkCapability.promise,this.streamSinks[streamId]=streamSink,new Promise((function(resolve){resolve(action(data.data,streamSink))})).then((function(){comObj.postMessage({sourceName,targetName,stream:StreamKind_START_COMPLETE,streamId,success:!0})}),(function(reason){comObj.postMessage({sourceName,targetName,stream:StreamKind_START_COMPLETE,streamId,reason:wrapReason(reason)})}))}#processStreamMessage(data){const streamId=data.streamId,sourceName=this.sourceName,targetName=data.sourceName,comObj=this.comObj,streamController=this.streamControllers[streamId],streamSink=this.streamSinks[streamId];switch(data.stream){case StreamKind_START_COMPLETE:data.success?streamController.startCall.resolve():streamController.startCall.reject(wrapReason(data.reason));break;case StreamKind_PULL_COMPLETE:data.success?streamController.pullCall.resolve():streamController.pullCall.reject(wrapReason(data.reason));break;case StreamKind_PULL:if(!streamSink){comObj.postMessage({sourceName,targetName,stream:StreamKind_PULL_COMPLETE,streamId,success:!0});break}streamSink.desiredSize<=0&&data.desiredSize>0&&streamSink.sinkCapability.resolve(),streamSink.desiredSize=data.desiredSize,new Promise((function(resolve){resolve(streamSink.onPull?.())})).then((function(){comObj.postMessage({sourceName,targetName,stream:StreamKind_PULL_COMPLETE,streamId,success:!0})}),(function(reason){comObj.postMessage({sourceName,targetName,stream:StreamKind_PULL_COMPLETE,streamId,reason:wrapReason(reason)})}));break;case StreamKind_ENQUEUE:if(assert(streamController,"enqueue should have stream controller"),streamController.isClosed)break;streamController.controller.enqueue(data.chunk);break;case StreamKind_CLOSE:if(assert(streamController,"close should have stream controller"),streamController.isClosed)break;streamController.isClosed=!0,streamController.controller.close(),this.#deleteStreamController(streamController,streamId);break;case StreamKind_ERROR:assert(streamController,"error should have stream controller"),streamController.controller.error(wrapReason(data.reason)),this.#deleteStreamController(streamController,streamId);break;case StreamKind_CANCEL_COMPLETE:data.success?streamController.cancelCall.resolve():streamController.cancelCall.reject(wrapReason(data.reason)),this.#deleteStreamController(streamController,streamId);break;case StreamKind_CANCEL:if(!streamSink)break;new Promise((function(resolve){resolve(streamSink.onCancel?.(wrapReason(data.reason)))})).then((function(){comObj.postMessage({sourceName,targetName,stream:StreamKind_CANCEL_COMPLETE,streamId,success:!0})}),(function(reason){comObj.postMessage({sourceName,targetName,stream:StreamKind_CANCEL_COMPLETE,streamId,reason:wrapReason(reason)})})),streamSink.sinkCapability.reject(wrapReason(data.reason)),streamSink.isCancelled=!0,delete this.streamSinks[streamId];break;default:throw new Error("Unexpected stream case")}}#deleteStreamController(streamController,streamId){var _this22=this;return(0,asyncToGenerator.A)((function*(){yield Promise.allSettled([streamController.startCall?.promise,streamController.pullCall?.promise,streamController.cancelCall?.promise]),delete _this22.streamControllers[streamId]}))()}destroy(){this.#messageAC?.abort(),this.#messageAC=null}}class Metadata{#metadataMap;#data;constructor({parsedData,rawData}){this.#metadataMap=parsedData,this.#data=rawData}getRaw(){return this.#data}get(name){return this.#metadataMap.get(name)??null}getAll(){return objectFromMap(this.#metadataMap)}has(name){return this.#metadataMap.has(name)}}const INTERNAL=Symbol("INTERNAL");class OptionalContentGroup{#isDisplay=!1;#isPrint=!1;#userSet=!1;#visible=!0;constructor(renderingIntent,{name,intent,usage,rbGroups}){this.#isDisplay=!!(renderingIntent&RenderingIntentFlag_DISPLAY),this.#isPrint=!!(renderingIntent&RenderingIntentFlag_PRINT),this.name=name,this.intent=intent,this.usage=usage,this.rbGroups=rbGroups}get visible(){if(this.#userSet)return this.#visible;if(!this.#visible)return!1;const{print,view}=this.usage;return this.#isDisplay?"OFF"!==view?.viewState:!this.#isPrint||"OFF"!==print?.printState}_setVisible(internal,visible,userSet=!1){internal!==INTERNAL&&unreachable("Internal method `_setVisible` called."),this.#userSet=userSet,this.#visible=visible}}class OptionalContentConfig{#cachedGetHash=null;#groups=new Map;#initialHash=null;#order=null;constructor(data,renderingIntent=RenderingIntentFlag_DISPLAY){if(this.renderingIntent=renderingIntent,this.name=null,this.creator=null,null!==data){this.name=data.name,this.creator=data.creator,this.#order=data.order;for(const group of data.groups)this.#groups.set(group.id,new OptionalContentGroup(renderingIntent,group));if("OFF"===data.baseState)for(const group of this.#groups.values())group._setVisible(INTERNAL,!1);for(const on of data.on)this.#groups.get(on)._setVisible(INTERNAL,!0);for(const off of data.off)this.#groups.get(off)._setVisible(INTERNAL,!1);this.#initialHash=this.getHash()}}#evaluateVisibilityExpression(array){const length=array.length;if(length<2)return!0;const operator=array[0];for(let i=1;i<length;i++){const element=array[i];let state;if(Array.isArray(element))state=this.#evaluateVisibilityExpression(element);else{if(!this.#groups.has(element))return warn(`Optional content group not found: ${element}`),!0;state=this.#groups.get(element).visible}switch(operator){case"And":if(!state)return!1;break;case"Or":if(state)return!0;break;case"Not":return!state;default:return!0}}return"And"===operator}isVisible(group){if(0===this.#groups.size)return!0;if(!group)return info("Optional content group not defined."),!0;if("OCG"===group.type)return this.#groups.has(group.id)?this.#groups.get(group.id).visible:(warn(`Optional content group not found: ${group.id}`),!0);if("OCMD"===group.type){if(group.expression)return this.#evaluateVisibilityExpression(group.expression);if(!group.policy||"AnyOn"===group.policy){for(const id of group.ids){if(!this.#groups.has(id))return warn(`Optional content group not found: ${id}`),!0;if(this.#groups.get(id).visible)return!0}return!1}if("AllOn"===group.policy){for(const id of group.ids){if(!this.#groups.has(id))return warn(`Optional content group not found: ${id}`),!0;if(!this.#groups.get(id).visible)return!1}return!0}if("AnyOff"===group.policy){for(const id of group.ids){if(!this.#groups.has(id))return warn(`Optional content group not found: ${id}`),!0;if(!this.#groups.get(id).visible)return!0}return!1}if("AllOff"===group.policy){for(const id of group.ids){if(!this.#groups.has(id))return warn(`Optional content group not found: ${id}`),!0;if(this.#groups.get(id).visible)return!1}return!0}return warn(`Unknown optional content policy ${group.policy}.`),!0}return warn(`Unknown group type ${group.type}.`),!0}setVisibility(id,visible=!0,preserveRB=!0){const group=this.#groups.get(id);if(group){if(preserveRB&&visible&&group.rbGroups.length)for(const rbGroup of group.rbGroups)for(const otherId of rbGroup)otherId!==id&&this.#groups.get(otherId)?._setVisible(INTERNAL,!1,!0);group._setVisible(INTERNAL,!!visible,!0),this.#cachedGetHash=null}else warn(`Optional content group not found: ${id}`)}setOCGState({state,preserveRB}){let operator;for(const elem of state){switch(elem){case"ON":case"OFF":case"Toggle":operator=elem;continue}const group=this.#groups.get(elem);if(group)switch(operator){case"ON":this.setVisibility(elem,!0,preserveRB);break;case"OFF":this.setVisibility(elem,!1,preserveRB);break;case"Toggle":this.setVisibility(elem,!group.visible,preserveRB)}}this.#cachedGetHash=null}get hasInitialVisibility(){return null===this.#initialHash||this.getHash()===this.#initialHash}getOrder(){return this.#groups.size?this.#order?this.#order.slice():[...this.#groups.keys()]:null}getGroups(){return this.#groups.size>0?objectFromMap(this.#groups):null}getGroup(id){return this.#groups.get(id)||null}getHash(){if(null!==this.#cachedGetHash)return this.#cachedGetHash;const hash=new MurmurHash3_64;for(const[id,group]of this.#groups)hash.update(`${id}:${group.visible}`);return this.#cachedGetHash=hash.hexdigest()}}class PDFDataTransportStream{constructor(pdfDataRangeTransport,{disableRange=!1,disableStream=!1}){assert(pdfDataRangeTransport,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length,initialData,progressiveDone,contentDispositionFilename}=pdfDataRangeTransport;if(this._queuedChunks=[],this._progressiveDone=progressiveDone,this._contentDispositionFilename=contentDispositionFilename,initialData?.length>0){const buffer=initialData instanceof Uint8Array&&initialData.byteLength===initialData.buffer.byteLength?initialData.buffer:new Uint8Array(initialData).buffer;this._queuedChunks.push(buffer)}this._pdfDataRangeTransport=pdfDataRangeTransport,this._isStreamingSupported=!disableStream,this._isRangeSupported=!disableRange,this._contentLength=length,this._fullRequestReader=null,this._rangeReaders=[],pdfDataRangeTransport.addRangeListener(((begin,chunk)=>{this._onReceiveData({begin,chunk})})),pdfDataRangeTransport.addProgressListener(((loaded,total)=>{this._onProgress({loaded,total})})),pdfDataRangeTransport.addProgressiveReadListener((chunk=>{this._onReceiveData({chunk})})),pdfDataRangeTransport.addProgressiveDoneListener((()=>{this._onProgressiveDone()})),pdfDataRangeTransport.transportReady()}_onReceiveData({begin,chunk}){const buffer=chunk instanceof Uint8Array&&chunk.byteLength===chunk.buffer.byteLength?chunk.buffer:new Uint8Array(chunk).buffer;if(void 0===begin)this._fullRequestReader?this._fullRequestReader._enqueue(buffer):this._queuedChunks.push(buffer);else{assert(this._rangeReaders.some((function(rangeReader){return rangeReader._begin===begin&&(rangeReader._enqueue(buffer),!0)})),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(evt){void 0===evt.total?this._rangeReaders[0]?.onProgress?.({loaded:evt.loaded}):this._fullRequestReader?.onProgress?.({loaded:evt.loaded,total:evt.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(reader){const i=this._rangeReaders.indexOf(reader);i>=0&&this._rangeReaders.splice(i,1)}getFullReader(){assert(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const queuedChunks=this._queuedChunks;return this._queuedChunks=null,new PDFDataTransportStreamReader(this,queuedChunks,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(begin,end){if(end<=this._progressiveDataLength)return null;const reader=new PDFDataTransportStreamRangeReader(this,begin,end);return this._pdfDataRangeTransport.requestDataRange(begin,end),this._rangeReaders.push(reader),reader}cancelAllRequests(reason){this._fullRequestReader?.cancel(reason);for(const reader of this._rangeReaders.slice(0))reader.cancel(reason);this._pdfDataRangeTransport.abort()}}class PDFDataTransportStreamReader{constructor(stream,queuedChunks,progressiveDone=!1,contentDispositionFilename=null){this._stream=stream,this._done=progressiveDone||!1,this._filename=isPdfFile(contentDispositionFilename)?contentDispositionFilename:null,this._queuedChunks=queuedChunks||[],this._loaded=0;for(const chunk of this._queuedChunks)this._loaded+=chunk.byteLength;this._requests=[],this._headersReady=Promise.resolve(),stream._fullRequestReader=this,this.onProgress=null}_enqueue(chunk){if(!this._done){if(this._requests.length>0){this._requests.shift().resolve({value:chunk,done:!1})}else this._queuedChunks.push(chunk);this._loaded+=chunk.byteLength}}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}read(){var _this23=this;return(0,asyncToGenerator.A)((function*(){if(_this23._queuedChunks.length>0){return{value:_this23._queuedChunks.shift(),done:!1}}if(_this23._done)return{value:void 0,done:!0};const requestCapability=Promise.withResolvers();return _this23._requests.push(requestCapability),requestCapability.promise}))()}cancel(reason){this._done=!0;for(const requestCapability of this._requests)requestCapability.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class PDFDataTransportStreamRangeReader{constructor(stream,begin,end){this._stream=stream,this._begin=begin,this._end=end,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(chunk){if(!this._done){if(0===this._requests.length)this._queuedChunk=chunk;else{this._requests.shift().resolve({value:chunk,done:!1});for(const requestCapability of this._requests)requestCapability.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}read(){var _this24=this;return(0,asyncToGenerator.A)((function*(){if(_this24._queuedChunk){const chunk=_this24._queuedChunk;return _this24._queuedChunk=null,{value:chunk,done:!1}}if(_this24._done)return{value:void 0,done:!0};const requestCapability=Promise.withResolvers();return _this24._requests.push(requestCapability),requestCapability.promise}))()}cancel(reason){this._done=!0;for(const requestCapability of this._requests)requestCapability.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function createHeaders(isHttp,httpHeaders){const headers=new Headers;if(!isHttp||!httpHeaders||"object"!=typeof httpHeaders)return headers;for(const key in httpHeaders){const val=httpHeaders[key];void 0!==val&&headers.append(key,val)}return headers}function validateRangeRequestCapabilities({responseHeaders,isHttp,rangeChunkSize,disableRange}){const returnValues={allowRangeRequests:!1,suggestedLength:void 0},length=parseInt(responseHeaders.get("Content-Length"),10);if(!Number.isInteger(length))return returnValues;if(returnValues.suggestedLength=length,length<=2*rangeChunkSize)return returnValues;if(disableRange||!isHttp)return returnValues;if("bytes"!==responseHeaders.get("Accept-Ranges"))return returnValues;return"identity"!==(responseHeaders.get("Content-Encoding")||"identity")||(returnValues.allowRangeRequests=!0),returnValues}function extractFilenameFromHeader(responseHeaders){const contentDisposition=responseHeaders.get("Content-Disposition");if(contentDisposition){let filename=function getFilenameFromContentDispositionHeader(contentDisposition){let needsEncodingFixup=!0,tmp=toParamRegExp("filename\\*","i").exec(contentDisposition);if(tmp){tmp=tmp[1];let filename=rfc2616unquote(tmp);return filename=unescape(filename),filename=rfc5987decode(filename),filename=rfc2047decode(filename),fixupEncoding(filename)}if(tmp=function rfc2231getparam(contentDispositionStr){const matches=[];let match;const iter=toParamRegExp("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(match=iter.exec(contentDispositionStr));){let[,n,quot,part]=match;if(n=parseInt(n,10),n in matches){if(0===n)break}else matches[n]=[quot,part]}const parts=[];for(let n=0;n<matches.length&&n in matches;++n){let[quot,part]=matches[n];part=rfc2616unquote(part),quot&&(part=unescape(part),0===n&&(part=rfc5987decode(part))),parts.push(part)}return parts.join("")}(contentDisposition),tmp)return fixupEncoding(rfc2047decode(tmp));if(tmp=toParamRegExp("filename","i").exec(contentDisposition),tmp){tmp=tmp[1];let filename=rfc2616unquote(tmp);return filename=rfc2047decode(filename),fixupEncoding(filename)}function toParamRegExp(attributePattern,flags){return new RegExp("(?:^|;)\\s*"+attributePattern+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',flags)}function textdecode(encoding,value){if(encoding){if(!/^[\x00-\xFF]+$/.test(value))return value;try{const decoder=new TextDecoder(encoding,{fatal:!0}),buffer=stringToBytes(value);value=decoder.decode(buffer),needsEncodingFixup=!1}catch{}}return value}function fixupEncoding(value){return needsEncodingFixup&&/[\x80-\xff]/.test(value)&&(value=textdecode("utf-8",value),needsEncodingFixup&&(value=textdecode("iso-8859-1",value))),value}function rfc2616unquote(value){if(value.startsWith('"')){const parts=value.slice(1).split('\\"');for(let i=0;i<parts.length;++i){const quotindex=parts[i].indexOf('"');-1!==quotindex&&(parts[i]=parts[i].slice(0,quotindex),parts.length=i+1),parts[i]=parts[i].replaceAll(/\\(.)/g,"$1")}value=parts.join('"')}return value}function rfc5987decode(extvalue){const encodingend=extvalue.indexOf("'");return-1===encodingend?extvalue:textdecode(extvalue.slice(0,encodingend),extvalue.slice(encodingend+1).replace(/^[^']*'/,""))}function rfc2047decode(value){return!value.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(value)?value:value.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(matches,charset,encoding,text){if("q"===encoding||"Q"===encoding)return textdecode(charset,text=(text=text.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,(function(match,hex){return String.fromCharCode(parseInt(hex,16))})));try{text=atob(text)}catch{}return textdecode(charset,text)}))}return""}(contentDisposition);if(filename.includes("%"))try{filename=decodeURIComponent(filename)}catch{}if(isPdfFile(filename))return filename}return null}function createResponseStatusError(status,url){return 404===status||0===status&&url.startsWith("file:")?new MissingPDFException('Missing PDF "'+url+'".'):new UnexpectedResponseException(`Unexpected server response (${status}) while retrieving PDF "${url}".`,status)}function validateResponseStatus(status){return 200===status||206===status}function createFetchOptions(headers,withCredentials,abortController){return{method:"GET",headers,signal:abortController.signal,mode:"cors",credentials:withCredentials?"include":"same-origin",redirect:"follow"}}function getArrayBuffer(val){return val instanceof Uint8Array?val.buffer:val instanceof ArrayBuffer?val:(warn(`getArrayBuffer - unexpected data format: ${val}`),new Uint8Array(val).buffer)}class PDFFetchStream{constructor(source){this.source=source,this.isHttp=/^https?:/i.test(source.url),this.headers=createHeaders(this.isHttp,source.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return assert(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new PDFFetchStreamReader(this),this._fullRequestReader}getRangeReader(begin,end){if(end<=this._progressiveDataLength)return null;const reader=new PDFFetchStreamRangeReader(this,begin,end);return this._rangeRequestReaders.push(reader),reader}cancelAllRequests(reason){this._fullRequestReader?.cancel(reason);for(const reader of this._rangeRequestReaders.slice(0))reader.cancel(reason)}}class PDFFetchStreamReader{constructor(stream){this._stream=stream,this._reader=null,this._loaded=0,this._filename=null;const source=stream.source;this._withCredentials=source.withCredentials||!1,this._contentLength=source.length,this._headersCapability=Promise.withResolvers(),this._disableRange=source.disableRange||!1,this._rangeChunkSize=source.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!source.disableStream,this._isRangeSupported=!source.disableRange;const headers=new Headers(stream.headers),url=source.url;fetch(url,createFetchOptions(headers,this._withCredentials,this._abortController)).then((response=>{if(!validateResponseStatus(response.status))throw createResponseStatusError(response.status,url);this._reader=response.body.getReader(),this._headersCapability.resolve();const responseHeaders=response.headers,{allowRangeRequests,suggestedLength}=validateRangeRequestCapabilities({responseHeaders,isHttp:stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=allowRangeRequests,this._contentLength=suggestedLength||this._contentLength,this._filename=extractFilenameFromHeader(responseHeaders),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new AbortException("Streaming is disabled."))})).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){var _this25=this;return(0,asyncToGenerator.A)((function*(){yield _this25._headersCapability.promise;const{value,done}=yield _this25._reader.read();return done?{value,done}:(_this25._loaded+=value.byteLength,_this25.onProgress?.({loaded:_this25._loaded,total:_this25._contentLength}),{value:getArrayBuffer(value),done:!1})}))()}cancel(reason){this._reader?.cancel(reason),this._abortController.abort()}}class PDFFetchStreamRangeReader{constructor(stream,begin,end){this._stream=stream,this._reader=null,this._loaded=0;const source=stream.source;this._withCredentials=source.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!source.disableStream,this._abortController=new AbortController;const headers=new Headers(stream.headers);headers.append("Range",`bytes=${begin}-${end-1}`);const url=source.url;fetch(url,createFetchOptions(headers,this._withCredentials,this._abortController)).then((response=>{if(!validateResponseStatus(response.status))throw createResponseStatusError(response.status,url);this._readCapability.resolve(),this._reader=response.body.getReader()})).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}read(){var _this26=this;return(0,asyncToGenerator.A)((function*(){yield _this26._readCapability.promise;const{value,done}=yield _this26._reader.read();return done?{value,done}:(_this26._loaded+=value.byteLength,_this26.onProgress?.({loaded:_this26._loaded}),{value:getArrayBuffer(value),done:!1})}))()}cancel(reason){this._reader?.cancel(reason),this._abortController.abort()}}class NetworkManager{constructor({url,httpHeaders,withCredentials}){this.url=url,this.isHttp=/^https?:/i.test(url),this.headers=createHeaders(this.isHttp,httpHeaders),this.withCredentials=withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(begin,end,listeners){const args={begin,end};for(const prop in listeners)args[prop]=listeners[prop];return this.request(args)}requestFull(listeners){return this.request(listeners)}request(args){const xhr=new XMLHttpRequest,xhrId=this.currXhrId++,pendingRequest=this.pendingRequests[xhrId]={xhr};xhr.open("GET",this.url),xhr.withCredentials=this.withCredentials;for(const[key,val]of this.headers)xhr.setRequestHeader(key,val);return this.isHttp&&"begin"in args&&"end"in args?(xhr.setRequestHeader("Range",`bytes=${args.begin}-${args.end-1}`),pendingRequest.expectedStatus=206):pendingRequest.expectedStatus=200,xhr.responseType="arraybuffer",args.onError&&(xhr.onerror=function(evt){args.onError(xhr.status)}),xhr.onreadystatechange=this.onStateChange.bind(this,xhrId),xhr.onprogress=this.onProgress.bind(this,xhrId),pendingRequest.onHeadersReceived=args.onHeadersReceived,pendingRequest.onDone=args.onDone,pendingRequest.onError=args.onError,pendingRequest.onProgress=args.onProgress,xhr.send(null),xhrId}onProgress(xhrId,evt){const pendingRequest=this.pendingRequests[xhrId];pendingRequest&&pendingRequest.onProgress?.(evt)}onStateChange(xhrId,evt){const pendingRequest=this.pendingRequests[xhrId];if(!pendingRequest)return;const xhr=pendingRequest.xhr;if(xhr.readyState>=2&&pendingRequest.onHeadersReceived&&(pendingRequest.onHeadersReceived(),delete pendingRequest.onHeadersReceived),4!==xhr.readyState)return;if(!(xhrId in this.pendingRequests))return;if(delete this.pendingRequests[xhrId],0===xhr.status&&this.isHttp)return void pendingRequest.onError?.(xhr.status);const xhrStatus=xhr.status||200;if(!(200===xhrStatus&&206===pendingRequest.expectedStatus)&&xhrStatus!==pendingRequest.expectedStatus)return void pendingRequest.onError?.(xhr.status);const chunk=function network_getArrayBuffer(xhr){const data=xhr.response;return"string"!=typeof data?data:stringToBytes(data).buffer}(xhr);if(206===xhrStatus){const rangeHeader=xhr.getResponseHeader("Content-Range"),matches=/bytes (\d+)-(\d+)\/(\d+)/.exec(rangeHeader);pendingRequest.onDone({begin:parseInt(matches[1],10),chunk})}else chunk?pendingRequest.onDone({begin:0,chunk}):pendingRequest.onError?.(xhr.status)}getRequestXhr(xhrId){return this.pendingRequests[xhrId].xhr}isPendingRequest(xhrId){return xhrId in this.pendingRequests}abortRequest(xhrId){const xhr=this.pendingRequests[xhrId].xhr;delete this.pendingRequests[xhrId],xhr.abort()}}class PDFNetworkStream{constructor(source){this._source=source,this._manager=new NetworkManager(source),this._rangeChunkSize=source.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(reader){const i=this._rangeRequestReaders.indexOf(reader);i>=0&&this._rangeRequestReaders.splice(i,1)}getFullReader(){return assert(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new PDFNetworkStreamFullRequestReader(this._manager,this._source),this._fullRequestReader}getRangeReader(begin,end){const reader=new PDFNetworkStreamRangeRequestReader(this._manager,begin,end);return reader.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(reader),reader}cancelAllRequests(reason){this._fullRequestReader?.cancel(reason);for(const reader of this._rangeRequestReaders.slice(0))reader.cancel(reason)}}class PDFNetworkStreamFullRequestReader{constructor(manager,source){this._manager=manager;const args={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=source.url,this._fullRequestId=manager.requestFull(args),this._headersCapability=Promise.withResolvers(),this._disableRange=source.disableRange||!1,this._contentLength=source.length,this._rangeChunkSize=source.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const fullRequestXhrId=this._fullRequestId,fullRequestXhr=this._manager.getRequestXhr(fullRequestXhrId),responseHeaders=new Headers(fullRequestXhr.getAllResponseHeaders().trim().split(/[\r\n]+/).map((x=>{const[key,...val]=x.split(": ");return[key,val.join(": ")]}))),{allowRangeRequests,suggestedLength}=validateRangeRequestCapabilities({responseHeaders,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});allowRangeRequests&&(this._isRangeSupported=!0),this._contentLength=suggestedLength||this._contentLength,this._filename=extractFilenameFromHeader(responseHeaders),this._isRangeSupported&&this._manager.abortRequest(fullRequestXhrId),this._headersCapability.resolve()}_onDone(data){if(data)if(this._requests.length>0){this._requests.shift().resolve({value:data.chunk,done:!1})}else this._cachedChunks.push(data.chunk);if(this._done=!0,!(this._cachedChunks.length>0)){for(const requestCapability of this._requests)requestCapability.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(status){this._storedError=createResponseStatusError(status,this._url),this._headersCapability.reject(this._storedError);for(const requestCapability of this._requests)requestCapability.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(evt){this.onProgress?.({loaded:evt.loaded,total:evt.lengthComputable?evt.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}read(){var _this27=this;return(0,asyncToGenerator.A)((function*(){if(_this27._storedError)throw _this27._storedError;if(_this27._cachedChunks.length>0){return{value:_this27._cachedChunks.shift(),done:!1}}if(_this27._done)return{value:void 0,done:!0};const requestCapability=Promise.withResolvers();return _this27._requests.push(requestCapability),requestCapability.promise}))()}cancel(reason){this._done=!0,this._headersCapability.reject(reason);for(const requestCapability of this._requests)requestCapability.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class PDFNetworkStreamRangeRequestReader{constructor(manager,begin,end){this._manager=manager;const args={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=manager.url,this._requestId=manager.requestRange(begin,end,args),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(data){const chunk=data.chunk;if(this._requests.length>0){this._requests.shift().resolve({value:chunk,done:!1})}else this._queuedChunk=chunk;this._done=!0;for(const requestCapability of this._requests)requestCapability.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(status){this._storedError=createResponseStatusError(status,this._url);for(const requestCapability of this._requests)requestCapability.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(evt){this.isStreamingSupported||this.onProgress?.({loaded:evt.loaded})}get isStreamingSupported(){return!1}read(){var _this28=this;return(0,asyncToGenerator.A)((function*(){if(_this28._storedError)throw _this28._storedError;if(null!==_this28._queuedChunk){const chunk=_this28._queuedChunk;return _this28._queuedChunk=null,{value:chunk,done:!1}}if(_this28._done)return{value:void 0,done:!0};const requestCapability=Promise.withResolvers();return _this28._requests.push(requestCapability),requestCapability.promise}))()}cancel(reason){this._done=!0;for(const requestCapability of this._requests)requestCapability.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const urlRegex=/^[a-z][a-z0-9\-+.]+:/i;function createRequest(url,headers,callback){if("http:"===url.protocol){return NodePackages.get("http").request(url,{headers},callback)}return NodePackages.get("https").request(url,{headers},callback)}class PDFNodeStream{constructor(source){this.source=source,this.url=function parseUrlOrPath(sourceUrl){if(urlRegex.test(sourceUrl))return new URL(sourceUrl);const url=NodePackages.get("url");return new URL(url.pathToFileURL(sourceUrl))}(source.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.headers=createHeaders(this.isHttp,source.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return assert(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new PDFNodeStreamFsFullReader(this):new PDFNodeStreamFullReader(this),this._fullRequestReader}getRangeReader(start,end){if(end<=this._progressiveDataLength)return null;const rangeReader=this.isFsUrl?new PDFNodeStreamFsRangeReader(this,start,end):new PDFNodeStreamRangeReader(this,start,end);return this._rangeRequestReaders.push(rangeReader),rangeReader}cancelAllRequests(reason){this._fullRequestReader?.cancel(reason);for(const reader of this._rangeRequestReaders.slice(0))reader.cancel(reason)}}class BaseFullReader{constructor(stream){this._url=stream.url,this._done=!1,this._storedError=null,this.onProgress=null;const source=stream.source;this._contentLength=source.length,this._loaded=0,this._filename=null,this._disableRange=source.disableRange||!1,this._rangeChunkSize=source.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!source.disableStream,this._isRangeSupported=!source.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){var _this29=this;return(0,asyncToGenerator.A)((function*(){if(yield _this29._readCapability.promise,_this29._done)return{value:void 0,done:!0};if(_this29._storedError)throw _this29._storedError;const chunk=_this29._readableStream.read();if(null===chunk)return _this29._readCapability=Promise.withResolvers(),_this29.read();_this29._loaded+=chunk.length,_this29.onProgress?.({loaded:_this29._loaded,total:_this29._contentLength});return{value:new Uint8Array(chunk).buffer,done:!1}}))()}cancel(reason){this._readableStream?this._readableStream.destroy(reason):this._error(reason)}_error(reason){this._storedError=reason,this._readCapability.resolve()}_setReadableStream(readableStream){this._readableStream=readableStream,readableStream.on("readable",(()=>{this._readCapability.resolve()})),readableStream.on("end",(()=>{readableStream.destroy(),this._done=!0,this._readCapability.resolve()})),readableStream.on("error",(reason=>{this._error(reason)})),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class BaseRangeReader{constructor(stream){this._url=stream.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const source=stream.source;this._isStreamingSupported=!source.disableStream}get isStreamingSupported(){return this._isStreamingSupported}read(){var _this30=this;return(0,asyncToGenerator.A)((function*(){if(yield _this30._readCapability.promise,_this30._done)return{value:void 0,done:!0};if(_this30._storedError)throw _this30._storedError;const chunk=_this30._readableStream.read();if(null===chunk)return _this30._readCapability=Promise.withResolvers(),_this30.read();_this30._loaded+=chunk.length,_this30.onProgress?.({loaded:_this30._loaded});return{value:new Uint8Array(chunk).buffer,done:!1}}))()}cancel(reason){this._readableStream?this._readableStream.destroy(reason):this._error(reason)}_error(reason){this._storedError=reason,this._readCapability.resolve()}_setReadableStream(readableStream){this._readableStream=readableStream,readableStream.on("readable",(()=>{this._readCapability.resolve()})),readableStream.on("end",(()=>{readableStream.destroy(),this._done=!0,this._readCapability.resolve()})),readableStream.on("error",(reason=>{this._error(reason)})),this._storedError&&this._readableStream.destroy(this._storedError)}}class PDFNodeStreamFullReader extends BaseFullReader{constructor(stream){super(stream);const headers=Object.fromEntries(stream.headers);this._request=createRequest(this._url,headers,(response=>{if(404===response.statusCode){const error=new MissingPDFException(`Missing PDF "${this._url}".`);return this._storedError=error,void this._headersCapability.reject(error)}this._headersCapability.resolve(),this._setReadableStream(response);const responseHeaders=new Headers(this._readableStream.headers),{allowRangeRequests,suggestedLength}=validateRangeRequestCapabilities({responseHeaders,isHttp:stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=allowRangeRequests,this._contentLength=suggestedLength||this._contentLength,this._filename=extractFilenameFromHeader(responseHeaders)})),this._request.on("error",(reason=>{this._storedError=reason,this._headersCapability.reject(reason)})),this._request.end()}}class PDFNodeStreamRangeReader extends BaseRangeReader{constructor(stream,start,end){super(stream);const headers=Object.fromEntries(stream.headers);headers.Range=`bytes=${start}-${end-1}`;this._request=createRequest(this._url,headers,(response=>{if(404!==response.statusCode)this._setReadableStream(response);else{const error=new MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=error}})),this._request.on("error",(reason=>{this._storedError=reason})),this._request.end()}}class PDFNodeStreamFsFullReader extends BaseFullReader{constructor(stream){super(stream);const fs=NodePackages.get("fs");fs.promises.lstat(this._url).then((stat=>{this._contentLength=stat.size,this._setReadableStream(fs.createReadStream(this._url)),this._headersCapability.resolve()}),(error=>{"ENOENT"===error.code&&(error=new MissingPDFException(`Missing PDF "${this._url}".`)),this._storedError=error,this._headersCapability.reject(error)}))}}class PDFNodeStreamFsRangeReader extends BaseRangeReader{constructor(stream,start,end){super(stream);const fs=NodePackages.get("fs");this._setReadableStream(fs.createReadStream(this._url,{start,end:end-1}))}}class TextLayer{#capability=Promise.withResolvers();#container=null;#disableProcessItems=!1;#fontInspectorEnabled=!!globalThis.FontInspector?.enabled;#lang=null;#layoutTextParams=null;#pageHeight=0;#pageWidth=0;#reader=null;#rootContainer=null;#rotation=0;#scale=0;#styleCache=Object.create(null);#textContentItemsStr=[];#textContentSource=null;#textDivs=[];#textDivProperties=new WeakMap;#transform=null;static#ascentCache=new Map;static#canvasContexts=new Map;static#canvasCtxFonts=new WeakMap;static#minFontSize=null;static#pendingTextLayers=new Set;constructor({textContentSource,container,viewport}){if(textContentSource instanceof ReadableStream)this.#textContentSource=textContentSource;else{if("object"!=typeof textContentSource)throw new Error('No "textContentSource" parameter specified.');this.#textContentSource=new ReadableStream({start(controller){controller.enqueue(textContentSource),controller.close()}})}this.#container=this.#rootContainer=container,this.#scale=viewport.scale*(globalThis.devicePixelRatio||1),this.#rotation=viewport.rotation,this.#layoutTextParams={div:null,properties:null,ctx:null};const{pageWidth,pageHeight,pageX,pageY}=viewport.rawDims;this.#transform=[1,0,0,-1,-pageX,pageY+pageHeight],this.#pageWidth=pageWidth,this.#pageHeight=pageHeight,TextLayer.#ensureMinFontSizeComputed(),setLayerDimensions(container,viewport),this.#capability.promise.finally((()=>{TextLayer.#pendingTextLayers.delete(this),this.#layoutTextParams=null,this.#styleCache=null})).catch((()=>{}))}static get fontFamilyMap(){const{isWindows,isFirefox}=util_FeatureTest.platform;return shadow(this,"fontFamilyMap",new Map([["sans-serif",(isWindows&&isFirefox?"Calibri, ":"")+"sans-serif"],["monospace",(isWindows&&isFirefox?"Lucida Console, ":"")+"monospace"]]))}render(){const pump=()=>{this.#reader.read().then((({value,done})=>{done?this.#capability.resolve():(this.#lang??=value.lang,Object.assign(this.#styleCache,value.styles),this.#processItems(value.items),pump())}),this.#capability.reject)};return this.#reader=this.#textContentSource.getReader(),TextLayer.#pendingTextLayers.add(this),pump(),this.#capability.promise}update({viewport,onBefore=null}){const scale=viewport.scale*(globalThis.devicePixelRatio||1),rotation=viewport.rotation;if(rotation!==this.#rotation&&(onBefore?.(),this.#rotation=rotation,setLayerDimensions(this.#rootContainer,{rotation})),scale!==this.#scale){onBefore?.(),this.#scale=scale;const params={div:null,properties:null,ctx:TextLayer.#getCtx(this.#lang)};for(const div of this.#textDivs)params.properties=this.#textDivProperties.get(div),params.div=div,this.#layout(params)}}cancel(){const abortEx=new AbortException("TextLayer task cancelled.");this.#reader?.cancel(abortEx).catch((()=>{})),this.#reader=null,this.#capability.reject(abortEx)}get textDivs(){return this.#textDivs}get textContentItemsStr(){return this.#textContentItemsStr}#processItems(items){if(this.#disableProcessItems)return;this.#layoutTextParams.ctx??=TextLayer.#getCtx(this.#lang);const textDivs=this.#textDivs,textContentItemsStr=this.#textContentItemsStr;for(const item of items){if(textDivs.length>1e5)return warn("Ignoring additional textDivs for performance reasons."),void(this.#disableProcessItems=!0);if(void 0!==item.str)textContentItemsStr.push(item.str),this.#appendText(item);else if("beginMarkedContentProps"===item.type||"beginMarkedContent"===item.type){const parent=this.#container;this.#container=document.createElement("span"),this.#container.classList.add("markedContent"),null!==item.id&&this.#container.setAttribute("id",`${item.id}`),parent.append(this.#container)}else"endMarkedContent"===item.type&&(this.#container=this.#container.parentNode)}}#appendText(geom){const textDiv=document.createElement("span"),textDivProperties={angle:0,canvasWidth:0,hasText:""!==geom.str,hasEOL:geom.hasEOL,fontSize:0};this.#textDivs.push(textDiv);const tx=Util.transform(this.#transform,geom.transform);let angle=Math.atan2(tx[1],tx[0]);const style=this.#styleCache[geom.fontName];style.vertical&&(angle+=Math.PI/2);let fontFamily=this.#fontInspectorEnabled&&style.fontSubstitution||style.fontFamily;fontFamily=TextLayer.fontFamilyMap.get(fontFamily)||fontFamily;const fontHeight=Math.hypot(tx[2],tx[3]),fontAscent=fontHeight*TextLayer.#getAscent(fontFamily,this.#lang);let left,top;0===angle?(left=tx[4],top=tx[5]-fontAscent):(left=tx[4]+fontAscent*Math.sin(angle),top=tx[5]-fontAscent*Math.cos(angle));const divStyle=textDiv.style;this.#container===this.#rootContainer?(divStyle.left=`${(100*left/this.#pageWidth).toFixed(2)}%`,divStyle.top=`${(100*top/this.#pageHeight).toFixed(2)}%`):(divStyle.left=`calc(var(--scale-factor)*${left.toFixed(2)}px)`,divStyle.top=`calc(var(--scale-factor)*${top.toFixed(2)}px)`),divStyle.fontSize=`calc(var(--scale-factor)*${(TextLayer.#minFontSize*fontHeight).toFixed(2)}px)`,divStyle.fontFamily=fontFamily,textDivProperties.fontSize=fontHeight,textDiv.setAttribute("role","presentation"),textDiv.textContent=geom.str,textDiv.dir=geom.dir,this.#fontInspectorEnabled&&(textDiv.dataset.fontName=style.fontSubstitutionLoadedName||geom.fontName),0!==angle&&(textDivProperties.angle=angle*(180/Math.PI));let shouldScaleText=!1;if(geom.str.length>1)shouldScaleText=!0;else if(" "!==geom.str&&geom.transform[0]!==geom.transform[3]){const absScaleX=Math.abs(geom.transform[0]),absScaleY=Math.abs(geom.transform[3]);absScaleX!==absScaleY&&Math.max(absScaleX,absScaleY)/Math.min(absScaleX,absScaleY)>1.5&&(shouldScaleText=!0)}if(shouldScaleText&&(textDivProperties.canvasWidth=style.vertical?geom.height:geom.width),this.#textDivProperties.set(textDiv,textDivProperties),this.#layoutTextParams.div=textDiv,this.#layoutTextParams.properties=textDivProperties,this.#layout(this.#layoutTextParams),textDivProperties.hasText&&this.#container.append(textDiv),textDivProperties.hasEOL){const br=document.createElement("br");br.setAttribute("role","presentation"),this.#container.append(br)}}#layout(params){const{div,properties,ctx}=params,{style}=div;let transform="";if(TextLayer.#minFontSize>1&&(transform=`scale(${1/TextLayer.#minFontSize})`),0!==properties.canvasWidth&&properties.hasText){const{fontFamily}=style,{canvasWidth,fontSize}=properties;TextLayer.#ensureCtxFont(ctx,fontSize*this.#scale,fontFamily);const{width}=ctx.measureText(div.textContent);width>0&&(transform=`scaleX(${canvasWidth*this.#scale/width}) ${transform}`)}0!==properties.angle&&(transform=`rotate(${properties.angle}deg) ${transform}`),transform.length>0&&(style.transform=transform)}static cleanup(){if(!(this.#pendingTextLayers.size>0)){this.#ascentCache.clear();for(const{canvas}of this.#canvasContexts.values())canvas.remove();this.#canvasContexts.clear()}}static#getCtx(lang=null){let ctx=this.#canvasContexts.get(lang||="");if(!ctx){const canvas=document.createElement("canvas");canvas.className="hiddenCanvasElement",canvas.lang=lang,document.body.append(canvas),ctx=canvas.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#canvasContexts.set(lang,ctx),this.#canvasCtxFonts.set(ctx,{size:0,family:""})}return ctx}static#ensureCtxFont(ctx,size,family){const cached=this.#canvasCtxFonts.get(ctx);size===cached.size&&family===cached.family||(ctx.font=`${size}px ${family}`,cached.size=size,cached.family=family)}static#ensureMinFontSizeComputed(){if(null!==this.#minFontSize)return;const div=document.createElement("div");div.style.opacity=0,div.style.lineHeight=1,div.style.fontSize="1px",div.style.position="absolute",div.textContent="X",document.body.append(div),this.#minFontSize=div.getBoundingClientRect().height,div.remove()}static#getAscent(fontFamily,lang){const cachedAscent=this.#ascentCache.get(fontFamily);if(cachedAscent)return cachedAscent;const ctx=this.#getCtx(lang);ctx.canvas.width=ctx.canvas.height=30,this.#ensureCtxFont(ctx,30,fontFamily);const metrics=ctx.measureText("");let ascent=metrics.fontBoundingBoxAscent,descent=Math.abs(metrics.fontBoundingBoxDescent);if(ascent){const ratio=ascent/(ascent+descent);return this.#ascentCache.set(fontFamily,ratio),ctx.canvas.width=ctx.canvas.height=0,ratio}ctx.strokeStyle="red",ctx.clearRect(0,0,30,30),ctx.strokeText("g",0,0);let pixels=ctx.getImageData(0,0,30,30).data;descent=0;for(let i=pixels.length-1-3;i>=0;i-=4)if(pixels[i]>0){descent=Math.ceil(i/4/30);break}ctx.clearRect(0,0,30,30),ctx.strokeText("A",0,30),pixels=ctx.getImageData(0,0,30,30).data,ascent=0;for(let i=0,ii=pixels.length;i<ii;i+=4)if(pixels[i]>0){ascent=30-Math.floor(i/4/30);break}ctx.canvas.width=ctx.canvas.height=0;const ratio=ascent?ascent/(ascent+descent):.8;return this.#ascentCache.set(fontFamily,ratio),ratio}}class XfaText{static textContent(xfa){const items=[],output={items,styles:Object.create(null)};return function walk(node){if(!node)return;let str=null;const name=node.name;if("#text"===name)str=node.value;else{if(!XfaText.shouldBuildText(name))return;node?.attributes?.textContent?str=node.attributes.textContent:node.value&&(str=node.value)}if(null!==str&&items.push({str}),node.children)for(const child of node.children)walk(child)}(xfa),output}static shouldBuildText(name){return!("textarea"===name||"input"===name||"option"===name||"select"===name)}}const DEFAULT_RANGE_CHUNK_SIZE=65536,DefaultCanvasFactory=isNodeJS?class NodeCanvasFactory extends BaseCanvasFactory{_createCanvas(width,height){return NodePackages.get("canvas").createCanvas(width,height)}}:class DOMCanvasFactory extends BaseCanvasFactory{constructor({ownerDocument=globalThis.document,enableHWA=!1}){super({enableHWA}),this._document=ownerDocument}_createCanvas(width,height){const canvas=this._document.createElement("canvas");return canvas.width=width,canvas.height=height,canvas}},DefaultCMapReaderFactory=isNodeJS?class NodeCMapReaderFactory extends BaseCMapReaderFactory{_fetch(url){return(0,asyncToGenerator.A)((function*(){return node_utils_fetchData(url)}))()}}:DOMCMapReaderFactory,DefaultFilterFactory=isNodeJS?class NodeFilterFactory extends BaseFilterFactory{}:class DOMFilterFactory extends BaseFilterFactory{#baseUrl;#_cache;#_defs;#docId;#document;#_hcmCache;#id=0;constructor({docId,ownerDocument=globalThis.document}){super(),this.#docId=docId,this.#document=ownerDocument}get#cache(){return this.#_cache||=new Map}get#hcmCache(){return this.#_hcmCache||=new Map}get#defs(){if(!this.#_defs){const div=this.#document.createElement("div"),{style}=div;style.visibility="hidden",style.contain="strict",style.width=style.height=0,style.position="absolute",style.top=style.left=0,style.zIndex=-1;const svg=this.#document.createElementNS(SVG_NS,"svg");svg.setAttribute("width",0),svg.setAttribute("height",0),this.#_defs=this.#document.createElementNS(SVG_NS,"defs"),div.append(svg),svg.append(this.#_defs),this.#document.body.append(div)}return this.#_defs}#createTables(maps){if(1===maps.length){const mapR=maps[0],buffer=new Array(256);for(let i=0;i<256;i++)buffer[i]=mapR[i]/255;const table=buffer.join(",");return[table,table,table]}const[mapR,mapG,mapB]=maps,bufferR=new Array(256),bufferG=new Array(256),bufferB=new Array(256);for(let i=0;i<256;i++)bufferR[i]=mapR[i]/255,bufferG[i]=mapG[i]/255,bufferB[i]=mapB[i]/255;return[bufferR.join(","),bufferG.join(","),bufferB.join(",")]}#createUrl(id){if(void 0===this.#baseUrl){this.#baseUrl="";const url=this.#document.URL;url!==this.#document.baseURI&&(isDataScheme(url)?warn('#createUrl: ignore "data:"-URL for performance reasons.'):this.#baseUrl=url.split("#",1)[0])}return`url(${this.#baseUrl}#${id})`}addFilter(maps){if(!maps)return"none";let value=this.#cache.get(maps);if(value)return value;const[tableR,tableG,tableB]=this.#createTables(maps),key=1===maps.length?tableR:`${tableR}${tableG}${tableB}`;if(value=this.#cache.get(key),value)return this.#cache.set(maps,value),value;const id=`g_${this.#docId}_transfer_map_${this.#id++}`,url=this.#createUrl(id);this.#cache.set(maps,url),this.#cache.set(key,url);const filter=this.#createFilter(id);return this.#addTransferMapConversion(tableR,tableG,tableB,filter),url}addHCMFilter(fgColor,bgColor){const key=`${fgColor}-${bgColor}`;let info=this.#hcmCache.get("base");if(info?.key===key)return info.url;if(info?(info.filter?.remove(),info.key=key,info.url="none",info.filter=null):(info={key,url:"none",filter:null},this.#hcmCache.set("base",info)),!fgColor||!bgColor)return info.url;const fgRGB=this.#getRGB(fgColor);fgColor=Util.makeHexColor(...fgRGB);const bgRGB=this.#getRGB(bgColor);if(bgColor=Util.makeHexColor(...bgRGB),this.#defs.style.color="","#000000"===fgColor&&"#ffffff"===bgColor||fgColor===bgColor)return info.url;const map=new Array(256);for(let i=0;i<=255;i++){const x=i/255;map[i]=x<=.03928?x/12.92:((x+.055)/1.055)**2.4}const table=map.join(","),id=`g_${this.#docId}_hcm_filter`,filter=info.filter=this.#createFilter(id);this.#addTransferMapConversion(table,table,table,filter),this.#addGrayConversion(filter);const getSteps=(c,n)=>{const start=fgRGB[c]/255,end=bgRGB[c]/255,arr=new Array(n+1);for(let i=0;i<=n;i++)arr[i]=start+i/n*(end-start);return arr.join(",")};return this.#addTransferMapConversion(getSteps(0,5),getSteps(1,5),getSteps(2,5),filter),info.url=this.#createUrl(id),info.url}addAlphaFilter(map){let value=this.#cache.get(map);if(value)return value;const[tableA]=this.#createTables([map]),key=`alpha_${tableA}`;if(value=this.#cache.get(key),value)return this.#cache.set(map,value),value;const id=`g_${this.#docId}_alpha_map_${this.#id++}`,url=this.#createUrl(id);this.#cache.set(map,url),this.#cache.set(key,url);const filter=this.#createFilter(id);return this.#addTransferMapAlphaConversion(tableA,filter),url}addLuminosityFilter(map){let tableA,key,value=this.#cache.get(map||"luminosity");if(value)return value;if(map?([tableA]=this.#createTables([map]),key=`luminosity_${tableA}`):key="luminosity",value=this.#cache.get(key),value)return this.#cache.set(map,value),value;const id=`g_${this.#docId}_luminosity_map_${this.#id++}`,url=this.#createUrl(id);this.#cache.set(map,url),this.#cache.set(key,url);const filter=this.#createFilter(id);return this.#addLuminosityConversion(filter),map&&this.#addTransferMapAlphaConversion(tableA,filter),url}addHighlightHCMFilter(filterName,fgColor,bgColor,newFgColor,newBgColor){const key=`${fgColor}-${bgColor}-${newFgColor}-${newBgColor}`;let info=this.#hcmCache.get(filterName);if(info?.key===key)return info.url;if(info?(info.filter?.remove(),info.key=key,info.url="none",info.filter=null):(info={key,url:"none",filter:null},this.#hcmCache.set(filterName,info)),!fgColor||!bgColor)return info.url;const[fgRGB,bgRGB]=[fgColor,bgColor].map(this.#getRGB.bind(this));let fgGray=Math.round(.2126*fgRGB[0]+.7152*fgRGB[1]+.0722*fgRGB[2]),bgGray=Math.round(.2126*bgRGB[0]+.7152*bgRGB[1]+.0722*bgRGB[2]),[newFgRGB,newBgRGB]=[newFgColor,newBgColor].map(this.#getRGB.bind(this));bgGray<fgGray&&([fgGray,bgGray,newFgRGB,newBgRGB]=[bgGray,fgGray,newBgRGB,newFgRGB]),this.#defs.style.color="";const getSteps=(fg,bg,n)=>{const arr=new Array(256),step=(bgGray-fgGray)/n,newStart=fg/255,newStep=(bg-fg)/(255*n);let prev=0;for(let i=0;i<=n;i++){const k=Math.round(fgGray+i*step),value=newStart+i*newStep;for(let j=prev;j<=k;j++)arr[j]=value;prev=k+1}for(let i=prev;i<256;i++)arr[i]=arr[prev-1];return arr.join(",")},id=`g_${this.#docId}_hcm_${filterName}_filter`,filter=info.filter=this.#createFilter(id);return this.#addGrayConversion(filter),this.#addTransferMapConversion(getSteps(newFgRGB[0],newBgRGB[0],5),getSteps(newFgRGB[1],newBgRGB[1],5),getSteps(newFgRGB[2],newBgRGB[2],5),filter),info.url=this.#createUrl(id),info.url}destroy(keepHCM=!1){keepHCM&&0!==this.#hcmCache.size||(this.#_defs&&(this.#_defs.parentNode.parentNode.remove(),this.#_defs=null),this.#_cache&&(this.#_cache.clear(),this.#_cache=null),this.#id=0)}#addLuminosityConversion(filter){const feColorMatrix=this.#document.createElementNS(SVG_NS,"feColorMatrix");feColorMatrix.setAttribute("type","matrix"),feColorMatrix.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),filter.append(feColorMatrix)}#addGrayConversion(filter){const feColorMatrix=this.#document.createElementNS(SVG_NS,"feColorMatrix");feColorMatrix.setAttribute("type","matrix"),feColorMatrix.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),filter.append(feColorMatrix)}#createFilter(id){const filter=this.#document.createElementNS(SVG_NS,"filter");return filter.setAttribute("color-interpolation-filters","sRGB"),filter.setAttribute("id",id),this.#defs.append(filter),filter}#appendFeFunc(feComponentTransfer,func,table){const feFunc=this.#document.createElementNS(SVG_NS,func);feFunc.setAttribute("type","discrete"),feFunc.setAttribute("tableValues",table),feComponentTransfer.append(feFunc)}#addTransferMapConversion(rTable,gTable,bTable,filter){const feComponentTransfer=this.#document.createElementNS(SVG_NS,"feComponentTransfer");filter.append(feComponentTransfer),this.#appendFeFunc(feComponentTransfer,"feFuncR",rTable),this.#appendFeFunc(feComponentTransfer,"feFuncG",gTable),this.#appendFeFunc(feComponentTransfer,"feFuncB",bTable)}#addTransferMapAlphaConversion(aTable,filter){const feComponentTransfer=this.#document.createElementNS(SVG_NS,"feComponentTransfer");filter.append(feComponentTransfer),this.#appendFeFunc(feComponentTransfer,"feFuncA",aTable)}#getRGB(color){return this.#defs.style.color=color,getRGB(getComputedStyle(this.#defs).getPropertyValue("color"))}},DefaultStandardFontDataFactory=isNodeJS?class NodeStandardFontDataFactory extends BaseStandardFontDataFactory{_fetch(url){return(0,asyncToGenerator.A)((function*(){return node_utils_fetchData(url)}))()}}:DOMStandardFontDataFactory;function getDocument(src={}){"string"==typeof src||src instanceof URL?src={url:src}:(src instanceof ArrayBuffer||ArrayBuffer.isView(src))&&(src={data:src});const task=new PDFDocumentLoadingTask,{docId}=task,url=src.url?function getUrlProp(val){if(val instanceof URL)return val.href;try{return new URL(val,window.location).href}catch{if(isNodeJS&&"string"==typeof val)return val}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(src.url):null,data=src.data?function getDataProp(val){if(isNodeJS&&"undefined"!=typeof Buffer&&val instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(val instanceof Uint8Array&&val.byteLength===val.buffer.byteLength)return val;if("string"==typeof val)return stringToBytes(val);if(val instanceof ArrayBuffer||ArrayBuffer.isView(val)||"object"==typeof val&&!isNaN(val?.length))return new Uint8Array(val);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(src.data):null,httpHeaders=src.httpHeaders||null,withCredentials=!0===src.withCredentials,password=src.password??null,rangeTransport=src.range instanceof PDFDataRangeTransport?src.range:null,rangeChunkSize=Number.isInteger(src.rangeChunkSize)&&src.rangeChunkSize>0?src.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let worker=src.worker instanceof PDFWorker?src.worker:null;const verbosity=src.verbosity,docBaseUrl="string"!=typeof src.docBaseUrl||isDataScheme(src.docBaseUrl)?null:src.docBaseUrl,cMapUrl="string"==typeof src.cMapUrl?src.cMapUrl:null,cMapPacked=!1!==src.cMapPacked,CMapReaderFactory=src.CMapReaderFactory||DefaultCMapReaderFactory,standardFontDataUrl="string"==typeof src.standardFontDataUrl?src.standardFontDataUrl:null,StandardFontDataFactory=src.StandardFontDataFactory||DefaultStandardFontDataFactory,ignoreErrors=!0!==src.stopAtErrors,maxImageSize=Number.isInteger(src.maxImageSize)&&src.maxImageSize>-1?src.maxImageSize:-1,isEvalSupported=!1!==src.isEvalSupported,isOffscreenCanvasSupported="boolean"==typeof src.isOffscreenCanvasSupported?src.isOffscreenCanvasSupported:!isNodeJS,isChrome="boolean"==typeof src.isChrome?src.isChrome:!util_FeatureTest.platform.isFirefox&&"undefined"!=typeof window&&!!window?.chrome,canvasMaxAreaInBytes=Number.isInteger(src.canvasMaxAreaInBytes)?src.canvasMaxAreaInBytes:-1,disableFontFace="boolean"==typeof src.disableFontFace?src.disableFontFace:isNodeJS,fontExtraProperties=!0===src.fontExtraProperties,enableXfa=!0===src.enableXfa,ownerDocument=src.ownerDocument||globalThis.document,disableRange=!0===src.disableRange,disableStream=!0===src.disableStream,disableAutoFetch=!0===src.disableAutoFetch,pdfBug=!0===src.pdfBug,CanvasFactory=src.CanvasFactory||DefaultCanvasFactory,FilterFactory=src.FilterFactory||DefaultFilterFactory,enableHWA=!0===src.enableHWA,length=rangeTransport?rangeTransport.length:src.length??NaN,useSystemFonts="boolean"==typeof src.useSystemFonts?src.useSystemFonts:!isNodeJS&&!disableFontFace,useWorkerFetch="boolean"==typeof src.useWorkerFetch?src.useWorkerFetch:CMapReaderFactory===DOMCMapReaderFactory&&StandardFontDataFactory===DOMStandardFontDataFactory&&cMapUrl&&standardFontDataUrl&&isValidFetchUrl(cMapUrl,document.baseURI)&&isValidFetchUrl(standardFontDataUrl,document.baseURI);src.canvasFactory&&deprecated("`canvasFactory`-instance option, please use `CanvasFactory` instead."),src.filterFactory&&deprecated("`filterFactory`-instance option, please use `FilterFactory` instead.");setVerbosityLevel(verbosity);const transportFactory={canvasFactory:new CanvasFactory({ownerDocument,enableHWA}),filterFactory:new FilterFactory({docId,ownerDocument}),cMapReaderFactory:useWorkerFetch?null:new CMapReaderFactory({baseUrl:cMapUrl,isCompressed:cMapPacked}),standardFontDataFactory:useWorkerFetch?null:new StandardFontDataFactory({baseUrl:standardFontDataUrl})};if(!worker){const workerParams={verbosity,port:GlobalWorkerOptions.workerPort};worker=workerParams.port?PDFWorker.fromPort(workerParams):new PDFWorker(workerParams),task._worker=worker}const docParams={docId,apiVersion:"4.8.69",data,password,disableAutoFetch,rangeChunkSize,length,docBaseUrl,enableXfa,evaluatorOptions:{maxImageSize,disableFontFace,ignoreErrors,isEvalSupported,isOffscreenCanvasSupported,isChrome,canvasMaxAreaInBytes,fontExtraProperties,useSystemFonts,cMapUrl:useWorkerFetch?cMapUrl:null,standardFontDataUrl:useWorkerFetch?standardFontDataUrl:null}},transportParams={disableFontFace,fontExtraProperties,ownerDocument,pdfBug,styleElement:null,loadingParams:{disableAutoFetch,enableXfa}};return worker.promise.then((function(){if(task.destroyed)throw new Error("Loading aborted");if(worker.destroyed)throw new Error("Worker was destroyed");const workerIdPromise=worker.messageHandler.sendWithPromise("GetDocRequest",docParams,data?[data.buffer]:null);let networkStream;if(rangeTransport)networkStream=new PDFDataTransportStream(rangeTransport,{disableRange,disableStream});else if(!data){if(!url)throw new Error("getDocument - no `url` parameter provided.");let NetworkStream;if(isNodeJS){NetworkStream="undefined"!=typeof fetch&&"undefined"!=typeof Response&&"body"in Response.prototype&&isValidFetchUrl(url)?PDFFetchStream:PDFNodeStream}else NetworkStream=isValidFetchUrl(url)?PDFFetchStream:PDFNetworkStream;networkStream=new NetworkStream({url,length,httpHeaders,withCredentials,rangeChunkSize,disableRange,disableStream})}return workerIdPromise.then((workerId=>{if(task.destroyed)throw new Error("Loading aborted");if(worker.destroyed)throw new Error("Worker was destroyed");const messageHandler=new MessageHandler(docId,workerId,worker.port),transport=new WorkerTransport(messageHandler,task,networkStream,transportParams,transportFactory);task._transport=transport,messageHandler.send("Ready",null)}))})).catch(task._capability.reject),task}function isRefProxy(ref){return"object"==typeof ref&&Number.isInteger(ref?.num)&&ref.num>=0&&Number.isInteger(ref?.gen)&&ref.gen>=0}class PDFDocumentLoadingTask{static#docId=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId="d"+PDFDocumentLoadingTask.#docId++,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}destroy(){var _this31=this;return(0,asyncToGenerator.A)((function*(){_this31.destroyed=!0;try{_this31._worker?.port&&(_this31._worker._pendingDestroy=!0),yield _this31._transport?.destroy()}catch(ex){throw _this31._worker?.port&&delete _this31._worker._pendingDestroy,ex}_this31._transport=null,_this31._worker&&(_this31._worker.destroy(),_this31._worker=null)}))()}}class PDFDataRangeTransport{constructor(length,initialData,progressiveDone=!1,contentDispositionFilename=null){this.length=length,this.initialData=initialData,this.progressiveDone=progressiveDone,this.contentDispositionFilename=contentDispositionFilename,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(listener){this._rangeListeners.push(listener)}addProgressListener(listener){this._progressListeners.push(listener)}addProgressiveReadListener(listener){this._progressiveReadListeners.push(listener)}addProgressiveDoneListener(listener){this._progressiveDoneListeners.push(listener)}onDataRange(begin,chunk){for(const listener of this._rangeListeners)listener(begin,chunk)}onDataProgress(loaded,total){this._readyCapability.promise.then((()=>{for(const listener of this._progressListeners)listener(loaded,total)}))}onDataProgressiveRead(chunk){this._readyCapability.promise.then((()=>{for(const listener of this._progressiveReadListeners)listener(chunk)}))}onDataProgressiveDone(){this._readyCapability.promise.then((()=>{for(const listener of this._progressiveDoneListeners)listener()}))}transportReady(){this._readyCapability.resolve()}requestDataRange(begin,end){unreachable("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class PDFDocumentProxy{constructor(pdfInfo,transport){this._pdfInfo=pdfInfo,this._transport=transport}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return shadow(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(pageNumber){return this._transport.getPage(pageNumber)}getPageIndex(ref){return this._transport.getPageIndex(ref)}getDestinations(){return this._transport.getDestinations()}getDestination(id){return this._transport.getDestination(id)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent="display"}={}){const{renderingIntent}=this._transport.getRenderingIntent(intent);return this._transport.getOptionalContentConfig(renderingIntent)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(keepLoadedFonts=!1){return this._transport.startCleanup(keepLoadedFonts||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(ref){return this._transport.cachedPageNumber(ref)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class PDFPageProxy{#delayedCleanupTimeout=null;#pendingCleanup=!1;constructor(pageIndex,pageInfo,transport,pdfBug=!1){this._pageIndex=pageIndex,this._pageInfo=pageInfo,this._transport=transport,this._stats=pdfBug?new StatTimer:null,this._pdfBug=pdfBug,this.commonObjs=transport.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale,rotation=this.rotate,offsetX=0,offsetY=0,dontFlip=!1}={}){return new PageViewport({viewBox:this.view,scale,rotation,offsetX,offsetY,dontFlip})}getAnnotations({intent="display"}={}){const{renderingIntent}=this._transport.getRenderingIntent(intent);return this._transport.getAnnotations(this._pageIndex,renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return shadow(this,"isPureXfa",!!this._transport._htmlForXfa)}getXfa(){var _this32=this;return(0,asyncToGenerator.A)((function*(){return _this32._transport._htmlForXfa?.children[_this32._pageIndex]||null}))()}render({canvasContext,viewport,intent="display",annotationMode=AnnotationMode.ENABLE,transform=null,background=null,optionalContentConfigPromise=null,annotationCanvasMap=null,pageColors=null,printAnnotationStorage=null,isEditing=!1}){this._stats?.time("Overall");const intentArgs=this._transport.getRenderingIntent(intent,annotationMode,printAnnotationStorage,isEditing),{renderingIntent,cacheKey}=intentArgs;this.#pendingCleanup=!1,this.#abortDelayedCleanup(),optionalContentConfigPromise||=this._transport.getOptionalContentConfig(renderingIntent);let intentState=this._intentStates.get(cacheKey);intentState||(intentState=Object.create(null),this._intentStates.set(cacheKey,intentState)),intentState.streamReaderCancelTimeout&&(clearTimeout(intentState.streamReaderCancelTimeout),intentState.streamReaderCancelTimeout=null);const intentPrint=!!(renderingIntent&RenderingIntentFlag_PRINT);intentState.displayReadyCapability||(intentState.displayReadyCapability=Promise.withResolvers(),intentState.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(intentArgs));const complete=error=>{intentState.renderTasks.delete(internalRenderTask),(this._maybeCleanupAfterRender||intentPrint)&&(this.#pendingCleanup=!0),this.#tryCleanup(!intentPrint),error?(internalRenderTask.capability.reject(error),this._abortOperatorList({intentState,reason:error instanceof Error?error:new Error(error)})):internalRenderTask.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},internalRenderTask=new InternalRenderTask({callback:complete,params:{canvasContext,viewport,transform,background},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap,operatorList:intentState.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!intentPrint,pdfBug:this._pdfBug,pageColors});(intentState.renderTasks||=new Set).add(internalRenderTask);const renderTask=internalRenderTask.task;return Promise.all([intentState.displayReadyCapability.promise,optionalContentConfigPromise]).then((([transparency,optionalContentConfig])=>{if(this.destroyed)complete();else{if(this._stats?.time("Rendering"),!(optionalContentConfig.renderingIntent&renderingIntent))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");internalRenderTask.initializeGraphics({transparency,optionalContentConfig}),internalRenderTask.operatorListChanged()}})).catch(complete),renderTask}getOperatorList({intent="display",annotationMode=AnnotationMode.ENABLE,printAnnotationStorage=null,isEditing=!1}={}){const intentArgs=this._transport.getRenderingIntent(intent,annotationMode,printAnnotationStorage,isEditing,!0);let opListTask,intentState=this._intentStates.get(intentArgs.cacheKey);return intentState||(intentState=Object.create(null),this._intentStates.set(intentArgs.cacheKey,intentState)),intentState.opListReadCapability||(opListTask=Object.create(null),opListTask.operatorListChanged=function operatorListChanged(){intentState.operatorList.lastChunk&&(intentState.opListReadCapability.resolve(intentState.operatorList),intentState.renderTasks.delete(opListTask))},intentState.opListReadCapability=Promise.withResolvers(),(intentState.renderTasks||=new Set).add(opListTask),intentState.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(intentArgs)),intentState.opListReadCapability.promise}streamTextContent({includeMarkedContent=!1,disableNormalization=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===includeMarkedContent,disableNormalization:!0===disableNormalization},{highWaterMark:100,size:textContent=>textContent.items.length})}getTextContent(params={}){if(this._transport._htmlForXfa)return this.getXfa().then((xfa=>XfaText.textContent(xfa)));const readableStream=this.streamTextContent(params);return new Promise((function(resolve,reject){const reader=readableStream.getReader(),textContent={items:[],styles:Object.create(null),lang:null};!function pump(){reader.read().then((function({value,done}){done?resolve(textContent):(textContent.lang??=value.lang,Object.assign(textContent.styles,value.styles),textContent.items.push(...value.items),pump())}),reject)}()}))}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const waitOn=[];for(const intentState of this._intentStates.values())if(this._abortOperatorList({intentState,reason:new Error("Page was destroyed."),force:!0}),!intentState.opListReadCapability)for(const internalRenderTask of intentState.renderTasks)waitOn.push(internalRenderTask.completed),internalRenderTask.cancel();return this.objs.clear(),this.#pendingCleanup=!1,this.#abortDelayedCleanup(),Promise.all(waitOn)}cleanup(resetStats=!1){this.#pendingCleanup=!0;const success=this.#tryCleanup(!1);return resetStats&&success&&(this._stats&&=new StatTimer),success}#tryCleanup(delayed=!1){if(this.#abortDelayedCleanup(),!this.#pendingCleanup||this.destroyed)return!1;if(delayed)return this.#delayedCleanupTimeout=setTimeout((()=>{this.#delayedCleanupTimeout=null,this.#tryCleanup(!1)}),5e3),!1;for(const{renderTasks,operatorList}of this._intentStates.values())if(renderTasks.size>0||!operatorList.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#pendingCleanup=!1,!0}#abortDelayedCleanup(){this.#delayedCleanupTimeout&&(clearTimeout(this.#delayedCleanupTimeout),this.#delayedCleanupTimeout=null)}_startRenderPage(transparency,cacheKey){const intentState=this._intentStates.get(cacheKey);intentState&&(this._stats?.timeEnd("Page Request"),intentState.displayReadyCapability?.resolve(transparency))}_renderPageChunk(operatorListChunk,intentState){for(let i=0,ii=operatorListChunk.length;i<ii;i++)intentState.operatorList.fnArray.push(operatorListChunk.fnArray[i]),intentState.operatorList.argsArray.push(operatorListChunk.argsArray[i]);intentState.operatorList.lastChunk=operatorListChunk.lastChunk,intentState.operatorList.separateAnnots=operatorListChunk.separateAnnots;for(const internalRenderTask of intentState.renderTasks)internalRenderTask.operatorListChanged();operatorListChunk.lastChunk&&this.#tryCleanup(!0)}_pumpOperatorList({renderingIntent,cacheKey,annotationStorageSerializable,modifiedIds}){const{map,transfer}=annotationStorageSerializable,reader=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:renderingIntent,cacheKey,annotationStorage:map,modifiedIds},transfer).getReader(),intentState=this._intentStates.get(cacheKey);intentState.streamReader=reader;const pump=()=>{reader.read().then((({value,done})=>{done?intentState.streamReader=null:this._transport.destroyed||(this._renderPageChunk(value,intentState),pump())}),(reason=>{if(intentState.streamReader=null,!this._transport.destroyed){if(intentState.operatorList){intentState.operatorList.lastChunk=!0;for(const internalRenderTask of intentState.renderTasks)internalRenderTask.operatorListChanged();this.#tryCleanup(!0)}if(intentState.displayReadyCapability)intentState.displayReadyCapability.reject(reason);else{if(!intentState.opListReadCapability)throw reason;intentState.opListReadCapability.reject(reason)}}}))};pump()}_abortOperatorList({intentState,reason,force=!1}){if(intentState.streamReader){if(intentState.streamReaderCancelTimeout&&(clearTimeout(intentState.streamReaderCancelTimeout),intentState.streamReaderCancelTimeout=null),!force){if(intentState.renderTasks.size>0)return;if(reason instanceof RenderingCancelledException){let delay=100;return reason.extraDelay>0&&reason.extraDelay<1e3&&(delay+=reason.extraDelay),void(intentState.streamReaderCancelTimeout=setTimeout((()=>{intentState.streamReaderCancelTimeout=null,this._abortOperatorList({intentState,reason,force:!0})}),delay))}}if(intentState.streamReader.cancel(new AbortException(reason.message)).catch((()=>{})),intentState.streamReader=null,!this._transport.destroyed){for(const[curCacheKey,curIntentState]of this._intentStates)if(curIntentState===intentState){this._intentStates.delete(curCacheKey);break}this.cleanup()}}}get stats(){return this._stats}}class LoopbackPort{#listeners=new Map;#deferred=Promise.resolve();postMessage(obj,transfer){const event={data:structuredClone(obj,transfer?{transfer}:null)};this.#deferred.then((()=>{for(const[listener]of this.#listeners)listener.call(this,event)}))}addEventListener(name,listener,options=null){let rmAbort=null;if(options?.signal instanceof AbortSignal){const{signal}=options;if(signal.aborted)return void warn("LoopbackPort - cannot use an `aborted` signal.");const onAbort=()=>this.removeEventListener(name,listener);rmAbort=()=>signal.removeEventListener("abort",onAbort),signal.addEventListener("abort",onAbort)}this.#listeners.set(listener,rmAbort)}removeEventListener(name,listener){const rmAbort=this.#listeners.get(listener);rmAbort?.(),this.#listeners.delete(listener)}terminate(){for(const[,rmAbort]of this.#listeners)rmAbort?.();this.#listeners.clear()}}class PDFWorker{static#fakeWorkerId=0;static#isWorkerDisabled=!1;static#workerPorts;static#_=(()=>{isNodeJS&&(this.#isWorkerDisabled=!0,GlobalWorkerOptions.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(baseUrl,otherUrl)=>{let base;try{if(base=new URL(baseUrl),!base.origin||"null"===base.origin)return!1}catch{return!1}const other=new URL(otherUrl,base);return base.origin===other.origin},this._createCDNWrapper=url=>{const wrapper=`await import("${url}");`;return URL.createObjectURL(new Blob([wrapper],{type:"text/javascript"}))}})();constructor({name=null,port=null,verbosity=getVerbosityLevel()}={}){if(this.name=name,this.destroyed=!1,this.verbosity=verbosity,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,port){if(PDFWorker.#workerPorts?.has(port))throw new Error("Cannot use more than one PDFWorker per port.");return(PDFWorker.#workerPorts||=new WeakMap).set(port,this),void this._initializeFromPort(port)}this._initialize()}get promise(){return isNodeJS?Promise.all([NodePackages.promise,this._readyCapability.promise]):this._readyCapability.promise}#resolve(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(port){this._port=port,this._messageHandler=new MessageHandler("main","worker",port),this._messageHandler.on("ready",(function(){})),this.#resolve()}_initialize(){if(PDFWorker.#isWorkerDisabled||PDFWorker.#mainThreadWorkerMessageHandler)return void this._setupFakeWorker();let{workerSrc}=PDFWorker;try{PDFWorker._isSameOrigin(window.location.href,workerSrc)||(workerSrc=PDFWorker._createCDNWrapper(new URL(workerSrc,window.location).href));const worker=new Worker(workerSrc,{type:"module"}),messageHandler=new MessageHandler("main","worker",worker),terminateEarly=()=>{ac.abort(),messageHandler.destroy(),worker.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},ac=new AbortController;worker.addEventListener("error",(()=>{this._webWorker||terminateEarly()}),{signal:ac.signal}),messageHandler.on("test",(data=>{ac.abort(),!this.destroyed&&data?(this._messageHandler=messageHandler,this._port=worker,this._webWorker=worker,this.#resolve()):terminateEarly()})),messageHandler.on("ready",(data=>{if(ac.abort(),this.destroyed)terminateEarly();else try{sendTest()}catch{this._setupFakeWorker()}}));const sendTest=()=>{const testObj=new Uint8Array;messageHandler.send("test",testObj,[testObj.buffer])};return void sendTest()}catch{info("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){PDFWorker.#isWorkerDisabled||(warn("Setting up fake worker."),PDFWorker.#isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then((WorkerMessageHandler=>{if(this.destroyed)return void this._readyCapability.reject(new Error("Worker was destroyed"));const port=new LoopbackPort;this._port=port;const id="fake"+PDFWorker.#fakeWorkerId++,workerHandler=new MessageHandler(id+"_worker",id,port);WorkerMessageHandler.setup(workerHandler,port),this._messageHandler=new MessageHandler(id,id+"_worker",port),this.#resolve()})).catch((reason=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${reason.message}".`))}))}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),PDFWorker.#workerPorts?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(params){if(!params?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const cachedPort=this.#workerPorts?.get(params.port);if(cachedPort){if(cachedPort._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return cachedPort}return new PDFWorker(params)}static get workerSrc(){if(GlobalWorkerOptions.workerSrc)return GlobalWorkerOptions.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){var _this33=this;const loader=function(){var _ref3=(0,asyncToGenerator.A)((function*(){if(_this33.#mainThreadWorkerMessageHandler)return _this33.#mainThreadWorkerMessageHandler;return(yield import(_this33.workerSrc)).WorkerMessageHandler}));return function loader(){return _ref3.apply(this,arguments)}}();return shadow(this,"_setupFakeWorkerGlobal",loader())}}class WorkerTransport{#methodPromises=new Map;#pageCache=new Map;#pagePromises=new Map;#pageRefCache=new Map;#passwordCapability=null;constructor(messageHandler,loadingTask,networkStream,params,factory){this.messageHandler=messageHandler,this.loadingTask=loadingTask,this.commonObjs=new PDFObjects,this.fontLoader=new FontLoader({ownerDocument:params.ownerDocument,styleElement:params.styleElement}),this.loadingParams=params.loadingParams,this._params=params,this.canvasFactory=factory.canvasFactory,this.filterFactory=factory.filterFactory,this.cMapReaderFactory=factory.cMapReaderFactory,this.standardFontDataFactory=factory.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=networkStream,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#cacheSimpleMethod(name,data=null){const cachedPromise=this.#methodPromises.get(name);if(cachedPromise)return cachedPromise;const promise=this.messageHandler.sendWithPromise(name,data);return this.#methodPromises.set(name,promise),promise}get annotationStorage(){return shadow(this,"annotationStorage",new AnnotationStorage)}getRenderingIntent(intent,annotationMode=AnnotationMode.ENABLE,printAnnotationStorage=null,isEditing=!1,isOpList=!1){let renderingIntent=RenderingIntentFlag_DISPLAY,annotationStorageSerializable=SerializableEmpty;switch(intent){case"any":renderingIntent=RenderingIntentFlag_ANY;break;case"display":break;case"print":renderingIntent=RenderingIntentFlag_PRINT;break;default:warn(`getRenderingIntent - invalid intent: ${intent}`)}const annotationStorage=renderingIntent&RenderingIntentFlag_PRINT&&printAnnotationStorage instanceof PrintAnnotationStorage?printAnnotationStorage:this.annotationStorage;switch(annotationMode){case AnnotationMode.DISABLE:renderingIntent+=RenderingIntentFlag_ANNOTATIONS_DISABLE;break;case AnnotationMode.ENABLE:break;case AnnotationMode.ENABLE_FORMS:renderingIntent+=RenderingIntentFlag_ANNOTATIONS_FORMS;break;case AnnotationMode.ENABLE_STORAGE:renderingIntent+=RenderingIntentFlag_ANNOTATIONS_STORAGE,annotationStorageSerializable=annotationStorage.serializable;break;default:warn(`getRenderingIntent - invalid annotationMode: ${annotationMode}`)}isEditing&&(renderingIntent+=RenderingIntentFlag_IS_EDITING),isOpList&&(renderingIntent+=RenderingIntentFlag_OPLIST);const{ids:modifiedIds,hash:modifiedIdsHash}=annotationStorage.modifiedIds;return{renderingIntent,cacheKey:[renderingIntent,annotationStorageSerializable.hash,modifiedIdsHash].join("_"),annotationStorageSerializable,modifiedIds}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#passwordCapability?.reject(new Error("Worker was destroyed during onPassword callback"));const waitOn=[];for(const page of this.#pageCache.values())waitOn.push(page._destroy());this.#pageCache.clear(),this.#pagePromises.clear(),this.#pageRefCache.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const terminated=this.messageHandler.sendWithPromise("Terminate",null);return waitOn.push(terminated),Promise.all(waitOn).then((()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#methodPromises.clear(),this.filterFactory.destroy(),TextLayer.cleanup(),this._networkStream?.cancelAllRequests(new AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()}),this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){var _this34=this;const{messageHandler,loadingTask}=this;messageHandler.on("GetReader",((data,sink)=>{assert(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=evt=>{this._lastProgress={loaded:evt.loaded,total:evt.total}},sink.onPull=()=>{this._fullReader.read().then((function({value,done}){done?sink.close():(assert(value instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),sink.enqueue(new Uint8Array(value),1,[value]))})).catch((reason=>{sink.error(reason)}))},sink.onCancel=reason=>{this._fullReader.cancel(reason),sink.ready.catch((readyReason=>{if(!this.destroyed)throw readyReason}))}})),messageHandler.on("ReaderHeadersReady",function(){var _ref4=(0,asyncToGenerator.A)((function*(data){yield _this34._fullReader.headersReady;const{isStreamingSupported,isRangeSupported,contentLength}=_this34._fullReader;return isStreamingSupported&&isRangeSupported||(_this34._lastProgress&&loadingTask.onProgress?.(_this34._lastProgress),_this34._fullReader.onProgress=evt=>{loadingTask.onProgress?.({loaded:evt.loaded,total:evt.total})}),{isStreamingSupported,isRangeSupported,contentLength}}));return function(_x3){return _ref4.apply(this,arguments)}}()),messageHandler.on("GetRangeReader",((data,sink)=>{assert(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const rangeReader=this._networkStream.getRangeReader(data.begin,data.end);rangeReader?(sink.onPull=()=>{rangeReader.read().then((function({value,done}){done?sink.close():(assert(value instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),sink.enqueue(new Uint8Array(value),1,[value]))})).catch((reason=>{sink.error(reason)}))},sink.onCancel=reason=>{rangeReader.cancel(reason),sink.ready.catch((readyReason=>{if(!this.destroyed)throw readyReason}))}):sink.close()})),messageHandler.on("GetDoc",(({pdfInfo})=>{this._numPages=pdfInfo.numPages,this._htmlForXfa=pdfInfo.htmlForXfa,delete pdfInfo.htmlForXfa,loadingTask._capability.resolve(new PDFDocumentProxy(pdfInfo,this))})),messageHandler.on("DocException",(function(ex){let reason;switch(ex.name){case"PasswordException":reason=new PasswordException(ex.message,ex.code);break;case"InvalidPDFException":reason=new InvalidPDFException(ex.message);break;case"MissingPDFException":reason=new MissingPDFException(ex.message);break;case"UnexpectedResponseException":reason=new UnexpectedResponseException(ex.message,ex.status);break;case"UnknownErrorException":reason=new UnknownErrorException(ex.message,ex.details);break;default:unreachable("DocException - expected a valid Error.")}loadingTask._capability.reject(reason)})),messageHandler.on("PasswordRequest",(exception=>{if(this.#passwordCapability=Promise.withResolvers(),loadingTask.onPassword){const updatePassword=password=>{password instanceof Error?this.#passwordCapability.reject(password):this.#passwordCapability.resolve({password})};try{loadingTask.onPassword(updatePassword,exception.code)}catch(ex){this.#passwordCapability.reject(ex)}}else this.#passwordCapability.reject(new PasswordException(exception.message,exception.code));return this.#passwordCapability.promise})),messageHandler.on("DataLoaded",(data=>{loadingTask.onProgress?.({loaded:data.length,total:data.length}),this.downloadInfoCapability.resolve(data)})),messageHandler.on("StartRenderPage",(data=>{if(this.destroyed)return;this.#pageCache.get(data.pageIndex)._startRenderPage(data.transparency,data.cacheKey)})),messageHandler.on("commonobj",(([id,type,exportedData])=>{if(this.destroyed)return null;if(this.commonObjs.has(id))return null;switch(type){case"Font":const{disableFontFace,fontExtraProperties,pdfBug}=this._params;if("error"in exportedData){const exportedError=exportedData.error;warn(`Error during font loading: ${exportedError}`),this.commonObjs.resolve(id,exportedError);break}const inspectFont=pdfBug&&globalThis.FontInspector?.enabled?(font,url)=>globalThis.FontInspector.fontAdded(font,url):null,font=new FontFaceObject(exportedData,{disableFontFace,inspectFont});this.fontLoader.bind(font).catch((()=>messageHandler.sendWithPromise("FontFallback",{id}))).finally((()=>{!fontExtraProperties&&font.data&&(font.data=null),this.commonObjs.resolve(id,font)}));break;case"CopyLocalImage":const{imageRef}=exportedData;assert(imageRef,"The imageRef must be defined.");for(const pageProxy of this.#pageCache.values())for(const[,data]of pageProxy.objs)if(data?.ref===imageRef)return data.dataLen?(this.commonObjs.resolve(id,structuredClone(data)),data.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(id,exportedData);break;default:throw new Error(`Got unknown common object type ${type}`)}return null})),messageHandler.on("obj",(([id,pageIndex,type,imageData])=>{if(this.destroyed)return;const pageProxy=this.#pageCache.get(pageIndex);if(!pageProxy.objs.has(id))if(0!==pageProxy._intentStates.size)switch(type){case"Image":pageProxy.objs.resolve(id,imageData),imageData?.dataLen>1e7&&(pageProxy._maybeCleanupAfterRender=!0);break;case"Pattern":pageProxy.objs.resolve(id,imageData);break;default:throw new Error(`Got unknown object type ${type}`)}else imageData?.bitmap?.close()})),messageHandler.on("DocProgress",(data=>{this.destroyed||loadingTask.onProgress?.({loaded:data.loaded,total:data.total})})),messageHandler.on("FetchBuiltInCMap",function(){var _ref5=(0,asyncToGenerator.A)((function*(data){if(_this34.destroyed)throw new Error("Worker was destroyed.");if(!_this34.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return _this34.cMapReaderFactory.fetch(data)}));return function(_x4){return _ref5.apply(this,arguments)}}()),messageHandler.on("FetchStandardFontData",function(){var _ref6=(0,asyncToGenerator.A)((function*(data){if(_this34.destroyed)throw new Error("Worker was destroyed.");if(!_this34.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return _this34.standardFontDataFactory.fetch(data)}));return function(_x5){return _ref6.apply(this,arguments)}}())}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&warn("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map,transfer}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:map,filename:this._fullReader?.filename??null},transfer).finally((()=>{this.annotationStorage.resetModified()}))}getPage(pageNumber){if(!Number.isInteger(pageNumber)||pageNumber<=0||pageNumber>this._numPages)return Promise.reject(new Error("Invalid page request."));const pageIndex=pageNumber-1,cachedPromise=this.#pagePromises.get(pageIndex);if(cachedPromise)return cachedPromise;const promise=this.messageHandler.sendWithPromise("GetPage",{pageIndex}).then((pageInfo=>{if(this.destroyed)throw new Error("Transport destroyed");pageInfo.refStr&&this.#pageRefCache.set(pageInfo.refStr,pageNumber);const page=new PDFPageProxy(pageIndex,pageInfo,this,this._params.pdfBug);return this.#pageCache.set(pageIndex,page),page}));return this.#pagePromises.set(pageIndex,promise),promise}getPageIndex(ref){return isRefProxy(ref)?this.messageHandler.sendWithPromise("GetPageIndex",{num:ref.num,gen:ref.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(pageIndex,intent){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex,intent})}getFieldObjects(){return this.#cacheSimpleMethod("GetFieldObjects")}hasJSActions(){return this.#cacheSimpleMethod("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(id){return"string"!=typeof id?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#cacheSimpleMethod("GetDocJSActions")}getPageJSActions(pageIndex){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex})}getStructTree(pageIndex){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(renderingIntent){return this.#cacheSimpleMethod("GetOptionalContentConfig").then((data=>new OptionalContentConfig(data,renderingIntent)))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const name="GetMetadata",cachedPromise=this.#methodPromises.get(name);if(cachedPromise)return cachedPromise;const promise=this.messageHandler.sendWithPromise(name,null).then((results=>({info:results[0],metadata:results[1]?new Metadata(results[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null})));return this.#methodPromises.set(name,promise),promise}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}startCleanup(keepLoadedFonts=!1){var _this35=this;return(0,asyncToGenerator.A)((function*(){if(!_this35.destroyed){yield _this35.messageHandler.sendWithPromise("Cleanup",null);for(const page of _this35.#pageCache.values()){if(!page.cleanup())throw new Error(`startCleanup: Page ${page.pageNumber} is currently rendering.`)}_this35.commonObjs.clear(),keepLoadedFonts||_this35.fontLoader.clear(),_this35.#methodPromises.clear(),_this35.filterFactory.destroy(!0),TextLayer.cleanup()}}))()}cachedPageNumber(ref){if(!isRefProxy(ref))return null;const refStr=0===ref.gen?`${ref.num}R`:`${ref.num}R${ref.gen}`;return this.#pageRefCache.get(refStr)??null}}const INITIAL_DATA=Symbol("INITIAL_DATA");class PDFObjects{#objs=Object.create(null);#ensureObj(objId){return this.#objs[objId]||={...Promise.withResolvers(),data:INITIAL_DATA}}get(objId,callback=null){if(callback){const obj=this.#ensureObj(objId);return obj.promise.then((()=>callback(obj.data))),null}const obj=this.#objs[objId];if(!obj||obj.data===INITIAL_DATA)throw new Error(`Requesting object that isn't resolved yet ${objId}.`);return obj.data}has(objId){const obj=this.#objs[objId];return!!obj&&obj.data!==INITIAL_DATA}resolve(objId,data=null){const obj=this.#ensureObj(objId);obj.data=data,obj.resolve()}clear(){for(const objId in this.#objs){const{data}=this.#objs[objId];data?.bitmap?.close()}this.#objs=Object.create(null)}*[Symbol.iterator](){for(const objId in this.#objs){const{data}=this.#objs[objId];data!==INITIAL_DATA&&(yield[objId,data])}}}class RenderTask{#internalRenderTask=null;constructor(internalRenderTask){this.#internalRenderTask=internalRenderTask,this.onContinue=null}get promise(){return this.#internalRenderTask.capability.promise}cancel(extraDelay=0){this.#internalRenderTask.cancel(null,extraDelay)}get separateAnnots(){const{separateAnnots}=this.#internalRenderTask.operatorList;if(!separateAnnots)return!1;const{annotationCanvasMap}=this.#internalRenderTask;return separateAnnots.form||separateAnnots.canvas&&annotationCanvasMap?.size>0}}class InternalRenderTask{#rAF=null;static#canvasInUse=new WeakSet;constructor({callback,params,objs,commonObjs,annotationCanvasMap,operatorList,pageIndex,canvasFactory,filterFactory,useRequestAnimationFrame=!1,pdfBug=!1,pageColors=null}){this.callback=callback,this.params=params,this.objs=objs,this.commonObjs=commonObjs,this.annotationCanvasMap=annotationCanvasMap,this.operatorListIdx=null,this.operatorList=operatorList,this._pageIndex=pageIndex,this.canvasFactory=canvasFactory,this.filterFactory=filterFactory,this._pdfBug=pdfBug,this.pageColors=pageColors,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===useRequestAnimationFrame&&"undefined"!=typeof window,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=params.canvasContext.canvas}get completed(){return this.capability.promise.catch((function(){}))}initializeGraphics({transparency=!1,optionalContentConfig}){if(this.cancelled)return;if(this._canvas){if(InternalRenderTask.#canvasInUse.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");InternalRenderTask.#canvasInUse.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext,viewport,transform,background}=this.params;this.gfx=new CanvasGraphics(canvasContext,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform,viewport,transparency,background}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(error=null,extraDelay=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#rAF&&(window.cancelAnimationFrame(this.#rAF),this.#rAF=null),InternalRenderTask.#canvasInUse.delete(this._canvas),this.callback(error||new RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,extraDelay))}operatorListChanged(){this.graphicsReady?(this.stepper?.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||=this._continueBound}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#rAF=window.requestAnimationFrame((()=>{this.#rAF=null,this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}_next(){var _this36=this;return(0,asyncToGenerator.A)((function*(){_this36.cancelled||(_this36.operatorListIdx=_this36.gfx.executeOperatorList(_this36.operatorList,_this36.operatorListIdx,_this36._continueBound,_this36.stepper),_this36.operatorListIdx===_this36.operatorList.argsArray.length&&(_this36.running=!1,_this36.operatorList.lastChunk&&(_this36.gfx.endDrawing(),InternalRenderTask.#canvasInUse.delete(_this36._canvas),_this36.callback())))}))()}}const version="4.8.69",build="3634dab10";function makeColorComp(n){return Math.floor(255*Math.max(0,Math.min(1,n))).toString(16).padStart(2,"0")}function scaleAndClamp(x){return Math.max(0,Math.min(255,255*x))}class ColorConverters{static CMYK_G([c,y,m,k]){return["G",1-Math.min(1,.3*c+.59*m+.11*y+k)]}static G_CMYK([g]){return["CMYK",0,0,0,1-g]}static G_RGB([g]){return["RGB",g,g,g]}static G_rgb([g]){return[g=scaleAndClamp(g),g,g]}static G_HTML([g]){const G=makeColorComp(g);return`#${G}${G}${G}`}static RGB_G([r,g,b]){return["G",.3*r+.59*g+.11*b]}static RGB_rgb(color){return color.map(scaleAndClamp)}static RGB_HTML(color){return`#${color.map(makeColorComp).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([c,y,m,k]){return["RGB",1-Math.min(1,c+k),1-Math.min(1,m+k),1-Math.min(1,y+k)]}static CMYK_rgb([c,y,m,k]){return[scaleAndClamp(1-Math.min(1,c+k)),scaleAndClamp(1-Math.min(1,m+k)),scaleAndClamp(1-Math.min(1,y+k))]}static CMYK_HTML(components){const rgb=this.CMYK_RGB(components).slice(1);return this.RGB_HTML(rgb)}static RGB_CMYK([r,g,b]){const c=1-r,m=1-g,y=1-b;return["CMYK",c,m,y,Math.min(c,m,y)]}}class BaseSVGFactory{create(width,height,skipDimensions=!1){if(width<=0||height<=0)throw new Error("Invalid SVG dimensions");const svg=this._createSVG("svg:svg");return svg.setAttribute("version","1.1"),skipDimensions||(svg.setAttribute("width",`${width}px`),svg.setAttribute("height",`${height}px`)),svg.setAttribute("preserveAspectRatio","none"),svg.setAttribute("viewBox",`0 0 ${width} ${height}`),svg}createElement(type){if("string"!=typeof type)throw new Error("Invalid SVG element type");return this._createSVG(type)}_createSVG(type){unreachable("Abstract method `_createSVG` called.")}}class DOMSVGFactory extends BaseSVGFactory{_createSVG(type){return document.createElementNS(SVG_NS,type)}}class XfaLayer{static setupStorage(html,id,element,storage,intent){const storedData=storage.getValue(id,{value:null});switch(element.name){case"textarea":if(null!==storedData.value&&(html.textContent=storedData.value),"print"===intent)break;html.addEventListener("input",(event=>{storage.setValue(id,{value:event.target.value})}));break;case"input":if("radio"===element.attributes.type||"checkbox"===element.attributes.type){if(storedData.value===element.attributes.xfaOn?html.setAttribute("checked",!0):storedData.value===element.attributes.xfaOff&&html.removeAttribute("checked"),"print"===intent)break;html.addEventListener("change",(event=>{storage.setValue(id,{value:event.target.checked?event.target.getAttribute("xfaOn"):event.target.getAttribute("xfaOff")})}))}else{if(null!==storedData.value&&html.setAttribute("value",storedData.value),"print"===intent)break;html.addEventListener("input",(event=>{storage.setValue(id,{value:event.target.value})}))}break;case"select":if(null!==storedData.value){html.setAttribute("value",storedData.value);for(const option of element.children)option.attributes.value===storedData.value?option.attributes.selected=!0:option.attributes.hasOwnProperty("selected")&&delete option.attributes.selected}html.addEventListener("input",(event=>{const options=event.target.options,value=-1===options.selectedIndex?"":options[options.selectedIndex].value;storage.setValue(id,{value})}))}}static setAttributes({html,element,storage=null,intent,linkService}){const{attributes}=element,isHTMLAnchorElement=html instanceof HTMLAnchorElement;"radio"===attributes.type&&(attributes.name=`${attributes.name}-${intent}`);for(const[key,value]of Object.entries(attributes))if(null!=value)switch(key){case"class":value.length&&html.setAttribute(key,value.join(" "));break;case"dataId":break;case"id":html.setAttribute("data-element-id",value);break;case"style":Object.assign(html.style,value);break;case"textContent":html.textContent=value;break;default:(!isHTMLAnchorElement||"href"!==key&&"newWindow"!==key)&&html.setAttribute(key,value)}isHTMLAnchorElement&&linkService.addLinkAttributes(html,attributes.href,attributes.newWindow),storage&&attributes.dataId&&this.setupStorage(html,attributes.dataId,element,storage)}static render(parameters){const storage=parameters.annotationStorage,linkService=parameters.linkService,root=parameters.xfaHtml,intent=parameters.intent||"display",rootHtml=document.createElement(root.name);root.attributes&&this.setAttributes({html:rootHtml,element:root,intent,linkService});const isNotForRichText="richText"!==intent,rootDiv=parameters.div;if(rootDiv.append(rootHtml),parameters.viewport){const transform=`matrix(${parameters.viewport.transform.join(",")})`;rootDiv.style.transform=transform}isNotForRichText&&rootDiv.setAttribute("class","xfaLayer xfaFont");const textDivs=[];if(0===root.children.length){if(root.value){const node=document.createTextNode(root.value);rootHtml.append(node),isNotForRichText&&XfaText.shouldBuildText(root.name)&&textDivs.push(node)}return{textDivs}}const stack=[[root,-1,rootHtml]];for(;stack.length>0;){const[parent,i,html]=stack.at(-1);if(i+1===parent.children.length){stack.pop();continue}const child=parent.children[++stack.at(-1)[1]];if(null===child)continue;const{name}=child;if("#text"===name){const node=document.createTextNode(child.value);textDivs.push(node),html.append(node);continue}const childHtml=child?.attributes?.xmlns?document.createElementNS(child.attributes.xmlns,name):document.createElement(name);if(html.append(childHtml),child.attributes&&this.setAttributes({html:childHtml,element:child,storage,intent,linkService}),child.children?.length>0)stack.push([child,-1,childHtml]);else if(child.value){const node=document.createTextNode(child.value);isNotForRichText&&XfaText.shouldBuildText(name)&&textDivs.push(node),childHtml.append(node)}}for(const el of rootDiv.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))el.setAttribute("readOnly",!0);return{textDivs}}static update(parameters){const transform=`matrix(${parameters.viewport.transform.join(",")})`;parameters.div.style.transform=transform,parameters.div.hidden=!1}}const GetElementsByNameSet=new WeakSet;function getRectDims(rect){return{width:rect[2]-rect[0],height:rect[3]-rect[1]}}class AnnotationElementFactory{static create(parameters){switch(parameters.data.annotationType){case AnnotationType_LINK:return new LinkAnnotationElement(parameters);case AnnotationType_TEXT:return new TextAnnotationElement(parameters);case AnnotationType_WIDGET:switch(parameters.data.fieldType){case"Tx":return new TextWidgetAnnotationElement(parameters);case"Btn":return parameters.data.radioButton?new RadioButtonWidgetAnnotationElement(parameters):parameters.data.checkBox?new CheckboxWidgetAnnotationElement(parameters):new PushButtonWidgetAnnotationElement(parameters);case"Ch":return new ChoiceWidgetAnnotationElement(parameters);case"Sig":return new SignatureWidgetAnnotationElement(parameters)}return new WidgetAnnotationElement(parameters);case AnnotationType_POPUP:return new PopupAnnotationElement(parameters);case AnnotationType_FREETEXT:return new FreeTextAnnotationElement(parameters);case AnnotationType_LINE:return new LineAnnotationElement(parameters);case AnnotationType_SQUARE:return new SquareAnnotationElement(parameters);case AnnotationType_CIRCLE:return new CircleAnnotationElement(parameters);case AnnotationType_POLYLINE:return new PolylineAnnotationElement(parameters);case AnnotationType_CARET:return new CaretAnnotationElement(parameters);case AnnotationType_INK:return new InkAnnotationElement(parameters);case AnnotationType_POLYGON:return new PolygonAnnotationElement(parameters);case AnnotationType_HIGHLIGHT:return new HighlightAnnotationElement(parameters);case AnnotationType_UNDERLINE:return new UnderlineAnnotationElement(parameters);case AnnotationType_SQUIGGLY:return new SquigglyAnnotationElement(parameters);case AnnotationType_STRIKEOUT:return new StrikeOutAnnotationElement(parameters);case AnnotationType_STAMP:return new StampAnnotationElement(parameters);case AnnotationType_FILEATTACHMENT:return new FileAttachmentAnnotationElement(parameters);default:return new AnnotationElement(parameters)}}}class AnnotationElement{#updates=null;#hasBorder=!1;#popupElement=null;constructor(parameters,{isRenderable=!1,ignoreBorder=!1,createQuadrilaterals=!1}={}){this.isRenderable=isRenderable,this.data=parameters.data,this.layer=parameters.layer,this.linkService=parameters.linkService,this.downloadManager=parameters.downloadManager,this.imageResourcesPath=parameters.imageResourcesPath,this.renderForms=parameters.renderForms,this.svgFactory=parameters.svgFactory,this.annotationStorage=parameters.annotationStorage,this.enableScripting=parameters.enableScripting,this.hasJSActions=parameters.hasJSActions,this._fieldObjects=parameters.fieldObjects,this.parent=parameters.parent,isRenderable&&(this.container=this._createContainer(ignoreBorder)),createQuadrilaterals&&this._createQuadrilaterals()}static _hasPopupData({titleObj,contentsObj,richText}){return!!(titleObj?.str||contentsObj?.str||richText?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return AnnotationElement._hasPopupData(this.data)}updateEdited(params){if(!this.container)return;this.#updates||={rect:this.data.rect.slice(0)};const{rect}=params;rect&&this.#setRectEdited(rect),this.#popupElement?.popup.updateEdited(params)}resetEdited(){this.#updates&&(this.#setRectEdited(this.#updates.rect),this.#popupElement?.popup.resetEdited(),this.#updates=null)}#setRectEdited(rect){const{container:{style},data:{rect:currentRect,rotation},parent:{viewport:{rawDims:{pageWidth,pageHeight,pageX,pageY}}}}=this;currentRect?.splice(0,4,...rect);const{width,height}=getRectDims(rect);style.left=100*(rect[0]-pageX)/pageWidth+"%",style.top=100*(pageHeight-rect[3]+pageY)/pageHeight+"%",0===rotation?(style.width=100*width/pageWidth+"%",style.height=100*height/pageHeight+"%"):this.setRotation(rotation)}_createContainer(ignoreBorder){const{data,parent:{page,viewport}}=this,container=document.createElement("section");container.setAttribute("data-annotation-id",data.id),this instanceof WidgetAnnotationElement||(container.tabIndex=1e3);const{style}=container;if(style.zIndex=this.parent.zIndex++,data.alternativeText&&(container.title=data.alternativeText),data.noRotate&&container.classList.add("norotate"),!data.rect||this instanceof PopupAnnotationElement){const{rotation}=data;return data.hasOwnCanvas||0===rotation||this.setRotation(rotation,container),container}const{width,height}=getRectDims(data.rect);if(!ignoreBorder&&data.borderStyle.width>0){style.borderWidth=`${data.borderStyle.width}px`;const horizontalRadius=data.borderStyle.horizontalCornerRadius,verticalRadius=data.borderStyle.verticalCornerRadius;if(horizontalRadius>0||verticalRadius>0){const radius=`calc(${horizontalRadius}px * var(--scale-factor)) / calc(${verticalRadius}px * var(--scale-factor))`;style.borderRadius=radius}else if(this instanceof RadioButtonWidgetAnnotationElement){const radius=`calc(${width}px * var(--scale-factor)) / calc(${height}px * var(--scale-factor))`;style.borderRadius=radius}switch(data.borderStyle.style){case AnnotationBorderStyleType_SOLID:style.borderStyle="solid";break;case AnnotationBorderStyleType_DASHED:style.borderStyle="dashed";break;case AnnotationBorderStyleType_BEVELED:warn("Unimplemented border style: beveled");break;case AnnotationBorderStyleType_INSET:warn("Unimplemented border style: inset");break;case AnnotationBorderStyleType_UNDERLINE:style.borderBottomStyle="solid"}const borderColor=data.borderColor||null;borderColor?(this.#hasBorder=!0,style.borderColor=Util.makeHexColor(0|borderColor[0],0|borderColor[1],0|borderColor[2])):style.borderWidth=0}const rect=Util.normalizeRect([data.rect[0],page.view[3]-data.rect[1]+page.view[1],data.rect[2],page.view[3]-data.rect[3]+page.view[1]]),{pageWidth,pageHeight,pageX,pageY}=viewport.rawDims;style.left=100*(rect[0]-pageX)/pageWidth+"%",style.top=100*(rect[1]-pageY)/pageHeight+"%";const{rotation}=data;return data.hasOwnCanvas||0===rotation?(style.width=100*width/pageWidth+"%",style.height=100*height/pageHeight+"%"):this.setRotation(rotation,container),container}setRotation(angle,container=this.container){if(!this.data.rect)return;const{pageWidth,pageHeight}=this.parent.viewport.rawDims,{width,height}=getRectDims(this.data.rect);let elementWidth,elementHeight;angle%180==0?(elementWidth=100*width/pageWidth,elementHeight=100*height/pageHeight):(elementWidth=100*height/pageWidth,elementHeight=100*width/pageHeight),container.style.width=`${elementWidth}%`,container.style.height=`${elementHeight}%`,container.setAttribute("data-main-rotation",(360-angle)%360)}get _commonActions(){const setColor=(jsName,styleName,event)=>{const color=event.detail[jsName],colorType=color[0],colorArray=color.slice(1);event.target.style[styleName]=ColorConverters[`${colorType}_HTML`](colorArray),this.annotationStorage.setValue(this.data.id,{[styleName]:ColorConverters[`${colorType}_rgb`](colorArray)})};return shadow(this,"_commonActions",{display:event=>{const{display}=event.detail,hidden=display%2==1;this.container.style.visibility=hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:hidden,noPrint:1===display||2===display})},print:event=>{this.annotationStorage.setValue(this.data.id,{noPrint:!event.detail.print})},hidden:event=>{const{hidden}=event.detail;this.container.style.visibility=hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:hidden,noView:hidden})},focus:event=>{setTimeout((()=>event.target.focus({preventScroll:!1})),0)},userName:event=>{event.target.title=event.detail.userName},readonly:event=>{event.target.disabled=event.detail.readonly},required:event=>{this._setRequired(event.target,event.detail.required)},bgColor:event=>{setColor("bgColor","backgroundColor",event)},fillColor:event=>{setColor("fillColor","backgroundColor",event)},fgColor:event=>{setColor("fgColor","color",event)},textColor:event=>{setColor("textColor","color",event)},borderColor:event=>{setColor("borderColor","borderColor",event)},strokeColor:event=>{setColor("strokeColor","borderColor",event)},rotation:event=>{const angle=event.detail.rotation;this.setRotation(angle),this.annotationStorage.setValue(this.data.id,{rotation:angle})}})}_dispatchEventFromSandbox(actions,jsEvent){const commonActions=this._commonActions;for(const name of Object.keys(jsEvent.detail)){const action=actions[name]||commonActions[name];action?.(jsEvent)}}_setDefaultPropertiesFromJS(element){if(!this.enableScripting)return;const storedData=this.annotationStorage.getRawValue(this.data.id);if(!storedData)return;const commonActions=this._commonActions;for(const[actionName,detail]of Object.entries(storedData)){const action=commonActions[actionName];if(action){action({detail:{[actionName]:detail},target:element}),delete storedData[actionName]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints}=this.data;if(!quadPoints)return;const[rectBlX,rectBlY,rectTrX,rectTrY]=this.data.rect.map((x=>Math.fround(x)));if(8===quadPoints.length){const[trX,trY,blX,blY]=quadPoints.subarray(2,6);if(rectTrX===trX&&rectTrY===trY&&rectBlX===blX&&rectBlY===blY)return}const{style}=this.container;let svgBuffer;if(this.#hasBorder){const{borderColor,borderWidth}=style;style.borderWidth=0,svgBuffer=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${borderColor}" stroke-width="${borderWidth}">`],this.container.classList.add("hasBorder")}const width=rectTrX-rectBlX,height=rectTrY-rectBlY,{svgFactory}=this,svg=svgFactory.createElement("svg");svg.classList.add("quadrilateralsContainer"),svg.setAttribute("width",0),svg.setAttribute("height",0);const defs=svgFactory.createElement("defs");svg.append(defs);const clipPath=svgFactory.createElement("clipPath"),id=`clippath_${this.data.id}`;clipPath.setAttribute("id",id),clipPath.setAttribute("clipPathUnits","objectBoundingBox"),defs.append(clipPath);for(let i=2,ii=quadPoints.length;i<ii;i+=8){const trX=quadPoints[i],trY=quadPoints[i+1],blX=quadPoints[i+2],blY=quadPoints[i+3],rect=svgFactory.createElement("rect"),x=(blX-rectBlX)/width,y=(rectTrY-trY)/height,rectWidth=(trX-blX)/width,rectHeight=(trY-blY)/height;rect.setAttribute("x",x),rect.setAttribute("y",y),rect.setAttribute("width",rectWidth),rect.setAttribute("height",rectHeight),clipPath.append(rect),svgBuffer?.push(`<rect vector-effect="non-scaling-stroke" x="${x}" y="${y}" width="${rectWidth}" height="${rectHeight}"/>`)}this.#hasBorder&&(svgBuffer.push("</g></svg>')"),style.backgroundImage=svgBuffer.join("")),this.container.append(svg),this.container.style.clipPath=`url(#${id})`}_createPopup(){const{data}=this,popup=this.#popupElement=new PopupAnnotationElement({data:{color:data.color,titleObj:data.titleObj,modificationDate:data.modificationDate,contentsObj:data.contentsObj,richText:data.richText,parentRect:data.rect,borderStyle:0,id:`popup_${data.id}`,rotation:data.rotation},parent:this.parent,elements:[this]});this.parent.div.append(popup.render())}render(){unreachable("Abstract method `AnnotationElement.render` called")}_getElementsByName(name,skipId=null){const fields=[];if(this._fieldObjects){const fieldObj=this._fieldObjects[name];if(fieldObj)for(const{page,id,exportValues}of fieldObj){if(-1===page)continue;if(id===skipId)continue;const exportValue="string"==typeof exportValues?exportValues:null,domElement=document.querySelector(`[data-element-id="${id}"]`);!domElement||GetElementsByNameSet.has(domElement)?fields.push({id,exportValue,domElement}):warn(`_getElementsByName - element not allowed: ${id}`)}return fields}for(const domElement of document.getElementsByName(name)){const{exportValue}=domElement,id=domElement.getAttribute("data-element-id");id!==skipId&&(GetElementsByNameSet.has(domElement)&&fields.push({id,exportValue,domElement}))}return fields}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const triggers=this.getElementsToTriggerPopup();if(Array.isArray(triggers))for(const element of triggers)element.classList.add("highlightArea");else triggers.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:mode,data:{id:editId}}=this;this.container.addEventListener("dblclick",(()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode,editId})}))}}class LinkAnnotationElement extends AnnotationElement{constructor(parameters,options=null){super(parameters,{isRenderable:!0,ignoreBorder:!!options?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=parameters.data.isTooltipOnly}render(){const{data,linkService}=this,link=document.createElement("a");link.setAttribute("data-element-id",data.id);let isBound=!1;return data.url?(linkService.addLinkAttributes(link,data.url,data.newWindow),isBound=!0):data.action?(this._bindNamedAction(link,data.action),isBound=!0):data.attachment?(this.#bindAttachment(link,data.attachment,data.attachmentDest),isBound=!0):data.setOCGState?(this.#bindSetOCGState(link,data.setOCGState),isBound=!0):data.dest?(this._bindLink(link,data.dest),isBound=!0):(data.actions&&(data.actions.Action||data.actions["Mouse Up"]||data.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(link,data),isBound=!0),data.resetForm?(this._bindResetFormAction(link,data.resetForm),isBound=!0):this.isTooltipOnly&&!isBound&&(this._bindLink(link,""),isBound=!0)),this.container.classList.add("linkAnnotation"),isBound&&this.container.append(link),this.container}#setInternalLink(){this.container.setAttribute("data-internal-link","")}_bindLink(link,destination){link.href=this.linkService.getDestinationHash(destination),link.onclick=()=>(destination&&this.linkService.goToDestination(destination),!1),(destination||""===destination)&&this.#setInternalLink()}_bindNamedAction(link,action){link.href=this.linkService.getAnchorUrl(""),link.onclick=()=>(this.linkService.executeNamedAction(action),!1),this.#setInternalLink()}#bindAttachment(link,attachment,dest=null){link.href=this.linkService.getAnchorUrl(""),attachment.description&&(link.title=attachment.description),link.onclick=()=>(this.downloadManager?.openOrDownloadData(attachment.content,attachment.filename,dest),!1),this.#setInternalLink()}#bindSetOCGState(link,action){link.href=this.linkService.getAnchorUrl(""),link.onclick=()=>(this.linkService.executeSetOCGState(action),!1),this.#setInternalLink()}_bindJSAction(link,data){link.href=this.linkService.getAnchorUrl("");const map=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const name of Object.keys(data.actions)){const jsName=map.get(name);jsName&&(link[jsName]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:data.id,name}}),!1))}link.onclick||(link.onclick=()=>!1),this.#setInternalLink()}_bindResetFormAction(link,resetForm){const otherClickAction=link.onclick;if(otherClickAction||(link.href=this.linkService.getAnchorUrl("")),this.#setInternalLink(),!this._fieldObjects)return warn('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(otherClickAction||(link.onclick=()=>!1));link.onclick=()=>{otherClickAction?.();const{fields:resetFormFields,refs:resetFormRefs,include}=resetForm,allFields=[];if(0!==resetFormFields.length||0!==resetFormRefs.length){const fieldIds=new Set(resetFormRefs);for(const fieldName of resetFormFields){const fields=this._fieldObjects[fieldName]||[];for(const{id}of fields)fieldIds.add(id)}for(const fields of Object.values(this._fieldObjects))for(const field of fields)fieldIds.has(field.id)===include&&allFields.push(field)}else for(const fields of Object.values(this._fieldObjects))allFields.push(...fields);const storage=this.annotationStorage,allIds=[];for(const field of allFields){const{id}=field;switch(allIds.push(id),field.type){case"text":{const value=field.defaultValue||"";storage.setValue(id,{value});break}case"checkbox":case"radiobutton":{const value=field.defaultValue===field.exportValues;storage.setValue(id,{value});break}case"combobox":case"listbox":{const value=field.defaultValue||"";storage.setValue(id,{value});break}default:continue}const domElement=document.querySelector(`[data-element-id="${id}"]`);domElement&&(GetElementsByNameSet.has(domElement)?domElement.dispatchEvent(new Event("resetform")):warn(`_bindResetFormAction - element not allowed: ${id}`))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:allIds,name:"ResetForm"}}),!1}}}class TextAnnotationElement extends AnnotationElement{constructor(parameters){super(parameters,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const image=document.createElement("img");return image.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",image.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),image.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(image),this.container}}class WidgetAnnotationElement extends AnnotationElement{render(){return this.container}showElementAndHideCanvas(element){this.data.hasOwnCanvas&&("CANVAS"===element.previousSibling?.nodeName&&(element.previousSibling.hidden=!0),element.hidden=!1)}_getKeyModifier(event){return util_FeatureTest.platform.isMac?event.metaKey:event.ctrlKey}_setEventListener(element,elementData,baseName,eventName,valueGetter){baseName.includes("mouse")?element.addEventListener(baseName,(event=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:eventName,value:valueGetter(event),shift:event.shiftKey,modifier:this._getKeyModifier(event)}})})):element.addEventListener(baseName,(event=>{if("blur"===baseName){if(!elementData.focused||!event.relatedTarget)return;elementData.focused=!1}else if("focus"===baseName){if(elementData.focused)return;elementData.focused=!0}valueGetter&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:eventName,value:valueGetter(event)}})}))}_setEventListeners(element,elementData,names,getter){for(const[baseName,eventName]of names)("Action"===eventName||this.data.actions?.[eventName])&&("Focus"!==eventName&&"Blur"!==eventName||(elementData||={focused:!1}),this._setEventListener(element,elementData,baseName,eventName,getter),"Focus"!==eventName||this.data.actions?.Blur?"Blur"!==eventName||this.data.actions?.Focus||this._setEventListener(element,elementData,"focus","Focus",null):this._setEventListener(element,elementData,"blur","Blur",null))}_setBackgroundColor(element){const color=this.data.backgroundColor||null;element.style.backgroundColor=null===color?"transparent":Util.makeHexColor(color[0],color[1],color[2])}_setTextStyle(element){const TEXT_ALIGNMENT=["left","center","right"],{fontColor}=this.data.defaultAppearanceData,fontSize=this.data.defaultAppearanceData.fontSize||9,style=element.style;let computedFontSize;const roundToOneDecimal=x=>Math.round(10*x)/10;if(this.data.multiLine){const height=Math.abs(this.data.rect[3]-this.data.rect[1]-2),lineHeight=height/(Math.round(height/(1.35*fontSize))||1);computedFontSize=Math.min(fontSize,roundToOneDecimal(lineHeight/1.35))}else{const height=Math.abs(this.data.rect[3]-this.data.rect[1]-2);computedFontSize=Math.min(fontSize,roundToOneDecimal(height/1.35))}style.fontSize=`calc(${computedFontSize}px * var(--scale-factor))`,style.color=Util.makeHexColor(fontColor[0],fontColor[1],fontColor[2]),null!==this.data.textAlignment&&(style.textAlign=TEXT_ALIGNMENT[this.data.textAlignment])}_setRequired(element,isRequired){isRequired?element.setAttribute("required",!0):element.removeAttribute("required"),element.setAttribute("aria-required",isRequired)}}class TextWidgetAnnotationElement extends WidgetAnnotationElement{constructor(parameters){super(parameters,{isRenderable:parameters.renderForms||parameters.data.hasOwnCanvas||!parameters.data.hasAppearance&&!!parameters.data.fieldValue})}setPropertyOnSiblings(base,key,value,keyInStorage){const storage=this.annotationStorage;for(const element of this._getElementsByName(base.name,base.id))element.domElement&&(element.domElement[key]=value),storage.setValue(element.id,{[keyInStorage]:value})}render(){const storage=this.annotationStorage,id=this.data.id;this.container.classList.add("textWidgetAnnotation");let element=null;if(this.renderForms){const storedData=storage.getValue(id,{value:this.data.fieldValue});let textContent=storedData.value||"";const maxLen=storage.getValue(id,{charLimit:this.data.maxLen}).charLimit;maxLen&&textContent.length>maxLen&&(textContent=textContent.slice(0,maxLen));let fieldFormattedValues=storedData.formattedValue||this.data.textContent?.join("\n")||null;fieldFormattedValues&&this.data.comb&&(fieldFormattedValues=fieldFormattedValues.replaceAll(/\s+/g,""));const elementData={userValue:textContent,formattedValue:fieldFormattedValues,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(element=document.createElement("textarea"),element.textContent=fieldFormattedValues??textContent,this.data.doNotScroll&&(element.style.overflowY="hidden")):(element=document.createElement("input"),element.type="text",element.setAttribute("value",fieldFormattedValues??textContent),this.data.doNotScroll&&(element.style.overflowX="hidden")),this.data.hasOwnCanvas&&(element.hidden=!0),GetElementsByNameSet.add(element),element.setAttribute("data-element-id",id),element.disabled=this.data.readOnly,element.name=this.data.fieldName,element.tabIndex=1e3,this._setRequired(element,this.data.required),maxLen&&(element.maxLength=maxLen),element.addEventListener("input",(event=>{storage.setValue(id,{value:event.target.value}),this.setPropertyOnSiblings(element,"value",event.target.value,"value"),elementData.formattedValue=null})),element.addEventListener("resetform",(event=>{const defaultValue=this.data.defaultFieldValue??"";element.value=elementData.userValue=defaultValue,elementData.formattedValue=null}));let blurListener=event=>{const{formattedValue}=elementData;null!=formattedValue&&(event.target.value=formattedValue),event.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){element.addEventListener("focus",(event=>{if(elementData.focused)return;const{target}=event;elementData.userValue&&(target.value=elementData.userValue),elementData.lastCommittedValue=target.value,elementData.commitKey=1,this.data.actions?.Focus||(elementData.focused=!0)})),element.addEventListener("updatefromsandbox",(jsEvent=>{this.showElementAndHideCanvas(jsEvent.target);const actions={value(event){elementData.userValue=event.detail.value??"",storage.setValue(id,{value:elementData.userValue.toString()}),event.target.value=elementData.userValue},formattedValue(event){const{formattedValue}=event.detail;elementData.formattedValue=formattedValue,null!=formattedValue&&event.target!==document.activeElement&&(event.target.value=formattedValue),storage.setValue(id,{formattedValue})},selRange(event){event.target.setSelectionRange(...event.detail.selRange)},charLimit:event=>{const{charLimit}=event.detail,{target}=event;if(0===charLimit)return void target.removeAttribute("maxLength");target.setAttribute("maxLength",charLimit);let value=elementData.userValue;!value||value.length<=charLimit||(value=value.slice(0,charLimit),target.value=elementData.userValue=value,storage.setValue(id,{value}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id,name:"Keystroke",value,willCommit:!0,commitKey:1,selStart:target.selectionStart,selEnd:target.selectionEnd}}))}};this._dispatchEventFromSandbox(actions,jsEvent)})),element.addEventListener("keydown",(event=>{elementData.commitKey=1;let commitKey=-1;if("Escape"===event.key?commitKey=0:"Enter"!==event.key||this.data.multiLine?"Tab"===event.key&&(elementData.commitKey=3):commitKey=2,-1===commitKey)return;const{value}=event.target;elementData.lastCommittedValue!==value&&(elementData.lastCommittedValue=value,elementData.userValue=value,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id,name:"Keystroke",value,willCommit:!0,commitKey,selStart:event.target.selectionStart,selEnd:event.target.selectionEnd}}))}));const _blurListener=blurListener;blurListener=null,element.addEventListener("blur",(event=>{if(!elementData.focused||!event.relatedTarget)return;this.data.actions?.Blur||(elementData.focused=!1);const{value}=event.target;elementData.userValue=value,elementData.lastCommittedValue!==value&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id,name:"Keystroke",value,willCommit:!0,commitKey:elementData.commitKey,selStart:event.target.selectionStart,selEnd:event.target.selectionEnd}}),_blurListener(event)})),this.data.actions?.Keystroke&&element.addEventListener("beforeinput",(event=>{elementData.lastCommittedValue=null;const{data,target}=event,{value,selectionStart,selectionEnd}=target;let selStart=selectionStart,selEnd=selectionEnd;switch(event.inputType){case"deleteWordBackward":{const match=value.substring(0,selectionStart).match(/\w*[^\w]*$/);match&&(selStart-=match[0].length);break}case"deleteWordForward":{const match=value.substring(selectionStart).match(/^[^\w]*\w*/);match&&(selEnd+=match[0].length);break}case"deleteContentBackward":selectionStart===selectionEnd&&(selStart-=1);break;case"deleteContentForward":selectionStart===selectionEnd&&(selEnd+=1)}event.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id,name:"Keystroke",value,change:data||"",willCommit:!1,selStart,selEnd}})})),this._setEventListeners(element,elementData,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(event=>event.target.value))}if(blurListener&&element.addEventListener("blur",blurListener),this.data.comb){const combWidth=(this.data.rect[2]-this.data.rect[0])/maxLen;element.classList.add("comb"),element.style.letterSpacing=`calc(${combWidth}px * var(--scale-factor) - 1ch)`}}else element=document.createElement("div"),element.textContent=this.data.fieldValue,element.style.verticalAlign="middle",element.style.display="table-cell",this.data.hasOwnCanvas&&(element.hidden=!0);return this._setTextStyle(element),this._setBackgroundColor(element),this._setDefaultPropertiesFromJS(element),this.container.append(element),this.container}}class SignatureWidgetAnnotationElement extends WidgetAnnotationElement{constructor(parameters){super(parameters,{isRenderable:!!parameters.data.hasOwnCanvas})}}class CheckboxWidgetAnnotationElement extends WidgetAnnotationElement{constructor(parameters){super(parameters,{isRenderable:parameters.renderForms})}render(){const storage=this.annotationStorage,data=this.data,id=data.id;let value=storage.getValue(id,{value:data.exportValue===data.fieldValue}).value;"string"==typeof value&&(value="Off"!==value,storage.setValue(id,{value})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const element=document.createElement("input");return GetElementsByNameSet.add(element),element.setAttribute("data-element-id",id),element.disabled=data.readOnly,this._setRequired(element,this.data.required),element.type="checkbox",element.name=data.fieldName,value&&element.setAttribute("checked",!0),element.setAttribute("exportValue",data.exportValue),element.tabIndex=1e3,element.addEventListener("change",(event=>{const{name,checked}=event.target;for(const checkbox of this._getElementsByName(name,id)){const curChecked=checked&&checkbox.exportValue===data.exportValue;checkbox.domElement&&(checkbox.domElement.checked=curChecked),storage.setValue(checkbox.id,{value:curChecked})}storage.setValue(id,{value:checked})})),element.addEventListener("resetform",(event=>{const defaultValue=data.defaultFieldValue||"Off";event.target.checked=defaultValue===data.exportValue})),this.enableScripting&&this.hasJSActions&&(element.addEventListener("updatefromsandbox",(jsEvent=>{const actions={value(event){event.target.checked="Off"!==event.detail.value,storage.setValue(id,{value:event.target.checked})}};this._dispatchEventFromSandbox(actions,jsEvent)})),this._setEventListeners(element,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(event=>event.target.checked))),this._setBackgroundColor(element),this._setDefaultPropertiesFromJS(element),this.container.append(element),this.container}}class RadioButtonWidgetAnnotationElement extends WidgetAnnotationElement{constructor(parameters){super(parameters,{isRenderable:parameters.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const storage=this.annotationStorage,data=this.data,id=data.id;let value=storage.getValue(id,{value:data.fieldValue===data.buttonValue}).value;if("string"==typeof value&&(value=value!==data.buttonValue,storage.setValue(id,{value})),value)for(const radio of this._getElementsByName(data.fieldName,id))storage.setValue(radio.id,{value:!1});const element=document.createElement("input");if(GetElementsByNameSet.add(element),element.setAttribute("data-element-id",id),element.disabled=data.readOnly,this._setRequired(element,this.data.required),element.type="radio",element.name=data.fieldName,value&&element.setAttribute("checked",!0),element.tabIndex=1e3,element.addEventListener("change",(event=>{const{name,checked}=event.target;for(const radio of this._getElementsByName(name,id))storage.setValue(radio.id,{value:!1});storage.setValue(id,{value:checked})})),element.addEventListener("resetform",(event=>{const defaultValue=data.defaultFieldValue;event.target.checked=null!=defaultValue&&defaultValue===data.buttonValue})),this.enableScripting&&this.hasJSActions){const pdfButtonValue=data.buttonValue;element.addEventListener("updatefromsandbox",(jsEvent=>{const actions={value:event=>{const checked=pdfButtonValue===event.detail.value;for(const radio of this._getElementsByName(event.target.name)){const curChecked=checked&&radio.id===id;radio.domElement&&(radio.domElement.checked=curChecked),storage.setValue(radio.id,{value:curChecked})}}};this._dispatchEventFromSandbox(actions,jsEvent)})),this._setEventListeners(element,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(event=>event.target.checked))}return this._setBackgroundColor(element),this._setDefaultPropertiesFromJS(element),this.container.append(element),this.container}}class PushButtonWidgetAnnotationElement extends LinkAnnotationElement{constructor(parameters){super(parameters,{ignoreBorder:parameters.data.hasAppearance})}render(){const container=super.render();container.classList.add("buttonWidgetAnnotation","pushButton");const linkElement=container.lastChild;return this.enableScripting&&this.hasJSActions&&linkElement&&(this._setDefaultPropertiesFromJS(linkElement),linkElement.addEventListener("updatefromsandbox",(jsEvent=>{this._dispatchEventFromSandbox({},jsEvent)}))),container}}class ChoiceWidgetAnnotationElement extends WidgetAnnotationElement{constructor(parameters){super(parameters,{isRenderable:parameters.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const storage=this.annotationStorage,id=this.data.id,storedData=storage.getValue(id,{value:this.data.fieldValue}),selectElement=document.createElement("select");GetElementsByNameSet.add(selectElement),selectElement.setAttribute("data-element-id",id),selectElement.disabled=this.data.readOnly,this._setRequired(selectElement,this.data.required),selectElement.name=this.data.fieldName,selectElement.tabIndex=1e3;let addAnEmptyEntry=this.data.combo&&this.data.options.length>0;this.data.combo||(selectElement.size=this.data.options.length,this.data.multiSelect&&(selectElement.multiple=!0)),selectElement.addEventListener("resetform",(event=>{const defaultValue=this.data.defaultFieldValue;for(const option of selectElement.options)option.selected=option.value===defaultValue}));for(const option of this.data.options){const optionElement=document.createElement("option");optionElement.textContent=option.displayValue,optionElement.value=option.exportValue,storedData.value.includes(option.exportValue)&&(optionElement.setAttribute("selected",!0),addAnEmptyEntry=!1),selectElement.append(optionElement)}let removeEmptyEntry=null;if(addAnEmptyEntry){const noneOptionElement=document.createElement("option");noneOptionElement.value=" ",noneOptionElement.setAttribute("hidden",!0),noneOptionElement.setAttribute("selected",!0),selectElement.prepend(noneOptionElement),removeEmptyEntry=()=>{noneOptionElement.remove(),selectElement.removeEventListener("input",removeEmptyEntry),removeEmptyEntry=null},selectElement.addEventListener("input",removeEmptyEntry)}const getValue=isExport=>{const name=isExport?"value":"textContent",{options,multiple}=selectElement;return multiple?Array.prototype.filter.call(options,(option=>option.selected)).map((option=>option[name])):-1===options.selectedIndex?null:options[options.selectedIndex][name]};let selectedValues=getValue(!1);const getItems=event=>{const options=event.target.options;return Array.prototype.map.call(options,(option=>({displayValue:option.textContent,exportValue:option.value})))};return this.enableScripting&&this.hasJSActions?(selectElement.addEventListener("updatefromsandbox",(jsEvent=>{const actions={value(event){removeEmptyEntry?.();const value=event.detail.value,values=new Set(Array.isArray(value)?value:[value]);for(const option of selectElement.options)option.selected=values.has(option.value);storage.setValue(id,{value:getValue(!0)}),selectedValues=getValue(!1)},multipleSelection(event){selectElement.multiple=!0},remove(event){const options=selectElement.options,index=event.detail.remove;if(options[index].selected=!1,selectElement.remove(index),options.length>0){-1===Array.prototype.findIndex.call(options,(option=>option.selected))&&(options[0].selected=!0)}storage.setValue(id,{value:getValue(!0),items:getItems(event)}),selectedValues=getValue(!1)},clear(event){for(;0!==selectElement.length;)selectElement.remove(0);storage.setValue(id,{value:null,items:[]}),selectedValues=getValue(!1)},insert(event){const{index,displayValue,exportValue}=event.detail.insert,selectChild=selectElement.children[index],optionElement=document.createElement("option");optionElement.textContent=displayValue,optionElement.value=exportValue,selectChild?selectChild.before(optionElement):selectElement.append(optionElement),storage.setValue(id,{value:getValue(!0),items:getItems(event)}),selectedValues=getValue(!1)},items(event){const{items}=event.detail;for(;0!==selectElement.length;)selectElement.remove(0);for(const item of items){const{displayValue,exportValue}=item,optionElement=document.createElement("option");optionElement.textContent=displayValue,optionElement.value=exportValue,selectElement.append(optionElement)}selectElement.options.length>0&&(selectElement.options[0].selected=!0),storage.setValue(id,{value:getValue(!0),items:getItems(event)}),selectedValues=getValue(!1)},indices(event){const indices=new Set(event.detail.indices);for(const option of event.target.options)option.selected=indices.has(option.index);storage.setValue(id,{value:getValue(!0)}),selectedValues=getValue(!1)},editable(event){event.target.disabled=!event.detail.editable}};this._dispatchEventFromSandbox(actions,jsEvent)})),selectElement.addEventListener("input",(event=>{const exportValue=getValue(!0),change=getValue(!1);storage.setValue(id,{value:exportValue}),event.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id,name:"Keystroke",value:selectedValues,change,changeEx:exportValue,willCommit:!1,commitKey:1,keyDown:!1}})})),this._setEventListeners(selectElement,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],(event=>event.target.value))):selectElement.addEventListener("input",(function(event){storage.setValue(id,{value:getValue(!0)})})),this.data.combo&&this._setTextStyle(selectElement),this._setBackgroundColor(selectElement),this._setDefaultPropertiesFromJS(selectElement),this.container.append(selectElement),this.container}}class PopupAnnotationElement extends AnnotationElement{constructor(parameters){const{data,elements}=parameters;super(parameters,{isRenderable:AnnotationElement._hasPopupData(data)}),this.elements=elements,this.popup=null}render(){this.container.classList.add("popupAnnotation");const popup=this.popup=new PopupElement({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),elementIds=[];for(const element of this.elements)element.popup=popup,element.container.ariaHasPopup="dialog",elementIds.push(element.data.id),element.addHighlightArea();return this.container.setAttribute("aria-controls",elementIds.map((id=>`pdfjs_internal_id_${id}`)).join(",")),this.container}}class PopupElement{#boundKeyDown=this.#keyDown.bind(this);#boundHide=this.#hide.bind(this);#boundShow=this.#show.bind(this);#boundToggle=this.#toggle.bind(this);#color=null;#container=null;#contentsObj=null;#dateObj=null;#elements=null;#parent=null;#parentRect=null;#pinned=!1;#popup=null;#position=null;#rect=null;#richText=null;#titleObj=null;#updates=null;#wasVisible=!1;constructor({container,color,elements,titleObj,modificationDate,contentsObj,richText,parent,rect,parentRect,open}){this.#container=container,this.#titleObj=titleObj,this.#contentsObj=contentsObj,this.#richText=richText,this.#parent=parent,this.#color=color,this.#rect=rect,this.#parentRect=parentRect,this.#elements=elements,this.#dateObj=PDFDateString.toDateObject(modificationDate),this.trigger=elements.flatMap((e=>e.getElementsToTriggerPopup()));for(const element of this.trigger)element.addEventListener("click",this.#boundToggle),element.addEventListener("mouseenter",this.#boundShow),element.addEventListener("mouseleave",this.#boundHide),element.classList.add("popupTriggerArea");for(const element of elements)element.container?.addEventListener("keydown",this.#boundKeyDown);this.#container.hidden=!0,open&&this.#toggle()}render(){if(this.#popup)return;const popup=this.#popup=document.createElement("div");if(popup.className="popup",this.#color){const baseColor=popup.style.outlineColor=Util.makeHexColor(...this.#color);if(CSS.supports("background-color","color-mix(in srgb, red 30%, white)"))popup.style.backgroundColor=`color-mix(in srgb, ${baseColor} 30%, white)`;else{const BACKGROUND_ENLIGHT=.7;popup.style.backgroundColor=Util.makeHexColor(...this.#color.map((c=>Math.floor(BACKGROUND_ENLIGHT*(255-c)+c))))}}const header=document.createElement("span");header.className="header";const title=document.createElement("h1");if(header.append(title),({dir:title.dir,str:title.textContent}=this.#titleObj),popup.append(header),this.#dateObj){const modificationDate=document.createElement("span");modificationDate.classList.add("popupDate"),modificationDate.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),modificationDate.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#dateObj.valueOf()})),header.append(modificationDate)}const html=this.#html;if(html)XfaLayer.render({xfaHtml:html,intent:"richText",div:popup}),popup.lastChild.classList.add("richText","popupContent");else{const contents=this._formatContents(this.#contentsObj);popup.append(contents)}this.#container.append(popup)}get#html(){const richText=this.#richText,contentsObj=this.#contentsObj;return!richText?.str||contentsObj?.str&&contentsObj.str!==richText.str?null:this.#richText.html||null}get#fontSize(){return this.#html?.attributes?.style?.fontSize||0}get#fontColor(){return this.#html?.attributes?.style?.color||null}#makePopupContent(text){const popupLines=[],popupContent={str:text,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:popupLines}]}},lineAttributes={style:{color:this.#fontColor,fontSize:this.#fontSize?`calc(${this.#fontSize}px * var(--scale-factor))`:""}};for(const line of text.split("\n"))popupLines.push({name:"span",value:line,attributes:lineAttributes});return popupContent}_formatContents({str,dir}){const p=document.createElement("p");p.classList.add("popupContent"),p.dir=dir;const lines=str.split(/(?:\r\n?|\n)/);for(let i=0,ii=lines.length;i<ii;++i){const line=lines[i];p.append(document.createTextNode(line)),i<ii-1&&p.append(document.createElement("br"))}return p}#keyDown(event){event.altKey||event.shiftKey||event.ctrlKey||event.metaKey||("Enter"===event.key||"Escape"===event.key&&this.#pinned)&&this.#toggle()}updateEdited({rect,popupContent}){this.#updates||={contentsObj:this.#contentsObj,richText:this.#richText},rect&&(this.#position=null),popupContent&&(this.#richText=this.#makePopupContent(popupContent),this.#contentsObj=null),this.#popup?.remove(),this.#popup=null}resetEdited(){this.#updates&&(({contentsObj:this.#contentsObj,richText:this.#richText}=this.#updates),this.#updates=null,this.#popup?.remove(),this.#popup=null,this.#position=null)}#setPosition(){if(null!==this.#position)return;const{page:{view},viewport:{rawDims:{pageWidth,pageHeight,pageX,pageY}}}=this.#parent;let useParentRect=!!this.#parentRect,rect=useParentRect?this.#parentRect:this.#rect;for(const element of this.#elements)if(!rect||null!==Util.intersect(element.data.rect,rect)){rect=element.data.rect,useParentRect=!0;break}const normalizedRect=Util.normalizeRect([rect[0],view[3]-rect[1]+view[1],rect[2],view[3]-rect[3]+view[1]]),parentWidth=useParentRect?rect[2]-rect[0]+5:0,popupLeft=normalizedRect[0]+parentWidth,popupTop=normalizedRect[1];this.#position=[100*(popupLeft-pageX)/pageWidth,100*(popupTop-pageY)/pageHeight];const{style}=this.#container;style.left=`${this.#position[0]}%`,style.top=`${this.#position[1]}%`}#toggle(){this.#pinned=!this.#pinned,this.#pinned?(this.#show(),this.#container.addEventListener("click",this.#boundToggle),this.#container.addEventListener("keydown",this.#boundKeyDown)):(this.#hide(),this.#container.removeEventListener("click",this.#boundToggle),this.#container.removeEventListener("keydown",this.#boundKeyDown))}#show(){this.#popup||this.render(),this.isVisible?this.#pinned&&this.#container.classList.add("focused"):(this.#setPosition(),this.#container.hidden=!1,this.#container.style.zIndex=parseInt(this.#container.style.zIndex)+1e3)}#hide(){this.#container.classList.remove("focused"),!this.#pinned&&this.isVisible&&(this.#container.hidden=!0,this.#container.style.zIndex=parseInt(this.#container.style.zIndex)-1e3)}forceHide(){this.#wasVisible=this.isVisible,this.#wasVisible&&(this.#container.hidden=!0)}maybeShow(){this.#wasVisible&&(this.#popup||this.#show(),this.#wasVisible=!1,this.#container.hidden=!1)}get isVisible(){return!1===this.#container.hidden}}class FreeTextAnnotationElement extends AnnotationElement{constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0}),this.textContent=parameters.data.textContent,this.textPosition=parameters.data.textPosition,this.annotationEditorType=AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const content=document.createElement("div");content.classList.add("annotationTextContent"),content.setAttribute("role","comment");for(const line of this.textContent){const lineSpan=document.createElement("span");lineSpan.textContent=line,content.append(lineSpan)}this.container.append(content)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class LineAnnotationElement extends AnnotationElement{#line=null;constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const data=this.data,{width,height}=getRectDims(data.rect),svg=this.svgFactory.create(width,height,!0),line=this.#line=this.svgFactory.createElement("svg:line");return line.setAttribute("x1",data.rect[2]-data.lineCoordinates[0]),line.setAttribute("y1",data.rect[3]-data.lineCoordinates[1]),line.setAttribute("x2",data.rect[2]-data.lineCoordinates[2]),line.setAttribute("y2",data.rect[3]-data.lineCoordinates[3]),line.setAttribute("stroke-width",data.borderStyle.width||1),line.setAttribute("stroke","transparent"),line.setAttribute("fill","transparent"),svg.append(line),this.container.append(svg),!data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#line}addHighlightArea(){this.container.classList.add("highlightArea")}}class SquareAnnotationElement extends AnnotationElement{#square=null;constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const data=this.data,{width,height}=getRectDims(data.rect),svg=this.svgFactory.create(width,height,!0),borderWidth=data.borderStyle.width,square=this.#square=this.svgFactory.createElement("svg:rect");return square.setAttribute("x",borderWidth/2),square.setAttribute("y",borderWidth/2),square.setAttribute("width",width-borderWidth),square.setAttribute("height",height-borderWidth),square.setAttribute("stroke-width",borderWidth||1),square.setAttribute("stroke","transparent"),square.setAttribute("fill","transparent"),svg.append(square),this.container.append(svg),!data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#square}addHighlightArea(){this.container.classList.add("highlightArea")}}class CircleAnnotationElement extends AnnotationElement{#circle=null;constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const data=this.data,{width,height}=getRectDims(data.rect),svg=this.svgFactory.create(width,height,!0),borderWidth=data.borderStyle.width,circle=this.#circle=this.svgFactory.createElement("svg:ellipse");return circle.setAttribute("cx",width/2),circle.setAttribute("cy",height/2),circle.setAttribute("rx",width/2-borderWidth/2),circle.setAttribute("ry",height/2-borderWidth/2),circle.setAttribute("stroke-width",borderWidth||1),circle.setAttribute("stroke","transparent"),circle.setAttribute("fill","transparent"),svg.append(circle),this.container.append(svg),!data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#circle}addHighlightArea(){this.container.classList.add("highlightArea")}}class PolylineAnnotationElement extends AnnotationElement{#polyline=null;constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect,vertices,borderStyle,popupRef}}=this;if(!vertices)return this.container;const{width,height}=getRectDims(rect),svg=this.svgFactory.create(width,height,!0);let points=[];for(let i=0,ii=vertices.length;i<ii;i+=2){const x=vertices[i]-rect[0],y=rect[3]-vertices[i+1];points.push(`${x},${y}`)}points=points.join(" ");const polyline=this.#polyline=this.svgFactory.createElement(this.svgElementName);return polyline.setAttribute("points",points),polyline.setAttribute("stroke-width",borderStyle.width||1),polyline.setAttribute("stroke","transparent"),polyline.setAttribute("fill","transparent"),svg.append(polyline),this.container.append(svg),!popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#polyline}addHighlightArea(){this.container.classList.add("highlightArea")}}class PolygonAnnotationElement extends PolylineAnnotationElement{constructor(parameters){super(parameters),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class CaretAnnotationElement extends AnnotationElement{constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class InkAnnotationElement extends AnnotationElement{#polylines=[];constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType="InkHighlight"===this.data.it?AnnotationEditorType.HIGHLIGHT:AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect,inkLists,borderStyle,popupRef}}=this,{width,height}=getRectDims(rect),svg=this.svgFactory.create(width,height,!0);for(const inkList of inkLists){let points=[];for(let i=0,ii=inkList.length;i<ii;i+=2){const x=inkList[i]-rect[0],y=rect[3]-inkList[i+1];points.push(`${x},${y}`)}points=points.join(" ");const polyline=this.svgFactory.createElement(this.svgElementName);this.#polylines.push(polyline),polyline.setAttribute("points",points),polyline.setAttribute("stroke-width",borderStyle.width||1),polyline.setAttribute("stroke","transparent"),polyline.setAttribute("fill","transparent"),svg.append(polyline)}return!popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(svg),this._editOnDoubleClick(),this.container}getElementsToTriggerPopup(){return this.#polylines}addHighlightArea(){this.container.classList.add("highlightArea")}}class HighlightAnnotationElement extends AnnotationElement{constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=AnnotationEditorType.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class UnderlineAnnotationElement extends AnnotationElement{constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class SquigglyAnnotationElement extends AnnotationElement{constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class StrikeOutAnnotationElement extends AnnotationElement{constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class StampAnnotationElement extends AnnotationElement{constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=AnnotationEditorType.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class FileAttachmentAnnotationElement extends AnnotationElement{#trigger=null;constructor(parameters){super(parameters,{isRenderable:!0});const{file}=this.data;this.filename=file.filename,this.content=file.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...file})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container,data}=this;let trigger;data.hasAppearance||0===data.fillAlpha?trigger=document.createElement("div"):(trigger=document.createElement("img"),trigger.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(data.name)?"paperclip":"pushpin"}.svg`,data.fillAlpha&&data.fillAlpha<1&&(trigger.style=`filter: opacity(${Math.round(100*data.fillAlpha)}%);`)),trigger.addEventListener("dblclick",this.#download.bind(this)),this.#trigger=trigger;const{isMac}=util_FeatureTest.platform;return container.addEventListener("keydown",(evt=>{"Enter"===evt.key&&(isMac?evt.metaKey:evt.ctrlKey)&&this.#download()})),!data.popupRef&&this.hasPopupData?this._createPopup():trigger.classList.add("popupTriggerArea"),container.append(trigger),container}getElementsToTriggerPopup(){return this.#trigger}addHighlightArea(){this.container.classList.add("highlightArea")}#download(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class AnnotationLayer{#accessibilityManager=null;#annotationCanvasMap=null;#editableAnnotations=new Map;#structTreeLayer=null;constructor({div,accessibilityManager,annotationCanvasMap,annotationEditorUIManager,page,viewport,structTreeLayer}){this.div=div,this.#accessibilityManager=accessibilityManager,this.#annotationCanvasMap=annotationCanvasMap,this.#structTreeLayer=structTreeLayer||null,this.page=page,this.viewport=viewport,this.zIndex=0,this._annotationEditorUIManager=annotationEditorUIManager}hasEditableAnnotations(){return this.#editableAnnotations.size>0}#appendElement(element,id){var _this37=this;return(0,asyncToGenerator.A)((function*(){const contentElement=element.firstChild||element,annotationId=contentElement.id=`pdfjs_internal_id_${id}`,ariaAttributes=yield _this37.#structTreeLayer?.getAriaAttributes(annotationId);if(ariaAttributes)for(const[key,value]of ariaAttributes)contentElement.setAttribute(key,value);_this37.div.append(element),_this37.#accessibilityManager?.moveElementInDOM(_this37.div,element,contentElement,!1)}))()}render(params){var _this38=this;return(0,asyncToGenerator.A)((function*(){const{annotations}=params,layer=_this38.div;setLayerDimensions(layer,_this38.viewport);const popupToElements=new Map,elementParams={data:null,layer,linkService:params.linkService,downloadManager:params.downloadManager,imageResourcesPath:params.imageResourcesPath||"",renderForms:!1!==params.renderForms,svgFactory:new DOMSVGFactory,annotationStorage:params.annotationStorage||new AnnotationStorage,enableScripting:!0===params.enableScripting,hasJSActions:params.hasJSActions,fieldObjects:params.fieldObjects,parent:_this38,elements:null};for(const data of annotations){if(data.noHTML)continue;const isPopupAnnotation=data.annotationType===AnnotationType_POPUP;if(isPopupAnnotation){const elements=popupToElements.get(data.id);if(!elements)continue;elementParams.elements=elements}else{const{width,height}=getRectDims(data.rect);if(width<=0||height<=0)continue}elementParams.data=data;const element=AnnotationElementFactory.create(elementParams);if(!element.isRenderable)continue;if(!isPopupAnnotation&&data.popupRef){const elements=popupToElements.get(data.popupRef);elements?elements.push(element):popupToElements.set(data.popupRef,[element])}const rendered=element.render();data.hidden&&(rendered.style.visibility="hidden"),yield _this38.#appendElement(rendered,data.id),element._isEditable&&(_this38.#editableAnnotations.set(element.data.id,element),_this38._annotationEditorUIManager?.renderAnnotationElement(element))}_this38.#setAnnotationCanvasMap()}))()}update({viewport}){const layer=this.div;this.viewport=viewport,setLayerDimensions(layer,{rotation:viewport.rotation}),this.#setAnnotationCanvasMap(),layer.hidden=!1}#setAnnotationCanvasMap(){if(!this.#annotationCanvasMap)return;const layer=this.div;for(const[id,canvas]of this.#annotationCanvasMap){const element=layer.querySelector(`[data-annotation-id="${id}"]`);if(!element)continue;canvas.className="annotationContent";const{firstChild}=element;firstChild?"CANVAS"===firstChild.nodeName?firstChild.replaceWith(canvas):firstChild.classList.contains("annotationContent")?firstChild.after(canvas):firstChild.before(canvas):element.append(canvas)}this.#annotationCanvasMap.clear()}getEditableAnnotations(){return Array.from(this.#editableAnnotations.values())}getEditableAnnotation(id){return this.#editableAnnotations.get(id)}}const EOL_PATTERN=/\r\n?|\n/g;class FreeTextEditor extends AnnotationEditor{#color;#content="";#editorDivId=`${this.id}-editor`;#editModeAC=null;#fontSize;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const proto=FreeTextEditor.prototype,arrowChecker=self=>self.isEmpty(),small=AnnotationEditorUIManager.TRANSLATE_SMALL,big=AnnotationEditorUIManager.TRANSLATE_BIG;return shadow(this,"_keyboardManager",new KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],proto.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],proto.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],proto._translateEmpty,{args:[-small,0],checker:arrowChecker}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],proto._translateEmpty,{args:[-big,0],checker:arrowChecker}],[["ArrowRight","mac+ArrowRight"],proto._translateEmpty,{args:[small,0],checker:arrowChecker}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],proto._translateEmpty,{args:[big,0],checker:arrowChecker}],[["ArrowUp","mac+ArrowUp"],proto._translateEmpty,{args:[0,-small],checker:arrowChecker}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],proto._translateEmpty,{args:[0,-big],checker:arrowChecker}],[["ArrowDown","mac+ArrowDown"],proto._translateEmpty,{args:[0,small],checker:arrowChecker}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],proto._translateEmpty,{args:[0,big],checker:arrowChecker}]]))}static _type="freetext";static _editorType=AnnotationEditorType.FREETEXT;constructor(params){super({...params,name:"freeTextEditor"}),this.#color=params.color||FreeTextEditor._defaultColor||AnnotationEditor._defaultLineColor,this.#fontSize=params.fontSize||FreeTextEditor._defaultFontSize}static initialize(l10n,uiManager){AnnotationEditor.initialize(l10n,uiManager);const style=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(style.getPropertyValue("--freetext-padding"))}static updateDefaultParams(type,value){switch(type){case AnnotationEditorParamsType.FREETEXT_SIZE:FreeTextEditor._defaultFontSize=value;break;case AnnotationEditorParamsType.FREETEXT_COLOR:FreeTextEditor._defaultColor=value}}updateParams(type,value){switch(type){case AnnotationEditorParamsType.FREETEXT_SIZE:this.#updateFontSize(value);break;case AnnotationEditorParamsType.FREETEXT_COLOR:this.#updateColor(value)}}static get defaultPropertiesToUpdate(){return[[AnnotationEditorParamsType.FREETEXT_SIZE,FreeTextEditor._defaultFontSize],[AnnotationEditorParamsType.FREETEXT_COLOR,FreeTextEditor._defaultColor||AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[AnnotationEditorParamsType.FREETEXT_SIZE,this.#fontSize],[AnnotationEditorParamsType.FREETEXT_COLOR,this.#color]]}#updateFontSize(fontSize){const setFontsize=size=>{this.editorDiv.style.fontSize=`calc(${size}px * var(--scale-factor))`,this.translate(0,-(size-this.#fontSize)*this.parentScale),this.#fontSize=size,this.#setEditorDimensions()},savedFontsize=this.#fontSize;this.addCommands({cmd:setFontsize.bind(this,fontSize),undo:setFontsize.bind(this,savedFontsize),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#updateColor(color){const setColor=col=>{this.#color=this.editorDiv.style.color=col},savedColor=this.#color;this.addCommands({cmd:setColor.bind(this,color),undo:setColor.bind(this,savedColor),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(x,y){this._uiManager.translateSelectedEditors(x,y,!0)}getInitialTranslation(){const scale=this.parentScale;return[-FreeTextEditor._internalPadding*scale,-(FreeTextEditor._internalPadding+this.#fontSize)*scale]}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#editModeAC=new AbortController;const signal=this._uiManager.combinedSignal(this.#editModeAC);this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#editorDivId),this._isDraggable=!0,this.#editModeAC?.abort(),this.#editModeAC=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(event){this._focusEventsAllowed&&(super.focusin(event),event.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#extractText(){const buffer=[];this.editorDiv.normalize();let prevChild=null;for(const child of this.editorDiv.childNodes)prevChild?.nodeType===Node.TEXT_NODE&&"BR"===child.nodeName||(buffer.push(FreeTextEditor.#getNodeContent(child)),prevChild=child);return buffer.join("\n")}#setEditorDimensions(){const[parentWidth,parentHeight]=this.parentDimensions;let rect;if(this.isAttachedToDOM)rect=this.div.getBoundingClientRect();else{const{currentLayer,div}=this,savedDisplay=div.style.display,savedVisibility=div.classList.contains("hidden");div.classList.remove("hidden"),div.style.display="hidden",currentLayer.div.append(this.div),rect=div.getBoundingClientRect(),div.remove(),div.style.display=savedDisplay,div.classList.toggle("hidden",savedVisibility)}this.rotation%180==this.parentRotation%180?(this.width=rect.width/parentWidth,this.height=rect.height/parentHeight):(this.width=rect.height/parentWidth,this.height=rect.width/parentHeight),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const savedText=this.#content,newText=this.#content=this.#extractText().trimEnd();if(savedText===newText)return;const setText=text=>{this.#content=text,text?(this.#setContent(),this._uiManager.rebuild(this),this.#setEditorDimensions()):this.remove()};this.addCommands({cmd:()=>{setText(newText)},undo:()=>{setText(savedText)},mustExec:!1}),this.#setEditorDimensions()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(event){this.enterInEditMode()}keydown(event){event.target===this.div&&"Enter"===event.key&&(this.enterInEditMode(),event.preventDefault())}editorDivKeydown(event){FreeTextEditor._keyboardManager.exec(this,event)}editorDivFocus(event){this.isEditing=!0}editorDivBlur(event){this.isEditing=!1}editorDivInput(event){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let baseX,baseY;this.width&&(baseX=this.x,baseY=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#editorDivId),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style}=this.editorDiv;if(style.fontSize=`calc(${this.#fontSize}px * var(--scale-factor))`,style.color=this.#color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),bindEvents(this,this.div,["dblclick","keydown"]),this.width){const[parentWidth,parentHeight]=this.parentDimensions;if(this.annotationElementId){const{position}=this._initialData;let[tx,ty]=this.getInitialTranslation();[tx,ty]=this.pageTranslationToScreen(tx,ty);const[pageWidth,pageHeight]=this.pageDimensions,[pageX,pageY]=this.pageTranslation;let posX,posY;switch(this.rotation){case 0:posX=baseX+(position[0]-pageX)/pageWidth,posY=baseY+this.height-(position[1]-pageY)/pageHeight;break;case 90:posX=baseX+(position[0]-pageX)/pageWidth,posY=baseY-(position[1]-pageY)/pageHeight,[tx,ty]=[ty,-tx];break;case 180:posX=baseX-this.width+(position[0]-pageX)/pageWidth,posY=baseY-(position[1]-pageY)/pageHeight,[tx,ty]=[-tx,-ty];break;case 270:posX=baseX+(position[0]-pageX-this.height*pageHeight)/pageWidth,posY=baseY+(position[1]-pageY-this.width*pageWidth)/pageHeight,[tx,ty]=[-ty,tx]}this.setAt(posX*parentWidth,posY*parentHeight,tx,ty)}else this.setAt(baseX*parentWidth,baseY*parentHeight,this.width*parentWidth,this.height*parentHeight);this.#setContent(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#getNodeContent(node){return(node.nodeType===Node.TEXT_NODE?node.nodeValue:node.innerText).replaceAll(EOL_PATTERN,"")}editorDivPaste(event){const clipboardData=event.clipboardData||window.clipboardData,{types}=clipboardData;if(1===types.length&&"text/plain"===types[0])return;event.preventDefault();const paste=FreeTextEditor.#deserializeContent(clipboardData.getData("text")||"").replaceAll(EOL_PATTERN,"\n");if(!paste)return;const selection=window.getSelection();if(!selection.rangeCount)return;this.editorDiv.normalize(),selection.deleteFromDocument();const range=selection.getRangeAt(0);if(!paste.includes("\n"))return range.insertNode(document.createTextNode(paste)),this.editorDiv.normalize(),void selection.collapseToStart();const{startContainer,startOffset}=range,bufferBefore=[],bufferAfter=[];if(startContainer.nodeType===Node.TEXT_NODE){const parent=startContainer.parentElement;if(bufferAfter.push(startContainer.nodeValue.slice(startOffset).replaceAll(EOL_PATTERN,"")),parent!==this.editorDiv){let buffer=bufferBefore;for(const child of this.editorDiv.childNodes)child!==parent?buffer.push(FreeTextEditor.#getNodeContent(child)):buffer=bufferAfter}bufferBefore.push(startContainer.nodeValue.slice(0,startOffset).replaceAll(EOL_PATTERN,""))}else if(startContainer===this.editorDiv){let buffer=bufferBefore,i=0;for(const child of this.editorDiv.childNodes)i++===startOffset&&(buffer=bufferAfter),buffer.push(FreeTextEditor.#getNodeContent(child))}this.#content=`${bufferBefore.join("\n")}${paste}${bufferAfter.join("\n")}`,this.#setContent();const newRange=new Range;let beforeLength=bufferBefore.reduce(((acc,line)=>acc+line.length),0);for(const{firstChild}of this.editorDiv.childNodes)if(firstChild.nodeType===Node.TEXT_NODE){const length=firstChild.nodeValue.length;if(beforeLength<=length){newRange.setStart(firstChild,beforeLength),newRange.setEnd(firstChild,beforeLength);break}beforeLength-=length}selection.removeAllRanges(),selection.addRange(newRange)}#setContent(){if(this.editorDiv.replaceChildren(),this.#content)for(const line of this.#content.split("\n")){const div=document.createElement("div");div.append(line?document.createTextNode(line):document.createElement("br")),this.editorDiv.append(div)}}#serializeContent(){return this.#content.replaceAll(" "," ")}static#deserializeContent(content){return content.replaceAll(" "," ")}get contentDiv(){return this.editorDiv}static deserialize(data,parent,uiManager){var _superprop_getDeserialize=()=>super.deserialize,_this39=this;return(0,asyncToGenerator.A)((function*(){let initialData=null;if(data instanceof FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize,fontColor},rect,rotation,id,popupRef},textContent,textPosition,parent:{page:{pageNumber}}}=data;if(!textContent||0===textContent.length)return null;initialData=data={annotationType:AnnotationEditorType.FREETEXT,color:Array.from(fontColor),fontSize,value:textContent.join("\n"),position:textPosition,pageIndex:pageNumber-1,rect:rect.slice(0),rotation,id,deleted:!1,popupRef}}const editor=yield _superprop_getDeserialize().call(_this39,data,parent,uiManager);return editor.#fontSize=data.fontSize,editor.#color=Util.makeHexColor(...data.color),editor.#content=FreeTextEditor.#deserializeContent(data.value),editor.annotationElementId=data.id||null,editor._initialData=initialData,editor}))()}serialize(isForCopying=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const padding=FreeTextEditor._internalPadding*this.parentScale,rect=this.getRect(padding,padding),color=AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#color),serialized={annotationType:AnnotationEditorType.FREETEXT,color,fontSize:this.#fontSize,value:this.#serializeContent(),pageIndex:this.pageIndex,rect,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return isForCopying?serialized:this.annotationElementId&&!this.#hasElementChanged(serialized)?null:(serialized.id=this.annotationElementId,serialized)}#hasElementChanged(serialized){const{value,fontSize,color,pageIndex}=this._initialData;return this._hasBeenMoved||serialized.value!==value||serialized.fontSize!==fontSize||serialized.color.some(((c,i)=>c!==color[i]))||serialized.pageIndex!==pageIndex}renderAnnotationElement(annotation){const content=super.renderAnnotationElement(annotation);if(this.deleted)return content;const{style}=content;style.fontSize=`calc(${this.#fontSize}px * var(--scale-factor))`,style.color=this.#color,content.replaceChildren();for(const line of this.#content.split("\n")){const div=document.createElement("div");div.append(line?document.createTextNode(line):document.createElement("br")),content.append(div)}const padding=FreeTextEditor._internalPadding*this.parentScale;return annotation.updateEdited({rect:this.getRect(padding,padding),popupContent:this.#content}),content}resetAnnotationElement(annotation){super.resetAnnotationElement(annotation),annotation.resetEdited()}}class Outline{toSVGPath(){unreachable("Abstract method `toSVGPath` must be implemented.")}get box(){unreachable("Abstract getter `box` must be implemented.")}serialize(_bbox,_rotation){unreachable("Abstract method `serialize` must be implemented.")}get classNamesForDrawing(){unreachable("Abstract getter `classNamesForDrawing` must be implemented.")}get classNamesForOutlining(){unreachable("Abstract getter `classNamesForOutlining` must be implemented.")}get mustRemoveSelfIntersections(){return!1}}class FreeDrawOutliner{#box;#bottom=[];#innerMargin;#isLTR;#top=[];#last=new Float64Array(18);#lastX;#lastY;#min;#min_dist;#scaleFactor;#thickness;#points=[];static#MIN_DIST=8;static#MIN_DIFF=2;static#MIN=FreeDrawOutliner.#MIN_DIST+FreeDrawOutliner.#MIN_DIFF;constructor({x,y},box,scaleFactor,thickness,isLTR,innerMargin=0){this.#box=box,this.#thickness=thickness*scaleFactor,this.#isLTR=isLTR,this.#last.set([NaN,NaN,NaN,NaN,x,y],6),this.#innerMargin=innerMargin,this.#min_dist=FreeDrawOutliner.#MIN_DIST*scaleFactor,this.#min=FreeDrawOutliner.#MIN*scaleFactor,this.#scaleFactor=scaleFactor,this.#points.push(x,y)}isEmpty(){return isNaN(this.#last[8])}#getLastCoords(){const lastTop=this.#last.subarray(4,6),lastBottom=this.#last.subarray(16,18),[x,y,width,height]=this.#box;return[(this.#lastX+(lastTop[0]-lastBottom[0])/2-x)/width,(this.#lastY+(lastTop[1]-lastBottom[1])/2-y)/height,(this.#lastX+(lastBottom[0]-lastTop[0])/2-x)/width,(this.#lastY+(lastBottom[1]-lastTop[1])/2-y)/height]}add({x,y}){this.#lastX=x,this.#lastY=y;const[layerX,layerY,layerWidth,layerHeight]=this.#box;let[x1,y1,x2,y2]=this.#last.subarray(8,12);const diffX=x-x2,diffY=y-y2,d=Math.hypot(diffX,diffY);if(d<this.#min)return!1;const diffD=d-this.#min_dist,K=diffD/d,shiftX=K*diffX,shiftY=K*diffY;let x0=x1,y0=y1;x1=x2,y1=y2,x2+=shiftX,y2+=shiftY,this.#points?.push(x,y);const nY=shiftX/diffD,thX=-shiftY/diffD*this.#thickness,thY=nY*this.#thickness;if(this.#last.set(this.#last.subarray(2,8),0),this.#last.set([x2+thX,y2+thY],4),this.#last.set(this.#last.subarray(14,18),12),this.#last.set([x2-thX,y2-thY],16),isNaN(this.#last[6]))return 0===this.#top.length&&(this.#last.set([x1+thX,y1+thY],2),this.#top.push(NaN,NaN,NaN,NaN,(x1+thX-layerX)/layerWidth,(y1+thY-layerY)/layerHeight),this.#last.set([x1-thX,y1-thY],14),this.#bottom.push(NaN,NaN,NaN,NaN,(x1-thX-layerX)/layerWidth,(y1-thY-layerY)/layerHeight)),this.#last.set([x0,y0,x1,y1,x2,y2],6),!this.isEmpty();this.#last.set([x0,y0,x1,y1,x2,y2],6);return Math.abs(Math.atan2(y0-y1,x0-x1)-Math.atan2(shiftY,shiftX))<Math.PI/2?([x1,y1,x2,y2]=this.#last.subarray(2,6),this.#top.push(NaN,NaN,NaN,NaN,((x1+x2)/2-layerX)/layerWidth,((y1+y2)/2-layerY)/layerHeight),[x1,y1,x0,y0]=this.#last.subarray(14,18),this.#bottom.push(NaN,NaN,NaN,NaN,((x0+x1)/2-layerX)/layerWidth,((y0+y1)/2-layerY)/layerHeight),!0):([x0,y0,x1,y1,x2,y2]=this.#last.subarray(0,6),this.#top.push(((x0+5*x1)/6-layerX)/layerWidth,((y0+5*y1)/6-layerY)/layerHeight,((5*x1+x2)/6-layerX)/layerWidth,((5*y1+y2)/6-layerY)/layerHeight,((x1+x2)/2-layerX)/layerWidth,((y1+y2)/2-layerY)/layerHeight),[x2,y2,x1,y1,x0,y0]=this.#last.subarray(12,18),this.#bottom.push(((x0+5*x1)/6-layerX)/layerWidth,((y0+5*y1)/6-layerY)/layerHeight,((5*x1+x2)/6-layerX)/layerWidth,((5*y1+y2)/6-layerY)/layerHeight,((x1+x2)/2-layerX)/layerWidth,((y1+y2)/2-layerY)/layerHeight),!0)}toSVGPath(){if(this.isEmpty())return"";const top=this.#top,bottom=this.#bottom;if(isNaN(this.#last[6])&&!this.isEmpty())return this.#toSVGPathTwoPoints();const buffer=[];buffer.push(`M${top[4]} ${top[5]}`);for(let i=6;i<top.length;i+=6)isNaN(top[i])?buffer.push(`L${top[i+4]} ${top[i+5]}`):buffer.push(`C${top[i]} ${top[i+1]} ${top[i+2]} ${top[i+3]} ${top[i+4]} ${top[i+5]}`);this.#toSVGPathEnd(buffer);for(let i=bottom.length-6;i>=6;i-=6)isNaN(bottom[i])?buffer.push(`L${bottom[i+4]} ${bottom[i+5]}`):buffer.push(`C${bottom[i]} ${bottom[i+1]} ${bottom[i+2]} ${bottom[i+3]} ${bottom[i+4]} ${bottom[i+5]}`);return this.#toSVGPathStart(buffer),buffer.join(" ")}#toSVGPathTwoPoints(){const[x,y,width,height]=this.#box,[lastTopX,lastTopY,lastBottomX,lastBottomY]=this.#getLastCoords();return`M${(this.#last[2]-x)/width} ${(this.#last[3]-y)/height} L${(this.#last[4]-x)/width} ${(this.#last[5]-y)/height} L${lastTopX} ${lastTopY} L${lastBottomX} ${lastBottomY} L${(this.#last[16]-x)/width} ${(this.#last[17]-y)/height} L${(this.#last[14]-x)/width} ${(this.#last[15]-y)/height} Z`}#toSVGPathStart(buffer){const bottom=this.#bottom;buffer.push(`L${bottom[4]} ${bottom[5]} Z`)}#toSVGPathEnd(buffer){const[x,y,width,height]=this.#box,lastTop=this.#last.subarray(4,6),lastBottom=this.#last.subarray(16,18),[lastTopX,lastTopY,lastBottomX,lastBottomY]=this.#getLastCoords();buffer.push(`L${(lastTop[0]-x)/width} ${(lastTop[1]-y)/height} L${lastTopX} ${lastTopY} L${lastBottomX} ${lastBottomY} L${(lastBottom[0]-x)/width} ${(lastBottom[1]-y)/height}`)}newFreeDrawOutline(outline,points,box,scaleFactor,innerMargin,isLTR){return new FreeDrawOutline(outline,points,box,scaleFactor,innerMargin,isLTR)}getOutlines(){const top=this.#top,bottom=this.#bottom,last=this.#last,[layerX,layerY,layerWidth,layerHeight]=this.#box,points=new Float64Array((this.#points?.length??0)+2);for(let i=0,ii=points.length-2;i<ii;i+=2)points[i]=(this.#points[i]-layerX)/layerWidth,points[i+1]=(this.#points[i+1]-layerY)/layerHeight;if(points[points.length-2]=(this.#lastX-layerX)/layerWidth,points[points.length-1]=(this.#lastY-layerY)/layerHeight,isNaN(last[6])&&!this.isEmpty())return this.#getOutlineTwoPoints(points);const outline=new Float64Array(this.#top.length+24+this.#bottom.length);let N=top.length;for(let i=0;i<N;i+=2)isNaN(top[i])?outline[i]=outline[i+1]=NaN:(outline[i]=top[i],outline[i+1]=top[i+1]);N=this.#getOutlineEnd(outline,N);for(let i=bottom.length-6;i>=6;i-=6)for(let j=0;j<6;j+=2)isNaN(bottom[i+j])?(outline[N]=outline[N+1]=NaN,N+=2):(outline[N]=bottom[i+j],outline[N+1]=bottom[i+j+1],N+=2);return this.#getOutlineStart(outline,N),this.newFreeDrawOutline(outline,points,this.#box,this.#scaleFactor,this.#innerMargin,this.#isLTR)}#getOutlineTwoPoints(points){const last=this.#last,[layerX,layerY,layerWidth,layerHeight]=this.#box,[lastTopX,lastTopY,lastBottomX,lastBottomY]=this.#getLastCoords(),outline=new Float64Array(36);return outline.set([NaN,NaN,NaN,NaN,(last[2]-layerX)/layerWidth,(last[3]-layerY)/layerHeight,NaN,NaN,NaN,NaN,(last[4]-layerX)/layerWidth,(last[5]-layerY)/layerHeight,NaN,NaN,NaN,NaN,lastTopX,lastTopY,NaN,NaN,NaN,NaN,lastBottomX,lastBottomY,NaN,NaN,NaN,NaN,(last[16]-layerX)/layerWidth,(last[17]-layerY)/layerHeight,NaN,NaN,NaN,NaN,(last[14]-layerX)/layerWidth,(last[15]-layerY)/layerHeight],0),this.newFreeDrawOutline(outline,points,this.#box,this.#scaleFactor,this.#innerMargin,this.#isLTR)}#getOutlineStart(outline,pos){const bottom=this.#bottom;return outline.set([NaN,NaN,NaN,NaN,bottom[4],bottom[5]],pos),pos+6}#getOutlineEnd(outline,pos){const lastTop=this.#last.subarray(4,6),lastBottom=this.#last.subarray(16,18),[layerX,layerY,layerWidth,layerHeight]=this.#box,[lastTopX,lastTopY,lastBottomX,lastBottomY]=this.#getLastCoords();return outline.set([NaN,NaN,NaN,NaN,(lastTop[0]-layerX)/layerWidth,(lastTop[1]-layerY)/layerHeight,NaN,NaN,NaN,NaN,lastTopX,lastTopY,NaN,NaN,NaN,NaN,lastBottomX,lastBottomY,NaN,NaN,NaN,NaN,(lastBottom[0]-layerX)/layerWidth,(lastBottom[1]-layerY)/layerHeight],pos),pos+24}}class FreeDrawOutline extends Outline{#box;#bbox=null;#innerMargin;#isLTR;#points;#scaleFactor;#outline;constructor(outline,points,box,scaleFactor,innerMargin,isLTR){super(),this.#outline=outline,this.#points=points,this.#box=box,this.#scaleFactor=scaleFactor,this.#innerMargin=innerMargin,this.#isLTR=isLTR,this.#computeMinMax(isLTR);const{x,y,width,height}=this.#bbox;for(let i=0,ii=outline.length;i<ii;i+=2)outline[i]=(outline[i]-x)/width,outline[i+1]=(outline[i+1]-y)/height;for(let i=0,ii=points.length;i<ii;i+=2)points[i]=(points[i]-x)/width,points[i+1]=(points[i+1]-y)/height}toSVGPath(){const buffer=[`M${this.#outline[4]} ${this.#outline[5]}`];for(let i=6,ii=this.#outline.length;i<ii;i+=6)isNaN(this.#outline[i])?buffer.push(`L${this.#outline[i+4]} ${this.#outline[i+5]}`):buffer.push(`C${this.#outline[i]} ${this.#outline[i+1]} ${this.#outline[i+2]} ${this.#outline[i+3]} ${this.#outline[i+4]} ${this.#outline[i+5]}`);return buffer.push("Z"),buffer.join(" ")}serialize([blX,blY,trX,trY],rotation){const width=trX-blX,height=trY-blY;let outline,points;switch(rotation){case 0:outline=this.#rescale(this.#outline,blX,trY,width,-height),points=this.#rescale(this.#points,blX,trY,width,-height);break;case 90:outline=this.#rescaleAndSwap(this.#outline,blX,blY,width,height),points=this.#rescaleAndSwap(this.#points,blX,blY,width,height);break;case 180:outline=this.#rescale(this.#outline,trX,blY,-width,height),points=this.#rescale(this.#points,trX,blY,-width,height);break;case 270:outline=this.#rescaleAndSwap(this.#outline,trX,trY,-width,-height),points=this.#rescaleAndSwap(this.#points,trX,trY,-width,-height)}return{outline:Array.from(outline),points:[Array.from(points)]}}#rescale(src,tx,ty,sx,sy){const dest=new Float64Array(src.length);for(let i=0,ii=src.length;i<ii;i+=2)dest[i]=tx+src[i]*sx,dest[i+1]=ty+src[i+1]*sy;return dest}#rescaleAndSwap(src,tx,ty,sx,sy){const dest=new Float64Array(src.length);for(let i=0,ii=src.length;i<ii;i+=2)dest[i]=tx+src[i+1]*sx,dest[i+1]=ty+src[i]*sy;return dest}#computeMinMax(isLTR){const outline=this.#outline;let lastX=outline[4],lastY=outline[5],minX=lastX,minY=lastY,maxX=lastX,maxY=lastY,lastPointX=lastX,lastPointY=lastY;const ltrCallback=isLTR?Math.max:Math.min;for(let i=6,ii=outline.length;i<ii;i+=6){if(isNaN(outline[i]))minX=Math.min(minX,outline[i+4]),minY=Math.min(minY,outline[i+5]),maxX=Math.max(maxX,outline[i+4]),maxY=Math.max(maxY,outline[i+5]),lastPointY<outline[i+5]?(lastPointX=outline[i+4],lastPointY=outline[i+5]):lastPointY===outline[i+5]&&(lastPointX=ltrCallback(lastPointX,outline[i+4]));else{const bbox=Util.bezierBoundingBox(lastX,lastY,...outline.slice(i,i+6));minX=Math.min(minX,bbox[0]),minY=Math.min(minY,bbox[1]),maxX=Math.max(maxX,bbox[2]),maxY=Math.max(maxY,bbox[3]),lastPointY<bbox[3]?(lastPointX=bbox[2],lastPointY=bbox[3]):lastPointY===bbox[3]&&(lastPointX=ltrCallback(lastPointX,bbox[2]))}lastX=outline[i+4],lastY=outline[i+5]}const x=minX-this.#innerMargin,y=minY-this.#innerMargin,width=maxX-minX+2*this.#innerMargin,height=maxY-minY+2*this.#innerMargin;this.#bbox={x,y,width,height,lastPoint:[lastPointX,lastPointY]}}get box(){return this.#bbox}newOutliner(point,box,scaleFactor,thickness,isLTR,innerMargin=0){return new FreeDrawOutliner(point,box,scaleFactor,thickness,isLTR,innerMargin)}getNewOutline(thickness,innerMargin){const{x,y,width,height}=this.#bbox,[layerX,layerY,layerWidth,layerHeight]=this.#box,sx=width*layerWidth,sy=height*layerHeight,tx=x*layerWidth+layerX,ty=y*layerHeight+layerY,outliner=this.newOutliner({x:this.#points[0]*sx+tx,y:this.#points[1]*sy+ty},this.#box,this.#scaleFactor,thickness,this.#isLTR,innerMargin??this.#innerMargin);for(let i=2;i<this.#points.length;i+=2)outliner.add({x:this.#points[i]*sx+tx,y:this.#points[i+1]*sy+ty});return outliner.getOutlines()}get mustRemoveSelfIntersections(){return!0}}class HighlightOutliner{#box;#verticalEdges=[];#intervals=[];constructor(boxes,borderWidth=0,innerMargin=0,isLTR=!0){let minX=1/0,maxX=-1/0,minY=1/0,maxY=-1/0;const EPSILON=10**-4;for(const{x,y,width,height}of boxes){const x1=Math.floor((x-borderWidth)/EPSILON)*EPSILON,x2=Math.ceil((x+width+borderWidth)/EPSILON)*EPSILON,y1=Math.floor((y-borderWidth)/EPSILON)*EPSILON,y2=Math.ceil((y+height+borderWidth)/EPSILON)*EPSILON,left=[x1,y1,y2,!0],right=[x2,y1,y2,!1];this.#verticalEdges.push(left,right),minX=Math.min(minX,x1),maxX=Math.max(maxX,x2),minY=Math.min(minY,y1),maxY=Math.max(maxY,y2)}const bboxWidth=maxX-minX+2*innerMargin,bboxHeight=maxY-minY+2*innerMargin,shiftedMinX=minX-innerMargin,shiftedMinY=minY-innerMargin,lastEdge=this.#verticalEdges.at(isLTR?-1:-2),lastPoint=[lastEdge[0],lastEdge[2]];for(const edge of this.#verticalEdges){const[x,y1,y2]=edge;edge[0]=(x-shiftedMinX)/bboxWidth,edge[1]=(y1-shiftedMinY)/bboxHeight,edge[2]=(y2-shiftedMinY)/bboxHeight}this.#box={x:shiftedMinX,y:shiftedMinY,width:bboxWidth,height:bboxHeight,lastPoint}}getOutlines(){this.#verticalEdges.sort(((a,b)=>a[0]-b[0]||a[1]-b[1]||a[2]-b[2]));const outlineVerticalEdges=[];for(const edge of this.#verticalEdges)edge[3]?(outlineVerticalEdges.push(...this.#breakEdge(edge)),this.#insert(edge)):(this.#remove(edge),outlineVerticalEdges.push(...this.#breakEdge(edge)));return this.#getOutlines(outlineVerticalEdges)}#getOutlines(outlineVerticalEdges){const edges=[],allEdges=new Set;for(const edge of outlineVerticalEdges){const[x,y1,y2]=edge;edges.push([x,y1,edge],[x,y2,edge])}edges.sort(((a,b)=>a[1]-b[1]||a[0]-b[0]));for(let i=0,ii=edges.length;i<ii;i+=2){const edge1=edges[i][2],edge2=edges[i+1][2];edge1.push(edge2),edge2.push(edge1),allEdges.add(edge1),allEdges.add(edge2)}const outlines=[];let outline;for(;allEdges.size>0;){const edge=allEdges.values().next().value;let[x,y1,y2,edge1,edge2]=edge;allEdges.delete(edge);let lastPointX=x,lastPointY=y1;for(outline=[x,y2],outlines.push(outline);;){let e;if(allEdges.has(edge1))e=edge1;else{if(!allEdges.has(edge2))break;e=edge2}allEdges.delete(e),[x,y1,y2,edge1,edge2]=e,lastPointX!==x&&(outline.push(lastPointX,lastPointY,x,lastPointY===y1?y1:y2),lastPointX=x),lastPointY=lastPointY===y1?y2:y1}outline.push(lastPointX,lastPointY)}return new HighlightOutline(outlines,this.#box)}#binarySearch(y){const array=this.#intervals;let start=0,end=array.length-1;for(;start<=end;){const middle=start+end>>1,y1=array[middle][0];if(y1===y)return middle;y1<y?start=middle+1:end=middle-1}return end+1}#insert([,y1,y2]){const index=this.#binarySearch(y1);this.#intervals.splice(index,0,[y1,y2])}#remove([,y1,y2]){const index=this.#binarySearch(y1);for(let i=index;i<this.#intervals.length;i++){const[start,end]=this.#intervals[i];if(start!==y1)break;if(start===y1&&end===y2)return void this.#intervals.splice(i,1)}for(let i=index-1;i>=0;i--){const[start,end]=this.#intervals[i];if(start!==y1)break;if(start===y1&&end===y2)return void this.#intervals.splice(i,1)}}#breakEdge(edge){const[x,y1,y2]=edge,results=[[x,y1,y2]],index=this.#binarySearch(y2);for(let i=0;i<index;i++){const[start,end]=this.#intervals[i];for(let j=0,jj=results.length;j<jj;j++){const[,y3,y4]=results[j];if(!(end<=y3||y4<=start))if(y3>=start)if(y4>end)results[j][1]=end;else{if(1===jj)return[];results.splice(j,1),j--,jj--}else results[j][2]=start,y4>end&&results.push([x,end,y4])}}return results}}class HighlightOutline extends Outline{#box;#outlines;constructor(outlines,box){super(),this.#outlines=outlines,this.#box=box}toSVGPath(){const buffer=[];for(const polygon of this.#outlines){let[prevX,prevY]=polygon;buffer.push(`M${prevX} ${prevY}`);for(let i=2;i<polygon.length;i+=2){const x=polygon[i],y=polygon[i+1];x===prevX?(buffer.push(`V${y}`),prevY=y):y===prevY&&(buffer.push(`H${x}`),prevX=x)}buffer.push("Z")}return buffer.join(" ")}serialize([blX,blY,trX,trY],_rotation){const outlines=[],width=trX-blX,height=trY-blY;for(const outline of this.#outlines){const points=new Array(outline.length);for(let i=0;i<outline.length;i+=2)points[i]=blX+outline[i]*width,points[i+1]=trY-outline[i+1]*height;outlines.push(points)}return outlines}get box(){return this.#box}get classNamesForDrawing(){return["highlight"]}get classNamesForOutlining(){return["highlightOutline"]}}class FreeHighlightOutliner extends FreeDrawOutliner{newFreeDrawOutline(outline,points,box,scaleFactor,innerMargin,isLTR){return new FreeHighlightOutline(outline,points,box,scaleFactor,innerMargin,isLTR)}get classNamesForDrawing(){return["highlight","free"]}}class FreeHighlightOutline extends FreeDrawOutline{get classNamesForDrawing(){return["highlight","free"]}get classNamesForOutlining(){return["highlightOutline","free"]}newOutliner(point,box,scaleFactor,thickness,isLTR,innerMargin=0){return new FreeHighlightOutliner(point,box,scaleFactor,thickness,isLTR,innerMargin)}}class ColorPicker{#button=null;#buttonSwatch=null;#defaultColor;#dropdown=null;#dropdownWasFromKeyboard=!1;#isMainColorPicker=!1;#editor=null;#eventBus;#openDropdownAC=null;#uiManager=null;#type;static#l10nColor=null;static get _keyboardManager(){return shadow(this,"_keyboardManager",new KeyboardManager([[["Escape","mac+Escape"],ColorPicker.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],ColorPicker.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],ColorPicker.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],ColorPicker.prototype._moveToPrevious],[["Home","mac+Home"],ColorPicker.prototype._moveToBeginning],[["End","mac+End"],ColorPicker.prototype._moveToEnd]]))}constructor({editor=null,uiManager=null}){editor?(this.#isMainColorPicker=!1,this.#type=AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.#editor=editor):(this.#isMainColorPicker=!0,this.#type=AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR),this.#uiManager=editor?._uiManager||uiManager,this.#eventBus=this.#uiManager._eventBus,this.#defaultColor=editor?.color||this.#uiManager?.highlightColors.values().next().value||"#FFFF98",ColorPicker.#l10nColor||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const button=this.#button=document.createElement("button");button.className="colorPicker",button.tabIndex="0",button.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),button.setAttribute("aria-haspopup",!0);const signal=this.#uiManager._signal;button.addEventListener("click",this.#openDropdown.bind(this),{signal}),button.addEventListener("keydown",this.#keyDown.bind(this),{signal});const swatch=this.#buttonSwatch=document.createElement("span");return swatch.className="swatch",swatch.setAttribute("aria-hidden",!0),swatch.style.backgroundColor=this.#defaultColor,button.append(swatch),button}renderMainDropdown(){const dropdown=this.#dropdown=this.#getDropdownRoot();return dropdown.setAttribute("aria-orientation","horizontal"),dropdown.setAttribute("aria-labelledby","highlightColorPickerLabel"),dropdown}#getDropdownRoot(){const div=document.createElement("div"),signal=this.#uiManager._signal;div.addEventListener("contextmenu",noContextMenu,{signal}),div.className="dropdown",div.role="listbox",div.setAttribute("aria-multiselectable",!1),div.setAttribute("aria-orientation","vertical"),div.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[name,color]of this.#uiManager.highlightColors){const button=document.createElement("button");button.tabIndex="0",button.role="option",button.setAttribute("data-color",color),button.title=name,button.setAttribute("data-l10n-id",ColorPicker.#l10nColor[name]);const swatch=document.createElement("span");button.append(swatch),swatch.className="swatch",swatch.style.backgroundColor=color,button.setAttribute("aria-selected",color===this.#defaultColor),button.addEventListener("click",this.#colorSelect.bind(this,color),{signal}),div.append(button)}return div.addEventListener("keydown",this.#keyDown.bind(this),{signal}),div}#colorSelect(color,event){event.stopPropagation(),this.#eventBus.dispatch("switchannotationeditorparams",{source:this,type:this.#type,value:color})}_colorSelectFromKeyboard(event){if(event.target===this.#button)return void this.#openDropdown(event);const color=event.target.getAttribute("data-color");color&&this.#colorSelect(color,event)}_moveToNext(event){this.#isDropdownVisible?event.target!==this.#button?event.target.nextSibling?.focus():this.#dropdown.firstChild?.focus():this.#openDropdown(event)}_moveToPrevious(event){event.target!==this.#dropdown?.firstChild&&event.target!==this.#button?(this.#isDropdownVisible||this.#openDropdown(event),event.target.previousSibling?.focus()):this.#isDropdownVisible&&this._hideDropdownFromKeyboard()}_moveToBeginning(event){this.#isDropdownVisible?this.#dropdown.firstChild?.focus():this.#openDropdown(event)}_moveToEnd(event){this.#isDropdownVisible?this.#dropdown.lastChild?.focus():this.#openDropdown(event)}#keyDown(event){ColorPicker._keyboardManager.exec(this,event)}#openDropdown(event){if(this.#isDropdownVisible)return void this.hideDropdown();if(this.#dropdownWasFromKeyboard=0===event.detail,this.#openDropdownAC||(this.#openDropdownAC=new AbortController,window.addEventListener("pointerdown",this.#pointerDown.bind(this),{signal:this.#uiManager.combinedSignal(this.#openDropdownAC)})),this.#dropdown)return void this.#dropdown.classList.remove("hidden");const root=this.#dropdown=this.#getDropdownRoot();this.#button.append(root)}#pointerDown(event){this.#dropdown?.contains(event.target)||this.hideDropdown()}hideDropdown(){this.#dropdown?.classList.add("hidden"),this.#openDropdownAC?.abort(),this.#openDropdownAC=null}get#isDropdownVisible(){return this.#dropdown&&!this.#dropdown.classList.contains("hidden")}_hideDropdownFromKeyboard(){this.#isMainColorPicker||(this.#isDropdownVisible?(this.hideDropdown(),this.#button.focus({preventScroll:!0,focusVisible:this.#dropdownWasFromKeyboard})):this.#editor?.unselect())}updateColor(color){if(this.#buttonSwatch&&(this.#buttonSwatch.style.backgroundColor=color),!this.#dropdown)return;const i=this.#uiManager.highlightColors.values();for(const child of this.#dropdown.children)child.setAttribute("aria-selected",i.next().value===color)}destroy(){this.#button?.remove(),this.#button=null,this.#buttonSwatch=null,this.#dropdown?.remove(),this.#dropdown=null}}class HighlightEditor extends AnnotationEditor{#anchorNode=null;#anchorOffset=0;#boxes;#clipPathId=null;#colorPicker=null;#focusOutlines=null;#focusNode=null;#focusOffset=0;#highlightDiv=null;#highlightOutlines=null;#id=null;#isFreeHighlight=!1;#lastPoint=null;#opacity;#outlineId=null;#text="";#thickness;#methodOfCreation="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=AnnotationEditorType.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const proto=HighlightEditor.prototype;return shadow(this,"_keyboardManager",new KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],proto._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],proto._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],proto._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],proto._moveCaret,{args:[3]}]]))}constructor(params){super({...params,name:"highlightEditor"}),this.color=params.color||HighlightEditor._defaultColor,this.#thickness=params.thickness||HighlightEditor._defaultThickness,this.#opacity=params.opacity||HighlightEditor._defaultOpacity,this.#boxes=params.boxes||null,this.#methodOfCreation=params.methodOfCreation||"",this.#text=params.text||"",this._isDraggable=!1,params.highlightId>-1?(this.#isFreeHighlight=!0,this.#createFreeOutlines(params),this.#addToDrawLayer()):this.#boxes&&(this.#anchorNode=params.anchorNode,this.#anchorOffset=params.anchorOffset,this.#focusNode=params.focusNode,this.#focusOffset=params.focusOffset,this.#createOutlines(),this.#addToDrawLayer(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#isFreeHighlight?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#thickness,methodOfCreation:this.#methodOfCreation}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(data){return{numberOfColors:data.get("color").size}}#createOutlines(){const outliner=new HighlightOutliner(this.#boxes,.001);this.#highlightOutlines=outliner.getOutlines(),({x:this.x,y:this.y,width:this.width,height:this.height}=this.#highlightOutlines.box);const outlinerForOutline=new HighlightOutliner(this.#boxes,.0025,.001,"ltr"===this._uiManager.direction);this.#focusOutlines=outlinerForOutline.getOutlines();const{lastPoint}=this.#focusOutlines.box;this.#lastPoint=[(lastPoint[0]-this.x)/this.width,(lastPoint[1]-this.y)/this.height]}#createFreeOutlines({highlightOutlines,highlightId,clipPathId}){this.#highlightOutlines=highlightOutlines;if(this.#focusOutlines=highlightOutlines.getNewOutline(this.#thickness/2+1.5,.0025),highlightId>=0)this.#id=highlightId,this.#clipPathId=clipPathId,this.parent.drawLayer.finalizeLine(highlightId,highlightOutlines),this.#outlineId=this.parent.drawLayer.drawOutline(this.#focusOutlines);else if(this.parent){const angle=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(this.#id,highlightOutlines),this.parent.drawLayer.updateBox(this.#id,HighlightEditor.#rotateBbox(this.#highlightOutlines.box,(angle-this.rotation+360)%360)),this.parent.drawLayer.updateLine(this.#outlineId,this.#focusOutlines),this.parent.drawLayer.updateBox(this.#outlineId,HighlightEditor.#rotateBbox(this.#focusOutlines.box,angle))}const{x,y,width,height}=highlightOutlines.box;switch(this.rotation){case 0:this.x=x,this.y=y,this.width=width,this.height=height;break;case 90:{const[pageWidth,pageHeight]=this.parentDimensions;this.x=y,this.y=1-x,this.width=width*pageHeight/pageWidth,this.height=height*pageWidth/pageHeight;break}case 180:this.x=1-x,this.y=1-y,this.width=width,this.height=height;break;case 270:{const[pageWidth,pageHeight]=this.parentDimensions;this.x=1-y,this.y=x,this.width=width*pageHeight/pageWidth,this.height=height*pageWidth/pageHeight;break}}const{lastPoint}=this.#focusOutlines.box;this.#lastPoint=[(lastPoint[0]-x)/width,(lastPoint[1]-y)/height]}static initialize(l10n,uiManager){AnnotationEditor.initialize(l10n,uiManager),HighlightEditor._defaultColor||=uiManager.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(type,value){switch(type){case AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:HighlightEditor._defaultColor=value;break;case AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:HighlightEditor._defaultThickness=value}}translateInPage(x,y){}get toolbarPosition(){return this.#lastPoint}updateParams(type,value){switch(type){case AnnotationEditorParamsType.HIGHLIGHT_COLOR:this.#updateColor(value);break;case AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:this.#updateThickness(value)}}static get defaultPropertiesToUpdate(){return[[AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR,HighlightEditor._defaultColor],[AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,HighlightEditor._defaultThickness]]}get propertiesToUpdate(){return[[AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.color||HighlightEditor._defaultColor],[AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,this.#thickness||HighlightEditor._defaultThickness],[AnnotationEditorParamsType.HIGHLIGHT_FREE,this.#isFreeHighlight]]}#updateColor(color){const setColorAndOpacity=(col,opa)=>{this.color=col,this.parent?.drawLayer.changeColor(this.#id,col),this.#colorPicker?.updateColor(col),this.#opacity=opa,this.parent?.drawLayer.changeOpacity(this.#id,opa)},savedColor=this.color,savedOpacity=this.#opacity;this.addCommands({cmd:setColorAndOpacity.bind(this,color,HighlightEditor._defaultOpacity),undo:setColorAndOpacity.bind(this,savedColor,savedOpacity),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(color)},!0)}#updateThickness(thickness){const savedThickness=this.#thickness,setThickness=th=>{this.#thickness=th,this.#changeThickness(th)};this.addCommands({cmd:setThickness.bind(this,thickness),undo:setThickness.bind(this,savedThickness),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness},!0)}addEditToolbar(){var _superprop_getAddEditToolbar=()=>super.addEditToolbar,_this40=this;return(0,asyncToGenerator.A)((function*(){const toolbar=yield _superprop_getAddEditToolbar().call(_this40);return toolbar?(_this40._uiManager.highlightColors&&(_this40.#colorPicker=new ColorPicker({editor:_this40}),toolbar.addColorPicker(_this40.#colorPicker)),toolbar):null}))()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#getRotation())}getBaseTranslation(){return[0,0]}getRect(tx,ty){return super.getRect(tx,ty,this.#getRotation())}onceAdded(){this.annotationElementId||this.parent.addUndoableEditor(this),this.div.focus()}remove(){this.#cleanDrawLayer(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.#addToDrawLayer(),this.isAttachedToDOM||this.parent.add(this)))}setParent(parent){let mustBeSelected=!1;this.parent&&!parent?this.#cleanDrawLayer():parent&&(this.#addToDrawLayer(parent),mustBeSelected=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(parent),this.show(this._isVisible),mustBeSelected&&this.select()}#changeThickness(thickness){if(!this.#isFreeHighlight)return;this.#createFreeOutlines({highlightOutlines:this.#highlightOutlines.getNewOutline(thickness/2)}),this.fixAndSetPosition();const[parentWidth,parentHeight]=this.parentDimensions;this.setDims(this.width*parentWidth,this.height*parentHeight)}#cleanDrawLayer(){null!==this.#id&&this.parent&&(this.parent.drawLayer.remove(this.#id),this.#id=null,this.parent.drawLayer.remove(this.#outlineId),this.#outlineId=null)}#addToDrawLayer(parent=this.parent){null===this.#id&&(({id:this.#id,clipPathId:this.#clipPathId}=parent.drawLayer.draw(this.#highlightOutlines,this.color,this.#opacity)),this.#outlineId=parent.drawLayer.drawOutline(this.#focusOutlines),this.#highlightDiv&&(this.#highlightDiv.style.clipPath=this.#clipPathId))}static#rotateBbox({x,y,width,height},angle){switch(angle){case 90:return{x:1-y-height,y:x,width:height,height:width};case 180:return{x:1-x-width,y:1-y-height,width,height};case 270:return{x:y,y:1-x-width,width:height,height:width}}return{x,y,width,height}}rotate(angle){const{drawLayer}=this.parent;let box;this.#isFreeHighlight?(angle=(angle-this.rotation+360)%360,box=HighlightEditor.#rotateBbox(this.#highlightOutlines.box,angle)):box=HighlightEditor.#rotateBbox(this,angle),drawLayer.rotate(this.#id,angle),drawLayer.rotate(this.#outlineId,angle),drawLayer.updateBox(this.#id,box),drawLayer.updateBox(this.#outlineId,HighlightEditor.#rotateBbox(this.#focusOutlines.box,angle))}render(){if(this.div)return this.div;const div=super.render();this.#text&&(div.setAttribute("aria-label",this.#text),div.setAttribute("role","mark")),this.#isFreeHighlight?div.classList.add("free"):this.div.addEventListener("keydown",this.#keydown.bind(this),{signal:this._uiManager._signal});const highlightDiv=this.#highlightDiv=document.createElement("div");div.append(highlightDiv),highlightDiv.setAttribute("aria-hidden","true"),highlightDiv.className="internal",highlightDiv.style.clipPath=this.#clipPathId;const[parentWidth,parentHeight]=this.parentDimensions;return this.setDims(this.width*parentWidth,this.height*parentHeight),bindEvents(this,this.#highlightDiv,["pointerover","pointerleave"]),this.enableEditing(),div}pointerover(){this.isSelected||this.parent.drawLayer.addClass(this.#outlineId,"hovered")}pointerleave(){this.isSelected||this.parent.drawLayer.removeClass(this.#outlineId,"hovered")}#keydown(event){HighlightEditor._keyboardManager.exec(this,event)}_moveCaret(direction){switch(this.parent.unselect(this),direction){case 0:case 2:this.#setCaret(!0);break;case 1:case 3:this.#setCaret(!1)}}#setCaret(start){if(!this.#anchorNode)return;const selection=window.getSelection();start?selection.setPosition(this.#anchorNode,this.#anchorOffset):selection.setPosition(this.#focusNode,this.#focusOffset)}select(){super.select(),this.#outlineId&&(this.parent?.drawLayer.removeClass(this.#outlineId,"hovered"),this.parent?.drawLayer.addClass(this.#outlineId,"selected"))}unselect(){super.unselect(),this.#outlineId&&(this.parent?.drawLayer.removeClass(this.#outlineId,"selected"),this.#isFreeHighlight||this.#setCaret(!1))}get _mustFixPosition(){return!this.#isFreeHighlight}show(visible=this._isVisible){super.show(visible),this.parent&&(this.parent.drawLayer.show(this.#id,visible),this.parent.drawLayer.show(this.#outlineId,visible))}#getRotation(){return this.#isFreeHighlight?this.rotation:0}#serializeBoxes(){if(this.#isFreeHighlight)return null;const[pageWidth,pageHeight]=this.pageDimensions,[pageX,pageY]=this.pageTranslation,boxes=this.#boxes,quadPoints=new Float32Array(8*boxes.length);let i=0;for(const{x,y,width,height}of boxes){const sx=x*pageWidth+pageX,sy=(1-y-height)*pageHeight+pageY;quadPoints[i]=quadPoints[i+4]=sx,quadPoints[i+1]=quadPoints[i+3]=sy,quadPoints[i+2]=quadPoints[i+6]=sx+width*pageWidth,quadPoints[i+5]=quadPoints[i+7]=sy+height*pageHeight,i+=8}return quadPoints}#serializeOutlines(rect){return this.#highlightOutlines.serialize(rect,this.#getRotation())}static startHighlighting(parent,isLTR,{target:textLayer,x,y}){const{x:layerX,y:layerY,width:parentWidth,height:parentHeight}=textLayer.getBoundingClientRect(),ac=new AbortController,signal=parent.combinedSignal(ac),pointerUpCallback=e=>{ac.abort(),this.#endHighlight(parent,e)};window.addEventListener("blur",pointerUpCallback,{signal}),window.addEventListener("pointerup",pointerUpCallback,{signal}),window.addEventListener("pointerdown",(e=>{e.preventDefault(),e.stopPropagation()}),{capture:!0,passive:!1,signal}),window.addEventListener("contextmenu",noContextMenu,{signal}),textLayer.addEventListener("pointermove",this.#highlightMove.bind(this,parent),{signal}),this._freeHighlight=new FreeHighlightOutliner({x,y},[layerX,layerY,parentWidth,parentHeight],parent.scale,this._defaultThickness/2,isLTR,.001),({id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=parent.drawLayer.draw(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0))}static#highlightMove(parent,event){this._freeHighlight.add(event)&&parent.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)}static#endHighlight(parent,event){this._freeHighlight.isEmpty()?parent.drawLayer.remove(this._freeHighlightId):parent.createAndAddNewEditor(event,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static deserialize(data,parent,uiManager){var _superprop_getDeserialize2=()=>super.deserialize,_this41=this;return(0,asyncToGenerator.A)((function*(){let initialData=null;if(data instanceof HighlightAnnotationElement){const{data:{quadPoints,rect,rotation,id,color,opacity,popupRef},parent:{page:{pageNumber}}}=data;initialData=data={annotationType:AnnotationEditorType.HIGHLIGHT,color:Array.from(color),opacity,quadPoints,boxes:null,pageIndex:pageNumber-1,rect:rect.slice(0),rotation,id,deleted:!1,popupRef}}else if(data instanceof InkAnnotationElement){const{data:{inkLists,rect,rotation,id,color,borderStyle:{rawWidth:thickness},popupRef},parent:{page:{pageNumber}}}=data;initialData=data={annotationType:AnnotationEditorType.HIGHLIGHT,color:Array.from(color),thickness,inkLists,boxes:null,pageIndex:pageNumber-1,rect:rect.slice(0),rotation,id,deleted:!1,popupRef}}const{color,quadPoints,inkLists,opacity}=data,editor=yield _superprop_getDeserialize2().call(_this41,data,parent,uiManager);editor.color=Util.makeHexColor(...color),editor.#opacity=opacity||1,inkLists&&(editor.#thickness=data.thickness),editor.annotationElementId=data.id||null,editor._initialData=initialData;const[pageWidth,pageHeight]=editor.pageDimensions,[pageX,pageY]=editor.pageTranslation;if(quadPoints){const boxes=editor.#boxes=[];for(let i=0;i<quadPoints.length;i+=8)boxes.push({x:(quadPoints[i]-pageX)/pageWidth,y:1-(quadPoints[i+1]-pageY)/pageHeight,width:(quadPoints[i+2]-quadPoints[i])/pageWidth,height:(quadPoints[i+1]-quadPoints[i+5])/pageHeight});editor.#createOutlines(),editor.#addToDrawLayer(),editor.rotate(editor.rotation)}else if(inkLists){editor.#isFreeHighlight=!0;const points=inkLists[0],point={x:points[0]-pageX,y:pageHeight-(points[1]-pageY)},outliner=new FreeHighlightOutliner(point,[0,0,pageWidth,pageHeight],1,editor.#thickness/2,!0,.001);for(let i=0,ii=points.length;i<ii;i+=2)point.x=points[i]-pageX,point.y=pageHeight-(points[i+1]-pageY),outliner.add(point);const{id,clipPathId}=parent.drawLayer.draw(outliner,editor.color,editor._defaultOpacity,!0);editor.#createFreeOutlines({highlightOutlines:outliner.getOutlines(),highlightId:id,clipPathId}),editor.#addToDrawLayer()}return editor}))()}serialize(isForCopying=!1){if(this.isEmpty()||isForCopying)return null;if(this.deleted)return this.serializeDeleted();const rect=this.getRect(0,0),color=AnnotationEditor._colorManager.convert(this.color),serialized={annotationType:AnnotationEditorType.HIGHLIGHT,color,opacity:this.#opacity,thickness:this.#thickness,quadPoints:this.#serializeBoxes(),outlines:this.#serializeOutlines(rect),pageIndex:this.pageIndex,rect,rotation:this.#getRotation(),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!this.#hasElementChanged(serialized)?null:(serialized.id=this.annotationElementId,serialized)}#hasElementChanged(serialized){const{color}=this._initialData;return serialized.color.some(((c,i)=>c!==color[i]))}renderAnnotationElement(annotation){return annotation.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}class InkEditor extends AnnotationEditor{#baseHeight=0;#baseWidth=0;#canvasContextMenuTimeoutId=null;#currentPath2D=new Path2D;#disableEditing=!1;#drawingAC=null;#hasSomethingToDraw=!1;#isCanvasInitialized=!1;#observer=null;#pointerdownAC=null;#realWidth=0;#realHeight=0;#requestFrameCallback=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";static _editorType=AnnotationEditorType.INK;constructor(params){super({...params,name:"inkEditor"}),this.color=params.color||null,this.thickness=params.thickness||null,this.opacity=params.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(l10n,uiManager){AnnotationEditor.initialize(l10n,uiManager)}static updateDefaultParams(type,value){switch(type){case AnnotationEditorParamsType.INK_THICKNESS:InkEditor._defaultThickness=value;break;case AnnotationEditorParamsType.INK_COLOR:InkEditor._defaultColor=value;break;case AnnotationEditorParamsType.INK_OPACITY:InkEditor._defaultOpacity=value/100}}updateParams(type,value){switch(type){case AnnotationEditorParamsType.INK_THICKNESS:this.#updateThickness(value);break;case AnnotationEditorParamsType.INK_COLOR:this.#updateColor(value);break;case AnnotationEditorParamsType.INK_OPACITY:this.#updateOpacity(value)}}static get defaultPropertiesToUpdate(){return[[AnnotationEditorParamsType.INK_THICKNESS,InkEditor._defaultThickness],[AnnotationEditorParamsType.INK_COLOR,InkEditor._defaultColor||AnnotationEditor._defaultLineColor],[AnnotationEditorParamsType.INK_OPACITY,Math.round(100*InkEditor._defaultOpacity)]]}get propertiesToUpdate(){return[[AnnotationEditorParamsType.INK_THICKNESS,this.thickness||InkEditor._defaultThickness],[AnnotationEditorParamsType.INK_COLOR,this.color||InkEditor._defaultColor||AnnotationEditor._defaultLineColor],[AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??InkEditor._defaultOpacity))]]}#updateThickness(thickness){const setThickness=th=>{this.thickness=th,this.#fitToContent()},savedThickness=this.thickness;this.addCommands({cmd:setThickness.bind(this,thickness),undo:setThickness.bind(this,savedThickness),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#updateColor(color){const setColor=col=>{this.color=col,this.#redraw()},savedColor=this.color;this.addCommands({cmd:setColor.bind(this,color),undo:setColor.bind(this,savedColor),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#updateOpacity(opacity){const setOpacity=op=>{this.opacity=op,this.#redraw()};opacity/=100;const savedOpacity=this.opacity;this.addCommands({cmd:setOpacity.bind(this,opacity),undo:setOpacity.bind(this,savedOpacity),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.canvas||(this.#createCanvas(),this.#createObserver()),this.isAttachedToDOM||(this.parent.add(this),this.#setCanvasDims()),this.#fitToContent()))}remove(){null!==this.canvas&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#canvasContextMenuTimeoutId&&(clearTimeout(this.#canvasContextMenuTimeoutId),this.#canvasContextMenuTimeoutId=null),this.#observer?.disconnect(),this.#observer=null,super.remove())}setParent(parent){!this.parent&&parent?this._uiManager.removeShouldRescale(this):this.parent&&null===parent&&this._uiManager.addShouldRescale(this),super.setParent(parent)}onScaleChanging(){const[parentWidth,parentHeight]=this.parentDimensions,width=this.width*parentWidth,height=this.height*parentHeight;this.setDimensions(width,height)}enableEditMode(){this.#disableEditing||null===this.canvas||(super.enableEditMode(),this._isDraggable=!1,this.#addPointerdownListener())}disableEditMode(){this.isInEditMode()&&null!==this.canvas&&(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.#removePointerdownListener())}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return 0===this.paths.length||1===this.paths.length&&0===this.paths[0].length}#getInitialBBox(){const{parentRotation,parentDimensions:[width,height]}=this;switch(parentRotation){case 90:return[0,height,height,width];case 180:return[width,height,width,height];case 270:return[width,0,height,width];default:return[0,0,width,height]}}#setStroke(){const{ctx,color,opacity,thickness,parentScale,scaleFactor}=this;ctx.lineWidth=thickness*parentScale/scaleFactor,ctx.lineCap="round",ctx.lineJoin="round",ctx.miterLimit=10,ctx.strokeStyle=`${color}${function opacityToHex(opacity){return Math.round(Math.min(255,Math.max(1,255*opacity))).toString(16).padStart(2,"0")}(opacity)}`}#startDrawing(x,y){this.canvas.addEventListener("contextmenu",noContextMenu,{signal:this._uiManager._signal}),this.#removePointerdownListener(),this.#drawingAC=new AbortController;const signal=this._uiManager.combinedSignal(this.#drawingAC);this.canvas.addEventListener("pointerleave",this.canvasPointerleave.bind(this),{signal}),this.canvas.addEventListener("pointermove",this.canvasPointermove.bind(this),{signal}),this.canvas.addEventListener("pointerup",this.canvasPointerup.bind(this),{signal}),this.isEditing=!0,this.#isCanvasInitialized||(this.#isCanvasInitialized=!0,this.#setCanvasDims(),this.thickness||=InkEditor._defaultThickness,this.color||=InkEditor._defaultColor||AnnotationEditor._defaultLineColor,this.opacity??=InkEditor._defaultOpacity),this.currentPath.push([x,y]),this.#hasSomethingToDraw=!1,this.#setStroke(),this.#requestFrameCallback=()=>{this.#drawPoints(),this.#requestFrameCallback&&window.requestAnimationFrame(this.#requestFrameCallback)},window.requestAnimationFrame(this.#requestFrameCallback)}#draw(x,y){const[lastX,lastY]=this.currentPath.at(-1);if(this.currentPath.length>1&&x===lastX&&y===lastY)return;const currentPath=this.currentPath;let path2D=this.#currentPath2D;if(currentPath.push([x,y]),this.#hasSomethingToDraw=!0,currentPath.length<=2)return path2D.moveTo(...currentPath[0]),void path2D.lineTo(x,y);3===currentPath.length&&(this.#currentPath2D=path2D=new Path2D,path2D.moveTo(...currentPath[0])),this.#makeBezierCurve(path2D,...currentPath.at(-3),...currentPath.at(-2),x,y)}#endPath(){if(0===this.currentPath.length)return;const lastPoint=this.currentPath.at(-1);this.#currentPath2D.lineTo(...lastPoint)}#stopDrawing(x,y){let bezier;if(this.#requestFrameCallback=null,x=Math.min(Math.max(x,0),this.canvas.width),y=Math.min(Math.max(y,0),this.canvas.height),this.#draw(x,y),this.#endPath(),1!==this.currentPath.length)bezier=this.#generateBezierPoints();else{const xy=[x,y];bezier=[[xy,xy.slice(),xy.slice(),xy]]}const path2D=this.#currentPath2D,currentPath=this.currentPath;this.currentPath=[],this.#currentPath2D=new Path2D;this.addCommands({cmd:()=>{this.allRawPaths.push(currentPath),this.paths.push(bezier),this.bezierPath2D.push(path2D),this._uiManager.rebuild(this)},undo:()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),0===this.paths.length?this.remove():(this.canvas||(this.#createCanvas(),this.#createObserver()),this.#fitToContent())},mustExec:!0})}#drawPoints(){if(!this.#hasSomethingToDraw)return;this.#hasSomethingToDraw=!1;const thickness=Math.ceil(this.thickness*this.parentScale),lastPoints=this.currentPath.slice(-3),x=lastPoints.map((xy=>xy[0])),y=lastPoints.map((xy=>xy[1])),{ctx}=(Math.min(...x),Math.max(...x),Math.min(...y),Math.max(...y),this);ctx.save(),ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(const path of this.bezierPath2D)ctx.stroke(path);ctx.stroke(this.#currentPath2D),ctx.restore()}#makeBezierCurve(path2D,x0,y0,x1,y1,x2,y2){const prevX=(x0+x1)/2,prevY=(y0+y1)/2,x3=(x1+x2)/2,y3=(y1+y2)/2;path2D.bezierCurveTo(prevX+2*(x1-prevX)/3,prevY+2*(y1-prevY)/3,x3+2*(x1-x3)/3,y3+2*(y1-y3)/3,x3,y3)}#generateBezierPoints(){const path=this.currentPath;if(path.length<=2)return[[path[0],path[0],path.at(-1),path.at(-1)]];const bezierPoints=[];let i,[x0,y0]=path[0];for(i=1;i<path.length-2;i++){const[x1,y1]=path[i],[x2,y2]=path[i+1],x3=(x1+x2)/2,y3=(y1+y2)/2,control1=[x0+2*(x1-x0)/3,y0+2*(y1-y0)/3],control2=[x3+2*(x1-x3)/3,y3+2*(y1-y3)/3];bezierPoints.push([[x0,y0],control1,control2,[x3,y3]]),[x0,y0]=[x3,y3]}const[x1,y1]=path[i],[x2,y2]=path[i+1],control1=[x0+2*(x1-x0)/3,y0+2*(y1-y0)/3],control2=[x2+2*(x1-x2)/3,y2+2*(y1-y2)/3];return bezierPoints.push([[x0,y0],control1,control2,[x2,y2]]),bezierPoints}#redraw(){if(this.isEmpty())return void this.#updateTransform();this.#setStroke();const{canvas,ctx}=this;ctx.setTransform(1,0,0,1,0,0),ctx.clearRect(0,0,canvas.width,canvas.height),this.#updateTransform();for(const path of this.bezierPath2D)ctx.stroke(path)}commit(){this.#disableEditing||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#disableEditing=!0,this.div.classList.add("disabled"),this.#fitToContent(!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(event){this._focusEventsAllowed&&(super.focusin(event),this.enableEditMode())}#addPointerdownListener(){if(this.#pointerdownAC)return;this.#pointerdownAC=new AbortController;const signal=this._uiManager.combinedSignal(this.#pointerdownAC);this.canvas.addEventListener("pointerdown",this.canvasPointerdown.bind(this),{signal})}#removePointerdownListener(){this.pointerdownAC?.abort(),this.pointerdownAC=null}canvasPointerdown(event){0===event.button&&this.isInEditMode()&&!this.#disableEditing&&(this.setInForeground(),event.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),this.#startDrawing(event.offsetX,event.offsetY))}canvasPointermove(event){event.preventDefault(),this.#draw(event.offsetX,event.offsetY)}canvasPointerup(event){event.preventDefault(),this.#endDrawing(event)}canvasPointerleave(event){this.#endDrawing(event)}#endDrawing(event){this.#drawingAC?.abort(),this.#drawingAC=null,this.#addPointerdownListener(),this.#canvasContextMenuTimeoutId&&clearTimeout(this.#canvasContextMenuTimeoutId),this.#canvasContextMenuTimeoutId=setTimeout((()=>{this.#canvasContextMenuTimeoutId=null,this.canvas.removeEventListener("contextmenu",noContextMenu)}),10),this.#stopDrawing(event.offsetX,event.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#createCanvas(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#createObserver(){this.#observer=new ResizeObserver((entries=>{const rect=entries[0].contentRect;rect.width&&rect.height&&this.setDimensions(rect.width,rect.height)})),this.#observer.observe(this.div),this._uiManager._signal.addEventListener("abort",(()=>{this.#observer?.disconnect(),this.#observer=null}),{once:!0})}get isResizable(){return!this.isEmpty()&&this.#disableEditing}render(){if(this.div)return this.div;let baseX,baseY;this.width&&(baseX=this.x,baseY=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");const[x,y,w,h]=this.#getInitialBBox();if(this.setAt(x,y,0,0),this.setDims(w,h),this.#createCanvas(),this.width){const[parentWidth,parentHeight]=this.parentDimensions;this.setAspectRatio(this.width*parentWidth,this.height*parentHeight),this.setAt(baseX*parentWidth,baseY*parentHeight,this.width*parentWidth,this.height*parentHeight),this.#isCanvasInitialized=!0,this.#setCanvasDims(),this.setDims(this.width*parentWidth,this.height*parentHeight),this.#redraw(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#createObserver(),this.div}#setCanvasDims(){if(!this.#isCanvasInitialized)return;const[parentWidth,parentHeight]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*parentWidth),this.canvas.height=Math.ceil(this.height*parentHeight),this.#updateTransform()}setDimensions(width,height){const roundedWidth=Math.round(width),roundedHeight=Math.round(height);if(this.#realWidth===roundedWidth&&this.#realHeight===roundedHeight)return;this.#realWidth=roundedWidth,this.#realHeight=roundedHeight,this.canvas.style.visibility="hidden";const[parentWidth,parentHeight]=this.parentDimensions;this.width=width/parentWidth,this.height=height/parentHeight,this.fixAndSetPosition(),this.#disableEditing&&this.#setScaleFactor(width,height),this.#setCanvasDims(),this.#redraw(),this.canvas.style.visibility="visible",this.fixDims()}#setScaleFactor(width,height){const padding=this.#getPadding(),scaleFactorW=(width-padding)/this.#baseWidth,scaleFactorH=(height-padding)/this.#baseHeight;this.scaleFactor=Math.min(scaleFactorW,scaleFactorH)}#updateTransform(){const padding=this.#getPadding()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+padding,this.translationY*this.scaleFactor+padding)}static#buildPath2D(bezier){const path2D=new Path2D;for(let i=0,ii=bezier.length;i<ii;i++){const[first,control1,control2,second]=bezier[i];0===i&&path2D.moveTo(...first),path2D.bezierCurveTo(control1[0],control1[1],control2[0],control2[1],second[0],second[1])}return path2D}static#toPDFCoordinates(points,rect,rotation){const[blX,blY,trX,trY]=rect;switch(rotation){case 0:for(let i=0,ii=points.length;i<ii;i+=2)points[i]+=blX,points[i+1]=trY-points[i+1];break;case 90:for(let i=0,ii=points.length;i<ii;i+=2){const x=points[i];points[i]=points[i+1]+blX,points[i+1]=x+blY}break;case 180:for(let i=0,ii=points.length;i<ii;i+=2)points[i]=trX-points[i],points[i+1]+=blY;break;case 270:for(let i=0,ii=points.length;i<ii;i+=2){const x=points[i];points[i]=trX-points[i+1],points[i+1]=trY-x}break;default:throw new Error("Invalid rotation")}return points}static#fromPDFCoordinates(points,rect,rotation){const[blX,blY,trX,trY]=rect;switch(rotation){case 0:for(let i=0,ii=points.length;i<ii;i+=2)points[i]-=blX,points[i+1]=trY-points[i+1];break;case 90:for(let i=0,ii=points.length;i<ii;i+=2){const x=points[i];points[i]=points[i+1]-blY,points[i+1]=x-blX}break;case 180:for(let i=0,ii=points.length;i<ii;i+=2)points[i]=trX-points[i],points[i+1]-=blY;break;case 270:for(let i=0,ii=points.length;i<ii;i+=2){const x=points[i];points[i]=trY-points[i+1],points[i+1]=trX-x}break;default:throw new Error("Invalid rotation")}return points}#serializePaths(s,tx,ty,rect){const paths=[],padding=this.thickness/2,shiftX=s*tx+padding,shiftY=s*ty+padding;for(const bezier of this.paths){const buffer=[],points=[];for(let j=0,jj=bezier.length;j<jj;j++){const[first,control1,control2,second]=bezier[j];if(first[0]===second[0]&&first[1]===second[1]&&1===jj){const p0=s*first[0]+shiftX,p1=s*first[1]+shiftY;buffer.push(p0,p1),points.push(p0,p1);break}const p10=s*first[0]+shiftX,p11=s*first[1]+shiftY,p20=s*control1[0]+shiftX,p21=s*control1[1]+shiftY,p30=s*control2[0]+shiftX,p31=s*control2[1]+shiftY,p40=s*second[0]+shiftX,p41=s*second[1]+shiftY;0===j&&(buffer.push(p10,p11),points.push(p10,p11)),buffer.push(p20,p21,p30,p31,p40,p41),points.push(p20,p21),j===jj-1&&points.push(p40,p41)}paths.push({bezier:InkEditor.#toPDFCoordinates(buffer,rect,this.rotation),points:InkEditor.#toPDFCoordinates(points,rect,this.rotation)})}return paths}#getBbox(){let xMin=1/0,xMax=-1/0,yMin=1/0,yMax=-1/0;for(const path of this.paths)for(const[first,control1,control2,second]of path){const bbox=Util.bezierBoundingBox(...first,...control1,...control2,...second);xMin=Math.min(xMin,bbox[0]),yMin=Math.min(yMin,bbox[1]),xMax=Math.max(xMax,bbox[2]),yMax=Math.max(yMax,bbox[3])}return[xMin,yMin,xMax,yMax]}#getPadding(){return this.#disableEditing?Math.ceil(this.thickness*this.parentScale):0}#fitToContent(firstTime=!1){if(this.isEmpty())return;if(!this.#disableEditing)return void this.#redraw();const bbox=this.#getBbox(),padding=this.#getPadding();this.#baseWidth=Math.max(AnnotationEditor.MIN_SIZE,bbox[2]-bbox[0]),this.#baseHeight=Math.max(AnnotationEditor.MIN_SIZE,bbox[3]-bbox[1]);const width=Math.ceil(padding+this.#baseWidth*this.scaleFactor),height=Math.ceil(padding+this.#baseHeight*this.scaleFactor),[parentWidth,parentHeight]=this.parentDimensions;this.width=width/parentWidth,this.height=height/parentHeight,this.setAspectRatio(width,height);const prevTranslationX=this.translationX,prevTranslationY=this.translationY;this.translationX=-bbox[0],this.translationY=-bbox[1],this.#setCanvasDims(),this.#redraw(),this.#realWidth=width,this.#realHeight=height,this.setDims(width,height);const unscaledPadding=firstTime?padding/this.scaleFactor/2:0;this.translate(prevTranslationX-this.translationX-unscaledPadding,prevTranslationY-this.translationY-unscaledPadding)}static deserialize(data,parent,uiManager){var _superprop_getDeserialize3=()=>super.deserialize,_this42=this;return(0,asyncToGenerator.A)((function*(){if(data instanceof InkAnnotationElement)return null;const editor=yield _superprop_getDeserialize3().call(_this42,data,parent,uiManager);editor.thickness=data.thickness,editor.color=Util.makeHexColor(...data.color),editor.opacity=data.opacity;const[pageWidth,pageHeight]=editor.pageDimensions,width=editor.width*pageWidth,height=editor.height*pageHeight,scaleFactor=editor.parentScale,padding=data.thickness/2;editor.#disableEditing=!0,editor.#realWidth=Math.round(width),editor.#realHeight=Math.round(height);const{paths,rect,rotation}=data;for(let{bezier}of paths){bezier=InkEditor.#fromPDFCoordinates(bezier,rect,rotation);const path=[];editor.paths.push(path);let p0=scaleFactor*(bezier[0]-padding),p1=scaleFactor*(bezier[1]-padding);for(let i=2,ii=bezier.length;i<ii;i+=6){const p10=scaleFactor*(bezier[i]-padding),p11=scaleFactor*(bezier[i+1]-padding),p20=scaleFactor*(bezier[i+2]-padding),p21=scaleFactor*(bezier[i+3]-padding),p30=scaleFactor*(bezier[i+4]-padding),p31=scaleFactor*(bezier[i+5]-padding);path.push([[p0,p1],[p10,p11],[p20,p21],[p30,p31]]),p0=p30,p1=p31}const path2D=_this42.#buildPath2D(path);editor.bezierPath2D.push(path2D)}const bbox=editor.#getBbox();return editor.#baseWidth=Math.max(AnnotationEditor.MIN_SIZE,bbox[2]-bbox[0]),editor.#baseHeight=Math.max(AnnotationEditor.MIN_SIZE,bbox[3]-bbox[1]),editor.#setScaleFactor(width,height),editor}))()}serialize(){if(this.isEmpty())return null;const rect=this.getRect(0,0),color=AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:AnnotationEditorType.INK,color,thickness:this.thickness,opacity:this.opacity,paths:this.#serializePaths(this.scaleFactor/this.parentScale,this.translationX,this.translationY,rect),pageIndex:this.pageIndex,rect,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}class StampEditor extends AnnotationEditor{#bitmap=null;#bitmapId=null;#bitmapPromise=null;#bitmapUrl=null;#bitmapFile=null;#bitmapFileName="";#canvas=null;#observer=null;#resizeTimeoutId=null;#isSvg=!1;#hasBeenAddedInUndoStack=!1;static _type="stamp";static _editorType=AnnotationEditorType.STAMP;constructor(params){super({...params,name:"stampEditor"}),this.#bitmapUrl=params.bitmapUrl,this.#bitmapFile=params.bitmapFile}static initialize(l10n,uiManager){AnnotationEditor.initialize(l10n,uiManager)}static get supportedTypes(){return shadow(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map((type=>`image/${type}`)))}static get supportedTypesStr(){return shadow(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(mime){return this.supportedTypes.includes(mime)}static paste(item,parent){parent.pasteEditor(AnnotationEditorType.STAMP,{bitmapFile:item.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(data){const hasAltTextStats=data.get("hasAltText");return{hasAltText:hasAltTextStats.get(!0)??0,hasNoAltText:hasAltTextStats.get(!1)??0}}#getBitmapFetched(data,fromId=!1){data?(this.#bitmap=data.bitmap,fromId||(this.#bitmapId=data.id,this.#isSvg=data.isSvg),data.file&&(this.#bitmapFileName=data.file.name),this.#createCanvas()):this.remove()}#getBitmapDone(){if(this.#bitmapPromise=null,this._uiManager.enableWaiting(!1),this.#canvas){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#bitmap)return this._editToolbar.hide(),void this._uiManager.editAltText(this,!0);if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#bitmap){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}mlGuessAltText(imageData=null,updateAltTextData=!0){var _this43=this;return(0,asyncToGenerator.A)((function*(){if(_this43.hasAltTextData())return null;const{mlManager}=_this43._uiManager;if(!mlManager)throw new Error("No ML.");if(!(yield mlManager.isEnabledFor("altText")))throw new Error("ML isn't enabled for alt text.");const{data,width,height}=imageData||_this43.copyCanvas(null,null,!0).imageData,response=yield mlManager.guess({name:"altText",request:{data,width,height,channels:data.length/(width*height)}});if(!response)throw new Error("No response from the AI service.");if(response.error)throw new Error("Error from the AI service.");if(response.cancel)return null;if(!response.output)throw new Error("No valid response from the AI service.");const altText=response.output;return yield _this43.setGuessedAltText(altText),updateAltTextData&&!_this43.hasAltTextData()&&(_this43.altTextData={alt:altText,decorative:!1}),altText}))()}#getBitmap(){var _this44=this;if(this.#bitmapId)return this._uiManager.enableWaiting(!0),void this._uiManager.imageManager.getFromId(this.#bitmapId).then((data=>this.#getBitmapFetched(data,!0))).finally((()=>this.#getBitmapDone()));if(this.#bitmapUrl){const url=this.#bitmapUrl;return this.#bitmapUrl=null,this._uiManager.enableWaiting(!0),void(this.#bitmapPromise=this._uiManager.imageManager.getFromUrl(url).then((data=>this.#getBitmapFetched(data))).finally((()=>this.#getBitmapDone())))}if(this.#bitmapFile){const file=this.#bitmapFile;return this.#bitmapFile=null,this._uiManager.enableWaiting(!0),void(this.#bitmapPromise=this._uiManager.imageManager.getFromFile(file).then((data=>this.#getBitmapFetched(data))).finally((()=>this.#getBitmapDone())))}const input=document.createElement("input");input.type="file",input.accept=StampEditor.supportedTypesStr;const signal=this._uiManager._signal;this.#bitmapPromise=new Promise((resolve=>{input.addEventListener("change",(0,asyncToGenerator.A)((function*(){if(input.files&&0!==input.files.length){_this44._uiManager.enableWaiting(!0);const data=yield _this44._uiManager.imageManager.getFromFile(input.files[0]);_this44._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:_this44._uiManager.useNewAltTextFlow}}),_this44.#getBitmapFetched(data)}else _this44.remove();resolve()})),{signal}),input.addEventListener("cancel",(()=>{this.remove(),resolve()}),{signal})})).finally((()=>this.#getBitmapDone())),input.click()}remove(){this.#bitmapId&&(this.#bitmap=null,this._uiManager.imageManager.deleteId(this.#bitmapId),this.#canvas?.remove(),this.#canvas=null,this.#observer?.disconnect(),this.#observer=null,this.#resizeTimeoutId&&(clearTimeout(this.#resizeTimeoutId),this.#resizeTimeoutId=null)),super.remove()}rebuild(){this.parent?(super.rebuild(),null!==this.div&&(this.#bitmapId&&null===this.#canvas&&this.#getBitmap(),this.isAttachedToDOM||this.parent.add(this))):this.#bitmapId&&this.#getBitmap()}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#bitmapPromise||this.#bitmap||this.#bitmapUrl||this.#bitmapFile||this.#bitmapId)}get isResizable(){return!0}render(){if(this.div)return this.div;let baseX,baseY;if(this.width&&(baseX=this.x,baseY=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),this.#bitmap?this.#createCanvas():this.#getBitmap(),this.width&&!this.annotationElementId){const[parentWidth,parentHeight]=this.parentDimensions;this.setAt(baseX*parentWidth,baseY*parentHeight,this.width*parentWidth,this.height*parentHeight)}return this.div}#createCanvas(){const{div}=this;let{width,height}=this.#bitmap;const[pageWidth,pageHeight]=this.pageDimensions;if(this.width)width=this.width*pageWidth,height=this.height*pageHeight;else if(width>.75*pageWidth||height>.75*pageHeight){const factor=Math.min(.75*pageWidth/width,.75*pageHeight/height);width*=factor,height*=factor}const[parentWidth,parentHeight]=this.parentDimensions;this.setDims(width*parentWidth/pageWidth,height*parentHeight/pageHeight),this._uiManager.enableWaiting(!1);const canvas=this.#canvas=document.createElement("canvas");canvas.setAttribute("role","img"),this.addContainer(canvas),this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&!this.annotationElementId||(div.hidden=!1),this.#drawBitmap(width,height),this.#createObserver(),this.#hasBeenAddedInUndoStack||(this.parent.addUndoableEditor(this),this.#hasBeenAddedInUndoStack=!0),this._reportTelemetry({action:"inserted_image"}),this.#bitmapFileName&&canvas.setAttribute("aria-label",this.#bitmapFileName)}copyCanvas(maxDataDimension,maxPreviewDimension,createImageData=!1){maxDataDimension||(maxDataDimension=224);const{width:bitmapWidth,height:bitmapHeight}=this.#bitmap,outputScale=new OutputScale;let bitmap=this.#bitmap,width=bitmapWidth,height=bitmapHeight,canvas=null;if(maxPreviewDimension){if(bitmapWidth>maxPreviewDimension||bitmapHeight>maxPreviewDimension){const ratio=Math.min(maxPreviewDimension/bitmapWidth,maxPreviewDimension/bitmapHeight);width=Math.floor(bitmapWidth*ratio),height=Math.floor(bitmapHeight*ratio)}canvas=document.createElement("canvas");const scaledWidth=canvas.width=Math.ceil(width*outputScale.sx),scaledHeight=canvas.height=Math.ceil(height*outputScale.sy);this.#isSvg||(bitmap=this.#scaleBitmap(scaledWidth,scaledHeight));const ctx=canvas.getContext("2d");ctx.filter=this._uiManager.hcmFilter;let white="white",black="#cfcfd8";"none"!==this._uiManager.hcmFilter?black="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(white="#8f8f9d",black="#42414d");const boxDim=15,boxDimWidth=boxDim*outputScale.sx,boxDimHeight=boxDim*outputScale.sy,pattern=new OffscreenCanvas(2*boxDimWidth,2*boxDimHeight),patternCtx=pattern.getContext("2d");patternCtx.fillStyle=white,patternCtx.fillRect(0,0,2*boxDimWidth,2*boxDimHeight),patternCtx.fillStyle=black,patternCtx.fillRect(0,0,boxDimWidth,boxDimHeight),patternCtx.fillRect(boxDimWidth,boxDimHeight,boxDimWidth,boxDimHeight),ctx.fillStyle=ctx.createPattern(pattern,"repeat"),ctx.fillRect(0,0,scaledWidth,scaledHeight),ctx.drawImage(bitmap,0,0,bitmap.width,bitmap.height,0,0,scaledWidth,scaledHeight)}let imageData=null;if(createImageData){let dataWidth,dataHeight;if(outputScale.symmetric&&bitmap.width<maxDataDimension&&bitmap.height<maxDataDimension)dataWidth=bitmap.width,dataHeight=bitmap.height;else if(bitmap=this.#bitmap,bitmapWidth>maxDataDimension||bitmapHeight>maxDataDimension){const ratio=Math.min(maxDataDimension/bitmapWidth,maxDataDimension/bitmapHeight);dataWidth=Math.floor(bitmapWidth*ratio),dataHeight=Math.floor(bitmapHeight*ratio),this.#isSvg||(bitmap=this.#scaleBitmap(dataWidth,dataHeight))}const offscreenCtx=new OffscreenCanvas(dataWidth,dataHeight).getContext("2d",{willReadFrequently:!0});offscreenCtx.drawImage(bitmap,0,0,bitmap.width,bitmap.height,0,0,dataWidth,dataHeight),imageData={width:dataWidth,height:dataHeight,data:offscreenCtx.getImageData(0,0,dataWidth,dataHeight).data}}return{canvas,width,height,imageData}}#setDimensions(width,height){const[parentWidth,parentHeight]=this.parentDimensions;this.width=width/parentWidth,this.height=height/parentHeight,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,null!==this.#resizeTimeoutId&&clearTimeout(this.#resizeTimeoutId);this.#resizeTimeoutId=setTimeout((()=>{this.#resizeTimeoutId=null,this.#drawBitmap(width,height)}),200)}#scaleBitmap(width,height){const{width:bitmapWidth,height:bitmapHeight}=this.#bitmap;let newWidth=bitmapWidth,newHeight=bitmapHeight,bitmap=this.#bitmap;for(;newWidth>2*width||newHeight>2*height;){const prevWidth=newWidth,prevHeight=newHeight;newWidth>2*width&&(newWidth=newWidth>=16384?Math.floor(newWidth/2)-1:Math.ceil(newWidth/2)),newHeight>2*height&&(newHeight=newHeight>=16384?Math.floor(newHeight/2)-1:Math.ceil(newHeight/2));const offscreen=new OffscreenCanvas(newWidth,newHeight);offscreen.getContext("2d").drawImage(bitmap,0,0,prevWidth,prevHeight,0,0,newWidth,newHeight),bitmap=offscreen.transferToImageBitmap()}return bitmap}#drawBitmap(width,height){const outputScale=new OutputScale,scaledWidth=Math.ceil(width*outputScale.sx),scaledHeight=Math.ceil(height*outputScale.sy),canvas=this.#canvas;if(!canvas||canvas.width===scaledWidth&&canvas.height===scaledHeight)return;canvas.width=scaledWidth,canvas.height=scaledHeight;const bitmap=this.#isSvg?this.#bitmap:this.#scaleBitmap(scaledWidth,scaledHeight),ctx=canvas.getContext("2d");ctx.filter=this._uiManager.hcmFilter,ctx.drawImage(bitmap,0,0,bitmap.width,bitmap.height,0,0,scaledWidth,scaledHeight)}getImageForAltText(){return this.#canvas}#serializeBitmap(toUrl){if(toUrl){if(this.#isSvg){const url=this._uiManager.imageManager.getSvgUrl(this.#bitmapId);if(url)return url}const canvas=document.createElement("canvas");({width:canvas.width,height:canvas.height}=this.#bitmap);return canvas.getContext("2d").drawImage(this.#bitmap,0,0),canvas.toDataURL()}if(this.#isSvg){const[pageWidth,pageHeight]=this.pageDimensions,width=Math.round(this.width*pageWidth*PixelsPerInch.PDF_TO_CSS_UNITS),height=Math.round(this.height*pageHeight*PixelsPerInch.PDF_TO_CSS_UNITS),offscreen=new OffscreenCanvas(width,height);return offscreen.getContext("2d").drawImage(this.#bitmap,0,0,this.#bitmap.width,this.#bitmap.height,0,0,width,height),offscreen.transferToImageBitmap()}return structuredClone(this.#bitmap)}#createObserver(){this._uiManager._signal&&(this.#observer=new ResizeObserver((entries=>{const rect=entries[0].contentRect;rect.width&&rect.height&&this.#setDimensions(rect.width,rect.height)})),this.#observer.observe(this.div),this._uiManager._signal.addEventListener("abort",(()=>{this.#observer?.disconnect(),this.#observer=null}),{once:!0}))}static deserialize(data,parent,uiManager){var _superprop_getDeserialize4=()=>super.deserialize,_this45=this;return(0,asyncToGenerator.A)((function*(){let initialData=null;if(data instanceof StampAnnotationElement){const{data:{rect,rotation,id,structParent,popupRef},container,parent:{page:{pageNumber}}}=data,canvas=container.querySelector("canvas"),imageData=uiManager.imageManager.getFromCanvas(container.id,canvas);canvas.remove();const altText=(yield parent._structTree.getAriaAttributes(`pdfjs_internal_id_${id}`))?.get("aria-label")||"";initialData=data={annotationType:AnnotationEditorType.STAMP,bitmapId:imageData.id,bitmap:imageData.bitmap,pageIndex:pageNumber-1,rect:rect.slice(0),rotation,id,deleted:!1,accessibilityData:{decorative:!1,altText},isSvg:!1,structParent,popupRef}}const editor=yield _superprop_getDeserialize4().call(_this45,data,parent,uiManager),{rect,bitmap,bitmapUrl,bitmapId,isSvg,accessibilityData}=data;bitmapId&&uiManager.imageManager.isValidId(bitmapId)?(editor.#bitmapId=bitmapId,bitmap&&(editor.#bitmap=bitmap)):editor.#bitmapUrl=bitmapUrl,editor.#isSvg=isSvg;const[parentWidth,parentHeight]=editor.pageDimensions;return editor.width=(rect[2]-rect[0])/parentWidth,editor.height=(rect[3]-rect[1])/parentHeight,editor.annotationElementId=data.id||null,accessibilityData&&(editor.altTextData=accessibilityData),editor._initialData=initialData,editor.#hasBeenAddedInUndoStack=!!initialData,editor}))()}serialize(isForCopying=!1,context=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const serialized={annotationType:AnnotationEditorType.STAMP,bitmapId:this.#bitmapId,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#isSvg,structTreeParentId:this._structTreeParentId};if(isForCopying)return serialized.bitmapUrl=this.#serializeBitmap(!0),serialized.accessibilityData=this.serializeAltText(!0),serialized;const{decorative,altText}=this.serializeAltText(!1);if(!decorative&&altText&&(serialized.accessibilityData={type:"Figure",alt:altText}),this.annotationElementId){const changes=this.#hasElementChanged(serialized);if(changes.isSame)return null;changes.isSameAltText?delete serialized.accessibilityData:serialized.accessibilityData.structParent=this._initialData.structParent??-1}if(serialized.id=this.annotationElementId,null===context)return serialized;context.stamps||=new Map;const area=this.#isSvg?(serialized.rect[2]-serialized.rect[0])*(serialized.rect[3]-serialized.rect[1]):null;if(context.stamps.has(this.#bitmapId)){if(this.#isSvg){const prevData=context.stamps.get(this.#bitmapId);area>prevData.area&&(prevData.area=area,prevData.serialized.bitmap.close(),prevData.serialized.bitmap=this.#serializeBitmap(!1))}}else context.stamps.set(this.#bitmapId,{area,serialized}),serialized.bitmap=this.#serializeBitmap(!1);return serialized}#hasElementChanged(serialized){const{rect,pageIndex,accessibilityData:{altText}}=this._initialData,isSameRect=serialized.rect.every(((x,i)=>Math.abs(x-rect[i])<1)),isSamePageIndex=serialized.pageIndex===pageIndex,isSameAltText=(serialized.accessibilityData?.alt||"")===altText;return{isSame:isSameRect&&isSamePageIndex&&isSameAltText,isSameAltText}}renderAnnotationElement(annotation){return annotation.updateEdited({rect:this.getRect(0,0)}),null}}class AnnotationEditorLayer{#accessibilityManager;#allowClick=!1;#annotationLayer=null;#clickAC=null;#editorFocusTimeoutId=null;#editors=new Map;#hadPointerDown=!1;#isCleaningUp=!1;#isDisabling=!1;#textLayer=null;#textSelectionAC=null;#uiManager;static _initialized=!1;static#editorTypes=new Map([FreeTextEditor,InkEditor,StampEditor,HighlightEditor].map((type=>[type._editorType,type])));constructor({uiManager,pageIndex,div,structTreeLayer,accessibilityManager,annotationLayer,drawLayer,textLayer,viewport,l10n}){const editorTypes=[...AnnotationEditorLayer.#editorTypes.values()];if(!AnnotationEditorLayer._initialized){AnnotationEditorLayer._initialized=!0;for(const editorType of editorTypes)editorType.initialize(l10n,uiManager)}uiManager.registerEditorTypes(editorTypes),this.#uiManager=uiManager,this.pageIndex=pageIndex,this.div=div,this.#accessibilityManager=accessibilityManager,this.#annotationLayer=annotationLayer,this.viewport=viewport,this.#textLayer=textLayer,this.drawLayer=drawLayer,this._structTree=structTreeLayer,this.#uiManager.addLayer(this)}get isEmpty(){return 0===this.#editors.size}get isInvisible(){return this.isEmpty&&this.#uiManager.getMode()===AnnotationEditorType.NONE}updateToolbar(mode){this.#uiManager.updateToolbar(mode)}updateMode(mode=this.#uiManager.getMode()){switch(this.#cleanup(),mode){case AnnotationEditorType.NONE:return this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),void this.disableClick();case AnnotationEditorType.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case AnnotationEditorType.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList}=this.div;for(const editorType of AnnotationEditorLayer.#editorTypes.values())classList.toggle(`${editorType._type}Editing`,mode===editorType._editorType);this.div.hidden=!1}hasTextLayer(textLayer){return textLayer===this.#textLayer?.div}addInkEditorIfNeeded(isCommitting){if(this.#uiManager.getMode()!==AnnotationEditorType.INK)return;if(!isCommitting)for(const editor of this.#editors.values())if(editor.isEmpty())return void editor.setInBackground();this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(isEditing){this.#uiManager.setEditingState(isEditing)}addCommands(params){this.#uiManager.addCommands(params)}toggleDrawing(enabled=!1){this.div.classList.toggle("drawing",!enabled)}togglePointerEvents(enabled=!1){this.div.classList.toggle("disabled",!enabled)}toggleAnnotationLayerPointerEvents(enabled=!1){this.#annotationLayer?.div.classList.toggle("disabled",!enabled)}enable(){var _this46=this;return(0,asyncToGenerator.A)((function*(){_this46.div.tabIndex=0,_this46.togglePointerEvents(!0);const annotationElementIds=new Set;for(const editor of _this46.#editors.values())editor.enableEditing(),editor.show(!0),editor.annotationElementId&&(_this46.#uiManager.removeChangedExistingAnnotation(editor),annotationElementIds.add(editor.annotationElementId));if(!_this46.#annotationLayer)return;const editables=_this46.#annotationLayer.getEditableAnnotations();for(const editable of editables){if(editable.hide(),_this46.#uiManager.isDeletedAnnotationElement(editable.data.id))continue;if(annotationElementIds.has(editable.data.id))continue;const editor=yield _this46.deserialize(editable);editor&&(_this46.addOrRebuild(editor),editor.enableEditing())}}))()}disable(){this.#isDisabling=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);const changedAnnotations=new Map,resetAnnotations=new Map;for(const editor of this.#editors.values())editor.disableEditing(),editor.annotationElementId&&(null===editor.serialize()?(resetAnnotations.set(editor.annotationElementId,editor),this.getEditableAnnotation(editor.annotationElementId)?.show(),editor.remove()):changedAnnotations.set(editor.annotationElementId,editor));if(this.#annotationLayer){const editables=this.#annotationLayer.getEditableAnnotations();for(const editable of editables){const{id}=editable.data;if(this.#uiManager.isDeletedAnnotationElement(id))continue;let editor=resetAnnotations.get(id);editor?(editor.resetAnnotationElement(editable),editor.show(!1),editable.show()):(editor=changedAnnotations.get(id),editor&&(this.#uiManager.addChangedExistingAnnotation(editor),editor.renderAnnotationElement(editable)&&editor.show(!1)),editable.show())}}this.#cleanup(),this.isEmpty&&(this.div.hidden=!0);const{classList}=this.div;for(const editorType of AnnotationEditorLayer.#editorTypes.values())classList.remove(`${editorType._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#isDisabling=!1}getEditableAnnotation(id){return this.#annotationLayer?.getEditableAnnotation(id)||null}setActiveEditor(editor){this.#uiManager.getActive()!==editor&&this.#uiManager.setActiveEditor(editor)}enableTextSelection(){if(this.div.tabIndex=-1,this.#textLayer?.div&&!this.#textSelectionAC){this.#textSelectionAC=new AbortController;const signal=this.#uiManager.combinedSignal(this.#textSelectionAC);this.#textLayer.div.addEventListener("pointerdown",this.#textLayerPointerDown.bind(this),{signal}),this.#textLayer.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#textLayer?.div&&this.#textSelectionAC&&(this.#textSelectionAC.abort(),this.#textSelectionAC=null,this.#textLayer.div.classList.remove("highlighting"))}#textLayerPointerDown(event){this.#uiManager.unselectAll();const{target}=event;if(target===this.#textLayer.div||("img"===target.getAttribute("role")||target.classList.contains("endOfContent"))&&this.#textLayer.div.contains(target)){const{isMac}=util_FeatureTest.platform;if(0!==event.button||event.ctrlKey&&isMac)return;this.#uiManager.showAllEditors("highlight",!0,!0),this.#textLayer.div.classList.add("free"),this.toggleDrawing(),HighlightEditor.startHighlighting(this,"ltr"===this.#uiManager.direction,{target:this.#textLayer.div,x:event.x,y:event.y}),this.#textLayer.div.addEventListener("pointerup",(()=>{this.#textLayer.div.classList.remove("free"),this.toggleDrawing(!0)}),{once:!0,signal:this.#uiManager._signal}),event.preventDefault()}}enableClick(){if(this.#clickAC)return;this.#clickAC=new AbortController;const signal=this.#uiManager.combinedSignal(this.#clickAC);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal}),this.div.addEventListener("pointerup",this.pointerup.bind(this),{signal})}disableClick(){this.#clickAC?.abort(),this.#clickAC=null}attach(editor){this.#editors.set(editor.id,editor);const{annotationElementId}=editor;annotationElementId&&this.#uiManager.isDeletedAnnotationElement(annotationElementId)&&this.#uiManager.removeDeletedAnnotationElement(editor)}detach(editor){this.#editors.delete(editor.id),this.#accessibilityManager?.removePointerInTextLayer(editor.contentDiv),!this.#isDisabling&&editor.annotationElementId&&this.#uiManager.addDeletedAnnotationElement(editor)}remove(editor){this.detach(editor),this.#uiManager.removeEditor(editor),editor.div.remove(),editor.isAttachedToDOM=!1,this.#isCleaningUp||this.addInkEditorIfNeeded(!1)}changeParent(editor){editor.parent!==this&&(editor.parent&&editor.annotationElementId&&(this.#uiManager.addDeletedAnnotationElement(editor.annotationElementId),AnnotationEditor.deleteAnnotationElement(editor),editor.annotationElementId=null),this.attach(editor),editor.parent?.detach(editor),editor.setParent(this),editor.div&&editor.isAttachedToDOM&&(editor.div.remove(),this.div.append(editor.div)))}add(editor){if(editor.parent!==this||!editor.isAttachedToDOM){if(this.changeParent(editor),this.#uiManager.addEditor(editor),this.attach(editor),!editor.isAttachedToDOM){const div=editor.render();this.div.append(div),editor.isAttachedToDOM=!0}editor.fixAndSetPosition(),editor.onceAdded(),this.#uiManager.addToAnnotationStorage(editor),editor._reportTelemetry(editor.telemetryInitialData)}}moveEditorInDOM(editor){if(!editor.isAttachedToDOM)return;const{activeElement}=document;editor.div.contains(activeElement)&&!this.#editorFocusTimeoutId&&(editor._focusEventsAllowed=!1,this.#editorFocusTimeoutId=setTimeout((()=>{this.#editorFocusTimeoutId=null,editor.div.contains(document.activeElement)?editor._focusEventsAllowed=!0:(editor.div.addEventListener("focusin",(()=>{editor._focusEventsAllowed=!0}),{once:!0,signal:this.#uiManager._signal}),activeElement.focus())}),0)),editor._structTreeParentId=this.#accessibilityManager?.moveElementInDOM(this.div,editor.div,editor.contentDiv,!0)}addOrRebuild(editor){editor.needsToBeRebuilt()?(editor.parent||=this,editor.rebuild(),editor.show()):this.add(editor)}addUndoableEditor(editor){this.addCommands({cmd:()=>editor._uiManager.rebuild(editor),undo:()=>{editor.remove()},mustExec:!1})}getNextId(){return this.#uiManager.getId()}get#currentEditorType(){return AnnotationEditorLayer.#editorTypes.get(this.#uiManager.getMode())}combinedSignal(ac){return this.#uiManager.combinedSignal(ac)}#createNewEditor(params){const editorType=this.#currentEditorType;return editorType?new editorType.prototype.constructor(params):null}canCreateNewEmptyEditor(){return this.#currentEditorType?.canCreateNewEmptyEditor()}pasteEditor(mode,params){this.#uiManager.updateToolbar(mode),this.#uiManager.updateMode(mode);const{offsetX,offsetY}=this.#getCenterPoint(),id=this.getNextId(),editor=this.#createNewEditor({parent:this,id,x:offsetX,y:offsetY,uiManager:this.#uiManager,isCentered:!0,...params});editor&&this.add(editor)}deserialize(data){var _this47=this;return(0,asyncToGenerator.A)((function*(){return(yield AnnotationEditorLayer.#editorTypes.get(data.annotationType??data.annotationEditorType)?.deserialize(data,_this47,_this47.#uiManager))||null}))()}createAndAddNewEditor(event,isCentered,data={}){const id=this.getNextId(),editor=this.#createNewEditor({parent:this,id,x:event.offsetX,y:event.offsetY,uiManager:this.#uiManager,isCentered,...data});return editor&&this.add(editor),editor}#getCenterPoint(){const{x,y,width,height}=this.div.getBoundingClientRect(),tlX=Math.max(0,x),tlY=Math.max(0,y),centerX=(tlX+Math.min(window.innerWidth,x+width))/2-x,centerY=(tlY+Math.min(window.innerHeight,y+height))/2-y,[offsetX,offsetY]=this.viewport.rotation%180==0?[centerX,centerY]:[centerY,centerX];return{offsetX,offsetY}}addNewEditor(){this.createAndAddNewEditor(this.#getCenterPoint(),!0)}setSelected(editor){this.#uiManager.setSelected(editor)}toggleSelected(editor){this.#uiManager.toggleSelected(editor)}unselect(editor){this.#uiManager.unselect(editor)}pointerup(event){const{isMac}=util_FeatureTest.platform;0!==event.button||event.ctrlKey&&isMac||event.target===this.div&&this.#hadPointerDown&&(this.#hadPointerDown=!1,this.#allowClick?this.#uiManager.getMode()!==AnnotationEditorType.STAMP?this.createAndAddNewEditor(event,!1):this.#uiManager.unselectAll():this.#allowClick=!0)}pointerdown(event){if(this.#uiManager.getMode()===AnnotationEditorType.HIGHLIGHT&&this.enableTextSelection(),this.#hadPointerDown)return void(this.#hadPointerDown=!1);const{isMac}=util_FeatureTest.platform;if(0!==event.button||event.ctrlKey&&isMac)return;if(event.target!==this.div)return;this.#hadPointerDown=!0;const editor=this.#uiManager.getActive();this.#allowClick=!editor||editor.isEmpty()}findNewParent(editor,x,y){const layer=this.#uiManager.findParent(x,y);return null!==layer&&layer!==this&&(layer.changeParent(editor),!0)}destroy(){this.#uiManager.getActive()?.parent===this&&(this.#uiManager.commitOrRemove(),this.#uiManager.setActiveEditor(null)),this.#editorFocusTimeoutId&&(clearTimeout(this.#editorFocusTimeoutId),this.#editorFocusTimeoutId=null);for(const editor of this.#editors.values())this.#accessibilityManager?.removePointerInTextLayer(editor.contentDiv),editor.setParent(null),editor.isAttachedToDOM=!1,editor.div.remove();this.div=null,this.#editors.clear(),this.#uiManager.removeLayer(this)}#cleanup(){this.#isCleaningUp=!0;for(const editor of this.#editors.values())editor.isEmpty()&&editor.remove();this.#isCleaningUp=!1}render({viewport}){this.viewport=viewport,setLayerDimensions(this.div,viewport);for(const editor of this.#uiManager.getEditors(this.pageIndex))this.add(editor),editor.rebuild();this.updateMode()}update({viewport}){this.#uiManager.commitOrRemove(),this.#cleanup();const oldRotation=this.viewport.rotation,rotation=viewport.rotation;if(this.viewport=viewport,setLayerDimensions(this.div,{rotation}),oldRotation!==rotation)for(const editor of this.#editors.values())editor.rotate(rotation);this.addInkEditorIfNeeded(!1)}get pageDimensions(){const{pageWidth,pageHeight}=this.viewport.rawDims;return[pageWidth,pageHeight]}get scale(){return this.#uiManager.viewParameters.realScale}}class DrawLayer{#parent=null;#id=0;#mapping=new Map;#toUpdate=new Map;constructor({pageIndex}){this.pageIndex=pageIndex}setParent(parent){if(this.#parent){if(this.#parent!==parent){if(this.#mapping.size>0)for(const root of this.#mapping.values())root.remove(),parent.append(root);this.#parent=parent}}else this.#parent=parent}static get _svgFactory(){return shadow(this,"_svgFactory",new DOMSVGFactory)}static#setBox(element,{x=0,y=0,width=1,height=1}={}){const{style}=element;style.top=100*y+"%",style.left=100*x+"%",style.width=100*width+"%",style.height=100*height+"%"}#createSVG(box){const svg=DrawLayer._svgFactory.create(1,1,!0);return this.#parent.append(svg),svg.setAttribute("aria-hidden",!0),DrawLayer.#setBox(svg,box),svg}#createClipPath(defs,pathId){const clipPath=DrawLayer._svgFactory.createElement("clipPath");defs.append(clipPath);const clipPathId=`clip_${pathId}`;clipPath.setAttribute("id",clipPathId),clipPath.setAttribute("clipPathUnits","objectBoundingBox");const clipPathUse=DrawLayer._svgFactory.createElement("use");return clipPath.append(clipPathUse),clipPathUse.setAttribute("href",`#${pathId}`),clipPathUse.classList.add("clip"),clipPathId}draw(outlines,color,opacity,isPathUpdatable=!1){const id=this.#id++,root=this.#createSVG(outlines.box);root.classList.add(...outlines.classNamesForDrawing);const defs=DrawLayer._svgFactory.createElement("defs");root.append(defs);const path=DrawLayer._svgFactory.createElement("path");defs.append(path);const pathId=`path_p${this.pageIndex}_${id}`;path.setAttribute("id",pathId),path.setAttribute("d",outlines.toSVGPath()),isPathUpdatable&&this.#toUpdate.set(id,path);const clipPathId=this.#createClipPath(defs,pathId),use=DrawLayer._svgFactory.createElement("use");return root.append(use),root.setAttribute("fill",color),root.setAttribute("fill-opacity",opacity),use.setAttribute("href",`#${pathId}`),this.#mapping.set(id,root),{id,clipPathId:`url(#${clipPathId})`}}drawOutline(outlines){const id=this.#id++,root=this.#createSVG(outlines.box);root.classList.add(...outlines.classNamesForOutlining);const defs=DrawLayer._svgFactory.createElement("defs");root.append(defs);const path=DrawLayer._svgFactory.createElement("path");defs.append(path);const pathId=`path_p${this.pageIndex}_${id}`;let maskId;if(path.setAttribute("id",pathId),path.setAttribute("d",outlines.toSVGPath()),path.setAttribute("vector-effect","non-scaling-stroke"),outlines.mustRemoveSelfIntersections){const mask=DrawLayer._svgFactory.createElement("mask");defs.append(mask),maskId=`mask_p${this.pageIndex}_${id}`,mask.setAttribute("id",maskId),mask.setAttribute("maskUnits","objectBoundingBox");const rect=DrawLayer._svgFactory.createElement("rect");mask.append(rect),rect.setAttribute("width","1"),rect.setAttribute("height","1"),rect.setAttribute("fill","white");const use=DrawLayer._svgFactory.createElement("use");mask.append(use),use.setAttribute("href",`#${pathId}`),use.setAttribute("stroke","none"),use.setAttribute("fill","black"),use.setAttribute("fill-rule","nonzero"),use.classList.add("mask")}const use1=DrawLayer._svgFactory.createElement("use");root.append(use1),use1.setAttribute("href",`#${pathId}`),maskId&&use1.setAttribute("mask",`url(#${maskId})`);const use2=use1.cloneNode();return root.append(use2),use1.classList.add("mainOutline"),use2.classList.add("secondaryOutline"),this.#mapping.set(id,root),id}finalizeLine(id,line){const path=this.#toUpdate.get(id);this.#toUpdate.delete(id),this.updateBox(id,line.box),path.setAttribute("d",line.toSVGPath())}updateLine(id,line){this.#mapping.get(id).firstChild.firstChild.setAttribute("d",line.toSVGPath())}updatePath(id,line){this.#toUpdate.get(id).setAttribute("d",line.toSVGPath())}updateBox(id,box){DrawLayer.#setBox(this.#mapping.get(id),box)}show(id,visible){this.#mapping.get(id).classList.toggle("hidden",!visible)}rotate(id,angle){this.#mapping.get(id).setAttribute("data-main-rotation",angle)}changeColor(id,color){this.#mapping.get(id).setAttribute("fill",color)}changeOpacity(id,opacity){this.#mapping.get(id).setAttribute("fill-opacity",opacity)}addClass(id,className){this.#mapping.get(id).classList.add(className)}removeClass(id,className){this.#mapping.get(id).classList.remove(className)}getSVGRoot(id){return this.#mapping.get(id)}remove(id){this.#toUpdate.delete(id),null!==this.#parent&&(this.#mapping.get(id).remove(),this.#mapping.delete(id))}destroy(){this.#parent=null;for(const root of this.#mapping.values())root.remove();this.#mapping.clear(),this.#toUpdate.clear()}}var __webpack_exports__AbortException=__nested_webpack_exports__.AbortException,__webpack_exports__AnnotationEditorLayer=__nested_webpack_exports__.AnnotationEditorLayer,__webpack_exports__AnnotationEditorParamsType=__nested_webpack_exports__.AnnotationEditorParamsType,__webpack_exports__AnnotationEditorType=__nested_webpack_exports__.AnnotationEditorType,__webpack_exports__AnnotationEditorUIManager=__nested_webpack_exports__.AnnotationEditorUIManager,__webpack_exports__AnnotationLayer=__nested_webpack_exports__.AnnotationLayer,__webpack_exports__AnnotationMode=__nested_webpack_exports__.AnnotationMode,__webpack_exports__ColorPicker=__nested_webpack_exports__.ColorPicker,__webpack_exports__DOMSVGFactory=__nested_webpack_exports__.DOMSVGFactory,__webpack_exports__DrawLayer=__nested_webpack_exports__.DrawLayer,__webpack_exports__FeatureTest=__nested_webpack_exports__.FeatureTest,__webpack_exports__GlobalWorkerOptions=__nested_webpack_exports__.GlobalWorkerOptions,__webpack_exports__ImageKind=__nested_webpack_exports__.ImageKind,__webpack_exports__InvalidPDFException=__nested_webpack_exports__.InvalidPDFException,__webpack_exports__MissingPDFException=__nested_webpack_exports__.MissingPDFException,__webpack_exports__OPS=__nested_webpack_exports__.OPS,__webpack_exports__OutputScale=__nested_webpack_exports__.OutputScale,__webpack_exports__PDFDataRangeTransport=__nested_webpack_exports__.PDFDataRangeTransport,__webpack_exports__PDFDateString=__nested_webpack_exports__.PDFDateString,__webpack_exports__PDFWorker=__nested_webpack_exports__.PDFWorker,__webpack_exports__PasswordResponses=__nested_webpack_exports__.PasswordResponses,__webpack_exports__PermissionFlag=__nested_webpack_exports__.PermissionFlag,__webpack_exports__PixelsPerInch=__nested_webpack_exports__.PixelsPerInch,__webpack_exports__RenderingCancelledException=__nested_webpack_exports__.RenderingCancelledException,__webpack_exports__TextLayer=__nested_webpack_exports__.TextLayer,__webpack_exports__UnexpectedResponseException=__nested_webpack_exports__.UnexpectedResponseException,__webpack_exports__Util=__nested_webpack_exports__.Util,__webpack_exports__VerbosityLevel=__nested_webpack_exports__.VerbosityLevel,__webpack_exports__XfaLayer=__nested_webpack_exports__.XfaLayer,__webpack_exports__build=__nested_webpack_exports__.build,__webpack_exports__createValidAbsoluteUrl=__nested_webpack_exports__.createValidAbsoluteUrl,__webpack_exports__fetchData=__nested_webpack_exports__.fetchData,__webpack_exports__getDocument=__nested_webpack_exports__.getDocument,__webpack_exports__getFilenameFromUrl=__nested_webpack_exports__.getFilenameFromUrl,__webpack_exports__getPdfFilenameFromUrl=__nested_webpack_exports__.getPdfFilenameFromUrl,__webpack_exports__getXfaPageViewport=__nested_webpack_exports__.getXfaPageViewport,__webpack_exports__isDataScheme=__nested_webpack_exports__.isDataScheme,__webpack_exports__isPdfFile=__nested_webpack_exports__.isPdfFile,__webpack_exports__noContextMenu=__nested_webpack_exports__.noContextMenu,__webpack_exports__normalizeUnicode=__nested_webpack_exports__.normalizeUnicode,__webpack_exports__setLayerDimensions=__nested_webpack_exports__.setLayerDimensions,__webpack_exports__shadow=__nested_webpack_exports__.shadow,__webpack_exports__version=__nested_webpack_exports__.version;function _OverloadYield(e,d){this.v=e,this.k=d}function _awaitAsyncGenerator(e){return new _OverloadYield(e,0)}function _wrapAsyncGenerator(e){return function(){return new AsyncGenerator(e.apply(this,arguments))}}function AsyncGenerator(e){var r,t;function resume(r,t){try{var n=e[r](t),o=n.value,u=o instanceof _OverloadYield;Promise.resolve(u?o.v:o).then((function(t){if(u){var i="return"===r?"return":"next";if(!o.k||t.done)return resume(i,t);t=e[i](t).value}settle(n.done?"return":"normal",t)}),(function(e){resume("throw",e)}))}catch(e){settle("throw",e)}}function settle(e,n){switch(e){case"return":r.resolve({value:n,done:!0});break;case"throw":r.reject(n);break;default:r.resolve({value:n,done:!1})}(r=r.next)?resume(r.key,r.arg):t=null}this._invoke=function(e,n){return new Promise((function(o,u){var i={key:e,arg:n,resolve:o,reject:u,next:null};t?t=t.next=i:(r=t=i,resume(e,n))}))},"function"!=typeof e.return&&(this.return=void 0)}function AsyncFromSyncIterator(r){function AsyncFromSyncIteratorContinuation(r){if(Object(r)!==r)return Promise.reject(new TypeError(r+" is not an object."));var n=r.done;return Promise.resolve(r.value).then((function(r){return{value:r,done:n}}))}return AsyncFromSyncIterator=function AsyncFromSyncIterator(r){this.s=r,this.n=r.next},AsyncFromSyncIterator.prototype={s:null,n:null,next:function next(){return AsyncFromSyncIteratorContinuation(this.n.apply(this.s,arguments))},return:function _return(r){var n=this.s.return;return void 0===n?Promise.resolve({value:r,done:!0}):AsyncFromSyncIteratorContinuation(n.apply(this.s,arguments))},throw:function _throw(r){var n=this.s.return;return void 0===n?Promise.reject(r):AsyncFromSyncIteratorContinuation(n.apply(this.s,arguments))}},new AsyncFromSyncIterator(r)}AsyncGenerator.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},AsyncGenerator.prototype.next=function(e){return this._invoke("next",e)},AsyncGenerator.prototype.throw=function(e){return this._invoke("throw",e)},AsyncGenerator.prototype.return=function(e){return this._invoke("return",e)};var __nested_webpack_require_1619__={d:(exports,definition)=>{for(var key in definition)__nested_webpack_require_1619__.o(definition,key)&&!__nested_webpack_require_1619__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},o:(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop)},pdf_viewer_nested_webpack_exports_=globalThis.pdfjsViewer={};__nested_webpack_require_1619__.d(pdf_viewer_nested_webpack_exports_,{AnnotationLayerBuilder:()=>AnnotationLayerBuilder,DownloadManager:()=>DownloadManager,EventBus:()=>EventBus,FindState:()=>FindState,GenericL10n:()=>genericl10n_GenericL10n,LinkTarget:()=>LinkTarget,PDFFindController:()=>PDFFindController,PDFHistory:()=>PDFHistory,PDFLinkService:()=>PDFLinkService,PDFPageView:()=>PDFPageView,PDFScriptingManager:()=>PDFScriptingManagerComponents,PDFSinglePageViewer:()=>PDFSinglePageViewer,PDFViewer:()=>PDFViewer,ProgressBar:()=>ProgressBar,RenderingStates:()=>RenderingStates,ScrollMode:()=>ScrollMode,SimpleLinkService:()=>SimpleLinkService,SpreadMode:()=>SpreadMode,StructTreeLayerBuilder:()=>StructTreeLayerBuilder,TextLayerBuilder:()=>TextLayerBuilder,XfaLayerBuilder:()=>XfaLayerBuilder,parseQueryString:()=>parseQueryString});const RenderingStates={INITIAL:0,RUNNING:1,PAUSED:2,FINISHED:3},PresentationModeState_UNKNOWN=0,PresentationModeState_NORMAL=1,PresentationModeState_CHANGING=2,PresentationModeState_FULLSCREEN=3,TextLayerMode_DISABLE=0,TextLayerMode_ENABLE=1,TextLayerMode_ENABLE_PERMISSIONS=2,ScrollMode={UNKNOWN:-1,VERTICAL:0,HORIZONTAL:1,WRAPPED:2,PAGE:3},SpreadMode={UNKNOWN:-1,NONE:0,ODD:1,EVEN:2};function scrollIntoView(element,spot,scrollMatches=!1){let parent=element.offsetParent;if(!parent)return void console.error("offsetParent is not set -- cannot scroll");let offsetY=element.offsetTop+element.clientTop,offsetX=element.offsetLeft+element.clientLeft;for(;parent.clientHeight===parent.scrollHeight&&parent.clientWidth===parent.scrollWidth||scrollMatches&&(parent.classList.contains("markedContent")||"hidden"===getComputedStyle(parent).overflow);)if(offsetY+=parent.offsetTop,offsetX+=parent.offsetLeft,parent=parent.offsetParent,!parent)return;spot&&(void 0!==spot.top&&(offsetY+=spot.top),void 0!==spot.left&&(offsetX+=spot.left,parent.scrollLeft=offsetX)),parent.scrollTop=offsetY}function parseQueryString(query){const params=new Map;for(const[key,value]of new URLSearchParams(query))params.set(key.toLowerCase(),value);return params}const InvisibleCharsRegExp=/[\x00-\x1F]/g;function removeNullCharacters(str,replaceInvisible=!1){return InvisibleCharsRegExp.test(str)?replaceInvisible?str.replaceAll(InvisibleCharsRegExp,(m=>"\0"===m?"":" ")):str.replaceAll("\0",""):str}function binarySearchFirstItem(items,condition,start=0){let minIndex=start,maxIndex=items.length-1;if(maxIndex<0||!condition(items[maxIndex]))return items.length;if(condition(items[minIndex]))return minIndex;for(;minIndex<maxIndex;){const currentIndex=minIndex+maxIndex>>1;condition(items[currentIndex])?maxIndex=currentIndex:minIndex=currentIndex+1}return minIndex}function approximateFraction(x){if(Math.floor(x)===x)return[x,1];const xinv=1/x;if(xinv>8)return[1,8];if(Math.floor(xinv)===xinv)return[1,xinv];const x_=x>1?xinv:x;let result,a=0,b=1,c=1,d=1;for(;;){const p=a+c,q=b+d;if(q>8)break;x_<=p/q?(c=p,d=q):(a=p,b=q)}return result=x_-a/b<c/d-x_?x_===x?[a,b]:[b,a]:x_===x?[c,d]:[d,c],result}function floorToDivide(x,div){return x-x%div}function isValidRotation(angle){return Number.isInteger(angle)&&angle%90==0}function isPortraitOrientation(size){return size.width<=size.height}new Promise((function(resolve){window.requestAnimationFrame(resolve)}));const docStyle=document.documentElement.style;class ProgressBar{#classList=null;#disableAutoFetchTimeout=null;#percent=0;#style=null;#visible=!0;constructor(bar){this.#classList=bar.classList,this.#style=bar.style}get percent(){return this.#percent}set percent(val){this.#percent=function clamp(v,min,max){return Math.min(Math.max(v,min),max)}(val,0,100),isNaN(val)?this.#classList.add("indeterminate"):(this.#classList.remove("indeterminate"),this.#style.setProperty("--progressBar-percent",`${this.#percent}%`))}setWidth(viewer){if(!viewer)return;const scrollbarWidth=viewer.parentNode.offsetWidth-viewer.offsetWidth;scrollbarWidth>0&&this.#style.setProperty("--progressBar-end-offset",`${scrollbarWidth}px`)}setDisableAutoFetch(delay=5e3){100===this.#percent||isNaN(this.#percent)||(this.#disableAutoFetchTimeout&&clearTimeout(this.#disableAutoFetchTimeout),this.show(),this.#disableAutoFetchTimeout=setTimeout((()=>{this.#disableAutoFetchTimeout=null,this.hide()}),delay))}hide(){this.#visible&&(this.#visible=!1,this.#classList.add("hidden"))}show(){this.#visible||(this.#visible=!0,this.#classList.remove("hidden"))}}const calcRound=function(){const e=document.createElement("div");return e.style.width="round(down, calc(1.6666666666666665 * 792px), 1px)","calc(1320px)"===e.style.width?Math.fround:x=>x}(),CharacterType_SPACE=0,CharacterType_ALPHA_LETTER=1,CharacterType_PUNCT=2,CharacterType_HAN_LETTER=3,CharacterType_KATAKANA_LETTER=4,CharacterType_HIRAGANA_LETTER=5,CharacterType_HALFWIDTH_KATAKANA_LETTER=6,CharacterType_THAI_LETTER=7;function getCharacterType(charCode){return function isAlphabeticalScript(charCode){return charCode<11904}(charCode)?function isAscii(charCode){return!(65408&charCode)}(charCode)?function isAsciiSpace(charCode){return 32===charCode||9===charCode||13===charCode||10===charCode}(charCode)?CharacterType_SPACE:function isAsciiAlpha(charCode){return charCode>=97&&charCode<=122||charCode>=65&&charCode<=90}(charCode)||function isAsciiDigit(charCode){return charCode>=48&&charCode<=57}(charCode)||95===charCode?CharacterType_ALPHA_LETTER:CharacterType_PUNCT:function isThai(charCode){return 3584==(65408&charCode)}(charCode)?CharacterType_THAI_LETTER:160===charCode?CharacterType_SPACE:CharacterType_ALPHA_LETTER:function isHan(charCode){return charCode>=13312&&charCode<=40959||charCode>=63744&&charCode<=64255}(charCode)?CharacterType_HAN_LETTER:function isKatakana(charCode){return charCode>=12448&&charCode<=12543}(charCode)?CharacterType_KATAKANA_LETTER:function isHiragana(charCode){return charCode>=12352&&charCode<=12447}(charCode)?CharacterType_HIRAGANA_LETTER:function isHalfwidthKatakana(charCode){return charCode>=65376&&charCode<=65439}(charCode)?CharacterType_HALFWIDTH_KATAKANA_LETTER:CharacterType_ALPHA_LETTER}let NormalizeWithNFKC;const FindState={FOUND:0,NOT_FOUND:1,WRAPPED:2,PENDING:3},CHARACTERS_TO_NORMALIZE={"‐":"-","‘":"'","’":"'","‚":"'","‛":"'","“":'"',"”":'"',"„":'"',"‟":'"',"¼":"1/4","½":"1/2","¾":"3/4"},DIACRITICS_EXCEPTION=new Set([12441,12442,2381,2509,2637,2765,2893,3021,3149,3277,3387,3388,3405,3530,3642,3770,3972,4153,4154,5908,5940,6098,6752,6980,7082,7083,7154,7155,11647,43014,43052,43204,43347,43456,43766,44013,3158,3953,3954,3962,3963,3964,3965,3968,3956]);let DIACRITICS_EXCEPTION_STR;const DIACRITICS_REG_EXP=/\p{M}+/gu,SPECIAL_CHARS_REG_EXP=/([.*+?^${}()|[\]\\])|(\p{P})|(\s+)|(\p{M})|(\p{L})/gu,NOT_DIACRITIC_FROM_END_REG_EXP=/([^\p{M}])\p{M}*$/u,NOT_DIACRITIC_FROM_START_REG_EXP=/^\p{M}*([^\p{M}])/u,SYLLABLES_REG_EXP=/[\uAC00-\uD7AF\uFA6C\uFACF-\uFAD1\uFAD5-\uFAD7]+/g,SYLLABLES_LENGTHS=new Map,NFKC_CHARS_TO_NORMALIZE=new Map;let noSyllablesRegExp=null,withSyllablesRegExp=null;function normalize(text){const syllablePositions=[];let m,normalizationRegex;for(;null!==(m=SYLLABLES_REG_EXP.exec(text));){let{index}=m;for(const char of m[0]){let len=SYLLABLES_LENGTHS.get(char);len||(len=char.normalize("NFD").length,SYLLABLES_LENGTHS.set(char,len)),syllablePositions.push([len,index++])}}if(0===syllablePositions.length&&noSyllablesRegExp)normalizationRegex=noSyllablesRegExp;else if(syllablePositions.length>0&&withSyllablesRegExp)normalizationRegex=withSyllablesRegExp;else{const regexp=`([${Object.keys(CHARACTERS_TO_NORMALIZE).join("")}])|([${function getNormalizeWithNFKC(){return NormalizeWithNFKC||=" ¨ª¯²-µ¸-º¼-¾Ĳ-ĳĿ-ŀŉſǄ-ǌǱ-ǳʰ-ʸ˘-˝ˠ-ˤʹͺ;΄-΅·ϐ-ϖϰ-ϲϴ-ϵϹևٵ-ٸक़-य़ড়-ঢ়য়ਲ਼ਸ਼ਖ਼-ਜ਼ਫ਼ଡ଼-ଢ଼ำຳໜ-ໝ༌གྷཌྷདྷབྷཛྷཀྵჼᴬ-ᴮᴰ-ᴺᴼ-ᵍᵏ-ᵪᵸᶛ-ᶿẚ-ẛάέήίόύώΆ᾽-῁ΈΉ῍-῏ΐΊ῝-῟ΰΎ῭-`ΌΏ´-῾ - ‑‗․-… ″-‴‶-‷‼‾⁇-⁉⁗ ⁰-ⁱ⁴-₎ₐ-ₜ₨℀-℃℅-ℇ℉-ℓℕ-№ℙ-ℝ℠-™ℤΩℨK-ℭℯ-ℱℳ-ℹ℻-⅀ⅅ-ⅉ⅐-ⅿ↉∬-∭∯-∰〈-〉①-⓪⨌⩴-⩶⫝̸ⱼ-ⱽⵯ⺟⻳⼀-⿕　〶〸-〺゛-゜ゟヿㄱ-ㆎ㆒-㆟㈀-㈞㈠-㉇㉐-㉾㊀-㏿ꚜ-ꚝꝰꟲ-ꟴꟸ-ꟹꭜ-ꭟꭩ豈-嗀塚晴凞-羽蘒諸逸-都飯-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-זּטּ-לּמּנּ-סּףּ-פּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-﷼︐-︙︰-﹄﹇-﹒﹔-﹦﹨-﹫ﹰ-ﹲﹴﹶ-ﻼ！-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ￠-￦",NormalizeWithNFKC}()}])|(${"(?:゙|゚)"}\\n)|(\\p{M}+(?:-\\n)?)|(${"\\p{Ll}-\\n\\p{Lu}"})|(\\S-\\n)|(${"(?:\\p{Ideographic}|[぀-ヿ])"}\\n)|(\\n)`;normalizationRegex=0===syllablePositions.length?noSyllablesRegExp=new RegExp(regexp+"|(\\u0000)","gum"):withSyllablesRegExp=new RegExp(regexp+"|([\\u1100-\\u1112\\ud7a4-\\ud7af\\ud84a\\ud84c\\ud850\\ud854\\ud857\\ud85f])","gum")}const rawDiacriticsPositions=[];for(;null!==(m=DIACRITICS_REG_EXP.exec(text));)rawDiacriticsPositions.push([m[0].length,m.index]);let normalized=text.normalize("NFD");const positions=[[0,0]];let rawDiacriticsIndex=0,syllableIndex=0,shift=0,shiftOrigin=0,eol=0,hasDiacritics=!1;return normalized=normalized.replace(normalizationRegex,((match,p1,p2,p3,p4,p5,p6,p7,p8,p9,i)=>{if(i-=shiftOrigin,p1){const replacement=CHARACTERS_TO_NORMALIZE[p1],jj=replacement.length;for(let j=1;j<jj;j++)positions.push([i-shift+j,shift-j]);return shift-=jj-1,replacement}if(p2){let replacement=NFKC_CHARS_TO_NORMALIZE.get(p2);replacement||(replacement=p2.normalize("NFKC"),NFKC_CHARS_TO_NORMALIZE.set(p2,replacement));const jj=replacement.length;for(let j=1;j<jj;j++)positions.push([i-shift+j,shift-j]);return shift-=jj-1,replacement}if(p3)return hasDiacritics=!0,i+eol===rawDiacriticsPositions[rawDiacriticsIndex]?.[1]?++rawDiacriticsIndex:(positions.push([i-1-shift+1,shift-1]),shift-=1,shiftOrigin+=1),positions.push([i-shift+1,shift]),shiftOrigin+=1,eol+=1,p3.charAt(0);if(p4){const hasTrailingDashEOL=p4.endsWith("\n"),len=hasTrailingDashEOL?p4.length-2:p4.length;hasDiacritics=!0;let jj=len;i+eol===rawDiacriticsPositions[rawDiacriticsIndex]?.[1]&&(jj-=rawDiacriticsPositions[rawDiacriticsIndex][0],++rawDiacriticsIndex);for(let j=1;j<=jj;j++)positions.push([i-1-shift+j,shift-j]);return shift-=jj,shiftOrigin+=jj,hasTrailingDashEOL?(i+=len-1,positions.push([i-shift+1,1+shift]),shift+=1,shiftOrigin+=1,eol+=1,p4.slice(0,len)):p4}if(p5)return positions.push([i-shift+3,1+shift]),shift+=1,shiftOrigin+=1,eol+=1,p5.replace("\n","");if(p6){const len=p6.length-2;return positions.push([i-shift+len,1+shift]),shift+=1,shiftOrigin+=1,eol+=1,p6.slice(0,-2)}if(p7){const len=p7.length-1;return positions.push([i-shift+len,shift]),shiftOrigin+=1,eol+=1,p7.slice(0,-1)}if(p8)return positions.push([i-shift+1,shift-1]),shift-=1,shiftOrigin+=1,eol+=1," ";if(i+eol===syllablePositions[syllableIndex]?.[1]){const newCharLen=syllablePositions[syllableIndex][0]-1;++syllableIndex;for(let j=1;j<=newCharLen;j++)positions.push([i-(shift-j),shift-j]);shift-=newCharLen,shiftOrigin+=newCharLen}return p9})),positions.push([normalized.length,shift]),[normalized,positions,hasDiacritics]}class PDFFindController{#state=null;#updateMatchesCountOnProgress=!0;#visitedPagesCount=0;constructor({linkService,eventBus,updateMatchesCountOnProgress=!0}){this._linkService=linkService,this._eventBus=eventBus,this.#updateMatchesCountOnProgress=updateMatchesCountOnProgress,this.onIsPageVisible=null,this.#reset(),eventBus._on("find",this.#onFind.bind(this)),eventBus._on("findbarclose",this.#onFindBarClose.bind(this))}get highlightMatches(){return this._highlightMatches}get pageMatches(){return this._pageMatches}get pageMatchesLength(){return this._pageMatchesLength}get selected(){return this._selected}get state(){return this.#state}setDocument(pdfDocument){this._pdfDocument&&this.#reset(),pdfDocument&&(this._pdfDocument=pdfDocument,this._firstPageCapability.resolve())}#onFind(state){if(!state)return;const pdfDocument=this._pdfDocument,{type}=state;(null===this.#state||this.#shouldDirtyMatch(state))&&(this._dirtyMatch=!0),this.#state=state,"highlightallchange"!==type&&this.#updateUIState(FindState.PENDING),this._firstPageCapability.promise.then((()=>{if(!this._pdfDocument||pdfDocument&&this._pdfDocument!==pdfDocument)return;this.#extractText();const findbarClosed=!this._highlightMatches,pendingTimeout=!!this._findTimeout;this._findTimeout&&(clearTimeout(this._findTimeout),this._findTimeout=null),type?this._dirtyMatch?this.#nextMatch():"again"===type?(this.#nextMatch(),findbarClosed&&this.#state.highlightAll&&this.#updateAllPages()):"highlightallchange"===type?(pendingTimeout?this.#nextMatch():this._highlightMatches=!0,this.#updateAllPages()):this.#nextMatch():this._findTimeout=setTimeout((()=>{this.#nextMatch(),this._findTimeout=null}),250)}))}scrollMatchIntoView({element=null,selectedLeft=0,pageIndex=-1,matchIndex=-1}){if(!this._scrollMatches||!element)return;if(-1===matchIndex||matchIndex!==this._selected.matchIdx)return;if(-1===pageIndex||pageIndex!==this._selected.pageIdx)return;this._scrollMatches=!1;scrollIntoView(element,{top:-50,left:selectedLeft+-400},!0)}#reset(){this._highlightMatches=!1,this._scrollMatches=!1,this._pdfDocument=null,this._pageMatches=[],this._pageMatchesLength=[],this.#visitedPagesCount=0,this.#state=null,this._selected={pageIdx:-1,matchIdx:-1},this._offset={pageIdx:null,matchIdx:null,wrapped:!1},this._extractTextPromises=[],this._pageContents=[],this._pageDiffs=[],this._hasDiacritics=[],this._matchesCountTotal=0,this._pagesToSearch=null,this._pendingFindMatches=new Set,this._resumePageIdx=null,this._dirtyMatch=!1,clearTimeout(this._findTimeout),this._findTimeout=null,this._firstPageCapability=Promise.withResolvers()}get#query(){const{query}=this.#state;return"string"==typeof query?(query!==this._rawQuery&&(this._rawQuery=query,[this._normalizedQuery]=normalize(query)),this._normalizedQuery):(query||[]).filter((q=>!!q)).map((q=>normalize(q)[0]))}#shouldDirtyMatch(state){const newQuery=state.query,prevQuery=this.#state.query,newType=typeof newQuery;if(newType!==typeof prevQuery)return!0;if("string"===newType){if(newQuery!==prevQuery)return!0}else if(JSON.stringify(newQuery)!==JSON.stringify(prevQuery))return!0;switch(state.type){case"again":const pageNumber=this._selected.pageIdx+1,linkService=this._linkService;return pageNumber>=1&&pageNumber<=linkService.pagesCount&&pageNumber!==linkService.page&&!(this.onIsPageVisible?.(pageNumber)??1);case"highlightallchange":return!1}return!0}#isEntireWord(content,startIdx,length){let match=content.slice(0,startIdx).match(NOT_DIACRITIC_FROM_END_REG_EXP);if(match){const first=content.charCodeAt(startIdx),limit=match[1].charCodeAt(0);if(getCharacterType(first)===getCharacterType(limit))return!1}if(match=content.slice(startIdx+length).match(NOT_DIACRITIC_FROM_START_REG_EXP),match){const last=content.charCodeAt(startIdx+length-1),limit=match[1].charCodeAt(0);if(getCharacterType(last)===getCharacterType(limit))return!1}return!0}#convertToRegExpString(query,hasDiacritics){const{matchDiacritics}=this.#state;let isUnicode=!1;return(query=query.replaceAll(SPECIAL_CHARS_REG_EXP,((match,p1,p2,p3,p4,p5)=>p1?`[ ]*\\${p1}[ ]*`:p2?`[ ]*${p2}[ ]*`:p3?"[ ]+":matchDiacritics?p4||p5:p4?DIACRITICS_EXCEPTION.has(p4.charCodeAt(0))?p4:"":hasDiacritics?(isUnicode=!0,`${p5}\\p{M}*`):p5))).endsWith("[ ]*")&&(query=query.slice(0,query.length-4)),matchDiacritics&&hasDiacritics&&(DIACRITICS_EXCEPTION_STR||=String.fromCharCode(...DIACRITICS_EXCEPTION),isUnicode=!0,query=`${query}(?=[${DIACRITICS_EXCEPTION_STR}]|[^\\p{M}]|$)`),[isUnicode,query]}#calculateMatch(pageIndex){const query=this.#query;if(0===query.length)return;const pageContent=this._pageContents[pageIndex],matcherResult=this.match(query,pageContent,pageIndex),matches=this._pageMatches[pageIndex]=[],matchesLength=this._pageMatchesLength[pageIndex]=[],diffs=this._pageDiffs[pageIndex];matcherResult?.forEach((({index,length})=>{const[matchPos,matchLen]=function getOriginalIndex(diffs,pos,len){if(!diffs)return[pos,len];const start=pos,end=pos+len-1;let i=binarySearchFirstItem(diffs,(x=>x[0]>=start));diffs[i][0]>start&&--i;let j=binarySearchFirstItem(diffs,(x=>x[0]>=end),i);diffs[j][0]>end&&--j;const oldStart=start+diffs[i][1];return[oldStart,end+diffs[j][1]+1-oldStart]}(diffs,index,length);matchLen&&(matches.push(matchPos),matchesLength.push(matchLen))})),this.#state.highlightAll&&this.#updatePage(pageIndex),this._resumePageIdx===pageIndex&&(this._resumePageIdx=null,this.#nextPageMatch());const pageMatchesCount=matches.length;this._matchesCountTotal+=pageMatchesCount,this.#updateMatchesCountOnProgress?pageMatchesCount>0&&this.#updateUIResultsCount():++this.#visitedPagesCount===this._linkService.pagesCount&&this.#updateUIResultsCount()}match(query,pageContent,pageIndex){const hasDiacritics=this._hasDiacritics[pageIndex];let isUnicode=!1;if("string"==typeof query?[isUnicode,query]=this.#convertToRegExpString(query,hasDiacritics):query=query.sort().reverse().map((q=>{const[isUnicodePart,queryPart]=this.#convertToRegExpString(q,hasDiacritics);return isUnicode||=isUnicodePart,`(${queryPart})`})).join("|"),!query)return;const{caseSensitive,entireWord}=this.#state;query=new RegExp(query,`g${isUnicode?"u":""}${caseSensitive?"":"i"}`);const matches=[];let match;for(;null!==(match=query.exec(pageContent));)entireWord&&!this.#isEntireWord(pageContent,match.index,match[0].length)||matches.push({index:match.index,length:match[0].length});return matches}#extractText(){if(this._extractTextPromises.length>0)return;let deferred=Promise.resolve();const textOptions={disableNormalization:!0};for(let i=0,ii=this._linkService.pagesCount;i<ii;i++){const{promise,resolve}=Promise.withResolvers();this._extractTextPromises[i]=promise,deferred=deferred.then((()=>this._pdfDocument.getPage(i+1).then((pdfPage=>pdfPage.getTextContent(textOptions))).then((textContent=>{const strBuf=[];for(const textItem of textContent.items)strBuf.push(textItem.str),textItem.hasEOL&&strBuf.push("\n");[this._pageContents[i],this._pageDiffs[i],this._hasDiacritics[i]]=normalize(strBuf.join("")),resolve()}),(reason=>{console.error(`Unable to get text content for page ${i+1}`,reason),this._pageContents[i]="",this._pageDiffs[i]=null,this._hasDiacritics[i]=!1,resolve()}))))}}#updatePage(index){this._scrollMatches&&this._selected.pageIdx===index&&(this._linkService.page=index+1),this._eventBus.dispatch("updatetextlayermatches",{source:this,pageIndex:index})}#updateAllPages(){this._eventBus.dispatch("updatetextlayermatches",{source:this,pageIndex:-1})}#nextMatch(){const previous=this.#state.findPrevious,currentPageIndex=this._linkService.page-1,numPages=this._linkService.pagesCount;if(this._highlightMatches=!0,this._dirtyMatch){this._dirtyMatch=!1,this._selected.pageIdx=this._selected.matchIdx=-1,this._offset.pageIdx=currentPageIndex,this._offset.matchIdx=null,this._offset.wrapped=!1,this._resumePageIdx=null,this._pageMatches.length=0,this._pageMatchesLength.length=0,this.#visitedPagesCount=0,this._matchesCountTotal=0,this.#updateAllPages();for(let i=0;i<numPages;i++)this._pendingFindMatches.has(i)||(this._pendingFindMatches.add(i),this._extractTextPromises[i].then((()=>{this._pendingFindMatches.delete(i),this.#calculateMatch(i)})))}if(0===this.#query.length)return void this.#updateUIState(FindState.FOUND);if(this._resumePageIdx)return;const offset=this._offset;if(this._pagesToSearch=numPages,null!==offset.matchIdx){const numPageMatches=this._pageMatches[offset.pageIdx].length;if(!previous&&offset.matchIdx+1<numPageMatches||previous&&offset.matchIdx>0)return offset.matchIdx=previous?offset.matchIdx-1:offset.matchIdx+1,void this.#updateMatch(!0);this.#advanceOffsetPage(previous)}this.#nextPageMatch()}#matchesReady(matches){const offset=this._offset,numMatches=matches.length,previous=this.#state.findPrevious;return numMatches?(offset.matchIdx=previous?numMatches-1:0,this.#updateMatch(!0),!0):(this.#advanceOffsetPage(previous),!!(offset.wrapped&&(offset.matchIdx=null,this._pagesToSearch<0))&&(this.#updateMatch(!1),!0))}#nextPageMatch(){null!==this._resumePageIdx&&console.error("There can only be one pending page.");let matches=null;do{const pageIdx=this._offset.pageIdx;if(matches=this._pageMatches[pageIdx],!matches){this._resumePageIdx=pageIdx;break}}while(!this.#matchesReady(matches))}#advanceOffsetPage(previous){const offset=this._offset,numPages=this._linkService.pagesCount;offset.pageIdx=previous?offset.pageIdx-1:offset.pageIdx+1,offset.matchIdx=null,this._pagesToSearch--,(offset.pageIdx>=numPages||offset.pageIdx<0)&&(offset.pageIdx=previous?numPages-1:0,offset.wrapped=!0)}#updateMatch(found=!1){let state=FindState.NOT_FOUND;const wrapped=this._offset.wrapped;if(this._offset.wrapped=!1,found){const previousPage=this._selected.pageIdx;this._selected.pageIdx=this._offset.pageIdx,this._selected.matchIdx=this._offset.matchIdx,state=wrapped?FindState.WRAPPED:FindState.FOUND,-1!==previousPage&&previousPage!==this._selected.pageIdx&&this.#updatePage(previousPage)}this.#updateUIState(state,this.#state.findPrevious),-1!==this._selected.pageIdx&&(this._scrollMatches=!0,this.#updatePage(this._selected.pageIdx))}#onFindBarClose(evt){const pdfDocument=this._pdfDocument;this._firstPageCapability.promise.then((()=>{!this._pdfDocument||pdfDocument&&this._pdfDocument!==pdfDocument||(this._findTimeout&&(clearTimeout(this._findTimeout),this._findTimeout=null),this._resumePageIdx&&(this._resumePageIdx=null,this._dirtyMatch=!0),this.#updateUIState(FindState.FOUND),this._highlightMatches=!1,this.#updateAllPages())}))}#requestMatchesCount(){const{pageIdx,matchIdx}=this._selected;let current=0,total=this._matchesCountTotal;if(-1!==matchIdx){for(let i=0;i<pageIdx;i++)current+=this._pageMatches[i]?.length||0;current+=matchIdx+1}return(current<1||current>total)&&(current=total=0),{current,total}}#updateUIResultsCount(){this._eventBus.dispatch("updatefindmatchescount",{source:this,matchesCount:this.#requestMatchesCount()})}#updateUIState(state,previous=!1){(this.#updateMatchesCountOnProgress||this.#visitedPagesCount===this._linkService.pagesCount&&state!==FindState.PENDING)&&this._eventBus.dispatch("updatefindcontrolstate",{source:this,state,previous,entireWord:this.#state?.entireWord??null,matchesCount:this.#requestMatchesCount(),rawQuery:this.#state?.query??null})}}const LinkTarget={NONE:0,SELF:1,BLANK:2,PARENT:3,TOP:4};class PDFLinkService{externalLinkEnabled=!0;constructor({eventBus,externalLinkTarget=null,externalLinkRel=null,ignoreDestinationZoom=!1}={}){this.eventBus=eventBus,this.externalLinkTarget=externalLinkTarget,this.externalLinkRel=externalLinkRel,this._ignoreDestinationZoom=ignoreDestinationZoom,this.baseUrl=null,this.pdfDocument=null,this.pdfViewer=null,this.pdfHistory=null}setDocument(pdfDocument,baseUrl=null){this.baseUrl=baseUrl,this.pdfDocument=pdfDocument}setViewer(pdfViewer){this.pdfViewer=pdfViewer}setHistory(pdfHistory){this.pdfHistory=pdfHistory}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return this.pdfDocument?this.pdfViewer.currentPageNumber:1}set page(value){this.pdfDocument&&(this.pdfViewer.currentPageNumber=value)}get rotation(){return this.pdfDocument?this.pdfViewer.pagesRotation:0}set rotation(value){this.pdfDocument&&(this.pdfViewer.pagesRotation=value)}get isInPresentationMode(){return!!this.pdfDocument&&this.pdfViewer.isInPresentationMode}goToDestination(dest){var _this3=this;return(0,asyncToGenerator.A)((function*(){if(!_this3.pdfDocument)return;let namedDest,explicitDest,pageNumber;if("string"==typeof dest?(namedDest=dest,explicitDest=yield _this3.pdfDocument.getDestination(dest)):(namedDest=null,explicitDest=yield dest),!Array.isArray(explicitDest))return void console.error(`goToDestination: "${explicitDest}" is not a valid destination array, for dest="${dest}".`);const[destRef]=explicitDest;if(destRef&&"object"==typeof destRef){if(pageNumber=_this3.pdfDocument.cachedPageNumber(destRef),!pageNumber)try{pageNumber=(yield _this3.pdfDocument.getPageIndex(destRef))+1}catch{return void console.error(`goToDestination: "${destRef}" is not a valid page reference, for dest="${dest}".`)}}else Number.isInteger(destRef)&&(pageNumber=destRef+1);!pageNumber||pageNumber<1||pageNumber>_this3.pagesCount?console.error(`goToDestination: "${pageNumber}" is not a valid page number, for dest="${dest}".`):(_this3.pdfHistory&&(_this3.pdfHistory.pushCurrentPosition(),_this3.pdfHistory.push({namedDest,explicitDest,pageNumber})),_this3.pdfViewer.scrollPageIntoView({pageNumber,destArray:explicitDest,ignoreDestinationZoom:_this3._ignoreDestinationZoom}))}))()}goToPage(val){if(!this.pdfDocument)return;const pageNumber="string"==typeof val&&this.pdfViewer.pageLabelToPageNumber(val)||0|val;Number.isInteger(pageNumber)&&pageNumber>0&&pageNumber<=this.pagesCount?(this.pdfHistory&&(this.pdfHistory.pushCurrentPosition(),this.pdfHistory.pushPage(pageNumber)),this.pdfViewer.scrollPageIntoView({pageNumber})):console.error(`PDFLinkService.goToPage: "${val}" is not a valid page.`)}addLinkAttributes(link,url,newWindow=!1){if(!url||"string"!=typeof url)throw new Error('A valid "url" parameter must provided.');const target=newWindow?LinkTarget.BLANK:this.externalLinkTarget,rel=this.externalLinkRel;this.externalLinkEnabled?link.href=link.title=url:(link.href="",link.title=`Disabled: ${url}`,link.onclick=()=>!1);let targetStr="";switch(target){case LinkTarget.NONE:break;case LinkTarget.SELF:targetStr="_self";break;case LinkTarget.BLANK:targetStr="_blank";break;case LinkTarget.PARENT:targetStr="_parent";break;case LinkTarget.TOP:targetStr="_top"}link.target=targetStr,link.rel="string"==typeof rel?rel:"noopener noreferrer nofollow"}getDestinationHash(dest){if("string"==typeof dest){if(dest.length>0)return this.getAnchorUrl("#"+escape(dest))}else if(Array.isArray(dest)){const str=JSON.stringify(dest);if(str.length>0)return this.getAnchorUrl("#"+escape(str))}return this.getAnchorUrl("")}getAnchorUrl(anchor){return this.baseUrl?this.baseUrl+anchor:anchor}setHash(hash){if(!this.pdfDocument)return;let pageNumber,dest;if(hash.includes("=")){const params=parseQueryString(hash);if(params.has("search")){const query=params.get("search").replaceAll('"',""),phrase="true"===params.get("phrase");this.eventBus.dispatch("findfromurlhash",{source:this,query:phrase?query:query.match(/\S+/g)})}if(params.has("page")&&(pageNumber=0|params.get("page")||1),params.has("zoom")){const zoomArgs=params.get("zoom").split(","),zoomArg=zoomArgs[0],zoomArgNumber=parseFloat(zoomArg);zoomArg.includes("Fit")?"Fit"===zoomArg||"FitB"===zoomArg?dest=[null,{name:zoomArg}]:"FitH"===zoomArg||"FitBH"===zoomArg||"FitV"===zoomArg||"FitBV"===zoomArg?dest=[null,{name:zoomArg},zoomArgs.length>1?0|zoomArgs[1]:null]:"FitR"===zoomArg?5!==zoomArgs.length?console.error('PDFLinkService.setHash: Not enough parameters for "FitR".'):dest=[null,{name:zoomArg},0|zoomArgs[1],0|zoomArgs[2],0|zoomArgs[3],0|zoomArgs[4]]:console.error(`PDFLinkService.setHash: "${zoomArg}" is not a valid zoom value.`):dest=[null,{name:"XYZ"},zoomArgs.length>1?0|zoomArgs[1]:null,zoomArgs.length>2?0|zoomArgs[2]:null,zoomArgNumber?zoomArgNumber/100:zoomArg]}return dest?this.pdfViewer.scrollPageIntoView({pageNumber:pageNumber||this.page,destArray:dest,allowNegativeOffset:!0}):pageNumber&&(this.page=pageNumber),params.has("pagemode")&&this.eventBus.dispatch("pagemode",{source:this,mode:params.get("pagemode")}),void(params.has("nameddest")&&this.goToDestination(params.get("nameddest")))}dest=unescape(hash);try{dest=JSON.parse(dest),Array.isArray(dest)||(dest=dest.toString())}catch{}"string"==typeof dest||PDFLinkService.#isValidExplicitDest(dest)?this.goToDestination(dest):console.error(`PDFLinkService.setHash: "${unescape(hash)}" is not a valid destination.`)}executeNamedAction(action){if(this.pdfDocument){switch(action){case"GoBack":this.pdfHistory?.back();break;case"GoForward":this.pdfHistory?.forward();break;case"NextPage":this.pdfViewer.nextPage();break;case"PrevPage":this.pdfViewer.previousPage();break;case"LastPage":this.page=this.pagesCount;break;case"FirstPage":this.page=1}this.eventBus.dispatch("namedaction",{source:this,action})}}executeSetOCGState(action){var _this4=this;return(0,asyncToGenerator.A)((function*(){if(!_this4.pdfDocument)return;const pdfDocument=_this4.pdfDocument,optionalContentConfig=yield _this4.pdfViewer.optionalContentConfigPromise;pdfDocument===_this4.pdfDocument&&(optionalContentConfig.setOCGState(action),_this4.pdfViewer.optionalContentConfigPromise=Promise.resolve(optionalContentConfig))}))()}static#isValidExplicitDest(dest){if(!Array.isArray(dest)||dest.length<2)return!1;const[page,zoom,...args]=dest;if(!("object"==typeof page&&Number.isInteger(page?.num)&&Number.isInteger(page?.gen)||Number.isInteger(page)))return!1;if("object"!=typeof zoom||"string"!=typeof zoom?.name)return!1;const argsLen=args.length;let allowNull=!0;switch(zoom.name){case"XYZ":if(argsLen<2||argsLen>3)return!1;break;case"Fit":case"FitB":return 0===argsLen;case"FitH":case"FitBH":case"FitV":case"FitBV":if(argsLen>1)return!1;break;case"FitR":if(4!==argsLen)return!1;allowNull=!1;break;default:return!1}for(const arg of args)if(!("number"==typeof arg||allowNull&&null===arg))return!1;return!0}}class SimpleLinkService extends PDFLinkService{setDocument(pdfDocument,baseUrl=null){}}const{AbortException:pdf_viewer_AbortException,AnnotationEditorLayer:pdf_viewer_AnnotationEditorLayer,AnnotationEditorParamsType:pdf_viewer_AnnotationEditorParamsType,AnnotationEditorType:pdf_viewer_AnnotationEditorType,AnnotationEditorUIManager:pdf_viewer_AnnotationEditorUIManager,AnnotationLayer:pdf_viewer_AnnotationLayer,AnnotationMode:pdf_viewer_AnnotationMode,build:pdf_viewer_build,ColorPicker:pdf_viewer_ColorPicker,createValidAbsoluteUrl:pdf_viewer_createValidAbsoluteUrl,DOMSVGFactory:pdf_viewer_DOMSVGFactory,DrawLayer:pdf_viewer_DrawLayer,FeatureTest:pdf_viewer_FeatureTest,fetchData:pdf_viewer_fetchData,getDocument:pdf_viewer_getDocument,getFilenameFromUrl:pdf_viewer_getFilenameFromUrl,getPdfFilenameFromUrl:pdf_viewer_getPdfFilenameFromUrl,getXfaPageViewport:pdf_viewer_getXfaPageViewport,GlobalWorkerOptions:pdf_viewer_GlobalWorkerOptions,ImageKind:pdf_viewer_ImageKind,InvalidPDFException:pdf_viewer_InvalidPDFException,isDataScheme:pdf_viewer_isDataScheme,isPdfFile:pdf_viewer_isPdfFile,MissingPDFException:pdf_viewer_MissingPDFException,noContextMenu:pdf_viewer_noContextMenu,normalizeUnicode:pdf_viewer_normalizeUnicode,OPS:pdf_viewer_OPS,OutputScale:pdf_viewer_OutputScale,PasswordResponses:pdf_viewer_PasswordResponses,PDFDataRangeTransport:pdf_viewer_PDFDataRangeTransport,PDFDateString:pdf_viewer_PDFDateString,PDFWorker:pdf_viewer_PDFWorker,PermissionFlag:pdf_viewer_PermissionFlag,PixelsPerInch:pdf_viewer_PixelsPerInch,RenderingCancelledException:pdf_viewer_RenderingCancelledException,setLayerDimensions:pdf_viewer_setLayerDimensions,shadow:pdf_viewer_shadow,TextLayer:pdf_viewer_TextLayer,UnexpectedResponseException:pdf_viewer_UnexpectedResponseException,Util:pdf_viewer_Util,VerbosityLevel:pdf_viewer_VerbosityLevel,version:pdf_viewer_version,XfaLayer:pdf_viewer_XfaLayer}=globalThis.pdfjsLib;class AnnotationLayerBuilder{#onAppend=null;#eventAbortController=null;constructor({pdfPage,linkService,downloadManager,annotationStorage=null,imageResourcesPath="",renderForms=!0,enableScripting=!1,hasJSActionsPromise=null,fieldObjectsPromise=null,annotationCanvasMap=null,accessibilityManager=null,annotationEditorUIManager=null,onAppend=null}){this.pdfPage=pdfPage,this.linkService=linkService,this.downloadManager=downloadManager,this.imageResourcesPath=imageResourcesPath,this.renderForms=renderForms,this.annotationStorage=annotationStorage,this.enableScripting=enableScripting,this._hasJSActionsPromise=hasJSActionsPromise||Promise.resolve(!1),this._fieldObjectsPromise=fieldObjectsPromise||Promise.resolve(null),this._annotationCanvasMap=annotationCanvasMap,this._accessibilityManager=accessibilityManager,this._annotationEditorUIManager=annotationEditorUIManager,this.#onAppend=onAppend,this.annotationLayer=null,this.div=null,this._cancelled=!1,this._eventBus=linkService.eventBus}render(viewport,options,intent="display"){var _this5=this;return(0,asyncToGenerator.A)((function*(){if(_this5.div){if(_this5._cancelled||!_this5.annotationLayer)return;return void _this5.annotationLayer.update({viewport:viewport.clone({dontFlip:!0})})}const[annotations,hasJSActions,fieldObjects]=yield Promise.all([_this5.pdfPage.getAnnotations({intent}),_this5._hasJSActionsPromise,_this5._fieldObjectsPromise]);if(_this5._cancelled)return;const div=_this5.div=document.createElement("div");div.className="annotationLayer",_this5.#onAppend?.(div),0!==annotations.length?(_this5.annotationLayer=new pdf_viewer_AnnotationLayer({div,accessibilityManager:_this5._accessibilityManager,annotationCanvasMap:_this5._annotationCanvasMap,annotationEditorUIManager:_this5._annotationEditorUIManager,page:_this5.pdfPage,viewport:viewport.clone({dontFlip:!0}),structTreeLayer:options?.structTreeLayer||null}),yield _this5.annotationLayer.render({annotations,imageResourcesPath:_this5.imageResourcesPath,renderForms:_this5.renderForms,linkService:_this5.linkService,downloadManager:_this5.downloadManager,annotationStorage:_this5.annotationStorage,enableScripting:_this5.enableScripting,hasJSActions,fieldObjects}),_this5.linkService.isInPresentationMode&&_this5.#updatePresentationModeState(PresentationModeState_FULLSCREEN),_this5.#eventAbortController||(_this5.#eventAbortController=new AbortController,_this5._eventBus?._on("presentationmodechanged",(evt=>{_this5.#updatePresentationModeState(evt.state)}),{signal:_this5.#eventAbortController.signal}))):_this5.hide()}))()}cancel(){this._cancelled=!0,this.#eventAbortController?.abort(),this.#eventAbortController=null}hide(){this.div&&(this.div.hidden=!0)}hasEditableAnnotations(){return!!this.annotationLayer?.hasEditableAnnotations()}#updatePresentationModeState(state){if(!this.div)return;let disableFormElements=!1;switch(state){case PresentationModeState_FULLSCREEN:disableFormElements=!0;break;case PresentationModeState_NORMAL:break;default:return}for(const section of this.div.childNodes)section.hasAttribute("data-internal-link")||(section.inert=disableFormElements)}}function download(blobUrl,filename){const a=document.createElement("a");if(!a.click)throw new Error('DownloadManager: "a.click()" is not supported.');a.href=blobUrl,a.target="_parent","download"in a&&(a.download=filename),(document.body||document.documentElement).append(a),a.click(),a.remove()}class DownloadManager{#openBlobUrls=new WeakMap;downloadData(data,filename,contentType){download(URL.createObjectURL(new Blob([data],{type:contentType})),filename)}openOrDownloadData(data,filename,dest=null){const contentType=pdf_viewer_isPdfFile(filename)?"application/pdf":"";return this.downloadData(data,filename,contentType),!1}download(data,url,filename){let blobUrl;if(data)blobUrl=URL.createObjectURL(new Blob([data],{type:"application/pdf"}));else{if(!pdf_viewer_createValidAbsoluteUrl(url,"http://example.com"))return void console.error(`download - not a valid URL: ${url}`);blobUrl=url+"#pdfjs.action=download"}download(blobUrl,filename)}}const WaitOnType={EVENT:"event",TIMEOUT:"timeout"};function _waitOnEventOrTimeout(){return(_waitOnEventOrTimeout=(0,asyncToGenerator.A)((function*({target,name,delay=0}){if("object"!=typeof target||!name||"string"!=typeof name||!(Number.isInteger(delay)&&delay>=0))throw new Error("waitOnEventOrTimeout - invalid parameters.");const{promise,resolve}=Promise.withResolvers(),ac=new AbortController;function handler(type){ac.abort(),clearTimeout(timeout),resolve(type)}target[target instanceof EventBus?"_on":"addEventListener"](name,handler.bind(null,WaitOnType.EVENT),{signal:ac.signal});const timeout=setTimeout(handler.bind(null,WaitOnType.TIMEOUT),delay);return promise}))).apply(this,arguments)}class EventBus{#listeners=Object.create(null);on(eventName,listener,options=null){this._on(eventName,listener,{external:!0,once:options?.once,signal:options?.signal})}off(eventName,listener,options=null){this._off(eventName,listener)}dispatch(eventName,data){const eventListeners=this.#listeners[eventName];if(!eventListeners||0===eventListeners.length)return;let externalListeners;for(const{listener,external,once}of eventListeners.slice(0))once&&this._off(eventName,listener),external?(externalListeners||=[]).push(listener):listener(data);if(externalListeners){for(const listener of externalListeners)listener(data);externalListeners=null}}_on(eventName,listener,options=null){let rmAbort=null;if(options?.signal instanceof AbortSignal){const{signal}=options;if(signal.aborted)return void console.error("Cannot use an `aborted` signal.");const onAbort=()=>this._off(eventName,listener);rmAbort=()=>signal.removeEventListener("abort",onAbort),signal.addEventListener("abort",onAbort)}(this.#listeners[eventName]||=[]).push({listener,external:!0===options?.external,once:!0===options?.once,rmAbort})}_off(eventName,listener,options=null){const eventListeners=this.#listeners[eventName];if(eventListeners)for(let i=0,ii=eventListeners.length;i<ii;i++){const evt=eventListeners[i];if(evt.listener===listener)return evt.rmAbort?.(),void eventListeners.splice(i,1)}}}class FluentType{constructor(value){this.value=value}valueOf(){return this.value}}class FluentNone extends FluentType{constructor(value="???"){super(value)}toString(scope){return`{${this.value}}`}}class FluentNumber extends FluentType{constructor(value,opts={}){super(value),this.opts=opts}toString(scope){try{return scope.memoizeIntlObject(Intl.NumberFormat,this.opts).format(this.value)}catch(err){return scope.reportError(err),this.value.toString(10)}}}class FluentDateTime extends FluentType{constructor(value,opts={}){super(value),this.opts=opts}toString(scope){try{return scope.memoizeIntlObject(Intl.DateTimeFormat,this.opts).format(this.value)}catch(err){return scope.reportError(err),new Date(this.value).toISOString()}}}const MAX_PLACEABLES=100,FSI="⁨",PDI="⁩";function match(scope,selector,key){if(key===selector)return!0;if(key instanceof FluentNumber&&selector instanceof FluentNumber&&key.value===selector.value)return!0;if(selector instanceof FluentNumber&&"string"==typeof key){if(key===scope.memoizeIntlObject(Intl.PluralRules,selector.opts).select(selector.value))return!0}return!1}function getDefault(scope,variants,star){return variants[star]?resolvePattern(scope,variants[star].value):(scope.reportError(new RangeError("No default")),new FluentNone)}function getArguments(scope,args){const positional=[],named=Object.create(null);for(const arg of args)"narg"===arg.type?named[arg.name]=resolveExpression(scope,arg.value):positional.push(resolveExpression(scope,arg));return{positional,named}}function resolveExpression(scope,expr){switch(expr.type){case"str":return expr.value;case"num":return new FluentNumber(expr.value,{minimumFractionDigits:expr.precision});case"var":return function resolveVariableReference(scope,{name}){let arg;if(scope.params){if(!Object.prototype.hasOwnProperty.call(scope.params,name))return new FluentNone(`$${name}`);arg=scope.params[name]}else{if(!scope.args||!Object.prototype.hasOwnProperty.call(scope.args,name))return scope.reportError(new ReferenceError(`Unknown variable: $${name}`)),new FluentNone(`$${name}`);arg=scope.args[name]}if(arg instanceof FluentType)return arg;switch(typeof arg){case"string":return arg;case"number":return new FluentNumber(arg);case"object":if(arg instanceof Date)return new FluentDateTime(arg.getTime());default:return scope.reportError(new TypeError(`Variable type not supported: $${name}, ${typeof arg}`)),new FluentNone(`$${name}`)}}(scope,expr);case"mesg":return function resolveMessageReference(scope,{name,attr}){const message=scope.bundle._messages.get(name);if(!message)return scope.reportError(new ReferenceError(`Unknown message: ${name}`)),new FluentNone(name);if(attr){const attribute=message.attributes[attr];return attribute?resolvePattern(scope,attribute):(scope.reportError(new ReferenceError(`Unknown attribute: ${attr}`)),new FluentNone(`${name}.${attr}`))}if(message.value)return resolvePattern(scope,message.value);return scope.reportError(new ReferenceError(`No value: ${name}`)),new FluentNone(name)}(scope,expr);case"term":return function resolveTermReference(scope,{name,attr,args}){const id=`-${name}`,term=scope.bundle._terms.get(id);if(!term)return scope.reportError(new ReferenceError(`Unknown term: ${id}`)),new FluentNone(id);if(attr){const attribute=term.attributes[attr];if(attribute){scope.params=getArguments(scope,args).named;const resolved=resolvePattern(scope,attribute);return scope.params=null,resolved}return scope.reportError(new ReferenceError(`Unknown attribute: ${attr}`)),new FluentNone(`${id}.${attr}`)}scope.params=getArguments(scope,args).named;const resolved=resolvePattern(scope,term.value);return scope.params=null,resolved}(scope,expr);case"func":return function resolveFunctionReference(scope,{name,args}){let func=scope.bundle._functions[name];if(!func)return scope.reportError(new ReferenceError(`Unknown function: ${name}()`)),new FluentNone(`${name}()`);if("function"!=typeof func)return scope.reportError(new TypeError(`Function ${name}() is not callable`)),new FluentNone(`${name}()`);try{let resolved=getArguments(scope,args);return func(resolved.positional,resolved.named)}catch(err){return scope.reportError(err),new FluentNone(`${name}()`)}}(scope,expr);case"select":return function resolveSelectExpression(scope,{selector,variants,star}){let sel=resolveExpression(scope,selector);if(sel instanceof FluentNone)return getDefault(scope,variants,star);for(const variant of variants){if(match(scope,sel,resolveExpression(scope,variant.key)))return resolvePattern(scope,variant.value)}return getDefault(scope,variants,star)}(scope,expr);default:return new FluentNone}}function resolveComplexPattern(scope,ptn){if(scope.dirty.has(ptn))return scope.reportError(new RangeError("Cyclic reference")),new FluentNone;scope.dirty.add(ptn);const result=[],useIsolating=scope.bundle._useIsolating&&ptn.length>1;for(const elem of ptn)if("string"!=typeof elem){if(scope.placeables++,scope.placeables>MAX_PLACEABLES)throw scope.dirty.delete(ptn),new RangeError(`Too many placeables expanded: ${scope.placeables}, max allowed is ${MAX_PLACEABLES}`);useIsolating&&result.push(FSI),result.push(resolveExpression(scope,elem).toString(scope)),useIsolating&&result.push(PDI)}else result.push(scope.bundle._transform(elem));return scope.dirty.delete(ptn),result.join("")}function resolvePattern(scope,value){return"string"==typeof value?scope.bundle._transform(value):resolveComplexPattern(scope,value)}class Scope{constructor(bundle,errors,args){this.dirty=new WeakSet,this.params=null,this.placeables=0,this.bundle=bundle,this.errors=errors,this.args=args}reportError(error){if(!(this.errors&&error instanceof Error))throw error;this.errors.push(error)}memoizeIntlObject(ctor,opts){let cache=this.bundle._intls.get(ctor);cache||(cache={},this.bundle._intls.set(ctor,cache));let id=JSON.stringify(opts);return cache[id]||(cache[id]=new ctor(this.bundle.locales,opts)),cache[id]}}function values(opts,allowed){const unwrapped=Object.create(null);for(const[name,opt]of Object.entries(opts))allowed.includes(name)&&(unwrapped[name]=opt.valueOf());return unwrapped}const NUMBER_ALLOWED=["unitDisplay","currencyDisplay","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits"];function NUMBER(args,opts){let arg=args[0];if(arg instanceof FluentNone)return new FluentNone(`NUMBER(${arg.valueOf()})`);if(arg instanceof FluentNumber)return new FluentNumber(arg.valueOf(),{...arg.opts,...values(opts,NUMBER_ALLOWED)});if(arg instanceof FluentDateTime)return new FluentNumber(arg.valueOf(),{...values(opts,NUMBER_ALLOWED)});throw new TypeError("Invalid argument to NUMBER")}const DATETIME_ALLOWED=["dateStyle","timeStyle","fractionalSecondDigits","dayPeriod","hour12","weekday","era","year","month","day","hour","minute","second","timeZoneName"];function DATETIME(args,opts){let arg=args[0];if(arg instanceof FluentNone)return new FluentNone(`DATETIME(${arg.valueOf()})`);if(arg instanceof FluentDateTime)return new FluentDateTime(arg.valueOf(),{...arg.opts,...values(opts,DATETIME_ALLOWED)});if(arg instanceof FluentNumber)return new FluentDateTime(arg.valueOf(),{...values(opts,DATETIME_ALLOWED)});throw new TypeError("Invalid argument to DATETIME")}const cache=new Map;class FluentBundle{constructor(locales,{functions,useIsolating=!0,transform=v=>v}={}){this._terms=new Map,this._messages=new Map,this.locales=Array.isArray(locales)?locales:[locales],this._functions={NUMBER,DATETIME,...functions},this._useIsolating=useIsolating,this._transform=transform,this._intls=function getMemoizerForLocale(locales){const stringLocale=Array.isArray(locales)?locales.join(" "):locales;let memoizer=cache.get(stringLocale);return void 0===memoizer&&(memoizer=new Map,cache.set(stringLocale,memoizer)),memoizer}(locales)}hasMessage(id){return this._messages.has(id)}getMessage(id){return this._messages.get(id)}addResource(res,{allowOverrides=!1}={}){const errors=[];for(let i=0;i<res.body.length;i++){let entry=res.body[i];if(entry.id.startsWith("-")){if(!1===allowOverrides&&this._terms.has(entry.id)){errors.push(new Error(`Attempt to override an existing term: "${entry.id}"`));continue}this._terms.set(entry.id,entry)}else{if(!1===allowOverrides&&this._messages.has(entry.id)){errors.push(new Error(`Attempt to override an existing message: "${entry.id}"`));continue}this._messages.set(entry.id,entry)}}return errors}formatPattern(pattern,args=null,errors=null){if("string"==typeof pattern)return this._transform(pattern);let scope=new Scope(this,errors,args);try{return resolveComplexPattern(scope,pattern).toString(scope)}catch(err){if(scope.errors&&err instanceof Error)return scope.errors.push(err),(new FluentNone).toString(scope);throw err}}}const RE_MESSAGE_START=/^(-?[a-zA-Z][\w-]*) *= */gm,RE_ATTRIBUTE_START=/\.([a-zA-Z][\w-]*) *= */y,RE_VARIANT_START=/\*?\[/y,RE_NUMBER_LITERAL=/(-?[0-9]+(?:\.([0-9]+))?)/y,RE_IDENTIFIER=/([a-zA-Z][\w-]*)/y,RE_REFERENCE=/([$-])?([a-zA-Z][\w-]*)(?:\.([a-zA-Z][\w-]*))?/y,RE_FUNCTION_NAME=/^[A-Z][A-Z0-9_-]*$/,RE_TEXT_RUN=/([^{}\n\r]+)/y,RE_STRING_RUN=/([^\\"\n\r]*)/y,RE_STRING_ESCAPE=/\\([\\"])/y,RE_UNICODE_ESCAPE=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{6})/y,RE_LEADING_NEWLINES=/^\n+/,RE_TRAILING_SPACES=/ +$/,RE_BLANK_LINES=/ *\r?\n/g,RE_INDENT=/( *)$/,TOKEN_BRACE_OPEN=/{\s*/y,TOKEN_BRACE_CLOSE=/\s*}/y,TOKEN_BRACKET_OPEN=/\[\s*/y,TOKEN_BRACKET_CLOSE=/\s*] */y,TOKEN_PAREN_OPEN=/\s*\(\s*/y,TOKEN_ARROW=/\s*->\s*/y,TOKEN_COLON=/\s*:\s*/y,TOKEN_COMMA=/\s*,?\s*/y,TOKEN_BLANK=/\s+/y;class FluentResource{constructor(source){this.body=[],RE_MESSAGE_START.lastIndex=0;let cursor=0;for(;;){let next=RE_MESSAGE_START.exec(source);if(null===next)break;cursor=RE_MESSAGE_START.lastIndex;try{this.body.push(parseMessage(next[1]))}catch(err){if(err instanceof SyntaxError)continue;throw err}}function test(re){return re.lastIndex=cursor,re.test(source)}function consumeChar(char,errorClass){if(source[cursor]===char)return cursor++,!0;if(errorClass)throw new errorClass(`Expected ${char}`);return!1}function consumeToken(re,errorClass){if(test(re))return cursor=re.lastIndex,!0;if(errorClass)throw new errorClass(`Expected ${re.toString()}`);return!1}function match(re){re.lastIndex=cursor;let result=re.exec(source);if(null===result)throw new SyntaxError(`Expected ${re.toString()}`);return cursor=re.lastIndex,result}function match1(re){return match(re)[1]}function parseMessage(id){let value=parsePattern(),attributes=function parseAttributes(){let attrs=Object.create(null);for(;test(RE_ATTRIBUTE_START);){let name=match1(RE_ATTRIBUTE_START),value=parsePattern();if(null===value)throw new SyntaxError("Expected attribute value");attrs[name]=value}return attrs}();if(null===value&&0===Object.keys(attributes).length)throw new SyntaxError("Expected message value or attributes");return{id,value,attributes}}function parsePattern(){let first;if(test(RE_TEXT_RUN)&&(first=match1(RE_TEXT_RUN)),"{"===source[cursor]||"}"===source[cursor])return parsePatternElements(first?[first]:[],1/0);let indent=parseIndent();return indent?first?parsePatternElements([first,indent],indent.length):(indent.value=trim(indent.value,RE_LEADING_NEWLINES),parsePatternElements([indent],indent.length)):first?trim(first,RE_TRAILING_SPACES):null}function parsePatternElements(elements=[],commonIndent){for(;;){if(test(RE_TEXT_RUN)){elements.push(match1(RE_TEXT_RUN));continue}if("{"===source[cursor]){elements.push(parsePlaceable());continue}if("}"===source[cursor])throw new SyntaxError("Unbalanced closing brace");let indent=parseIndent();if(!indent)break;elements.push(indent),commonIndent=Math.min(commonIndent,indent.length)}let lastIndex=elements.length-1,lastElement=elements[lastIndex];"string"==typeof lastElement&&(elements[lastIndex]=trim(lastElement,RE_TRAILING_SPACES));let baked=[];for(let element of elements)element instanceof Indent&&(element=element.value.slice(0,element.value.length-commonIndent)),element&&baked.push(element);return baked}function parsePlaceable(){consumeToken(TOKEN_BRACE_OPEN,SyntaxError);let selector=parseInlineExpression();if(consumeToken(TOKEN_BRACE_CLOSE))return selector;if(consumeToken(TOKEN_ARROW)){let variants=function parseVariants(){let star,variants=[],count=0;for(;test(RE_VARIANT_START);){consumeChar("*")&&(star=count);let key=parseVariantKey(),value=parsePattern();if(null===value)throw new SyntaxError("Expected variant value");variants[count++]={key,value}}if(0===count)return null;if(void 0===star)throw new SyntaxError("Expected default variant");return{variants,star}}();return consumeToken(TOKEN_BRACE_CLOSE,SyntaxError),{type:"select",selector,...variants}}throw new SyntaxError("Unclosed placeable")}function parseInlineExpression(){if("{"===source[cursor])return parsePlaceable();if(test(RE_REFERENCE)){let[,sigil,name,attr=null]=match(RE_REFERENCE);if("$"===sigil)return{type:"var",name};if(consumeToken(TOKEN_PAREN_OPEN)){let args=function parseArguments(){let args=[];for(;;){switch(source[cursor]){case")":return cursor++,args;case void 0:throw new SyntaxError("Unclosed argument list")}args.push(parseArgument()),consumeToken(TOKEN_COMMA)}}();if("-"===sigil)return{type:"term",name,attr,args};if(RE_FUNCTION_NAME.test(name))return{type:"func",name,args};throw new SyntaxError("Function names must be all upper-case")}return"-"===sigil?{type:"term",name,attr,args:[]}:{type:"mesg",name,attr}}return parseLiteral()}function parseArgument(){let expr=parseInlineExpression();return"mesg"!==expr.type?expr:consumeToken(TOKEN_COLON)?{type:"narg",name:expr.name,value:parseLiteral()}:expr}function parseVariantKey(){let key;return consumeToken(TOKEN_BRACKET_OPEN,SyntaxError),key=test(RE_NUMBER_LITERAL)?parseNumberLiteral():{type:"str",value:match1(RE_IDENTIFIER)},consumeToken(TOKEN_BRACKET_CLOSE,SyntaxError),key}function parseLiteral(){if(test(RE_NUMBER_LITERAL))return parseNumberLiteral();if('"'===source[cursor])return function parseStringLiteral(){consumeChar('"',SyntaxError);let value="";for(;;){if(value+=match1(RE_STRING_RUN),"\\"!==source[cursor]){if(consumeChar('"'))return{type:"str",value};throw new SyntaxError("Unclosed string literal")}value+=parseEscapeSequence()}}();throw new SyntaxError("Invalid expression")}function parseNumberLiteral(){let[,value,fraction=""]=match(RE_NUMBER_LITERAL),precision=fraction.length;return{type:"num",value:parseFloat(value),precision}}function parseEscapeSequence(){if(test(RE_STRING_ESCAPE))return match1(RE_STRING_ESCAPE);if(test(RE_UNICODE_ESCAPE)){let[,codepoint4,codepoint6]=match(RE_UNICODE_ESCAPE),codepoint=parseInt(codepoint4||codepoint6,16);return codepoint<=55295||57344<=codepoint?String.fromCodePoint(codepoint):"�"}throw new SyntaxError("Unknown escape sequence")}function parseIndent(){let start=cursor;switch(consumeToken(TOKEN_BLANK),source[cursor]){case".":case"[":case"*":case"}":case void 0:return!1;case"{":return makeIndent(source.slice(start,cursor))}return" "===source[cursor-1]&&makeIndent(source.slice(start,cursor))}function trim(text,re){return text.replace(re,"")}function makeIndent(blank){let value=blank.replace(RE_BLANK_LINES,"\n"),length=RE_INDENT.exec(blank)[1].length;return new Indent(value,length)}}}class Indent{constructor(value,length){this.value=value,this.length=length}}const reOverlay=/<|&#?\w+;/,TEXT_LEVEL_ELEMENTS={"http://www.w3.org/1999/xhtml":["em","strong","small","s","cite","q","dfn","abbr","data","time","code","var","samp","kbd","sub","sup","i","b","u","mark","bdi","bdo","span","br","wbr"]},LOCALIZABLE_ATTRIBUTES={"http://www.w3.org/1999/xhtml":{global:["title","aria-label","aria-valuetext"],a:["download"],area:["download","alt"],input:["alt","placeholder"],menuitem:["label"],menu:["label"],optgroup:["label"],option:["label"],track:["label"],img:["alt"],textarea:["placeholder"],th:["abbr"]},"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul":{global:["accesskey","aria-label","aria-valuetext","label","title","tooltiptext"],description:["value"],key:["key","keycode"],label:["value"],textbox:["placeholder","value"]}};function translateElement(element,translation){const{value}=translation;if("string"==typeof value)if("title"===element.localName&&"http://www.w3.org/1999/xhtml"===element.namespaceURI)element.textContent=value;else if(reOverlay.test(value)){const templateElement=element.ownerDocument.createElementNS("http://www.w3.org/1999/xhtml","template");templateElement.innerHTML=value,function overlayChildNodes(fromFragment,toElement){for(const childNode of fromFragment.childNodes)if(childNode.nodeType!==childNode.TEXT_NODE)if(childNode.hasAttribute("data-l10n-name")){const sanitized=getNodeForNamedElement(toElement,childNode);fromFragment.replaceChild(sanitized,childNode)}else if(isElementAllowed(childNode)){const sanitized=createSanitizedElement(childNode);fromFragment.replaceChild(sanitized,childNode)}else console.warn(`An element of forbidden type "${childNode.localName}" was found in the translation. Only safe text-level elements and elements with data-l10n-name are allowed.`),fromFragment.replaceChild(createTextNodeFromTextContent(childNode),childNode);toElement.textContent="",toElement.appendChild(fromFragment)}(templateElement.content,element)}else element.textContent=value;overlayAttributes(translation,element)}function hasAttribute(attributes,name){if(!attributes)return!1;for(let attr of attributes)if(attr.name===name)return!0;return!1}function overlayAttributes(fromElement,toElement){const explicitlyAllowed=toElement.hasAttribute("data-l10n-attrs")?toElement.getAttribute("data-l10n-attrs").split(",").map((i=>i.trim())):null;for(const attr of Array.from(toElement.attributes))isAttrNameLocalizable(attr.name,toElement,explicitlyAllowed)&&!hasAttribute(fromElement.attributes,attr.name)&&toElement.removeAttribute(attr.name);if(fromElement.attributes)for(const attr of Array.from(fromElement.attributes))isAttrNameLocalizable(attr.name,toElement,explicitlyAllowed)&&toElement.getAttribute(attr.name)!==attr.value&&toElement.setAttribute(attr.name,attr.value)}function getNodeForNamedElement(sourceElement,translatedChild){const childName=translatedChild.getAttribute("data-l10n-name"),sourceChild=sourceElement.querySelector(`[data-l10n-name="${childName}"]`);if(!sourceChild)return console.warn(`An element named "${childName}" wasn't found in the source.`),createTextNodeFromTextContent(translatedChild);if(sourceChild.localName!==translatedChild.localName)return console.warn(`An element named "${childName}" was found in the translation but its type ${translatedChild.localName} didn't match the element found in the source (${sourceChild.localName}).`),createTextNodeFromTextContent(translatedChild);sourceElement.removeChild(sourceChild);return shallowPopulateUsing(translatedChild,sourceChild.cloneNode(!1))}function createSanitizedElement(element){const clone=element.ownerDocument.createElement(element.localName);return shallowPopulateUsing(element,clone)}function createTextNodeFromTextContent(element){return element.ownerDocument.createTextNode(element.textContent)}function isElementAllowed(element){const allowed=TEXT_LEVEL_ELEMENTS[element.namespaceURI];return allowed&&allowed.includes(element.localName)}function isAttrNameLocalizable(name,element,explicitlyAllowed=null){if(explicitlyAllowed&&explicitlyAllowed.includes(name))return!0;const allowed=LOCALIZABLE_ATTRIBUTES[element.namespaceURI];if(!allowed)return!1;const attrName=name.toLowerCase(),elemName=element.localName;if(allowed.global.includes(attrName))return!0;if(!allowed[elemName])return!1;if(allowed[elemName].includes(attrName))return!0;if("http://www.w3.org/1999/xhtml"===element.namespaceURI&&"input"===elemName&&"value"===attrName){const type=element.type.toLowerCase();if("submit"===type||"button"===type||"reset"===type)return!0}return!1}function shallowPopulateUsing(fromElement,toElement){return toElement.textContent=fromElement.textContent,overlayAttributes(fromElement,toElement),toElement}class CachedIterable extends Array{static from(iterable){return iterable instanceof this?iterable:new this(iterable)}}Symbol.iterator;class CachedAsyncIterable extends CachedIterable{constructor(iterable){if(super(),Symbol.asyncIterator in Object(iterable))this.iterator=iterable[Symbol.asyncIterator]();else{if(!(Symbol.iterator in Object(iterable)))throw new TypeError("Argument must implement the iteration protocol.");this.iterator=iterable[Symbol.iterator]()}}[Symbol.asyncIterator](){const cached=this;let cur=0;return{next:()=>(0,asyncToGenerator.A)((function*(){return cached.length<=cur&&cached.push(cached.iterator.next()),cached[cur++]}))()}}touchNext(count=1){var _this6=this;return(0,asyncToGenerator.A)((function*(){let idx=0;for(;idx++<count;){const last=_this6[_this6.length-1];if(last&&(yield last).done)break;_this6.push(_this6.iterator.next())}return _this6[_this6.length-1]}))()}}class Localization{constructor(resourceIds=[],generateBundles){this.resourceIds=resourceIds,this.generateBundles=generateBundles,this.onChange(!0)}addResourceIds(resourceIds,eager=!1){return this.resourceIds.push(...resourceIds),this.onChange(eager),this.resourceIds.length}removeResourceIds(resourceIds){return this.resourceIds=this.resourceIds.filter((r=>!resourceIds.includes(r))),this.onChange(),this.resourceIds.length}formatWithFallback(keys,method){var _this7=this;return(0,asyncToGenerator.A)((function*(){const translations=[];let hasAtLeastOneBundle=!1;var _iteratorError,_iteratorAbruptCompletion=!1,_didIteratorError=!1;try{for(var _step,_iterator=function _asyncIterator(r){var n,t,o,e=2;for("undefined"!=typeof Symbol&&(t=Symbol.asyncIterator,o=Symbol.iterator);e--;){if(t&&null!=(n=r[t]))return n.call(r);if(o&&null!=(n=r[o]))return new AsyncFromSyncIterator(n.call(r));t="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}(_this7.bundles);_iteratorAbruptCompletion=!(_step=yield _iterator.next()).done;_iteratorAbruptCompletion=!1){const bundle=_step.value;{hasAtLeastOneBundle=!0;const missingIds=keysFromBundle(method,bundle,keys,translations);if(0===missingIds.size)break;if("undefined"!=typeof console){const locale=bundle.locales[0],ids=Array.from(missingIds).join(", ");console.warn(`[fluent] Missing translations in ${locale}: ${ids}`)}}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorAbruptCompletion&&null!=_iterator.return&&(yield _iterator.return())}finally{if(_didIteratorError)throw _iteratorError}}return hasAtLeastOneBundle||"undefined"==typeof console||console.warn(`[fluent] Request for keys failed because no resource bundles got generated.\n  keys: ${JSON.stringify(keys)}.\n  resourceIds: ${JSON.stringify(_this7.resourceIds)}.`),translations}))()}formatMessages(keys){return this.formatWithFallback(keys,messageFromBundle)}formatValues(keys){return this.formatWithFallback(keys,valueFromBundle)}formatValue(id,args){var _this8=this;return(0,asyncToGenerator.A)((function*(){const[val]=yield _this8.formatValues([{id,args}]);return val}))()}handleEvent(){this.onChange()}onChange(eager=!1){this.bundles=CachedAsyncIterable.from(this.generateBundles(this.resourceIds)),eager&&this.bundles.touchNext(2)}}function valueFromBundle(bundle,errors,message,args){return message.value?bundle.formatPattern(message.value,args,errors):null}function messageFromBundle(bundle,errors,message,args){const formatted={value:null,attributes:null};message.value&&(formatted.value=bundle.formatPattern(message.value,args,errors));let attrNames=Object.keys(message.attributes);if(attrNames.length>0){formatted.attributes=new Array(attrNames.length);for(let[i,name]of attrNames.entries()){let value=bundle.formatPattern(message.attributes[name],args,errors);formatted.attributes[i]={name,value}}}return formatted}function keysFromBundle(method,bundle,keys,translations){const messageErrors=[],missingIds=new Set;return keys.forEach((({id,args},i)=>{if(void 0!==translations[i])return;let message=bundle.getMessage(id);if(message){if(messageErrors.length=0,translations[i]=method(bundle,messageErrors,message,args),messageErrors.length>0&&"undefined"!=typeof console){const locale=bundle.locales[0],errors=messageErrors.join(", ");console.warn(`[fluent][resolver] errors in ${locale}/${id}: ${errors}.`)}}else missingIds.add(id)})),missingIds}class DOMLocalization extends Localization{constructor(resourceIds,generateBundles){super(resourceIds,generateBundles),this.roots=new Set,this.pendingrAF=null,this.pendingElements=new Set,this.windowElement=null,this.mutationObserver=null,this.observerConfig={attributes:!0,characterData:!1,childList:!0,subtree:!0,attributeFilter:["data-l10n-id","data-l10n-args"]}}onChange(eager=!1){super.onChange(eager),this.roots&&this.translateRoots()}setAttributes(element,id,args){return element.setAttribute("data-l10n-id",id),args?element.setAttribute("data-l10n-args",JSON.stringify(args)):element.removeAttribute("data-l10n-args"),element}getAttributes(element){return{id:element.getAttribute("data-l10n-id"),args:JSON.parse(element.getAttribute("data-l10n-args")||null)}}connectRoot(newRoot){for(const root of this.roots)if(root===newRoot||root.contains(newRoot)||newRoot.contains(root))throw new Error("Cannot add a root that overlaps with existing root.");if(this.windowElement){if(this.windowElement!==newRoot.ownerDocument.defaultView)throw new Error("Cannot connect a root:\n          DOMLocalization already has a root from a different window.")}else this.windowElement=newRoot.ownerDocument.defaultView,this.mutationObserver=new this.windowElement.MutationObserver((mutations=>this.translateMutations(mutations)));this.roots.add(newRoot),this.mutationObserver.observe(newRoot,this.observerConfig)}disconnectRoot(root){return this.roots.delete(root),this.pauseObserving(),0===this.roots.size?(this.mutationObserver=null,this.windowElement&&this.pendingrAF&&this.windowElement.cancelAnimationFrame(this.pendingrAF),this.windowElement=null,this.pendingrAF=null,this.pendingElements.clear(),!0):(this.resumeObserving(),!1)}translateRoots(){const roots=Array.from(this.roots);return Promise.all(roots.map((root=>this.translateFragment(root))))}pauseObserving(){this.mutationObserver&&(this.translateMutations(this.mutationObserver.takeRecords()),this.mutationObserver.disconnect())}resumeObserving(){if(this.mutationObserver)for(const root of this.roots)this.mutationObserver.observe(root,this.observerConfig)}translateMutations(mutations){for(const mutation of mutations)switch(mutation.type){case"attributes":mutation.target.hasAttribute("data-l10n-id")&&this.pendingElements.add(mutation.target);break;case"childList":for(const addedNode of mutation.addedNodes)if(addedNode.nodeType===addedNode.ELEMENT_NODE)if(addedNode.childElementCount)for(const element of this.getTranslatables(addedNode))this.pendingElements.add(element);else addedNode.hasAttribute("data-l10n-id")&&this.pendingElements.add(addedNode)}this.pendingElements.size>0&&null===this.pendingrAF&&(this.pendingrAF=this.windowElement.requestAnimationFrame((()=>{this.translateElements(Array.from(this.pendingElements)),this.pendingElements.clear(),this.pendingrAF=null})))}translateFragment(frag){return this.translateElements(this.getTranslatables(frag))}translateElements(elements){var _this9=this;return(0,asyncToGenerator.A)((function*(){if(!elements.length)return;const keys=elements.map(_this9.getKeysForElement),translations=yield _this9.formatMessages(keys);return _this9.applyTranslations(elements,translations)}))()}applyTranslations(elements,translations){this.pauseObserving();for(let i=0;i<elements.length;i++)void 0!==translations[i]&&translateElement(elements[i],translations[i]);this.resumeObserving()}getTranslatables(element){const nodes=Array.from(element.querySelectorAll("[data-l10n-id]"));return"function"==typeof element.hasAttribute&&element.hasAttribute("data-l10n-id")&&nodes.push(element),nodes}getKeysForElement(element){return{id:element.getAttribute("data-l10n-id"),args:JSON.parse(element.getAttribute("data-l10n-args")||null)}}}class L10n{#dir;#elements;#lang;#l10n;constructor({lang,isRTL},l10n=null){this.#lang=L10n.#fixupLangCode(lang),this.#l10n=l10n,this.#dir=isRTL??L10n.#isRTL(this.#lang)?"rtl":"ltr"}_setL10n(l10n){this.#l10n=l10n}getLanguage(){return this.#lang}getDirection(){return this.#dir}get(ids,args=null,fallback){var _this10=this;return(0,asyncToGenerator.A)((function*(){if(Array.isArray(ids)){ids=ids.map((id=>({id})));return(yield _this10.#l10n.formatMessages(ids)).map((message=>message.value))}const messages=yield _this10.#l10n.formatMessages([{id:ids,args}]);return messages[0]?.value||fallback}))()}translate(element){var _this11=this;return(0,asyncToGenerator.A)((function*(){(_this11.#elements||=new Set).add(element);try{_this11.#l10n.connectRoot(element),yield _this11.#l10n.translateRoots()}catch{}}))()}translateOnce(element){var _this12=this;return(0,asyncToGenerator.A)((function*(){try{yield _this12.#l10n.translateElements([element])}catch(ex){console.error(`translateOnce: "${ex}".`)}}))()}destroy(){var _this13=this;return(0,asyncToGenerator.A)((function*(){if(_this13.#elements){for(const element of _this13.#elements)_this13.#l10n.disconnectRoot(element);_this13.#elements.clear(),_this13.#elements=null}_this13.#l10n.pauseObserving()}))()}pause(){this.#l10n.pauseObserving()}resume(){this.#l10n.resumeObserving()}static#fixupLangCode(langCode){return{en:"en-us",es:"es-es",fy:"fy-nl",ga:"ga-ie",gu:"gu-in",hi:"hi-in",hy:"hy-am",nb:"nb-no",ne:"ne-np",nn:"nn-no",pa:"pa-in",pt:"pt-pt",sv:"sv-se",zh:"zh-cn"}[langCode=langCode?.toLowerCase()||"en-us"]||langCode}static#isRTL(lang){const shortCode=lang.split("-",1)[0];return["ar","he","fa","ps","ur"].includes(shortCode)}}function createBundle(lang,text){const resource=new FluentResource(text),bundle=new FluentBundle(lang),errors=bundle.addResource(resource);return errors.length&&console.error("L10n errors",errors),bundle}class genericl10n_GenericL10n extends L10n{constructor(lang){super({lang});const generateBundles=lang?genericl10n_GenericL10n.#generateBundles.bind(genericl10n_GenericL10n,"en-us",this.getLanguage()):genericl10n_GenericL10n.#generateBundlesFallback.bind(genericl10n_GenericL10n,this.getLanguage());this._setL10n(new DOMLocalization([],generateBundles))}static#generateBundles(defaultLang,baseLang){var _this=this;return _wrapAsyncGenerator((function*(){const{baseURL,paths}=yield _awaitAsyncGenerator(_this.#getPaths()),langs=[baseLang];if(defaultLang!==baseLang){const shortLang=baseLang.split("-",1)[0];shortLang!==baseLang&&langs.push(shortLang),langs.push(defaultLang)}for(const lang of langs){const bundle=yield _awaitAsyncGenerator(_this.#createBundle(lang,baseURL,paths));bundle?yield bundle:"en-us"===lang&&(yield _this.#createBundleFallback(lang))}}))()}static#createBundle(lang,baseURL,paths){return(0,asyncToGenerator.A)((function*(){const path=paths[lang];if(!path)return null;const url=new URL(path,baseURL),text=yield pdf_viewer_fetchData(url,"text");return createBundle(lang,text)}))()}static#getPaths(){return(0,asyncToGenerator.A)((function*(){try{const{href}=document.querySelector('link[type="application/l10n"]'),paths=yield pdf_viewer_fetchData(href,"json");return{baseURL:href.replace(/[^/]*$/,"")||"./",paths}}catch{}return{baseURL:"./",paths:Object.create(null)}}))()}static#generateBundlesFallback(lang){var _this2=this;return _wrapAsyncGenerator((function*(){yield _this2.#createBundleFallback(lang)}))()}static#createBundleFallback(lang){return(0,asyncToGenerator.A)((function*(){return createBundle(lang,'pdfjs-previous-button =\n    .title = Previous Page\npdfjs-previous-button-label = Previous\npdfjs-next-button =\n    .title = Next Page\npdfjs-next-button-label = Next\npdfjs-page-input =\n    .title = Page\npdfjs-of-pages = of { $pagesCount }\npdfjs-page-of-pages = ({ $pageNumber } of { $pagesCount })\npdfjs-zoom-out-button =\n    .title = Zoom Out\npdfjs-zoom-out-button-label = Zoom Out\npdfjs-zoom-in-button =\n    .title = Zoom In\npdfjs-zoom-in-button-label = Zoom In\npdfjs-zoom-select =\n    .title = Zoom\npdfjs-presentation-mode-button =\n    .title = Switch to Presentation Mode\npdfjs-presentation-mode-button-label = Presentation Mode\npdfjs-open-file-button =\n    .title = Open File\npdfjs-open-file-button-label = Open\npdfjs-print-button =\n    .title = Print\npdfjs-print-button-label = Print\npdfjs-save-button =\n    .title = Save\npdfjs-save-button-label = Save\npdfjs-download-button =\n    .title = Download\npdfjs-download-button-label = Download\npdfjs-bookmark-button =\n    .title = Current Page (View URL from Current Page)\npdfjs-bookmark-button-label = Current Page\npdfjs-tools-button =\n    .title = Tools\npdfjs-tools-button-label = Tools\npdfjs-first-page-button =\n    .title = Go to First Page\npdfjs-first-page-button-label = Go to First Page\npdfjs-last-page-button =\n    .title = Go to Last Page\npdfjs-last-page-button-label = Go to Last Page\npdfjs-page-rotate-cw-button =\n    .title = Rotate Clockwise\npdfjs-page-rotate-cw-button-label = Rotate Clockwise\npdfjs-page-rotate-ccw-button =\n    .title = Rotate Counterclockwise\npdfjs-page-rotate-ccw-button-label = Rotate Counterclockwise\npdfjs-cursor-text-select-tool-button =\n    .title = Enable Text Selection Tool\npdfjs-cursor-text-select-tool-button-label = Text Selection Tool\npdfjs-cursor-hand-tool-button =\n    .title = Enable Hand Tool\npdfjs-cursor-hand-tool-button-label = Hand Tool\npdfjs-scroll-page-button =\n    .title = Use Page Scrolling\npdfjs-scroll-page-button-label = Page Scrolling\npdfjs-scroll-vertical-button =\n    .title = Use Vertical Scrolling\npdfjs-scroll-vertical-button-label = Vertical Scrolling\npdfjs-scroll-horizontal-button =\n    .title = Use Horizontal Scrolling\npdfjs-scroll-horizontal-button-label = Horizontal Scrolling\npdfjs-scroll-wrapped-button =\n    .title = Use Wrapped Scrolling\npdfjs-scroll-wrapped-button-label = Wrapped Scrolling\npdfjs-spread-none-button =\n    .title = Do not join page spreads\npdfjs-spread-none-button-label = No Spreads\npdfjs-spread-odd-button =\n    .title = Join page spreads starting with odd-numbered pages\npdfjs-spread-odd-button-label = Odd Spreads\npdfjs-spread-even-button =\n    .title = Join page spreads starting with even-numbered pages\npdfjs-spread-even-button-label = Even Spreads\npdfjs-document-properties-button =\n    .title = Document Properties…\npdfjs-document-properties-button-label = Document Properties…\npdfjs-document-properties-file-name = File name:\npdfjs-document-properties-file-size = File size:\npdfjs-document-properties-size-kb = { NUMBER($kb, maximumSignificantDigits: 3) } KB ({ $b } bytes)\npdfjs-document-properties-size-mb = { NUMBER($mb, maximumSignificantDigits: 3) } MB ({ $b } bytes)\npdfjs-document-properties-title = Title:\npdfjs-document-properties-author = Author:\npdfjs-document-properties-subject = Subject:\npdfjs-document-properties-keywords = Keywords:\npdfjs-document-properties-creation-date = Creation Date:\npdfjs-document-properties-modification-date = Modification Date:\npdfjs-document-properties-date-time-string = { DATETIME($dateObj, dateStyle: "short", timeStyle: "medium") }\npdfjs-document-properties-creator = Creator:\npdfjs-document-properties-producer = PDF Producer:\npdfjs-document-properties-version = PDF Version:\npdfjs-document-properties-page-count = Page Count:\npdfjs-document-properties-page-size = Page Size:\npdfjs-document-properties-page-size-unit-inches = in\npdfjs-document-properties-page-size-unit-millimeters = mm\npdfjs-document-properties-page-size-orientation-portrait = portrait\npdfjs-document-properties-page-size-orientation-landscape = landscape\npdfjs-document-properties-page-size-name-a-three = A3\npdfjs-document-properties-page-size-name-a-four = A4\npdfjs-document-properties-page-size-name-letter = Letter\npdfjs-document-properties-page-size-name-legal = Legal\npdfjs-document-properties-page-size-dimension-string = { $width } × { $height } { $unit } ({ $orientation })\npdfjs-document-properties-page-size-dimension-name-string = { $width } × { $height } { $unit } ({ $name }, { $orientation })\npdfjs-document-properties-linearized = Fast Web View:\npdfjs-document-properties-linearized-yes = Yes\npdfjs-document-properties-linearized-no = No\npdfjs-document-properties-close-button = Close\npdfjs-print-progress-message = Preparing document for printing…\npdfjs-print-progress-percent = { $progress }%\npdfjs-print-progress-close-button = Cancel\npdfjs-printing-not-supported = Warning: Printing is not fully supported by this browser.\npdfjs-printing-not-ready = Warning: The PDF is not fully loaded for printing.\npdfjs-toggle-sidebar-button =\n    .title = Toggle Sidebar\npdfjs-toggle-sidebar-notification-button =\n    .title = Toggle Sidebar (document contains outline/attachments/layers)\npdfjs-toggle-sidebar-button-label = Toggle Sidebar\npdfjs-document-outline-button =\n    .title = Show Document Outline (double-click to expand/collapse all items)\npdfjs-document-outline-button-label = Document Outline\npdfjs-attachments-button =\n    .title = Show Attachments\npdfjs-attachments-button-label = Attachments\npdfjs-layers-button =\n    .title = Show Layers (double-click to reset all layers to the default state)\npdfjs-layers-button-label = Layers\npdfjs-thumbs-button =\n    .title = Show Thumbnails\npdfjs-thumbs-button-label = Thumbnails\npdfjs-current-outline-item-button =\n    .title = Find Current Outline Item\npdfjs-current-outline-item-button-label = Current Outline Item\npdfjs-findbar-button =\n    .title = Find in Document\npdfjs-findbar-button-label = Find\npdfjs-additional-layers = Additional Layers\npdfjs-thumb-page-title =\n    .title = Page { $page }\npdfjs-thumb-page-canvas =\n    .aria-label = Thumbnail of Page { $page }\npdfjs-find-input =\n    .title = Find\n    .placeholder = Find in document…\npdfjs-find-previous-button =\n    .title = Find the previous occurrence of the phrase\npdfjs-find-previous-button-label = Previous\npdfjs-find-next-button =\n    .title = Find the next occurrence of the phrase\npdfjs-find-next-button-label = Next\npdfjs-find-highlight-checkbox = Highlight All\npdfjs-find-match-case-checkbox-label = Match Case\npdfjs-find-match-diacritics-checkbox-label = Match Diacritics\npdfjs-find-entire-word-checkbox-label = Whole Words\npdfjs-find-reached-top = Reached top of document, continued from bottom\npdfjs-find-reached-bottom = Reached end of document, continued from top\npdfjs-find-match-count =\n    { $total ->\n        [one] { $current } of { $total } match\n       *[other] { $current } of { $total } matches\n    }\npdfjs-find-match-count-limit =\n    { $limit ->\n        [one] More than { $limit } match\n       *[other] More than { $limit } matches\n    }\npdfjs-find-not-found = Phrase not found\npdfjs-page-scale-width = Page Width\npdfjs-page-scale-fit = Page Fit\npdfjs-page-scale-auto = Automatic Zoom\npdfjs-page-scale-actual = Actual Size\npdfjs-page-scale-percent = { $scale }%\npdfjs-page-landmark =\n    .aria-label = Page { $page }\npdfjs-loading-error = An error occurred while loading the PDF.\npdfjs-invalid-file-error = Invalid or corrupted PDF file.\npdfjs-missing-file-error = Missing PDF file.\npdfjs-unexpected-response-error = Unexpected server response.\npdfjs-rendering-error = An error occurred while rendering the page.\npdfjs-annotation-date-time-string = { DATETIME($dateObj, dateStyle: "short", timeStyle: "medium") }\npdfjs-text-annotation-type =\n    .alt = [{ $type } Annotation]\npdfjs-password-label = Enter the password to open this PDF file.\npdfjs-password-invalid = Invalid password. Please try again.\npdfjs-password-ok-button = OK\npdfjs-password-cancel-button = Cancel\npdfjs-web-fonts-disabled = Web fonts are disabled: unable to use embedded PDF fonts.\npdfjs-editor-free-text-button =\n    .title = Text\npdfjs-editor-free-text-button-label = Text\npdfjs-editor-ink-button =\n    .title = Draw\npdfjs-editor-ink-button-label = Draw\npdfjs-editor-stamp-button =\n    .title = Add or edit images\npdfjs-editor-stamp-button-label = Add or edit images\npdfjs-editor-highlight-button =\n    .title = Highlight\npdfjs-editor-highlight-button-label = Highlight\npdfjs-highlight-floating-button1 =\n    .title = Highlight\n    .aria-label = Highlight\npdfjs-highlight-floating-button-label = Highlight\npdfjs-editor-remove-ink-button =\n    .title = Remove drawing\npdfjs-editor-remove-freetext-button =\n    .title = Remove text\npdfjs-editor-remove-stamp-button =\n    .title = Remove image\npdfjs-editor-remove-highlight-button =\n    .title = Remove highlight\npdfjs-editor-free-text-color-input = Color\npdfjs-editor-free-text-size-input = Size\npdfjs-editor-ink-color-input = Color\npdfjs-editor-ink-thickness-input = Thickness\npdfjs-editor-ink-opacity-input = Opacity\npdfjs-editor-stamp-add-image-button =\n    .title = Add image\npdfjs-editor-stamp-add-image-button-label = Add image\npdfjs-editor-free-highlight-thickness-input = Thickness\npdfjs-editor-free-highlight-thickness-title =\n    .title = Change thickness when highlighting items other than text\npdfjs-free-text2 =\n    .aria-label = Text Editor\n    .default-content = Start typing…\npdfjs-ink =\n    .aria-label = Draw Editor\npdfjs-ink-canvas =\n    .aria-label = User-created image\npdfjs-editor-alt-text-button =\n    .aria-label = Alt text\npdfjs-editor-alt-text-button-label = Alt text\npdfjs-editor-alt-text-edit-button =\n    .aria-label = Edit alt text\npdfjs-editor-alt-text-dialog-label = Choose an option\npdfjs-editor-alt-text-dialog-description = Alt text (alternative text) helps when people can’t see the image or when it doesn’t load.\npdfjs-editor-alt-text-add-description-label = Add a description\npdfjs-editor-alt-text-add-description-description = Aim for 1-2 sentences that describe the subject, setting, or actions.\npdfjs-editor-alt-text-mark-decorative-label = Mark as decorative\npdfjs-editor-alt-text-mark-decorative-description = This is used for ornamental images, like borders or watermarks.\npdfjs-editor-alt-text-cancel-button = Cancel\npdfjs-editor-alt-text-save-button = Save\npdfjs-editor-alt-text-decorative-tooltip = Marked as decorative\npdfjs-editor-alt-text-textarea =\n    .placeholder = For example, “A young man sits down at a table to eat a meal”\npdfjs-editor-resizer-top-left =\n    .aria-label = Top left corner — resize\npdfjs-editor-resizer-top-middle =\n    .aria-label = Top middle — resize\npdfjs-editor-resizer-top-right =\n    .aria-label = Top right corner — resize\npdfjs-editor-resizer-middle-right =\n    .aria-label = Middle right — resize\npdfjs-editor-resizer-bottom-right =\n    .aria-label = Bottom right corner — resize\npdfjs-editor-resizer-bottom-middle =\n    .aria-label = Bottom middle — resize\npdfjs-editor-resizer-bottom-left =\n    .aria-label = Bottom left corner — resize\npdfjs-editor-resizer-middle-left =\n    .aria-label = Middle left — resize\npdfjs-editor-highlight-colorpicker-label = Highlight color\npdfjs-editor-colorpicker-button =\n    .title = Change color\npdfjs-editor-colorpicker-dropdown =\n    .aria-label = Color choices\npdfjs-editor-colorpicker-yellow =\n    .title = Yellow\npdfjs-editor-colorpicker-green =\n    .title = Green\npdfjs-editor-colorpicker-blue =\n    .title = Blue\npdfjs-editor-colorpicker-pink =\n    .title = Pink\npdfjs-editor-colorpicker-red =\n    .title = Red\npdfjs-editor-highlight-show-all-button-label = Show all\npdfjs-editor-highlight-show-all-button =\n    .title = Show all\npdfjs-editor-new-alt-text-dialog-edit-label = Edit alt text (image description)\npdfjs-editor-new-alt-text-dialog-add-label = Add alt text (image description)\npdfjs-editor-new-alt-text-textarea =\n    .placeholder = Write your description here…\npdfjs-editor-new-alt-text-description = Short description for people who can’t see the image or when the image doesn’t load.\npdfjs-editor-new-alt-text-disclaimer1 = This alt text was created automatically and may be inaccurate.\npdfjs-editor-new-alt-text-disclaimer-learn-more-url = Learn more\npdfjs-editor-new-alt-text-create-automatically-button-label = Create alt text automatically\npdfjs-editor-new-alt-text-not-now-button = Not now\npdfjs-editor-new-alt-text-error-title = Couldn’t create alt text automatically\npdfjs-editor-new-alt-text-error-description = Please write your own alt text or try again later.\npdfjs-editor-new-alt-text-error-close-button = Close\npdfjs-editor-new-alt-text-ai-model-downloading-progress = Downloading alt text AI model ({ $downloadedSize } of { $totalSize } MB)\n    .aria-valuetext = Downloading alt text AI model ({ $downloadedSize } of { $totalSize } MB)\npdfjs-editor-new-alt-text-added-button =\n    .aria-label = Alt text added\npdfjs-editor-new-alt-text-added-button-label = Alt text added\npdfjs-editor-new-alt-text-missing-button =\n    .aria-label = Missing alt text\npdfjs-editor-new-alt-text-missing-button-label = Missing alt text\npdfjs-editor-new-alt-text-to-review-button =\n    .aria-label = Review alt text\npdfjs-editor-new-alt-text-to-review-button-label = Review alt text\npdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer = Created automatically: { $generatedAltText }\npdfjs-image-alt-text-settings-button =\n    .title = Image alt text settings\npdfjs-image-alt-text-settings-button-label = Image alt text settings\npdfjs-editor-alt-text-settings-dialog-label = Image alt text settings\npdfjs-editor-alt-text-settings-automatic-title = Automatic alt text\npdfjs-editor-alt-text-settings-create-model-button-label = Create alt text automatically\npdfjs-editor-alt-text-settings-create-model-description = Suggests descriptions to help people who can’t see the image or when the image doesn’t load.\npdfjs-editor-alt-text-settings-download-model-label = Alt text AI model ({ $totalSize } MB)\npdfjs-editor-alt-text-settings-ai-model-description = Runs locally on your device so your data stays private. Required for automatic alt text.\npdfjs-editor-alt-text-settings-delete-model-button = Delete\npdfjs-editor-alt-text-settings-download-model-button = Download\npdfjs-editor-alt-text-settings-downloading-model-button = Downloading…\npdfjs-editor-alt-text-settings-editor-title = Alt text editor\npdfjs-editor-alt-text-settings-show-dialog-button-label = Show alt text editor right away when adding an image\npdfjs-editor-alt-text-settings-show-dialog-description = Helps you make sure all your images have alt text.\npdfjs-editor-alt-text-settings-close-button = Close')}))()}}function getCurrentHash(){return document.location.hash}class PDFHistory{#eventAbortController=null;constructor({linkService,eventBus}){this.linkService=linkService,this.eventBus=eventBus,this._initialized=!1,this._fingerprint="",this.reset(),this.eventBus._on("pagesinit",(()=>{this._isPagesLoaded=!1,this.eventBus._on("pagesloaded",(evt=>{this._isPagesLoaded=!!evt.pagesCount}),{once:!0})}))}initialize({fingerprint,resetHistory=!1,updateUrl=!1}){if(!fingerprint||"string"!=typeof fingerprint)return void console.error('PDFHistory.initialize: The "fingerprint" must be a non-empty string.');this._initialized&&this.reset();const reInitialized=""!==this._fingerprint&&this._fingerprint!==fingerprint;this._fingerprint=fingerprint,this._updateUrl=!0===updateUrl,this._initialized=!0,this.#bindEvents();const state=window.history.state;if(this._popStateInProgress=!1,this._blockHashChange=0,this._currentHash=getCurrentHash(),this._numPositionUpdates=0,this._uid=this._maxUid=0,this._destination=null,this._position=null,!this.#isValidState(state,!0)||resetHistory){const{hash,page,rotation}=this.#parseCurrentHash(!0);return!hash||reInitialized||resetHistory?void this.#pushOrReplaceState(null,!0):void this.#pushOrReplaceState({hash,page,rotation},!0)}const destination=state.destination;this.#updateInternalState(destination,state.uid,!0),void 0!==destination.rotation&&(this._initialRotation=destination.rotation),destination.dest?(this._initialBookmark=JSON.stringify(destination.dest),this._destination.page=null):destination.hash?this._initialBookmark=destination.hash:destination.page&&(this._initialBookmark=`page=${destination.page}`)}reset(){this._initialized&&(this.#pageHide(),this._initialized=!1,this.#unbindEvents()),this._updateViewareaTimeout&&(clearTimeout(this._updateViewareaTimeout),this._updateViewareaTimeout=null),this._initialBookmark=null,this._initialRotation=null}push({namedDest=null,explicitDest,pageNumber}){if(!this._initialized)return;if(namedDest&&"string"!=typeof namedDest)return void console.error(`PDFHistory.push: "${namedDest}" is not a valid namedDest parameter.`);if(!Array.isArray(explicitDest))return void console.error(`PDFHistory.push: "${explicitDest}" is not a valid explicitDest parameter.`);if(!this.#isValidPage(pageNumber)&&(null!==pageNumber||this._destination))return void console.error(`PDFHistory.push: "${pageNumber}" is not a valid pageNumber parameter.`);const hash=namedDest||JSON.stringify(explicitDest);if(!hash)return;let forceReplace=!1;if(this._destination&&(function isDestHashesEqual(destHash,pushHash){if("string"!=typeof destHash||"string"!=typeof pushHash)return!1;if(destHash===pushHash)return!0;if(parseQueryString(destHash).get("nameddest")===pushHash)return!0;return!1}(this._destination.hash,hash)||function isDestArraysEqual(firstDest,secondDest){function isEntryEqual(first,second){if(typeof first!=typeof second)return!1;if(Array.isArray(first)||Array.isArray(second))return!1;if(null!==first&&"object"==typeof first&&null!==second){if(Object.keys(first).length!==Object.keys(second).length)return!1;for(const key in first)if(!isEntryEqual(first[key],second[key]))return!1;return!0}return first===second||Number.isNaN(first)&&Number.isNaN(second)}if(!Array.isArray(firstDest)||!Array.isArray(secondDest))return!1;if(firstDest.length!==secondDest.length)return!1;for(let i=0,ii=firstDest.length;i<ii;i++)if(!isEntryEqual(firstDest[i],secondDest[i]))return!1;return!0}(this._destination.dest,explicitDest))){if(this._destination.page)return;forceReplace=!0}this._popStateInProgress&&!forceReplace||(this.#pushOrReplaceState({dest:explicitDest,hash,page:pageNumber,rotation:this.linkService.rotation},forceReplace),this._popStateInProgress||(this._popStateInProgress=!0,Promise.resolve().then((()=>{this._popStateInProgress=!1}))))}pushPage(pageNumber){this._initialized&&(this.#isValidPage(pageNumber)?this._destination?.page!==pageNumber&&(this._popStateInProgress||(this.#pushOrReplaceState({dest:null,hash:`page=${pageNumber}`,page:pageNumber,rotation:this.linkService.rotation}),this._popStateInProgress||(this._popStateInProgress=!0,Promise.resolve().then((()=>{this._popStateInProgress=!1}))))):console.error(`PDFHistory.pushPage: "${pageNumber}" is not a valid page number.`))}pushCurrentPosition(){this._initialized&&!this._popStateInProgress&&this.#tryPushCurrentPosition()}back(){if(!this._initialized||this._popStateInProgress)return;const state=window.history.state;this.#isValidState(state)&&state.uid>0&&window.history.back()}forward(){if(!this._initialized||this._popStateInProgress)return;const state=window.history.state;this.#isValidState(state)&&state.uid<this._maxUid&&window.history.forward()}get popStateInProgress(){return this._initialized&&(this._popStateInProgress||this._blockHashChange>0)}get initialBookmark(){return this._initialized?this._initialBookmark:null}get initialRotation(){return this._initialized?this._initialRotation:null}#pushOrReplaceState(destination,forceReplace=!1){const shouldReplace=forceReplace||!this._destination,newState={fingerprint:this._fingerprint,uid:shouldReplace?this._uid:this._uid+1,destination};let newUrl;if(this.#updateInternalState(destination,newState.uid),this._updateUrl&&destination?.hash){const baseUrl=document.location.href.split("#",1)[0];baseUrl.startsWith("file://")||(newUrl=`${baseUrl}#${destination.hash}`)}shouldReplace?window.history.replaceState(newState,"",newUrl):window.history.pushState(newState,"",newUrl)}#tryPushCurrentPosition(temporary=!1){if(!this._position)return;let position=this._position;if(temporary&&(position=Object.assign(Object.create(null),this._position),position.temporary=!0),!this._destination)return void this.#pushOrReplaceState(position);if(this._destination.temporary)return void this.#pushOrReplaceState(position,!0);if(this._destination.hash===position.hash)return;if(!this._destination.page&&this._numPositionUpdates<=50)return;let forceReplace=!1;if(this._destination.page>=position.first&&this._destination.page<=position.page){if(void 0!==this._destination.dest||!this._destination.first)return;forceReplace=!0}this.#pushOrReplaceState(position,forceReplace)}#isValidPage(val){return Number.isInteger(val)&&val>0&&val<=this.linkService.pagesCount}#isValidState(state,checkReload=!1){if(!state)return!1;if(state.fingerprint!==this._fingerprint){if(!checkReload)return!1;{if("string"!=typeof state.fingerprint||state.fingerprint.length!==this._fingerprint.length)return!1;const[perfEntry]=performance.getEntriesByType("navigation");if("reload"!==perfEntry?.type)return!1}}return!(!Number.isInteger(state.uid)||state.uid<0)&&(null!==state.destination&&"object"==typeof state.destination)}#updateInternalState(destination,uid,removeTemporary=!1){this._updateViewareaTimeout&&(clearTimeout(this._updateViewareaTimeout),this._updateViewareaTimeout=null),removeTemporary&&destination?.temporary&&delete destination.temporary,this._destination=destination,this._uid=uid,this._maxUid=Math.max(this._maxUid,uid),this._numPositionUpdates=0}#parseCurrentHash(checkNameddest=!1){const hash=unescape(getCurrentHash()).substring(1),params=parseQueryString(hash),nameddest=params.get("nameddest")||"";let page=0|params.get("page");return(!this.#isValidPage(page)||checkNameddest&&nameddest.length>0)&&(page=null),{hash,page,rotation:this.linkService.rotation}}#updateViewarea({location}){this._updateViewareaTimeout&&(clearTimeout(this._updateViewareaTimeout),this._updateViewareaTimeout=null),this._position={hash:location.pdfOpenParams.substring(1),page:this.linkService.page,first:location.pageNumber,rotation:location.rotation},this._popStateInProgress||(this._isPagesLoaded&&this._destination&&!this._destination.page&&this._numPositionUpdates++,this._updateViewareaTimeout=setTimeout((()=>{this._popStateInProgress||this.#tryPushCurrentPosition(!0),this._updateViewareaTimeout=null}),1e3))}#popState({state}){const newHash=getCurrentHash(),hashChanged=this._currentHash!==newHash;if(this._currentHash=newHash,!state){this._uid++;const{hash,page,rotation}=this.#parseCurrentHash();return void this.#pushOrReplaceState({hash,page,rotation},!0)}if(!this.#isValidState(state))return;this._popStateInProgress=!0,hashChanged&&(this._blockHashChange++,function waitOnEventOrTimeout(_x){return _waitOnEventOrTimeout.apply(this,arguments)}({target:window,name:"hashchange",delay:1e3}).then((()=>{this._blockHashChange--})));const destination=state.destination;this.#updateInternalState(destination,state.uid,!0),isValidRotation(destination.rotation)&&(this.linkService.rotation=destination.rotation),destination.dest?this.linkService.goToDestination(destination.dest):destination.hash?this.linkService.setHash(destination.hash):destination.page&&(this.linkService.page=destination.page),Promise.resolve().then((()=>{this._popStateInProgress=!1}))}#pageHide(){this._destination&&!this._destination.temporary||this.#tryPushCurrentPosition()}#bindEvents(){if(this.#eventAbortController)return;this.#eventAbortController=new AbortController;const{signal}=this.#eventAbortController;this.eventBus._on("updateviewarea",this.#updateViewarea.bind(this),{signal}),window.addEventListener("popstate",this.#popState.bind(this),{signal}),window.addEventListener("pagehide",this.#pageHide.bind(this),{signal})}#unbindEvents(){this.#eventAbortController?.abort(),this.#eventAbortController=null}}class AnnotationEditorLayerBuilder{#annotationLayer=null;#drawLayer=null;#onAppend=null;#structTreeLayer=null;#textLayer=null;#uiManager;constructor(options){this.pdfPage=options.pdfPage,this.accessibilityManager=options.accessibilityManager,this.l10n=options.l10n,this.l10n||=new genericl10n_GenericL10n,this.annotationEditorLayer=null,this.div=null,this._cancelled=!1,this.#uiManager=options.uiManager,this.#annotationLayer=options.annotationLayer||null,this.#textLayer=options.textLayer||null,this.#drawLayer=options.drawLayer||null,this.#onAppend=options.onAppend||null,this.#structTreeLayer=options.structTreeLayer||null}render(viewport,intent="display"){var _this14=this;return(0,asyncToGenerator.A)((function*(){if("display"!==intent)return;if(_this14._cancelled)return;const clonedViewport=viewport.clone({dontFlip:!0});if(_this14.div)return _this14.annotationEditorLayer.update({viewport:clonedViewport}),void _this14.show();const div=_this14.div=document.createElement("div");div.className="annotationEditorLayer",div.hidden=!0,div.dir=_this14.#uiManager.direction,_this14.#onAppend?.(div),_this14.annotationEditorLayer=new pdf_viewer_AnnotationEditorLayer({uiManager:_this14.#uiManager,div,structTreeLayer:_this14.#structTreeLayer,accessibilityManager:_this14.accessibilityManager,pageIndex:_this14.pdfPage.pageNumber-1,l10n:_this14.l10n,viewport:clonedViewport,annotationLayer:_this14.#annotationLayer,textLayer:_this14.#textLayer,drawLayer:_this14.#drawLayer});const parameters={viewport:clonedViewport,div,annotations:null,intent};_this14.annotationEditorLayer.render(parameters),_this14.show()}))()}cancel(){this._cancelled=!0,this.div&&this.annotationEditorLayer.destroy()}hide(){this.div&&(this.div.hidden=!0)}show(){this.div&&!this.annotationEditorLayer.isInvisible&&(this.div.hidden=!1)}}{var compatParams=new Map;const userAgent=navigator.userAgent||"",platform=navigator.platform||"",maxTouchPoints=navigator.maxTouchPoints||1,isAndroid=/Android/.test(userAgent);(/\b(iPad|iPhone|iPod)(?=;)/.test(userAgent)||"MacIntel"===platform&&maxTouchPoints>1||isAndroid)&&compatParams.set("maxCanvasPixels",5242880),isAndroid&&compatParams.set("useSystemFonts",!1)}const OptionKind_BROWSER=1,OptionKind_VIEWER=2,OptionKind_API=4,OptionKind_WORKER=8,OptionKind_EVENT_DISPATCH=16,OptionKind_PREFERENCE=128,Type={BOOLEAN:1,NUMBER:2,OBJECT:4,STRING:8,UNDEFINED:16},defaultOptions={allowedGlobalEvents:{value:null,kind:OptionKind_BROWSER},canvasMaxAreaInBytes:{value:-1,kind:OptionKind_BROWSER+OptionKind_API},isInAutomation:{value:!1,kind:OptionKind_BROWSER},localeProperties:{value:{lang:navigator.language||"en-US"},kind:OptionKind_BROWSER},nimbusDataStr:{value:"",kind:OptionKind_BROWSER},supportsCaretBrowsingMode:{value:!1,kind:OptionKind_BROWSER},supportsDocumentFonts:{value:!0,kind:OptionKind_BROWSER},supportsIntegratedFind:{value:!1,kind:OptionKind_BROWSER},supportsMouseWheelZoomCtrlKey:{value:!0,kind:OptionKind_BROWSER},supportsMouseWheelZoomMetaKey:{value:!0,kind:OptionKind_BROWSER},supportsPinchToZoom:{value:!0,kind:OptionKind_BROWSER},toolbarDensity:{value:0,kind:OptionKind_BROWSER+OptionKind_EVENT_DISPATCH},altTextLearnMoreUrl:{value:"",kind:OptionKind_VIEWER+OptionKind_PREFERENCE},annotationEditorMode:{value:0,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},annotationMode:{value:2,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},cursorToolOnLoad:{value:0,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},debuggerSrc:{value:"./debugger.mjs",kind:OptionKind_VIEWER},defaultZoomDelay:{value:400,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},defaultZoomValue:{value:"",kind:OptionKind_VIEWER+OptionKind_PREFERENCE},disableHistory:{value:!1,kind:OptionKind_VIEWER},disablePageLabels:{value:!1,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},enableAltText:{value:!1,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},enableAltTextModelDownload:{value:!0,kind:OptionKind_VIEWER+OptionKind_PREFERENCE+OptionKind_EVENT_DISPATCH},enableGuessAltText:{value:!0,kind:OptionKind_VIEWER+OptionKind_PREFERENCE+OptionKind_EVENT_DISPATCH},enableHighlightFloatingButton:{value:!1,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},enableNewAltTextWhenAddingImage:{value:!0,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},enablePermissions:{value:!1,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},enablePrintAutoRotate:{value:!0,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},enableScripting:{value:!0,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},enableUpdatedAddImage:{value:!1,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},externalLinkRel:{value:"noopener noreferrer nofollow",kind:OptionKind_VIEWER},externalLinkTarget:{value:0,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},highlightEditorColors:{value:"yellow=#FFFF98,green=#53FFBC,blue=#80EBFF,pink=#FFCBE6,red=#FF4F5F",kind:OptionKind_VIEWER+OptionKind_PREFERENCE},historyUpdateUrl:{value:!1,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},ignoreDestinationZoom:{value:!1,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},imageResourcesPath:{value:"./images/",kind:OptionKind_VIEWER},maxCanvasPixels:{value:2**25,kind:OptionKind_VIEWER},forcePageColors:{value:!1,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},pageColorsBackground:{value:"Canvas",kind:OptionKind_VIEWER+OptionKind_PREFERENCE},pageColorsForeground:{value:"CanvasText",kind:OptionKind_VIEWER+OptionKind_PREFERENCE},pdfBugEnabled:{value:!1,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},printResolution:{value:150,kind:OptionKind_VIEWER},sidebarViewOnLoad:{value:-1,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},scrollModeOnLoad:{value:-1,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},spreadModeOnLoad:{value:-1,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},textLayerMode:{value:1,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},viewOnLoad:{value:0,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},cMapPacked:{value:!0,kind:OptionKind_API},cMapUrl:{value:"../web/cmaps/",kind:OptionKind_API},disableAutoFetch:{value:!1,kind:OptionKind_API+OptionKind_PREFERENCE},disableFontFace:{value:!1,kind:OptionKind_API+OptionKind_PREFERENCE},disableRange:{value:!1,kind:OptionKind_API+OptionKind_PREFERENCE},disableStream:{value:!1,kind:OptionKind_API+OptionKind_PREFERENCE},docBaseUrl:{value:"",kind:OptionKind_API},enableHWA:{value:!0,kind:OptionKind_API+OptionKind_VIEWER+OptionKind_PREFERENCE},enableXfa:{value:!0,kind:OptionKind_API+OptionKind_PREFERENCE},fontExtraProperties:{value:!1,kind:OptionKind_API},isEvalSupported:{value:!0,kind:OptionKind_API},isOffscreenCanvasSupported:{value:!0,kind:OptionKind_API},maxImageSize:{value:-1,kind:OptionKind_API},pdfBug:{value:!1,kind:OptionKind_API},standardFontDataUrl:{value:"../web/standard_fonts/",kind:OptionKind_API},useSystemFonts:{value:void 0,kind:OptionKind_API,type:Type.BOOLEAN+Type.UNDEFINED},verbosity:{value:1,kind:OptionKind_API},workerPort:{value:null,kind:OptionKind_WORKER},workerSrc:{value:"../build/pdf.worker.mjs",kind:OptionKind_WORKER}};defaultOptions.defaultUrl={value:"compressed.tracemonkey-pldi-09.pdf",kind:OptionKind_VIEWER},defaultOptions.sandboxBundleSrc={value:"../build/pdf.sandbox.mjs",kind:OptionKind_VIEWER},defaultOptions.viewerCssTheme={value:0,kind:OptionKind_VIEWER+OptionKind_PREFERENCE},defaultOptions.enableFakeMLManager={value:!0,kind:OptionKind_VIEWER},defaultOptions.disablePreferences={value:!1,kind:OptionKind_VIEWER};class AppOptions{static eventBus;static#opts=new Map;static#_=(()=>{for(const name in defaultOptions)this.#opts.set(name,defaultOptions[name].value);for(const[name,value]of compatParams)this.#opts.set(name,value);this._hasInvokedSet=!1,this._checkDisablePreferences=()=>!!this.get("disablePreferences")||(this._hasInvokedSet&&console.warn('The Preferences may override manually set AppOptions; please use the "disablePreferences"-option to prevent that.'),!1)})();static get(name){return this.#opts.get(name)}static getAll(kind=null,defaultOnly=!1){const options=Object.create(null);for(const name in defaultOptions){const defaultOpt=defaultOptions[name];(!kind||kind&defaultOpt.kind)&&(options[name]=defaultOnly?defaultOpt.value:this.#opts.get(name))}return options}static set(name,value){this.setAll({[name]:value})}static setAll(options,prefs=!1){let events;this._hasInvokedSet||=!0;for(const name in options){const defaultOpt=defaultOptions[name],userOpt=options[name];if(!defaultOpt||!(typeof userOpt==typeof defaultOpt.value||Type[(typeof userOpt).toUpperCase()]&defaultOpt.type))continue;const{kind}=defaultOpt;(!prefs||kind&OptionKind_BROWSER||kind&OptionKind_PREFERENCE)&&(this.eventBus&&kind&OptionKind_EVENT_DISPATCH&&(events||=new Map).set(name,userOpt),this.#opts.set(name,userOpt))}if(events)for(const[name,value]of events)this.eventBus.dispatch(name.toLowerCase(),{source:this,value})}}class DrawLayerBuilder{#drawLayer=null;constructor(options){this.pageIndex=options.pageIndex}render(intent="display"){var _this15=this;return(0,asyncToGenerator.A)((function*(){"display"!==intent||_this15.#drawLayer||_this15._cancelled||(_this15.#drawLayer=new pdf_viewer_DrawLayer({pageIndex:_this15.pageIndex}))}))()}cancel(){this._cancelled=!0,this.#drawLayer&&(this.#drawLayer.destroy(),this.#drawLayer=null)}setParent(parent){this.#drawLayer?.setParent(parent)}getDrawLayer(){return this.#drawLayer}}const PDF_ROLE_TO_HTML_ROLE={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},HEADING_PATTERN=/^H(\d+)$/;class StructTreeLayerBuilder{#promise;#treeDom=null;#treePromise;#elementAttributes=new Map;#rawDims;#elementsToAddToTextLayer=null;constructor(pdfPage,rawDims){this.#promise=pdfPage.getStructTree(),this.#rawDims=rawDims}render(){var _this16=this;return(0,asyncToGenerator.A)((function*(){if(_this16.#treePromise)return _this16.#treePromise;const{promise,resolve,reject}=Promise.withResolvers();_this16.#treePromise=promise;try{_this16.#treeDom=_this16.#walk(yield _this16.#promise)}catch(ex){reject(ex)}return _this16.#promise=null,_this16.#treeDom?.classList.add("structTree"),resolve(_this16.#treeDom),promise}))()}getAriaAttributes(annotationId){var _this17=this;return(0,asyncToGenerator.A)((function*(){try{return yield _this17.render(),_this17.#elementAttributes.get(annotationId)}catch{}return null}))()}hide(){this.#treeDom&&!this.#treeDom.hidden&&(this.#treeDom.hidden=!0)}show(){this.#treeDom?.hidden&&(this.#treeDom.hidden=!1)}#setAttributes(structElement,htmlElement){const{alt,id,lang}=structElement;if(void 0!==alt){let added=!1;const label=removeNullCharacters(alt);for(const child of structElement.children)if("annotation"===child.type){let attrs=this.#elementAttributes.get(child.id);attrs||(attrs=new Map,this.#elementAttributes.set(child.id,attrs)),attrs.set("aria-label",label),added=!0}added||htmlElement.setAttribute("aria-label",label)}void 0!==id&&htmlElement.setAttribute("aria-owns",id),void 0!==lang&&htmlElement.setAttribute("lang",removeNullCharacters(lang,!0))}#addImageInTextLayer(node,element){const{alt,bbox,children}=node,child=children?.[0];if(!this.#rawDims||!alt||!bbox||"content"!==child?.type)return!1;const{id}=child;if(!id)return!1;element.setAttribute("aria-owns",id);const img=document.createElement("span");(this.#elementsToAddToTextLayer||=new Map).set(id,img),img.setAttribute("role","img"),img.setAttribute("aria-label",removeNullCharacters(alt));const{pageHeight,pageX,pageY}=this.#rawDims,calc="calc(var(--scale-factor)*",{style}=img;return style.width=`${calc}${bbox[2]-bbox[0]}px)`,style.height=`${calc}${bbox[3]-bbox[1]}px)`,style.left=`${calc}${bbox[0]-pageX}px)`,style.top=`${calc}${pageHeight-bbox[3]+pageY}px)`,!0}addElementsToTextLayer(){if(this.#elementsToAddToTextLayer){for(const[id,img]of this.#elementsToAddToTextLayer)document.getElementById(id)?.append(img);this.#elementsToAddToTextLayer.clear(),this.#elementsToAddToTextLayer=null}}#walk(node){if(!node)return null;const element=document.createElement("span");if("role"in node){const{role}=node,match=role.match(HEADING_PATTERN);if(match?(element.setAttribute("role","heading"),element.setAttribute("aria-level",match[1])):PDF_ROLE_TO_HTML_ROLE[role]&&element.setAttribute("role",PDF_ROLE_TO_HTML_ROLE[role]),"Figure"===role&&this.#addImageInTextLayer(node,element))return element}if(this.#setAttributes(node,element),node.children)if(1===node.children.length&&"id"in node.children[0])this.#setAttributes(node.children[0],element);else for(const kid of node.children)element.append(this.#walk(kid));return element}}class TextAccessibilityManager{#enabled=!1;#textChildren=null;#textNodes=new Map;#waitingElements=new Map;setTextMapping(textDivs){this.#textChildren=textDivs}static#compareElementPositions(e1,e2){const rect1=e1.getBoundingClientRect(),rect2=e2.getBoundingClientRect();if(0===rect1.width&&0===rect1.height)return 1;if(0===rect2.width&&0===rect2.height)return-1;const top1=rect1.y,bot1=rect1.y+rect1.height,mid1=rect1.y+rect1.height/2,top2=rect2.y,bot2=rect2.y+rect2.height,mid2=rect2.y+rect2.height/2;if(mid1<=top2&&mid2>=bot1)return-1;if(mid2<=top1&&mid1>=bot2)return 1;return rect1.x+rect1.width/2-(rect2.x+rect2.width/2)}enable(){if(this.#enabled)throw new Error("TextAccessibilityManager is already enabled.");if(!this.#textChildren)throw new Error("Text divs and strings have not been set.");if(this.#enabled=!0,this.#textChildren=this.#textChildren.slice(),this.#textChildren.sort(TextAccessibilityManager.#compareElementPositions),this.#textNodes.size>0){const textChildren=this.#textChildren;for(const[id,nodeIndex]of this.#textNodes){document.getElementById(id)?this.#addIdToAriaOwns(id,textChildren[nodeIndex]):this.#textNodes.delete(id)}}for(const[element,isRemovable]of this.#waitingElements)this.addPointerInTextLayer(element,isRemovable);this.#waitingElements.clear()}disable(){this.#enabled&&(this.#waitingElements.clear(),this.#textChildren=null,this.#enabled=!1)}removePointerInTextLayer(element){if(!this.#enabled)return void this.#waitingElements.delete(element);const children=this.#textChildren;if(!children||0===children.length)return;const{id}=element,nodeIndex=this.#textNodes.get(id);if(void 0===nodeIndex)return;const node=children[nodeIndex];this.#textNodes.delete(id);let owns=node.getAttribute("aria-owns");owns?.includes(id)&&(owns=owns.split(" ").filter((x=>x!==id)).join(" "),owns?node.setAttribute("aria-owns",owns):(node.removeAttribute("aria-owns"),node.setAttribute("role","presentation")))}#addIdToAriaOwns(id,node){const owns=node.getAttribute("aria-owns");owns?.includes(id)||node.setAttribute("aria-owns",owns?`${owns} ${id}`:id),node.removeAttribute("role")}addPointerInTextLayer(element,isRemovable){const{id}=element;if(!id)return null;if(!this.#enabled)return this.#waitingElements.set(element,isRemovable),null;isRemovable&&this.removePointerInTextLayer(element);const children=this.#textChildren;if(!children||0===children.length)return null;const index=binarySearchFirstItem(children,(node=>TextAccessibilityManager.#compareElementPositions(element,node)<0)),nodeIndex=Math.max(0,index-1),child=children[nodeIndex];this.#addIdToAriaOwns(id,child),this.#textNodes.set(id,nodeIndex);const parent=child.parentNode;return parent?.classList.contains("markedContent")?parent.id:null}moveElementInDOM(container,element,contentElement,isRemovable){const id=this.addPointerInTextLayer(contentElement,isRemovable);if(!container.hasChildNodes())return container.append(element),id;const children=Array.from(container.childNodes).filter((node=>node!==element));if(0===children.length)return id;const elementToCompare=contentElement||element,index=binarySearchFirstItem(children,(node=>TextAccessibilityManager.#compareElementPositions(elementToCompare,node)<0));return 0===index?children[0].before(element):children[index-1].after(element),id}}class TextHighlighter{#eventAbortController=null;constructor({findController,eventBus,pageIndex}){this.findController=findController,this.matches=[],this.eventBus=eventBus,this.pageIdx=pageIndex,this.textDivs=null,this.textContentItemsStr=null,this.enabled=!1}setTextMapping(divs,texts){this.textDivs=divs,this.textContentItemsStr=texts}enable(){if(!this.textDivs||!this.textContentItemsStr)throw new Error("Text divs and strings have not been set.");if(this.enabled)throw new Error("TextHighlighter is already enabled.");this.enabled=!0,this.#eventAbortController||(this.#eventAbortController=new AbortController,this.eventBus._on("updatetextlayermatches",(evt=>{evt.pageIndex!==this.pageIdx&&-1!==evt.pageIndex||this._updateMatches()}),{signal:this.#eventAbortController.signal})),this._updateMatches()}disable(){this.enabled&&(this.enabled=!1,this.#eventAbortController?.abort(),this.#eventAbortController=null,this._updateMatches(!0))}_convertMatches(matches,matchesLength){if(!matches)return[];const{textContentItemsStr}=this;let i=0,iIndex=0;const end=textContentItemsStr.length-1,result=[];for(let m=0,mm=matches.length;m<mm;m++){let matchIdx=matches[m];for(;i!==end&&matchIdx>=iIndex+textContentItemsStr[i].length;)iIndex+=textContentItemsStr[i].length,i++;i===textContentItemsStr.length&&console.error("Could not find a matching mapping");const match={begin:{divIdx:i,offset:matchIdx-iIndex}};for(matchIdx+=matchesLength[m];i!==end&&matchIdx>iIndex+textContentItemsStr[i].length;)iIndex+=textContentItemsStr[i].length,i++;match.end={divIdx:i,offset:matchIdx-iIndex},result.push(match)}return result}_renderMatches(matches){if(0===matches.length)return;const{findController,pageIdx}=this,{textContentItemsStr,textDivs}=this,isSelectedPage=pageIdx===findController.selected.pageIdx,selectedMatchIdx=findController.selected.matchIdx;let prevEnd=null;const infinity={divIdx:-1,offset:void 0};function beginText(begin,className){const divIdx=begin.divIdx;return textDivs[divIdx].textContent="",appendTextToDiv(divIdx,0,begin.offset,className)}function appendTextToDiv(divIdx,fromOffset,toOffset,className){let div=textDivs[divIdx];if(div.nodeType===Node.TEXT_NODE){const span=document.createElement("span");div.before(span),span.append(div),textDivs[divIdx]=span,div=span}const content=textContentItemsStr[divIdx].substring(fromOffset,toOffset),node=document.createTextNode(content);if(className){const span=document.createElement("span");return span.className=`${className} appended`,span.append(node),div.append(span),className.includes("selected")?span.offsetLeft:0}return div.append(node),0}let i0=selectedMatchIdx,i1=i0+1;if(findController.state.highlightAll)i0=0,i1=matches.length;else if(!isSelectedPage)return;let lastDivIdx=-1,lastOffset=-1;for(let i=i0;i<i1;i++){const match=matches[i],begin=match.begin;if(begin.divIdx===lastDivIdx&&begin.offset===lastOffset)continue;lastDivIdx=begin.divIdx,lastOffset=begin.offset;const end=match.end,isSelected=isSelectedPage&&i===selectedMatchIdx,highlightSuffix=isSelected?" selected":"";let selectedLeft=0;if(prevEnd&&begin.divIdx===prevEnd.divIdx?appendTextToDiv(prevEnd.divIdx,prevEnd.offset,begin.offset):(null!==prevEnd&&appendTextToDiv(prevEnd.divIdx,prevEnd.offset,infinity.offset),beginText(begin)),begin.divIdx===end.divIdx)selectedLeft=appendTextToDiv(begin.divIdx,begin.offset,end.offset,"highlight"+highlightSuffix);else{selectedLeft=appendTextToDiv(begin.divIdx,begin.offset,infinity.offset,"highlight begin"+highlightSuffix);for(let n0=begin.divIdx+1,n1=end.divIdx;n0<n1;n0++)textDivs[n0].className="highlight middle"+highlightSuffix;beginText(end,"highlight end"+highlightSuffix)}prevEnd=end,isSelected&&findController.scrollMatchIntoView({element:textDivs[begin.divIdx],selectedLeft,pageIndex:pageIdx,matchIndex:selectedMatchIdx})}prevEnd&&appendTextToDiv(prevEnd.divIdx,prevEnd.offset,infinity.offset)}_updateMatches(reset=!1){if(!this.enabled&&!reset)return;const{findController,matches,pageIdx}=this,{textContentItemsStr,textDivs}=this;let clearedUntilDivIdx=-1;for(const match of matches){for(let n=Math.max(clearedUntilDivIdx,match.begin.divIdx),end=match.end.divIdx;n<=end;n++){const div=textDivs[n];div.textContent=textContentItemsStr[n],div.className=""}clearedUntilDivIdx=match.end.divIdx+1}if(!findController?.highlightMatches||reset)return;const pageMatches=findController.pageMatches[pageIdx]||null,pageMatchesLength=findController.pageMatchesLength[pageIdx]||null;this.matches=this._convertMatches(pageMatches,pageMatchesLength),this._renderMatches(this.matches)}}class TextLayerBuilder{#enablePermissions=!1;#onAppend=null;#renderingDone=!1;#textLayer=null;static#textLayers=new Map;static#selectionChangeAbortController=null;constructor({pdfPage,highlighter=null,accessibilityManager=null,enablePermissions=!1,onAppend=null}){this.pdfPage=pdfPage,this.highlighter=highlighter,this.accessibilityManager=accessibilityManager,this.#enablePermissions=!0===enablePermissions,this.#onAppend=onAppend,this.div=document.createElement("div"),this.div.tabIndex=0,this.div.className="textLayer"}render(viewport,textContentParams=null){var _this18=this;return(0,asyncToGenerator.A)((function*(){if(_this18.#renderingDone&&_this18.#textLayer)return _this18.#textLayer.update({viewport,onBefore:_this18.hide.bind(_this18)}),void _this18.show();_this18.cancel(),_this18.#textLayer=new pdf_viewer_TextLayer({textContentSource:_this18.pdfPage.streamTextContent(textContentParams||{includeMarkedContent:!0,disableNormalization:!0}),container:_this18.div,viewport});const{textDivs,textContentItemsStr}=_this18.#textLayer;_this18.highlighter?.setTextMapping(textDivs,textContentItemsStr),_this18.accessibilityManager?.setTextMapping(textDivs),yield _this18.#textLayer.render(),_this18.#renderingDone=!0;const endOfContent=document.createElement("div");endOfContent.className="endOfContent",_this18.div.append(endOfContent),_this18.#bindMouse(endOfContent),_this18.#onAppend?.(_this18.div),_this18.highlighter?.enable(),_this18.accessibilityManager?.enable()}))()}hide(){!this.div.hidden&&this.#renderingDone&&(this.highlighter?.disable(),this.div.hidden=!0)}show(){this.div.hidden&&this.#renderingDone&&(this.div.hidden=!1,this.highlighter?.enable())}cancel(){this.#textLayer?.cancel(),this.#textLayer=null,this.highlighter?.disable(),this.accessibilityManager?.disable(),TextLayerBuilder.#removeGlobalSelectionListener(this.div)}#bindMouse(end){const{div}=this;div.addEventListener("mousedown",(()=>{div.classList.add("selecting")})),div.addEventListener("copy",(event=>{if(!this.#enablePermissions){const selection=document.getSelection();event.clipboardData.setData("text/plain",removeNullCharacters(pdf_viewer_normalizeUnicode(selection.toString())))}event.preventDefault(),event.stopPropagation()})),TextLayerBuilder.#textLayers.set(div,end),TextLayerBuilder.#enableGlobalSelectionListener()}static#removeGlobalSelectionListener(textLayerDiv){this.#textLayers.delete(textLayerDiv),0===this.#textLayers.size&&(this.#selectionChangeAbortController?.abort(),this.#selectionChangeAbortController=null)}static#enableGlobalSelectionListener(){if(this.#selectionChangeAbortController)return;this.#selectionChangeAbortController=new AbortController;const{signal}=this.#selectionChangeAbortController,reset=(end,textLayer)=>{textLayer.append(end),end.style.width="",end.style.height="",textLayer.classList.remove("selecting")};let isPointerDown=!1;var isFirefox,prevRange;document.addEventListener("pointerdown",(()=>{isPointerDown=!0}),{signal}),document.addEventListener("pointerup",(()=>{isPointerDown=!1,this.#textLayers.forEach(reset)}),{signal}),window.addEventListener("blur",(()=>{isPointerDown=!1,this.#textLayers.forEach(reset)}),{signal}),document.addEventListener("keyup",(()=>{isPointerDown||this.#textLayers.forEach(reset)}),{signal}),document.addEventListener("selectionchange",(()=>{const selection=document.getSelection();if(0===selection.rangeCount)return void this.#textLayers.forEach(reset);const activeTextLayers=new Set;for(let i=0;i<selection.rangeCount;i++){const range=selection.getRangeAt(i);for(const textLayerDiv of this.#textLayers.keys())!activeTextLayers.has(textLayerDiv)&&range.intersectsNode(textLayerDiv)&&activeTextLayers.add(textLayerDiv)}for(const[textLayerDiv,endDiv]of this.#textLayers)activeTextLayers.has(textLayerDiv)?textLayerDiv.classList.add("selecting"):reset(endDiv,textLayerDiv);if(isFirefox??="none"===getComputedStyle(this.#textLayers.values().next().value).getPropertyValue("-moz-user-select"),isFirefox)return;const range=selection.getRangeAt(0),modifyStart=prevRange&&(0===range.compareBoundaryPoints(Range.END_TO_END,prevRange)||0===range.compareBoundaryPoints(Range.START_TO_END,prevRange));let anchor=modifyStart?range.startContainer:range.endContainer;anchor.nodeType===Node.TEXT_NODE&&(anchor=anchor.parentNode);const parentTextLayer=anchor.parentElement?.closest(".textLayer"),endDiv=this.#textLayers.get(parentTextLayer);endDiv&&(endDiv.style.width=parentTextLayer.style.width,endDiv.style.height=parentTextLayer.style.height,anchor.parentElement.insertBefore(endDiv,modifyStart?anchor:anchor.nextSibling)),prevRange=range.cloneRange()}),{signal})}}class XfaLayerBuilder{constructor({pdfPage,annotationStorage=null,linkService,xfaHtml=null}){this.pdfPage=pdfPage,this.annotationStorage=annotationStorage,this.linkService=linkService,this.xfaHtml=xfaHtml,this.div=null,this._cancelled=!1}render(viewport,intent="display"){var _this19=this;return(0,asyncToGenerator.A)((function*(){if("print"===intent){const parameters={viewport:viewport.clone({dontFlip:!0}),div:_this19.div,xfaHtml:_this19.xfaHtml,annotationStorage:_this19.annotationStorage,linkService:_this19.linkService,intent};return _this19.div=document.createElement("div"),parameters.div=_this19.div,pdf_viewer_XfaLayer.render(parameters)}const xfaHtml=yield _this19.pdfPage.getXfa();if(_this19._cancelled||!xfaHtml)return{textDivs:[]};const parameters={viewport:viewport.clone({dontFlip:!0}),div:_this19.div,xfaHtml,annotationStorage:_this19.annotationStorage,linkService:_this19.linkService,intent};return _this19.div?pdf_viewer_XfaLayer.update(parameters):(_this19.div=document.createElement("div"),parameters.div=_this19.div,pdf_viewer_XfaLayer.render(parameters))}))()}cancel(){this._cancelled=!0}hide(){this.div&&(this.div.hidden=!0)}}const DEFAULT_LAYER_PROPERTIES={annotationEditorUIManager:null,annotationStorage:null,downloadManager:null,enableScripting:!1,fieldObjectsPromise:null,findController:null,hasJSActionsPromise:null,get linkService(){return new SimpleLinkService}},LAYERS_ORDER=new Map([["canvasWrapper",0],["textLayer",1],["annotationLayer",2],["annotationEditorLayer",3],["xfaLayer",3]]);class PDFPageView{#annotationMode=pdf_viewer_AnnotationMode.ENABLE_FORMS;#enableHWA=!1;#hasRestrictedScaling=!1;#isEditing=!1;#layerProperties=null;#loadingId=null;#previousRotation=null;#scaleRoundX=1;#scaleRoundY=1;#renderError=null;#renderingState=RenderingStates.INITIAL;#textLayerMode=TextLayerMode_ENABLE;#useThumbnailCanvas={directDrawing:!0,initialOptionalContent:!0,regularAnnotations:!0};#viewportMap=new WeakMap;#layers=[null,null,null,null];constructor(options){const container=options.container,defaultViewport=options.defaultViewport;this.id=options.id,this.renderingId="page"+this.id,this.#layerProperties=options.layerProperties||DEFAULT_LAYER_PROPERTIES,this.pdfPage=null,this.pageLabel=null,this.rotation=0,this.scale=options.scale||1,this.viewport=defaultViewport,this.pdfPageRotate=defaultViewport.rotation,this._optionalContentConfigPromise=options.optionalContentConfigPromise||null,this.#textLayerMode=options.textLayerMode??TextLayerMode_ENABLE,this.#annotationMode=options.annotationMode??pdf_viewer_AnnotationMode.ENABLE_FORMS,this.imageResourcesPath=options.imageResourcesPath||"",this.maxCanvasPixels=options.maxCanvasPixels??AppOptions.get("maxCanvasPixels"),this.pageColors=options.pageColors||null,this.#enableHWA=options.enableHWA||!1,this.eventBus=options.eventBus,this.renderingQueue=options.renderingQueue,this.l10n=options.l10n,this.l10n||=new genericl10n_GenericL10n,this.renderTask=null,this.resume=null,this._isStandalone=!this.renderingQueue?.hasViewer(),this._container=container,this._annotationCanvasMap=null,this.annotationLayer=null,this.annotationEditorLayer=null,this.textLayer=null,this.zoomLayer=null,this.xfaLayer=null,this.structTreeLayer=null,this.drawLayer=null;const div=document.createElement("div");if(div.className="page",div.setAttribute("data-page-number",this.id),div.setAttribute("role","region"),div.setAttribute("data-l10n-id","pdfjs-page-landmark"),div.setAttribute("data-l10n-args",JSON.stringify({page:this.id})),this.div=div,this.#setDimensions(),container?.append(div),this._isStandalone){container?.style.setProperty("--scale-factor",this.scale*pdf_viewer_PixelsPerInch.PDF_TO_CSS_UNITS),this.pageColors?.background&&container?.style.setProperty("--page-bg-color",this.pageColors.background);const{optionalContentConfigPromise}=options;optionalContentConfigPromise&&optionalContentConfigPromise.then((optionalContentConfig=>{optionalContentConfigPromise===this._optionalContentConfigPromise&&(this.#useThumbnailCanvas.initialOptionalContent=optionalContentConfig.hasInitialVisibility)})),options.l10n||this.l10n.translate(this.div)}}#addLayer(div,name){const pos=LAYERS_ORDER.get(name),oldDiv=this.#layers[pos];if(this.#layers[pos]=div,oldDiv)oldDiv.replaceWith(div);else{for(let i=pos-1;i>=0;i--){const layer=this.#layers[i];if(layer)return void layer.after(div)}this.div.prepend(div)}}get renderingState(){return this.#renderingState}set renderingState(state){if(state!==this.#renderingState)switch(this.#renderingState=state,this.#loadingId&&(clearTimeout(this.#loadingId),this.#loadingId=null),state){case RenderingStates.PAUSED:this.div.classList.remove("loading");break;case RenderingStates.RUNNING:this.div.classList.add("loadingIcon"),this.#loadingId=setTimeout((()=>{this.div.classList.add("loading"),this.#loadingId=null}),0);break;case RenderingStates.INITIAL:case RenderingStates.FINISHED:this.div.classList.remove("loadingIcon","loading")}}#setDimensions(){const{viewport}=this;if(this.pdfPage){if(this.#previousRotation===viewport.rotation)return;this.#previousRotation=viewport.rotation}pdf_viewer_setLayerDimensions(this.div,viewport,!0,!1)}setPdfPage(pdfPage){!this._isStandalone||"CanvasText"!==this.pageColors?.foreground&&"Canvas"!==this.pageColors?.background||(this._container?.style.setProperty("--hcm-highlight-filter",pdfPage.filterFactory.addHighlightHCMFilter("highlight","CanvasText","Canvas","HighlightText","Highlight")),this._container?.style.setProperty("--hcm-highlight-selected-filter",pdfPage.filterFactory.addHighlightHCMFilter("highlight_selected","CanvasText","Canvas","HighlightText","Highlight"))),this.pdfPage=pdfPage,this.pdfPageRotate=pdfPage.rotate;const totalRotation=(this.rotation+this.pdfPageRotate)%360;this.viewport=pdfPage.getViewport({scale:this.scale*pdf_viewer_PixelsPerInch.PDF_TO_CSS_UNITS,rotation:totalRotation}),this.#setDimensions(),this.reset()}destroy(){this.reset(),this.pdfPage?.cleanup()}hasEditableAnnotations(){return!!this.annotationLayer?.hasEditableAnnotations()}get _textHighlighter(){return pdf_viewer_shadow(this,"_textHighlighter",new TextHighlighter({pageIndex:this.id-1,eventBus:this.eventBus,findController:this.#layerProperties.findController}))}#dispatchLayerRendered(name,error){this.eventBus.dispatch(name,{source:this,pageNumber:this.id,error})}#renderAnnotationLayer(){var _this20=this;return(0,asyncToGenerator.A)((function*(){let error=null;try{yield _this20.annotationLayer.render(_this20.viewport,{structTreeLayer:_this20.structTreeLayer},"display")}catch(ex){console.error(`#renderAnnotationLayer: "${ex}".`),error=ex}finally{_this20.#dispatchLayerRendered("annotationlayerrendered",error)}}))()}#renderAnnotationEditorLayer(){var _this21=this;return(0,asyncToGenerator.A)((function*(){let error=null;try{yield _this21.annotationEditorLayer.render(_this21.viewport,"display")}catch(ex){console.error(`#renderAnnotationEditorLayer: "${ex}".`),error=ex}finally{_this21.#dispatchLayerRendered("annotationeditorlayerrendered",error)}}))()}#renderDrawLayer(){var _this22=this;return(0,asyncToGenerator.A)((function*(){try{yield _this22.drawLayer.render("display")}catch(ex){console.error(`#renderDrawLayer: "${ex}".`)}}))()}#renderXfaLayer(){var _this23=this;return(0,asyncToGenerator.A)((function*(){let error=null;try{const result=yield _this23.xfaLayer.render(_this23.viewport,"display");result?.textDivs&&_this23._textHighlighter&&_this23.#buildXfaTextContentItems(result.textDivs)}catch(ex){console.error(`#renderXfaLayer: "${ex}".`),error=ex}finally{_this23.xfaLayer?.div&&(_this23.l10n.pause(),_this23.#addLayer(_this23.xfaLayer.div,"xfaLayer"),_this23.l10n.resume()),_this23.#dispatchLayerRendered("xfalayerrendered",error)}}))()}#renderTextLayer(){var _this24=this;return(0,asyncToGenerator.A)((function*(){if(!_this24.textLayer)return;let error=null;try{yield _this24.textLayer.render(_this24.viewport)}catch(ex){if(ex instanceof pdf_viewer_AbortException)return;console.error(`#renderTextLayer: "${ex}".`),error=ex}_this24.#dispatchLayerRendered("textlayerrendered",error),_this24.#renderStructTreeLayer()}))()}#renderStructTreeLayer(){var _this25=this;return(0,asyncToGenerator.A)((function*(){if(!_this25.textLayer)return;const treeDom=yield _this25.structTreeLayer?.render();treeDom&&(_this25.l10n.pause(),_this25.structTreeLayer?.addElementsToTextLayer(),_this25.canvas&&treeDom.parentNode!==_this25.canvas&&_this25.canvas.append(treeDom),_this25.l10n.resume()),_this25.structTreeLayer?.show()}))()}#buildXfaTextContentItems(textDivs){var _this26=this;return(0,asyncToGenerator.A)((function*(){const text=yield _this26.pdfPage.getTextContent(),items=[];for(const item of text.items)items.push(item.str);_this26._textHighlighter.setTextMapping(textDivs,items),_this26._textHighlighter.enable()}))()}_resetZoomLayer(removeFromDOM=!1){if(!this.zoomLayer)return;const zoomLayerCanvas=this.zoomLayer.firstChild;this.#viewportMap.delete(zoomLayerCanvas),zoomLayerCanvas.width=0,zoomLayerCanvas.height=0,removeFromDOM&&this.zoomLayer.remove(),this.zoomLayer=null}reset({keepZoomLayer=!1,keepAnnotationLayer=!1,keepAnnotationEditorLayer=!1,keepXfaLayer=!1,keepTextLayer=!1}={}){this.cancelRendering({keepAnnotationLayer,keepAnnotationEditorLayer,keepXfaLayer,keepTextLayer}),this.renderingState=RenderingStates.INITIAL;const div=this.div,childNodes=div.childNodes,zoomLayerNode=keepZoomLayer&&this.zoomLayer||null,annotationLayerNode=keepAnnotationLayer&&this.annotationLayer?.div||null,annotationEditorLayerNode=keepAnnotationEditorLayer&&this.annotationEditorLayer?.div||null,xfaLayerNode=keepXfaLayer&&this.xfaLayer?.div||null,textLayerNode=keepTextLayer&&this.textLayer?.div||null;for(let i=childNodes.length-1;i>=0;i--){const node=childNodes[i];switch(node){case zoomLayerNode:case annotationLayerNode:case annotationEditorLayerNode:case xfaLayerNode:case textLayerNode:continue}node.remove();const layerIndex=this.#layers.indexOf(node);layerIndex>=0&&(this.#layers[layerIndex]=null)}div.removeAttribute("data-loaded"),annotationLayerNode&&this.annotationLayer.hide(),annotationEditorLayerNode&&this.annotationEditorLayer.hide(),xfaLayerNode&&this.xfaLayer.hide(),textLayerNode&&this.textLayer.hide(),this.structTreeLayer?.hide(),zoomLayerNode||(this.canvas&&(this.#viewportMap.delete(this.canvas),this.canvas.width=0,this.canvas.height=0,delete this.canvas),this._resetZoomLayer())}toggleEditingMode(isEditing){this.hasEditableAnnotations()&&(this.#isEditing=isEditing,this.reset({keepZoomLayer:!0,keepAnnotationLayer:!0,keepAnnotationEditorLayer:!0,keepXfaLayer:!0,keepTextLayer:!0}))}update({scale=0,rotation=null,optionalContentConfigPromise=null,drawingDelay=-1}){this.scale=scale||this.scale,"number"==typeof rotation&&(this.rotation=rotation),optionalContentConfigPromise instanceof Promise&&(this._optionalContentConfigPromise=optionalContentConfigPromise,optionalContentConfigPromise.then((optionalContentConfig=>{optionalContentConfigPromise===this._optionalContentConfigPromise&&(this.#useThumbnailCanvas.initialOptionalContent=optionalContentConfig.hasInitialVisibility)}))),this.#useThumbnailCanvas.directDrawing=!0;const totalRotation=(this.rotation+this.pdfPageRotate)%360;if(this.viewport=this.viewport.clone({scale:this.scale*pdf_viewer_PixelsPerInch.PDF_TO_CSS_UNITS,rotation:totalRotation}),this.#setDimensions(),this._isStandalone&&this._container?.style.setProperty("--scale-factor",this.viewport.scale),this.canvas){let onlyCssZoom=!1;if(this.#hasRestrictedScaling)if(0===this.maxCanvasPixels)onlyCssZoom=!0;else if(this.maxCanvasPixels>0){const{width,height}=this.viewport,{sx,sy}=this.outputScale;onlyCssZoom=(Math.floor(width)*sx|0)*(Math.floor(height)*sy|0)>this.maxCanvasPixels}const postponeDrawing=drawingDelay>=0&&drawingDelay<1e3;if(postponeDrawing||onlyCssZoom){if(postponeDrawing&&!onlyCssZoom&&this.renderingState!==RenderingStates.FINISHED&&(this.cancelRendering({keepZoomLayer:!0,keepAnnotationLayer:!0,keepAnnotationEditorLayer:!0,keepXfaLayer:!0,keepTextLayer:!0,cancelExtraDelay:drawingDelay}),this.renderingState=RenderingStates.FINISHED,this.#useThumbnailCanvas.directDrawing=!1),this.cssTransform({target:this.canvas,redrawAnnotationLayer:!0,redrawAnnotationEditorLayer:!0,redrawXfaLayer:!0,redrawTextLayer:!postponeDrawing,hideTextLayer:postponeDrawing}),postponeDrawing)return;return void this.eventBus.dispatch("pagerendered",{source:this,pageNumber:this.id,cssTransform:!0,timestamp:performance.now(),error:this.#renderError})}this.zoomLayer||this.canvas.hidden||(this.zoomLayer=this.canvas.parentNode,this.zoomLayer.style.position="absolute")}this.zoomLayer&&this.cssTransform({target:this.zoomLayer.firstChild}),this.reset({keepZoomLayer:!0,keepAnnotationLayer:!0,keepAnnotationEditorLayer:!0,keepXfaLayer:!0,keepTextLayer:!0})}cancelRendering({keepAnnotationLayer=!1,keepAnnotationEditorLayer=!1,keepXfaLayer=!1,keepTextLayer=!1,cancelExtraDelay=0}={}){this.renderTask&&(this.renderTask.cancel(cancelExtraDelay),this.renderTask=null),this.resume=null,!this.textLayer||keepTextLayer&&this.textLayer.div||(this.textLayer.cancel(),this.textLayer=null),!this.annotationLayer||keepAnnotationLayer&&this.annotationLayer.div||(this.annotationLayer.cancel(),this.annotationLayer=null,this._annotationCanvasMap=null),this.structTreeLayer&&!this.textLayer&&(this.structTreeLayer=null),!this.annotationEditorLayer||keepAnnotationEditorLayer&&this.annotationEditorLayer.div||(this.drawLayer&&(this.drawLayer.cancel(),this.drawLayer=null),this.annotationEditorLayer.cancel(),this.annotationEditorLayer=null),!this.xfaLayer||keepXfaLayer&&this.xfaLayer.div||(this.xfaLayer.cancel(),this.xfaLayer=null,this._textHighlighter?.disable())}cssTransform({target,redrawAnnotationLayer=!1,redrawAnnotationEditorLayer=!1,redrawXfaLayer=!1,redrawTextLayer=!1,hideTextLayer=!1}){if(!target.hasAttribute("zooming")){target.setAttribute("zooming",!0);const{style}=target;style.width=style.height=""}const originalViewport=this.#viewportMap.get(target);if(this.viewport!==originalViewport){const relativeRotation=this.viewport.rotation-originalViewport.rotation,absRotation=Math.abs(relativeRotation);let scaleX=1,scaleY=1;if(90===absRotation||270===absRotation){const{width,height}=this.viewport;scaleX=height/width,scaleY=width/height}target.style.transform=`rotate(${relativeRotation}deg) scale(${scaleX}, ${scaleY})`}redrawAnnotationLayer&&this.annotationLayer&&this.#renderAnnotationLayer(),redrawAnnotationEditorLayer&&this.annotationEditorLayer&&(this.drawLayer&&this.#renderDrawLayer(),this.#renderAnnotationEditorLayer()),redrawXfaLayer&&this.xfaLayer&&this.#renderXfaLayer(),this.textLayer&&(hideTextLayer?(this.textLayer.hide(),this.structTreeLayer?.hide()):redrawTextLayer&&this.#renderTextLayer())}get width(){return this.viewport.width}get height(){return this.viewport.height}getPagePoint(x,y){return this.viewport.convertToPdfPoint(x,y)}#finishRenderTask(renderTask,error=null){var _this27=this;return(0,asyncToGenerator.A)((function*(){if(renderTask===_this27.renderTask&&(_this27.renderTask=null),error instanceof pdf_viewer_RenderingCancelledException)_this27.#renderError=null;else if(_this27.#renderError=error,_this27.renderingState=RenderingStates.FINISHED,_this27._resetZoomLayer(!0),_this27.#useThumbnailCanvas.regularAnnotations=!renderTask.separateAnnots,_this27.eventBus.dispatch("pagerendered",{source:_this27,pageNumber:_this27.id,cssTransform:!1,timestamp:performance.now(),error:_this27.#renderError}),error)throw error}))()}draw(){var _this28=this;return(0,asyncToGenerator.A)((function*(){_this28.renderingState!==RenderingStates.INITIAL&&(console.error("Must be in new state before drawing"),_this28.reset());const{div,l10n,pageColors,pdfPage,viewport}=_this28;if(!pdfPage)throw _this28.renderingState=RenderingStates.FINISHED,new Error("pdfPage is not loaded");_this28.renderingState=RenderingStates.RUNNING;const canvasWrapper=document.createElement("div");if(canvasWrapper.classList.add("canvasWrapper"),_this28.#addLayer(canvasWrapper,"canvasWrapper"),_this28.textLayer||_this28.#textLayerMode===TextLayerMode_DISABLE||pdfPage.isPureXfa||(_this28._accessibilityManager||=new TextAccessibilityManager,_this28.textLayer=new TextLayerBuilder({pdfPage,highlighter:_this28._textHighlighter,accessibilityManager:_this28._accessibilityManager,enablePermissions:_this28.#textLayerMode===TextLayerMode_ENABLE_PERMISSIONS,onAppend:textLayerDiv=>{_this28.l10n.pause(),_this28.#addLayer(textLayerDiv,"textLayer"),_this28.l10n.resume()}})),!_this28.annotationLayer&&_this28.#annotationMode!==pdf_viewer_AnnotationMode.DISABLE){const{annotationStorage,annotationEditorUIManager,downloadManager,enableScripting,fieldObjectsPromise,hasJSActionsPromise,linkService}=_this28.#layerProperties;_this28._annotationCanvasMap||=new Map,_this28.annotationLayer=new AnnotationLayerBuilder({pdfPage,annotationStorage,imageResourcesPath:_this28.imageResourcesPath,renderForms:_this28.#annotationMode===pdf_viewer_AnnotationMode.ENABLE_FORMS,linkService,downloadManager,enableScripting,hasJSActionsPromise,fieldObjectsPromise,annotationCanvasMap:_this28._annotationCanvasMap,accessibilityManager:_this28._accessibilityManager,annotationEditorUIManager,onAppend:annotationLayerDiv=>{_this28.#addLayer(annotationLayerDiv,"annotationLayer")}})}const{width,height}=viewport,canvas=document.createElement("canvas");canvas.setAttribute("role","presentation"),canvas.hidden=!0;const hasHCM=!(!pageColors?.background||!pageColors?.foreground);let showCanvas=isLastShow=>{hasHCM&&!isLastShow||(canvas.hidden=!1,showCanvas=null)};canvasWrapper.append(canvas),_this28.canvas=canvas;const ctx=canvas.getContext("2d",{alpha:!1,willReadFrequently:!_this28.#enableHWA}),outputScale=_this28.outputScale=new pdf_viewer_OutputScale;if(0===_this28.maxCanvasPixels){const invScale=1/_this28.scale;outputScale.sx*=invScale,outputScale.sy*=invScale,_this28.#hasRestrictedScaling=!0}else if(_this28.maxCanvasPixels>0){const pixelsInViewport=width*height,maxScale=Math.sqrt(_this28.maxCanvasPixels/pixelsInViewport);outputScale.sx>maxScale||outputScale.sy>maxScale?(outputScale.sx=maxScale,outputScale.sy=maxScale,_this28.#hasRestrictedScaling=!0):_this28.#hasRestrictedScaling=!1}const sfx=approximateFraction(outputScale.sx),sfy=approximateFraction(outputScale.sy),canvasWidth=canvas.width=floorToDivide(calcRound(width*outputScale.sx),sfx[0]),canvasHeight=canvas.height=floorToDivide(calcRound(height*outputScale.sy),sfy[0]),pageWidth=floorToDivide(calcRound(width),sfx[1]),pageHeight=floorToDivide(calcRound(height),sfy[1]);outputScale.sx=canvasWidth/pageWidth,outputScale.sy=canvasHeight/pageHeight,_this28.#scaleRoundX!==sfx[1]&&(div.style.setProperty("--scale-round-x",`${sfx[1]}px`),_this28.#scaleRoundX=sfx[1]),_this28.#scaleRoundY!==sfy[1]&&(div.style.setProperty("--scale-round-y",`${sfy[1]}px`),_this28.#scaleRoundY=sfy[1]),_this28.#viewportMap.set(canvas,viewport);const renderContext={canvasContext:ctx,transform:outputScale.scaled?[outputScale.sx,0,0,outputScale.sy,0,0]:null,viewport,annotationMode:_this28.#annotationMode,optionalContentConfigPromise:_this28._optionalContentConfigPromise,annotationCanvasMap:_this28._annotationCanvasMap,pageColors,isEditing:_this28.#isEditing},renderTask=_this28.renderTask=pdfPage.render(renderContext);renderTask.onContinue=cont=>{if(showCanvas?.(!1),_this28.renderingQueue&&!_this28.renderingQueue.isHighestPriority(_this28))return _this28.renderingState=RenderingStates.PAUSED,void(_this28.resume=()=>{_this28.renderingState=RenderingStates.RUNNING,cont()});cont()};const resultPromise=renderTask.promise.then((0,asyncToGenerator.A)((function*(){showCanvas?.(!0),yield _this28.#finishRenderTask(renderTask),_this28.structTreeLayer||=new StructTreeLayerBuilder(pdfPage,viewport.rawDims),_this28.#renderTextLayer(),_this28.annotationLayer&&(yield _this28.#renderAnnotationLayer());const{annotationEditorUIManager}=_this28.#layerProperties;annotationEditorUIManager&&(_this28.drawLayer||=new DrawLayerBuilder({pageIndex:_this28.id}),yield _this28.#renderDrawLayer(),_this28.drawLayer.setParent(canvasWrapper),_this28.annotationEditorLayer||=new AnnotationEditorLayerBuilder({uiManager:annotationEditorUIManager,pdfPage,l10n,structTreeLayer:_this28.structTreeLayer,accessibilityManager:_this28._accessibilityManager,annotationLayer:_this28.annotationLayer?.annotationLayer,textLayer:_this28.textLayer,drawLayer:_this28.drawLayer.getDrawLayer(),onAppend:annotationEditorLayerDiv=>{_this28.#addLayer(annotationEditorLayerDiv,"annotationEditorLayer")}}),_this28.#renderAnnotationEditorLayer())})),(error=>(error instanceof pdf_viewer_RenderingCancelledException||showCanvas?.(!0),_this28.#finishRenderTask(renderTask,error))));if(pdfPage.isPureXfa){if(!_this28.xfaLayer){const{annotationStorage,linkService}=_this28.#layerProperties;_this28.xfaLayer=new XfaLayerBuilder({pdfPage,annotationStorage,linkService})}_this28.#renderXfaLayer()}return div.setAttribute("data-loaded",!0),_this28.eventBus.dispatch("pagerender",{source:_this28,pageNumber:_this28.id}),resultPromise}))()}setPageLabel(label){this.pageLabel="string"==typeof label?label:null,this.div.setAttribute("data-l10n-args",JSON.stringify({page:this.pageLabel??this.id})),null!==this.pageLabel?this.div.setAttribute("data-page-label",this.pageLabel):this.div.removeAttribute("data-page-label")}get thumbnailCanvas(){const{directDrawing,initialOptionalContent,regularAnnotations}=this.#useThumbnailCanvas;return directDrawing&&initialOptionalContent&&regularAnnotations?this.canvas:null}}function _docProperties(){return _docProperties=(0,asyncToGenerator.A)((function*(pdfDocument){const baseUrl="".split("#",1)[0];let{info,metadata,contentDispositionFilename,contentLength}=yield pdfDocument.getMetadata();if(!contentLength){const{length}=yield pdfDocument.getDownloadInfo();contentLength=length}return{...info,baseURL:baseUrl,filesize:contentLength,filename:contentDispositionFilename||pdf_viewer_getPdfFilenameFromUrl(""),metadata:metadata?.getRaw(),authors:metadata?.get("dc:creator"),numPages:pdfDocument.numPages,URL:""}})),_docProperties.apply(this,arguments)}class GenericScripting{constructor(sandboxBundleSrc){this._ready=new Promise(((resolve,reject)=>{import(sandboxBundleSrc).then((pdfjsSandbox=>{resolve(pdfjsSandbox.QuickJSSandbox())})).catch(reject)}))}createSandbox(data){var _this29=this;return(0,asyncToGenerator.A)((function*(){(yield _this29._ready).create(data)}))()}dispatchEventInSandbox(event){var _this30=this;return(0,asyncToGenerator.A)((function*(){const sandbox=yield _this30._ready;setTimeout((()=>sandbox.dispatchEvent(event)),0)}))()}destroySandbox(){var _this31=this;return(0,asyncToGenerator.A)((function*(){(yield _this31._ready).nukeSandbox()}))()}}class PDFScriptingManager{#closeCapability=null;#destroyCapability=null;#docProperties=null;#eventAbortController=null;#eventBus=null;#externalServices=null;#pdfDocument=null;#pdfViewer=null;#ready=!1;#scripting=null;#willPrintCapability=null;constructor({eventBus,externalServices=null,docProperties=null}){this.#eventBus=eventBus,this.#externalServices=externalServices,this.#docProperties=docProperties}setViewer(pdfViewer){this.#pdfViewer=pdfViewer}setDocument(pdfDocument){var _this32=this;return(0,asyncToGenerator.A)((function*(){if(_this32.#pdfDocument&&(yield _this32.#destroyScripting()),_this32.#pdfDocument=pdfDocument,!pdfDocument)return;const[objects,calculationOrder,docActions]=yield Promise.all([pdfDocument.getFieldObjects(),pdfDocument.getCalculationOrderIds(),pdfDocument.getJSActions()]);if(!objects&&!docActions)return void(yield _this32.#destroyScripting());if(pdfDocument!==_this32.#pdfDocument)return;try{_this32.#scripting=_this32.#initScripting()}catch(error){return console.error(`setDocument: "${error.message}".`),void(yield _this32.#destroyScripting())}const eventBus=_this32.#eventBus;_this32.#eventAbortController=new AbortController;const{signal}=_this32.#eventAbortController;eventBus._on("updatefromsandbox",(event=>{event?.source===window&&_this32.#updateFromSandbox(event.detail)}),{signal}),eventBus._on("dispatcheventinsandbox",(event=>{_this32.#scripting?.dispatchEventInSandbox(event.detail)}),{signal}),eventBus._on("pagechanging",(({pageNumber,previous})=>{pageNumber!==previous&&(_this32.#dispatchPageClose(previous),_this32.#dispatchPageOpen(pageNumber))}),{signal}),eventBus._on("pagerendered",(({pageNumber})=>{_this32._pageOpenPending.has(pageNumber)&&pageNumber===_this32.#pdfViewer.currentPageNumber&&_this32.#dispatchPageOpen(pageNumber)}),{signal}),eventBus._on("pagesdestroy",(0,asyncToGenerator.A)((function*(){yield _this32.#dispatchPageClose(_this32.#pdfViewer.currentPageNumber),yield _this32.#scripting?.dispatchEventInSandbox({id:"doc",name:"WillClose"}),_this32.#closeCapability?.resolve()})),{signal});try{const docProperties=yield _this32.#docProperties(pdfDocument);if(pdfDocument!==_this32.#pdfDocument)return;yield _this32.#scripting.createSandbox({objects,calculationOrder,appInfo:{platform:navigator.platform,language:navigator.language},docInfo:{...docProperties,actions:docActions}}),eventBus.dispatch("sandboxcreated",{source:_this32})}catch(error){return console.error(`setDocument: "${error.message}".`),void(yield _this32.#destroyScripting())}yield _this32.#scripting?.dispatchEventInSandbox({id:"doc",name:"Open"}),yield _this32.#dispatchPageOpen(_this32.#pdfViewer.currentPageNumber,!0),Promise.resolve().then((()=>{pdfDocument===_this32.#pdfDocument&&(_this32.#ready=!0)}))}))()}dispatchWillSave(){var _this33=this;return(0,asyncToGenerator.A)((function*(){return _this33.#scripting?.dispatchEventInSandbox({id:"doc",name:"WillSave"})}))()}dispatchDidSave(){var _this34=this;return(0,asyncToGenerator.A)((function*(){return _this34.#scripting?.dispatchEventInSandbox({id:"doc",name:"DidSave"})}))()}dispatchWillPrint(){var _this35=this;return(0,asyncToGenerator.A)((function*(){if(_this35.#scripting){yield _this35.#willPrintCapability?.promise,_this35.#willPrintCapability=Promise.withResolvers();try{yield _this35.#scripting.dispatchEventInSandbox({id:"doc",name:"WillPrint"})}catch(ex){throw _this35.#willPrintCapability.resolve(),_this35.#willPrintCapability=null,ex}yield _this35.#willPrintCapability.promise}}))()}dispatchDidPrint(){var _this36=this;return(0,asyncToGenerator.A)((function*(){return _this36.#scripting?.dispatchEventInSandbox({id:"doc",name:"DidPrint"})}))()}get destroyPromise(){return this.#destroyCapability?.promise||null}get ready(){return this.#ready}get _pageOpenPending(){return pdf_viewer_shadow(this,"_pageOpenPending",new Set)}get _visitedPages(){return pdf_viewer_shadow(this,"_visitedPages",new Map)}#updateFromSandbox(detail){var _this37=this;return(0,asyncToGenerator.A)((function*(){const pdfViewer=_this37.#pdfViewer,isInPresentationMode=pdfViewer.isInPresentationMode||pdfViewer.isChangingPresentationMode,{id,siblings,command,value}=detail;if(!id){switch(command){case"clear":console.clear();break;case"error":console.error(value);break;case"layout":if(!isInPresentationMode){const modes=function apiPageLayoutToViewerModes(layout){let scrollMode=ScrollMode.VERTICAL,spreadMode=SpreadMode.NONE;switch(layout){case"SinglePage":scrollMode=ScrollMode.PAGE;break;case"OneColumn":break;case"TwoPageLeft":scrollMode=ScrollMode.PAGE;case"TwoColumnLeft":spreadMode=SpreadMode.ODD;break;case"TwoPageRight":scrollMode=ScrollMode.PAGE;case"TwoColumnRight":spreadMode=SpreadMode.EVEN}return{scrollMode,spreadMode}}(value);pdfViewer.spreadMode=modes.spreadMode}break;case"page-num":pdfViewer.currentPageNumber=value+1;break;case"print":yield pdfViewer.pagesPromise,_this37.#eventBus.dispatch("print",{source:_this37});break;case"println":console.log(value);break;case"zoom":isInPresentationMode||(pdfViewer.currentScaleValue=value);break;case"SaveAs":_this37.#eventBus.dispatch("download",{source:_this37});break;case"FirstPage":pdfViewer.currentPageNumber=1;break;case"LastPage":pdfViewer.currentPageNumber=pdfViewer.pagesCount;break;case"NextPage":pdfViewer.nextPage();break;case"PrevPage":pdfViewer.previousPage();break;case"ZoomViewIn":isInPresentationMode||pdfViewer.increaseScale();break;case"ZoomViewOut":isInPresentationMode||pdfViewer.decreaseScale();break;case"WillPrintFinished":_this37.#willPrintCapability?.resolve(),_this37.#willPrintCapability=null}return}if(isInPresentationMode&&detail.focus)return;delete detail.id,delete detail.siblings;const ids=siblings?[id,...siblings]:[id];for(const elementId of ids){const element=document.querySelector(`[data-element-id="${elementId}"]`);element?element.dispatchEvent(new CustomEvent("updatefromsandbox",{detail})):_this37.#pdfDocument?.annotationStorage.setValue(elementId,detail)}}))()}#dispatchPageOpen(pageNumber,initialize=!1){var _this38=this;return(0,asyncToGenerator.A)((function*(){const pdfDocument=_this38.#pdfDocument,visitedPages=_this38._visitedPages;if(initialize&&(_this38.#closeCapability=Promise.withResolvers()),!_this38.#closeCapability)return;const pageView=_this38.#pdfViewer.getPageView(pageNumber-1);if(pageView?.renderingState!==RenderingStates.FINISHED)return void _this38._pageOpenPending.add(pageNumber);_this38._pageOpenPending.delete(pageNumber);const actionsPromise=(0,asyncToGenerator.A)((function*(){const actions=yield visitedPages.has(pageNumber)?null:pageView.pdfPage?.getJSActions();pdfDocument===_this38.#pdfDocument&&(yield _this38.#scripting?.dispatchEventInSandbox({id:"page",name:"PageOpen",pageNumber,actions}))}))();visitedPages.set(pageNumber,actionsPromise)}))()}#dispatchPageClose(pageNumber){var _this39=this;return(0,asyncToGenerator.A)((function*(){const pdfDocument=_this39.#pdfDocument,visitedPages=_this39._visitedPages;if(!_this39.#closeCapability)return;if(_this39._pageOpenPending.has(pageNumber))return;const actionsPromise=visitedPages.get(pageNumber);actionsPromise&&(visitedPages.set(pageNumber,null),yield actionsPromise,pdfDocument===_this39.#pdfDocument&&(yield _this39.#scripting?.dispatchEventInSandbox({id:"page",name:"PageClose",pageNumber})))}))()}#initScripting(){if(this.#destroyCapability=Promise.withResolvers(),this.#scripting)throw new Error("#initScripting: Scripting already exists.");return this.#externalServices.createScripting()}#destroyScripting(){var _this40=this;return(0,asyncToGenerator.A)((function*(){if(!_this40.#scripting)return _this40.#pdfDocument=null,void _this40.#destroyCapability?.resolve();_this40.#closeCapability&&(yield Promise.race([_this40.#closeCapability.promise,new Promise((resolve=>{setTimeout(resolve,1e3)}))]).catch((()=>{})),_this40.#closeCapability=null),_this40.#pdfDocument=null;try{yield _this40.#scripting.destroySandbox()}catch{}_this40.#willPrintCapability?.reject(new Error("Scripting destroyed.")),_this40.#willPrintCapability=null,_this40.#eventAbortController?.abort(),_this40.#eventAbortController=null,_this40._pageOpenPending.clear(),_this40._visitedPages.clear(),_this40.#scripting=null,_this40.#ready=!1,_this40.#destroyCapability?.resolve()}))()}}class PDFScriptingManagerComponents extends PDFScriptingManager{constructor(options){options.externalServices||window.addEventListener("updatefromsandbox",(event=>{options.eventBus.dispatch("updatefromsandbox",{source:window,detail:event.detail})})),options.externalServices||={createScripting:()=>new GenericScripting(options.sandboxBundleSrc)},options.docProperties||=pdfDocument=>function docProperties(_x2){return _docProperties.apply(this,arguments)}(pdfDocument),super(options)}}class PDFRenderingQueue{constructor(){this.pdfViewer=null,this.pdfThumbnailViewer=null,this.onIdle=null,this.highestPriorityPage=null,this.idleTimeout=null,this.printing=!1,this.isThumbnailViewEnabled=!1,Object.defineProperty(this,"hasViewer",{value:()=>!!this.pdfViewer})}setViewer(pdfViewer){this.pdfViewer=pdfViewer}setThumbnailViewer(pdfThumbnailViewer){this.pdfThumbnailViewer=pdfThumbnailViewer}isHighestPriority(view){return this.highestPriorityPage===view.renderingId}renderHighestPriority(currentlyVisiblePages){this.idleTimeout&&(clearTimeout(this.idleTimeout),this.idleTimeout=null),this.pdfViewer.forceRendering(currentlyVisiblePages)||this.isThumbnailViewEnabled&&this.pdfThumbnailViewer?.forceRendering()||this.printing||this.onIdle&&(this.idleTimeout=setTimeout(this.onIdle.bind(this),3e4))}getHighestPriority(visible,views,scrolledDown,preRenderExtra=!1){const visibleViews=visible.views,numVisible=visibleViews.length;if(0===numVisible)return null;for(let i=0;i<numVisible;i++){const view=visibleViews[i].view;if(!this.isViewFinished(view))return view}const firstId=visible.first.id,lastId=visible.last.id;if(lastId-firstId+1>numVisible){const visibleIds=visible.ids;for(let i=1,ii=lastId-firstId;i<ii;i++){const holeId=scrolledDown?firstId+i:lastId-i;if(visibleIds.has(holeId))continue;const holeView=views[holeId-1];if(!this.isViewFinished(holeView))return holeView}}let preRenderIndex=scrolledDown?lastId:firstId-2,preRenderView=views[preRenderIndex];return preRenderView&&!this.isViewFinished(preRenderView)||preRenderExtra&&(preRenderIndex+=scrolledDown?1:-1,preRenderView=views[preRenderIndex],preRenderView&&!this.isViewFinished(preRenderView))?preRenderView:null}isViewFinished(view){return view.renderingState===RenderingStates.FINISHED}renderView(view){switch(view.renderingState){case RenderingStates.FINISHED:return!1;case RenderingStates.PAUSED:this.highestPriorityPage=view.renderingId,view.resume();break;case RenderingStates.RUNNING:this.highestPriorityPage=view.renderingId;break;case RenderingStates.INITIAL:this.highestPriorityPage=view.renderingId,view.draw().finally((()=>{this.renderHighestPriority()})).catch((reason=>{reason instanceof pdf_viewer_RenderingCancelledException||console.error(`renderView: "${reason}"`)}))}return!0}}const PagesCountLimit_FORCE_SCROLL_MODE_PAGE=1e4,PagesCountLimit_FORCE_LAZY_PAGE_INIT=5e3,PagesCountLimit_PAUSE_EAGER_PAGE_INIT=250;function isValidAnnotationEditorMode(mode){return Object.values(pdf_viewer_AnnotationEditorType).includes(mode)&&mode!==pdf_viewer_AnnotationEditorType.DISABLE}class PDFPageViewBuffer{#buf=new Set;#size=0;constructor(size){this.#size=size}push(view){const buf=this.#buf;buf.has(view)&&buf.delete(view),buf.add(view),buf.size>this.#size&&this.#destroyFirstView()}resize(newSize,idsToKeep=null){this.#size=newSize;const buf=this.#buf;if(idsToKeep){const ii=buf.size;let i=1;for(const view of buf)if(idsToKeep.has(view.id)&&(buf.delete(view),buf.add(view)),++i>ii)break}for(;buf.size>this.#size;)this.#destroyFirstView()}has(view){return this.#buf.has(view)}[Symbol.iterator](){return this.#buf.keys()}#destroyFirstView(){const firstView=this.#buf.keys().next().value;firstView?.destroy(),this.#buf.delete(firstView)}}class PDFViewer{#buffer=null;#altTextManager=null;#annotationEditorHighlightColors=null;#annotationEditorMode=pdf_viewer_AnnotationEditorType.NONE;#annotationEditorUIManager=null;#annotationMode=pdf_viewer_AnnotationMode.ENABLE_FORMS;#containerTopLeft=null;#enableHWA=!1;#enableHighlightFloatingButton=!1;#enablePermissions=!1;#enableUpdatedAddImage=!1;#enableNewAltTextWhenAddingImage=!1;#eventAbortController=null;#mlManager=null;#switchAnnotationEditorModeAC=null;#switchAnnotationEditorModeTimeoutId=null;#getAllTextInProgress=!1;#hiddenCopyElement=null;#interruptCopyCondition=!1;#previousContainerHeight=0;#resizeObserver=new ResizeObserver(this.#resizeObserverCallback.bind(this));#scrollModePageState=null;#scaleTimeoutId=null;#textLayerMode=TextLayerMode_ENABLE;constructor(options){if("4.8.69"!==pdf_viewer_version)throw new Error(`The API version "${pdf_viewer_version}" does not match the Viewer version "4.8.69".`);if(this.container=options.container,this.viewer=options.viewer||options.container.firstElementChild,"DIV"!==this.container?.tagName||"DIV"!==this.viewer?.tagName)throw new Error("Invalid `container` and/or `viewer` option.");if(this.container.offsetParent&&"absolute"!==getComputedStyle(this.container).position)throw new Error("The `container` must be absolutely positioned.");this.#resizeObserver.observe(this.container),this.eventBus=options.eventBus,this.linkService=options.linkService||new SimpleLinkService,this.downloadManager=options.downloadManager||null,this.findController=options.findController||null,this.#altTextManager=options.altTextManager||null,this.findController&&(this.findController.onIsPageVisible=pageNumber=>this._getVisiblePages().ids.has(pageNumber)),this._scriptingManager=options.scriptingManager||null,this.#textLayerMode=options.textLayerMode??TextLayerMode_ENABLE,this.#annotationMode=options.annotationMode??pdf_viewer_AnnotationMode.ENABLE_FORMS,this.#annotationEditorMode=options.annotationEditorMode??pdf_viewer_AnnotationEditorType.NONE,this.#annotationEditorHighlightColors=options.annotationEditorHighlightColors||null,this.#enableHighlightFloatingButton=!0===options.enableHighlightFloatingButton,this.#enableUpdatedAddImage=!0===options.enableUpdatedAddImage,this.#enableNewAltTextWhenAddingImage=!0===options.enableNewAltTextWhenAddingImage,this.imageResourcesPath=options.imageResourcesPath||"",this.enablePrintAutoRotate=options.enablePrintAutoRotate||!1,this.removePageBorders=options.removePageBorders||!1,this.maxCanvasPixels=options.maxCanvasPixels,this.l10n=options.l10n,this.l10n||=new genericl10n_GenericL10n,this.#enablePermissions=options.enablePermissions||!1,this.pageColors=options.pageColors||null,this.#mlManager=options.mlManager||null,this.#enableHWA=options.enableHWA||!1,this.defaultRenderingQueue=!options.renderingQueue,this.defaultRenderingQueue?(this.renderingQueue=new PDFRenderingQueue,this.renderingQueue.setViewer(this)):this.renderingQueue=options.renderingQueue;const{abortSignal}=options;abortSignal?.addEventListener("abort",(()=>{this.#resizeObserver.disconnect(),this.#resizeObserver=null}),{once:!0}),this.scroll=function watchScroll(viewAreaElement,callback,abortSignal){const debounceScroll=function(evt){rAF||(rAF=window.requestAnimationFrame((function viewAreaElementScrolled(){rAF=null;const currentX=viewAreaElement.scrollLeft,lastX=state.lastX;currentX!==lastX&&(state.right=currentX>lastX),state.lastX=currentX;const currentY=viewAreaElement.scrollTop,lastY=state.lastY;currentY!==lastY&&(state.down=currentY>lastY),state.lastY=currentY,callback(state)})))},state={right:!0,down:!0,lastX:viewAreaElement.scrollLeft,lastY:viewAreaElement.scrollTop,_eventHandler:debounceScroll};let rAF=null;return viewAreaElement.addEventListener("scroll",debounceScroll,{useCapture:!0,signal:abortSignal}),abortSignal?.addEventListener("abort",(()=>window.cancelAnimationFrame(rAF)),{once:!0}),state}(this.container,this._scrollUpdate.bind(this),abortSignal),this.presentationModeState=PresentationModeState_UNKNOWN,this._resetView(),this.removePageBorders&&this.viewer.classList.add("removePageBorders"),this.#updateContainerHeightCss(),this.eventBus._on("thumbnailrendered",(({pageNumber,pdfPage})=>{const pageView=this._pages[pageNumber-1];this.#buffer.has(pageView)||pdfPage?.cleanup()})),options.l10n||this.l10n.translate(this.container)}get pagesCount(){return this._pages.length}getPageView(index){return this._pages[index]}getCachedPageViews(){return new Set(this.#buffer)}get pageViewsReady(){return this._pages.every((pageView=>pageView?.pdfPage))}get renderForms(){return this.#annotationMode===pdf_viewer_AnnotationMode.ENABLE_FORMS}get enableScripting(){return!!this._scriptingManager}get currentPageNumber(){return this._currentPageNumber}set currentPageNumber(val){if(!Number.isInteger(val))throw new Error("Invalid page number.");this.pdfDocument&&(this._setCurrentPageNumber(val,!0)||console.error(`currentPageNumber: "${val}" is not a valid page.`))}_setCurrentPageNumber(val,resetCurrentPageView=!1){if(this._currentPageNumber===val)return resetCurrentPageView&&this.#resetCurrentPageView(),!0;if(!(0<val&&val<=this.pagesCount))return!1;const previous=this._currentPageNumber;return this._currentPageNumber=val,this.eventBus.dispatch("pagechanging",{source:this,pageNumber:val,pageLabel:this._pageLabels?.[val-1]??null,previous}),resetCurrentPageView&&this.#resetCurrentPageView(),!0}get currentPageLabel(){return this._pageLabels?.[this._currentPageNumber-1]??null}set currentPageLabel(val){if(!this.pdfDocument)return;let page=0|val;if(this._pageLabels){const i=this._pageLabels.indexOf(val);i>=0&&(page=i+1)}this._setCurrentPageNumber(page,!0)||console.error(`currentPageLabel: "${val}" is not a valid page.`)}get currentScale(){return 0!==this._currentScale?this._currentScale:1}set currentScale(val){if(isNaN(val))throw new Error("Invalid numeric scale.");this.pdfDocument&&this.#setScale(val,{noScroll:!1})}get currentScaleValue(){return this._currentScaleValue}set currentScaleValue(val){this.pdfDocument&&this.#setScale(val,{noScroll:!1})}get pagesRotation(){return this._pagesRotation}set pagesRotation(rotation){if(!isValidRotation(rotation))throw new Error("Invalid pages rotation angle.");if(!this.pdfDocument)return;if((rotation%=360)<0&&(rotation+=360),this._pagesRotation===rotation)return;this._pagesRotation=rotation;const pageNumber=this._currentPageNumber;this.refresh(!0,{rotation}),this._currentScaleValue&&this.#setScale(this._currentScaleValue,{noScroll:!0}),this.eventBus.dispatch("rotationchanging",{source:this,pagesRotation:rotation,pageNumber}),this.defaultRenderingQueue&&this.update()}get firstPagePromise(){return this.pdfDocument?this._firstPageCapability.promise:null}get onePageRendered(){return this.pdfDocument?this._onePageRenderedCapability.promise:null}get pagesPromise(){return this.pdfDocument?this._pagesCapability.promise:null}get _layerProperties(){const self=this;return pdf_viewer_shadow(this,"_layerProperties",{get annotationEditorUIManager(){return self.#annotationEditorUIManager},get annotationStorage(){return self.pdfDocument?.annotationStorage},get downloadManager(){return self.downloadManager},get enableScripting(){return!!self._scriptingManager},get fieldObjectsPromise(){return self.pdfDocument?.getFieldObjects()},get findController(){return self.findController},get hasJSActionsPromise(){return self.pdfDocument?.hasJSActions()},get linkService(){return self.linkService}})}#initializePermissions(permissions){const params={annotationEditorMode:this.#annotationEditorMode,annotationMode:this.#annotationMode,textLayerMode:this.#textLayerMode};return permissions?(permissions.includes(pdf_viewer_PermissionFlag.COPY)||this.#textLayerMode!==TextLayerMode_ENABLE||(params.textLayerMode=TextLayerMode_ENABLE_PERMISSIONS),permissions.includes(pdf_viewer_PermissionFlag.MODIFY_CONTENTS)||(params.annotationEditorMode=pdf_viewer_AnnotationEditorType.DISABLE),permissions.includes(pdf_viewer_PermissionFlag.MODIFY_ANNOTATIONS)||permissions.includes(pdf_viewer_PermissionFlag.FILL_INTERACTIVE_FORMS)||this.#annotationMode!==pdf_viewer_AnnotationMode.ENABLE_FORMS||(params.annotationMode=pdf_viewer_AnnotationMode.ENABLE),params):params}#onePageRenderedOrForceFetch(signal){var _this41=this;return(0,asyncToGenerator.A)((function*(){if("hidden"===document.visibilityState||!_this41.container.offsetParent||0===_this41._getVisiblePages().views.length)return;const hiddenCapability=Promise.withResolvers(),ac=new AbortController;document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&hiddenCapability.resolve()}),{signal:"function"==typeof AbortSignal.any?AbortSignal.any([signal,ac.signal]):signal}),yield Promise.race([_this41._onePageRenderedCapability.promise,hiddenCapability.promise]),ac.abort()}))()}getAllText(){var _this42=this;return(0,asyncToGenerator.A)((function*(){const texts=[],buffer=[];for(let pageNum=1,pagesCount=_this42.pdfDocument.numPages;pageNum<=pagesCount;++pageNum){if(_this42.#interruptCopyCondition)return null;buffer.length=0;const page=yield _this42.pdfDocument.getPage(pageNum),{items}=yield page.getTextContent();for(const item of items)item.str&&buffer.push(item.str),item.hasEOL&&buffer.push("\n");texts.push(removeNullCharacters(buffer.join("")))}return texts.join("\n")}))()}#copyCallback(textLayerMode,event){const selection=document.getSelection(),{focusNode,anchorNode}=selection;if(anchorNode&&focusNode&&selection.containsNode(this.#hiddenCopyElement)){if(this.#getAllTextInProgress||textLayerMode===TextLayerMode_ENABLE_PERMISSIONS)return event.preventDefault(),void event.stopPropagation();this.#getAllTextInProgress=!0;const{classList}=this.viewer;classList.add("copyAll");const ac=new AbortController;window.addEventListener("keydown",(ev=>this.#interruptCopyCondition="Escape"===ev.key),{signal:ac.signal}),this.getAllText().then(function(){var _ref4=(0,asyncToGenerator.A)((function*(text){null!==text&&(yield navigator.clipboard.writeText(text))}));return function(_x3){return _ref4.apply(this,arguments)}}()).catch((reason=>{console.warn(`Something goes wrong when extracting the text: ${reason.message}`)})).finally((()=>{this.#getAllTextInProgress=!1,this.#interruptCopyCondition=!1,ac.abort(),classList.remove("copyAll")})),event.preventDefault(),event.stopPropagation()}}setDocument(pdfDocument){var _this43=this;if(this.pdfDocument&&(this.eventBus.dispatch("pagesdestroy",{source:this}),this._cancelRendering(),this._resetView(),this.findController?.setDocument(null),this._scriptingManager?.setDocument(null),this.#annotationEditorUIManager?.destroy(),this.#annotationEditorUIManager=null),this.pdfDocument=pdfDocument,!pdfDocument)return;const pagesCount=pdfDocument.numPages,firstPagePromise=pdfDocument.getPage(1),optionalContentConfigPromise=pdfDocument.getOptionalContentConfig({intent:"display"}),permissionsPromise=this.#enablePermissions?pdfDocument.getPermissions():Promise.resolve(),{eventBus,pageColors,viewer}=this;this.#eventAbortController=new AbortController;const{signal}=this.#eventAbortController;if(pagesCount>PagesCountLimit_FORCE_SCROLL_MODE_PAGE){console.warn("Forcing PAGE-scrolling for performance reasons, given the length of the document.");const mode=this._scrollMode=ScrollMode.PAGE;eventBus.dispatch("scrollmodechanged",{source:this,mode})}this._pagesCapability.promise.then((()=>{eventBus.dispatch("pagesloaded",{source:this,pagesCount})}),(()=>{}));eventBus._on("pagerender",(evt=>{const pageView=this._pages[evt.pageNumber-1];pageView&&this.#buffer.push(pageView)}),{signal});const onAfterDraw=evt=>{evt.cssTransform||(this._onePageRenderedCapability.resolve({timestamp:evt.timestamp}),eventBus._off("pagerendered",onAfterDraw))};eventBus._on("pagerendered",onAfterDraw,{signal}),Promise.all([firstPagePromise,permissionsPromise]).then((([firstPdfPage,permissions])=>{if(pdfDocument!==this.pdfDocument)return;this._firstPageCapability.resolve(firstPdfPage),this._optionalContentConfigPromise=optionalContentConfigPromise;const{annotationEditorMode,annotationMode,textLayerMode}=this.#initializePermissions(permissions);if(textLayerMode!==TextLayerMode_DISABLE){const element=this.#hiddenCopyElement=document.createElement("div");element.id="hiddenCopyElement",viewer.before(element)}if("function"==typeof AbortSignal.any&&annotationEditorMode!==pdf_viewer_AnnotationEditorType.DISABLE){const mode=annotationEditorMode;pdfDocument.isPureXfa?console.warn("Warning: XFA-editing is not implemented."):isValidAnnotationEditorMode(mode)?(this.#annotationEditorUIManager=new pdf_viewer_AnnotationEditorUIManager(this.container,viewer,this.#altTextManager,eventBus,pdfDocument,pageColors,this.#annotationEditorHighlightColors,this.#enableHighlightFloatingButton,this.#enableUpdatedAddImage,this.#enableNewAltTextWhenAddingImage,this.#mlManager),eventBus.dispatch("annotationeditoruimanager",{source:this,uiManager:this.#annotationEditorUIManager}),mode!==pdf_viewer_AnnotationEditorType.NONE&&(mode===pdf_viewer_AnnotationEditorType.STAMP&&this.#mlManager?.loadModel("altText"),this.#annotationEditorUIManager.updateMode(mode))):console.error(`Invalid AnnotationEditor mode: ${mode}`)}const viewerElement=this._scrollMode===ScrollMode.PAGE?null:viewer,scale=this.currentScale,viewport=firstPdfPage.getViewport({scale:scale*pdf_viewer_PixelsPerInch.PDF_TO_CSS_UNITS});viewer.style.setProperty("--scale-factor",viewport.scale),pageColors?.background&&viewer.style.setProperty("--page-bg-color",pageColors.background),"CanvasText"!==pageColors?.foreground&&"Canvas"!==pageColors?.background||(viewer.style.setProperty("--hcm-highlight-filter",pdfDocument.filterFactory.addHighlightHCMFilter("highlight","CanvasText","Canvas","HighlightText","Highlight")),viewer.style.setProperty("--hcm-highlight-selected-filter",pdfDocument.filterFactory.addHighlightHCMFilter("highlight_selected","CanvasText","Canvas","HighlightText","ButtonText")));for(let pageNum=1;pageNum<=pagesCount;++pageNum){const pageView=new PDFPageView({container:viewerElement,eventBus,id:pageNum,scale,defaultViewport:viewport.clone(),optionalContentConfigPromise,renderingQueue:this.renderingQueue,textLayerMode,annotationMode,imageResourcesPath:this.imageResourcesPath,maxCanvasPixels:this.maxCanvasPixels,pageColors,l10n:this.l10n,layerProperties:this._layerProperties,enableHWA:this.#enableHWA});this._pages.push(pageView)}this._pages[0]?.setPdfPage(firstPdfPage),this._scrollMode===ScrollMode.PAGE?this.#ensurePageViewVisible():this._spreadMode!==SpreadMode.NONE&&this._updateSpreadMode(),this.#onePageRenderedOrForceFetch(signal).then((0,asyncToGenerator.A)((function*(){if(pdfDocument!==_this43.pdfDocument)return;if(_this43.findController?.setDocument(pdfDocument),_this43._scriptingManager?.setDocument(pdfDocument),_this43.#hiddenCopyElement&&document.addEventListener("copy",_this43.#copyCallback.bind(_this43,textLayerMode),{signal}),_this43.#annotationEditorUIManager&&eventBus.dispatch("annotationeditormodechanged",{source:_this43,mode:_this43.#annotationEditorMode}),pdfDocument.loadingParams.disableAutoFetch||pagesCount>PagesCountLimit_FORCE_LAZY_PAGE_INIT)return void _this43._pagesCapability.resolve();let getPagesLeft=pagesCount-1;if(getPagesLeft<=0)_this43._pagesCapability.resolve();else for(let pageNum=2;pageNum<=pagesCount;++pageNum){const promise=pdfDocument.getPage(pageNum).then((pdfPage=>{const pageView=_this43._pages[pageNum-1];pageView.pdfPage||pageView.setPdfPage(pdfPage),0==--getPagesLeft&&_this43._pagesCapability.resolve()}),(reason=>{console.error(`Unable to get page ${pageNum} to initialize viewer`,reason),0==--getPagesLeft&&_this43._pagesCapability.resolve()}));pageNum%PagesCountLimit_PAUSE_EAGER_PAGE_INIT==0&&(yield promise)}}))),eventBus.dispatch("pagesinit",{source:this}),pdfDocument.getMetadata().then((({info})=>{pdfDocument===this.pdfDocument&&info.Language&&(viewer.lang=info.Language)})),this.defaultRenderingQueue&&this.update()})).catch((reason=>{console.error("Unable to initialize viewer",reason),this._pagesCapability.reject(reason)}))}setPageLabels(labels){if(this.pdfDocument){labels?Array.isArray(labels)&&this.pdfDocument.numPages===labels.length?this._pageLabels=labels:(this._pageLabels=null,console.error("setPageLabels: Invalid page labels.")):this._pageLabels=null;for(let i=0,ii=this._pages.length;i<ii;i++)this._pages[i].setPageLabel(this._pageLabels?.[i]??null)}}_resetView(){this._pages=[],this._currentPageNumber=1,this._currentScale=0,this._currentScaleValue=null,this._pageLabels=null,this.#buffer=new PDFPageViewBuffer(10),this._location=null,this._pagesRotation=0,this._optionalContentConfigPromise=null,this._firstPageCapability=Promise.withResolvers(),this._onePageRenderedCapability=Promise.withResolvers(),this._pagesCapability=Promise.withResolvers(),this._scrollMode=ScrollMode.VERTICAL,this._previousScrollMode=ScrollMode.UNKNOWN,this._spreadMode=SpreadMode.NONE,this.#scrollModePageState={previousPageNumber:1,scrollDown:!0,pages:[]},this.#eventAbortController?.abort(),this.#eventAbortController=null,this.viewer.textContent="",this._updateScrollMode(),this.viewer.removeAttribute("lang"),this.#hiddenCopyElement?.remove(),this.#hiddenCopyElement=null,this.#cleanupSwitchAnnotationEditorMode()}#ensurePageViewVisible(){if(this._scrollMode!==ScrollMode.PAGE)throw new Error("#ensurePageViewVisible: Invalid scrollMode value.");const pageNumber=this._currentPageNumber,state=this.#scrollModePageState,viewer=this.viewer;if(viewer.textContent="",state.pages.length=0,this._spreadMode!==SpreadMode.NONE||this.isInPresentationMode){const pageIndexSet=new Set,parity=this._spreadMode-1;-1===parity?pageIndexSet.add(pageNumber-1):pageNumber%2!==parity?(pageIndexSet.add(pageNumber-1),pageIndexSet.add(pageNumber)):(pageIndexSet.add(pageNumber-2),pageIndexSet.add(pageNumber-1));const spread=document.createElement("div");if(spread.className="spread",this.isInPresentationMode){const dummyPage=document.createElement("div");dummyPage.className="dummyPage",spread.append(dummyPage)}for(const i of pageIndexSet){const pageView=this._pages[i];pageView&&(spread.append(pageView.div),state.pages.push(pageView))}viewer.append(spread)}else{const pageView=this._pages[pageNumber-1];viewer.append(pageView.div),state.pages.push(pageView)}state.scrollDown=pageNumber>=state.previousPageNumber,state.previousPageNumber=pageNumber}_scrollUpdate(){0!==this.pagesCount&&this.update()}#scrollIntoView(pageView,pageSpot=null){const{div,id}=pageView;if(this._currentPageNumber!==id&&this._setCurrentPageNumber(id),this._scrollMode===ScrollMode.PAGE&&(this.#ensurePageViewVisible(),this.update()),!pageSpot&&!this.isInPresentationMode){const left=div.offsetLeft+div.clientLeft,right=left+div.clientWidth,{scrollLeft,clientWidth}=this.container;(this._scrollMode===ScrollMode.HORIZONTAL||left<scrollLeft||right>scrollLeft+clientWidth)&&(pageSpot={left:0,top:0})}scrollIntoView(div,pageSpot),!this._currentScaleValue&&this._location&&(this._location=null)}#isSameScale(newScale){return newScale===this._currentScale||Math.abs(newScale-this._currentScale)<1e-15}#setScaleUpdatePages(newScale,newValue,{noScroll=!1,preset=!1,drawingDelay=-1,origin=null}){if(this._currentScaleValue=newValue.toString(),this.#isSameScale(newScale))return void(preset&&this.eventBus.dispatch("scalechanging",{source:this,scale:newScale,presetValue:newValue}));this.viewer.style.setProperty("--scale-factor",newScale*pdf_viewer_PixelsPerInch.PDF_TO_CSS_UNITS);const postponeDrawing=drawingDelay>=0&&drawingDelay<1e3;this.refresh(!0,{scale:newScale,drawingDelay:postponeDrawing?drawingDelay:-1}),postponeDrawing&&(this.#scaleTimeoutId=setTimeout((()=>{this.#scaleTimeoutId=null,this.refresh()}),drawingDelay));const previousScale=this._currentScale;if(this._currentScale=newScale,!noScroll){let dest,page=this._currentPageNumber;if(!this._location||this.isInPresentationMode||this.isChangingPresentationMode||(page=this._location.pageNumber,dest=[null,{name:"XYZ"},this._location.left,this._location.top,null]),this.scrollPageIntoView({pageNumber:page,destArray:dest,allowNegativeOffset:!0}),Array.isArray(origin)){const scaleDiff=newScale/previousScale-1,[top,left]=this.containerTopLeft;this.container.scrollLeft+=(origin[0]-left)*scaleDiff,this.container.scrollTop+=(origin[1]-top)*scaleDiff}}this.eventBus.dispatch("scalechanging",{source:this,scale:newScale,presetValue:preset?newValue:void 0}),this.defaultRenderingQueue&&this.update()}get#pageWidthScaleFactor(){return this._spreadMode!==SpreadMode.NONE&&this._scrollMode!==ScrollMode.HORIZONTAL?2:1}#setScale(value,options){let scale=parseFloat(value);if(scale>0)options.preset=!1,this.#setScaleUpdatePages(scale,value,options);else{const currentPage=this._pages[this._currentPageNumber-1];if(!currentPage)return;let hPadding=40,vPadding=5;this.isInPresentationMode?(hPadding=vPadding=4,this._spreadMode!==SpreadMode.NONE&&(hPadding*=2)):this.removePageBorders?hPadding=vPadding=0:this._scrollMode===ScrollMode.HORIZONTAL&&([hPadding,vPadding]=[vPadding,hPadding]);const pageWidthScale=(this.container.clientWidth-hPadding)/currentPage.width*currentPage.scale/this.#pageWidthScaleFactor,pageHeightScale=(this.container.clientHeight-vPadding)/currentPage.height*currentPage.scale;switch(value){case"page-actual":scale=1;break;case"page-width":scale=pageWidthScale;break;case"page-height":scale=pageHeightScale;break;case"page-fit":scale=Math.min(pageWidthScale,pageHeightScale);break;case"auto":const horizontalScale=isPortraitOrientation(currentPage)?pageWidthScale:Math.min(pageHeightScale,pageWidthScale);scale=Math.min(1.25,horizontalScale);break;default:return void console.error(`#setScale: "${value}" is an unknown zoom value.`)}options.preset=!0,this.#setScaleUpdatePages(scale,value,options)}}#resetCurrentPageView(){const pageView=this._pages[this._currentPageNumber-1];this.isInPresentationMode&&this.#setScale(this._currentScaleValue,{noScroll:!0}),this.#scrollIntoView(pageView)}pageLabelToPageNumber(label){if(!this._pageLabels)return null;const i=this._pageLabels.indexOf(label);return i<0?null:i+1}scrollPageIntoView({pageNumber,destArray=null,allowNegativeOffset=!1,ignoreDestinationZoom=!1}){if(!this.pdfDocument)return;const pageView=Number.isInteger(pageNumber)&&this._pages[pageNumber-1];if(!pageView)return void console.error(`scrollPageIntoView: "${pageNumber}" is not a valid pageNumber parameter.`);if(this.isInPresentationMode||!destArray)return void this._setCurrentPageNumber(pageNumber,!0);let widthScale,heightScale,x=0,y=0,width=0,height=0;const changeOrientation=pageView.rotation%180!=0,pageWidth=(changeOrientation?pageView.height:pageView.width)/pageView.scale/pdf_viewer_PixelsPerInch.PDF_TO_CSS_UNITS,pageHeight=(changeOrientation?pageView.width:pageView.height)/pageView.scale/pdf_viewer_PixelsPerInch.PDF_TO_CSS_UNITS;let scale=0;switch(destArray[1].name){case"XYZ":x=destArray[2],y=destArray[3],scale=destArray[4],x=null!==x?x:0,y=null!==y?y:pageHeight;break;case"Fit":case"FitB":scale="page-fit";break;case"FitH":case"FitBH":y=destArray[2],scale="page-width",null===y&&this._location?(x=this._location.left,y=this._location.top):("number"!=typeof y||y<0)&&(y=pageHeight);break;case"FitV":case"FitBV":x=destArray[2],width=pageWidth,height=pageHeight,scale="page-height";break;case"FitR":x=destArray[2],y=destArray[3],width=destArray[4]-x,height=destArray[5]-y;let hPadding=40,vPadding=5;this.removePageBorders&&(hPadding=vPadding=0),widthScale=(this.container.clientWidth-hPadding)/width/pdf_viewer_PixelsPerInch.PDF_TO_CSS_UNITS,heightScale=(this.container.clientHeight-vPadding)/height/pdf_viewer_PixelsPerInch.PDF_TO_CSS_UNITS,scale=Math.min(Math.abs(widthScale),Math.abs(heightScale));break;default:return void console.error(`scrollPageIntoView: "${destArray[1].name}" is not a valid destination type.`)}if(ignoreDestinationZoom||(scale&&scale!==this._currentScale?this.currentScaleValue=scale:0===this._currentScale&&(this.currentScaleValue="auto")),"page-fit"===scale&&!destArray[4])return void this.#scrollIntoView(pageView);const boundingRect=[pageView.viewport.convertToViewportPoint(x,y),pageView.viewport.convertToViewportPoint(x+width,y+height)];let left=Math.min(boundingRect[0][0],boundingRect[1][0]),top=Math.min(boundingRect[0][1],boundingRect[1][1]);allowNegativeOffset||(left=Math.max(left,0),top=Math.max(top,0)),this.#scrollIntoView(pageView,{left,top})}_updateLocation(firstPage){const currentScale=this._currentScale,currentScaleValue=this._currentScaleValue,normalizedScaleValue=parseFloat(currentScaleValue)===currentScale?Math.round(1e4*currentScale)/100:currentScaleValue,pageNumber=firstPage.id,currentPageView=this._pages[pageNumber-1],container=this.container,topLeft=currentPageView.getPagePoint(container.scrollLeft-firstPage.x,container.scrollTop-firstPage.y),intLeft=Math.round(topLeft[0]),intTop=Math.round(topLeft[1]);let pdfOpenParams=`#page=${pageNumber}`;this.isInPresentationMode||(pdfOpenParams+=`&zoom=${normalizedScaleValue},${intLeft},${intTop}`),this._location={pageNumber,scale:normalizedScaleValue,top:intTop,left:intLeft,rotation:this._pagesRotation,pdfOpenParams}}update(){const visible=this._getVisiblePages(),visiblePages=visible.views,numVisiblePages=visiblePages.length;if(0===numVisiblePages)return;const newCacheSize=Math.max(10,2*numVisiblePages+1);this.#buffer.resize(newCacheSize,visible.ids),this.renderingQueue.renderHighestPriority(visible);const isSimpleLayout=this._spreadMode===SpreadMode.NONE&&(this._scrollMode===ScrollMode.PAGE||this._scrollMode===ScrollMode.VERTICAL),currentId=this._currentPageNumber;let stillFullyVisible=!1;for(const page of visiblePages){if(page.percent<100)break;if(page.id===currentId&&isSimpleLayout){stillFullyVisible=!0;break}}this._setCurrentPageNumber(stillFullyVisible?currentId:visiblePages[0].id),this._updateLocation(visible.first),this.eventBus.dispatch("updateviewarea",{source:this,location:this._location})}#switchToEditAnnotationMode(){const visible=this._getVisiblePages(),pagesToRefresh=[],{ids,views}=visible;for(const page of views){const{view}=page;view.hasEditableAnnotations()?pagesToRefresh.push(page):ids.delete(view.id)}return 0===pagesToRefresh.length?null:(this.renderingQueue.renderHighestPriority({first:pagesToRefresh[0],last:pagesToRefresh.at(-1),views:pagesToRefresh,ids}),ids)}containsElement(element){return this.container.contains(element)}focus(){this.container.focus()}get _isContainerRtl(){return"rtl"===getComputedStyle(this.container).direction}get isInPresentationMode(){return this.presentationModeState===PresentationModeState_FULLSCREEN}get isChangingPresentationMode(){return this.presentationModeState===PresentationModeState_CHANGING}get isHorizontalScrollbarEnabled(){return!this.isInPresentationMode&&this.container.scrollWidth>this.container.clientWidth}get isVerticalScrollbarEnabled(){return!this.isInPresentationMode&&this.container.scrollHeight>this.container.clientHeight}_getVisiblePages(){const views=this._scrollMode===ScrollMode.PAGE?this.#scrollModePageState.pages:this._pages,horizontal=this._scrollMode===ScrollMode.HORIZONTAL,rtl=horizontal&&this._isContainerRtl;return function getVisibleElements({scrollEl,views,sortByVisibility=!1,horizontal=!1,rtl=!1}){const top=scrollEl.scrollTop,bottom=top+scrollEl.clientHeight,left=scrollEl.scrollLeft,right=left+scrollEl.clientWidth,visible=[],ids=new Set,numViews=views.length;let firstVisibleElementInd=binarySearchFirstItem(views,horizontal?function isElementNextAfterViewHorizontally(view){const element=view.div,elementLeft=element.offsetLeft+element.clientLeft,elementRight=elementLeft+element.clientWidth;return rtl?elementLeft<right:elementRight>left}:function isElementBottomAfterViewTop(view){const element=view.div;return element.offsetTop+element.clientTop+element.clientHeight>top});firstVisibleElementInd>0&&firstVisibleElementInd<numViews&&!horizontal&&(firstVisibleElementInd=function backtrackBeforeAllVisibleElements(index,views,top){if(index<2)return index;let elt=views[index].div,pageTop=elt.offsetTop+elt.clientTop;pageTop>=top&&(elt=views[index-1].div,pageTop=elt.offsetTop+elt.clientTop);for(let i=index-2;i>=0&&(elt=views[i].div,!(elt.offsetTop+elt.clientTop+elt.clientHeight<=pageTop));--i)index=i;return index}(firstVisibleElementInd,views,top));let lastEdge=horizontal?right:-1;for(let i=firstVisibleElementInd;i<numViews;i++){const view=views[i],element=view.div,currentWidth=element.offsetLeft+element.clientLeft,currentHeight=element.offsetTop+element.clientTop,viewWidth=element.clientWidth,viewHeight=element.clientHeight,viewRight=currentWidth+viewWidth,viewBottom=currentHeight+viewHeight;if(-1===lastEdge)viewBottom>=bottom&&(lastEdge=viewBottom);else if((horizontal?currentWidth:currentHeight)>lastEdge)break;if(viewBottom<=top||currentHeight>=bottom||viewRight<=left||currentWidth>=right)continue;const hiddenHeight=Math.max(0,top-currentHeight)+Math.max(0,viewBottom-bottom),fractionWidth=(viewWidth-(Math.max(0,left-currentWidth)+Math.max(0,viewRight-right)))/viewWidth,percent=(viewHeight-hiddenHeight)/viewHeight*fractionWidth*100|0;visible.push({id:view.id,x:currentWidth,y:currentHeight,view,percent,widthPercent:100*fractionWidth|0}),ids.add(view.id)}const first=visible[0],last=visible.at(-1);return sortByVisibility&&visible.sort((function(a,b){const pc=a.percent-b.percent;return Math.abs(pc)>.001?-pc:a.id-b.id})),{first,last,views:visible,ids}}({scrollEl:this.container,views,sortByVisibility:!0,horizontal,rtl})}cleanup(){for(const pageView of this._pages)pageView.renderingState!==RenderingStates.FINISHED&&pageView.reset()}_cancelRendering(){for(const pageView of this._pages)pageView.cancelRendering()}#ensurePdfPageLoaded(pageView){var _this44=this;return(0,asyncToGenerator.A)((function*(){if(pageView.pdfPage)return pageView.pdfPage;try{const pdfPage=yield _this44.pdfDocument.getPage(pageView.id);return pageView.pdfPage||pageView.setPdfPage(pdfPage),pdfPage}catch(reason){return console.error("Unable to get page for page view",reason),null}}))()}#getScrollAhead(visible){if(1===visible.first?.id)return!0;if(visible.last?.id===this.pagesCount)return!1;switch(this._scrollMode){case ScrollMode.PAGE:return this.#scrollModePageState.scrollDown;case ScrollMode.HORIZONTAL:return this.scroll.right}return this.scroll.down}forceRendering(currentlyVisiblePages){const visiblePages=currentlyVisiblePages||this._getVisiblePages(),scrollAhead=this.#getScrollAhead(visiblePages),preRenderExtra=this._spreadMode!==SpreadMode.NONE&&this._scrollMode!==ScrollMode.HORIZONTAL,pageView=this.renderingQueue.getHighestPriority(visiblePages,this._pages,scrollAhead,preRenderExtra);return!!pageView&&(this.#ensurePdfPageLoaded(pageView).then((()=>{this.renderingQueue.renderView(pageView)})),!0)}get hasEqualPageSizes(){const firstPageView=this._pages[0];for(let i=1,ii=this._pages.length;i<ii;++i){const pageView=this._pages[i];if(pageView.width!==firstPageView.width||pageView.height!==firstPageView.height)return!1}return!0}getPagesOverview(){let initialOrientation;return this._pages.map((pageView=>{const viewport=pageView.pdfPage.getViewport({scale:1}),orientation=isPortraitOrientation(viewport);if(void 0===initialOrientation)initialOrientation=orientation;else if(this.enablePrintAutoRotate&&orientation!==initialOrientation)return{width:viewport.height,height:viewport.width,rotation:(viewport.rotation-90)%360};return{width:viewport.width,height:viewport.height,rotation:viewport.rotation}}))}get optionalContentConfigPromise(){return this.pdfDocument?this._optionalContentConfigPromise?this._optionalContentConfigPromise:(console.error("optionalContentConfigPromise: Not initialized yet."),this.pdfDocument.getOptionalContentConfig({intent:"display"})):Promise.resolve(null)}set optionalContentConfigPromise(promise){if(!(promise instanceof Promise))throw new Error(`Invalid optionalContentConfigPromise: ${promise}`);this.pdfDocument&&this._optionalContentConfigPromise&&(this._optionalContentConfigPromise=promise,this.refresh(!1,{optionalContentConfigPromise:promise}),this.eventBus.dispatch("optionalcontentconfigchanged",{source:this,promise}))}get scrollMode(){return this._scrollMode}set scrollMode(mode){if(this._scrollMode!==mode){if(!function isValidScrollMode(mode){return Number.isInteger(mode)&&Object.values(ScrollMode).includes(mode)&&mode!==ScrollMode.UNKNOWN}(mode))throw new Error(`Invalid scroll mode: ${mode}`);this.pagesCount>PagesCountLimit_FORCE_SCROLL_MODE_PAGE||(this._previousScrollMode=this._scrollMode,this._scrollMode=mode,this.eventBus.dispatch("scrollmodechanged",{source:this,mode}),this._updateScrollMode(this._currentPageNumber))}}_updateScrollMode(pageNumber=null){const scrollMode=this._scrollMode,viewer=this.viewer;viewer.classList.toggle("scrollHorizontal",scrollMode===ScrollMode.HORIZONTAL),viewer.classList.toggle("scrollWrapped",scrollMode===ScrollMode.WRAPPED),this.pdfDocument&&pageNumber&&(scrollMode===ScrollMode.PAGE?this.#ensurePageViewVisible():this._previousScrollMode===ScrollMode.PAGE&&this._updateSpreadMode(),this._currentScaleValue&&isNaN(this._currentScaleValue)&&this.#setScale(this._currentScaleValue,{noScroll:!0}),this._setCurrentPageNumber(pageNumber,!0),this.update())}get spreadMode(){return this._spreadMode}set spreadMode(mode){if(this._spreadMode!==mode){if(!function isValidSpreadMode(mode){return Number.isInteger(mode)&&Object.values(SpreadMode).includes(mode)&&mode!==SpreadMode.UNKNOWN}(mode))throw new Error(`Invalid spread mode: ${mode}`);this._spreadMode=mode,this.eventBus.dispatch("spreadmodechanged",{source:this,mode}),this._updateSpreadMode(this._currentPageNumber)}}_updateSpreadMode(pageNumber=null){if(!this.pdfDocument)return;const viewer=this.viewer,pages=this._pages;if(this._scrollMode===ScrollMode.PAGE)this.#ensurePageViewVisible();else if(viewer.textContent="",this._spreadMode===SpreadMode.NONE)for(const pageView of this._pages)viewer.append(pageView.div);else{const parity=this._spreadMode-1;let spread=null;for(let i=0,ii=pages.length;i<ii;++i)null===spread?(spread=document.createElement("div"),spread.className="spread",viewer.append(spread)):i%2===parity&&(spread=spread.cloneNode(!1),viewer.append(spread)),spread.append(pages[i].div)}pageNumber&&(this._currentScaleValue&&isNaN(this._currentScaleValue)&&this.#setScale(this._currentScaleValue,{noScroll:!0}),this._setCurrentPageNumber(pageNumber,!0),this.update())}_getPageAdvance(currentPageNumber,previous=!1){switch(this._scrollMode){case ScrollMode.WRAPPED:{const{views}=this._getVisiblePages(),pageLayout=new Map;for(const{id,y,percent,widthPercent}of views){if(0===percent||widthPercent<100)continue;let yArray=pageLayout.get(y);yArray||pageLayout.set(y,yArray||=[]),yArray.push(id)}for(const yArray of pageLayout.values()){const currentIndex=yArray.indexOf(currentPageNumber);if(-1===currentIndex)continue;const numPages=yArray.length;if(1===numPages)break;if(previous)for(let i=currentIndex-1,ii=0;i>=ii;i--){const currentId=yArray[i],expectedId=yArray[i+1]-1;if(currentId<expectedId)return currentPageNumber-expectedId}else for(let i=currentIndex+1,ii=numPages;i<ii;i++){const currentId=yArray[i],expectedId=yArray[i-1]+1;if(currentId>expectedId)return expectedId-currentPageNumber}if(previous){const firstId=yArray[0];if(firstId<currentPageNumber)return currentPageNumber-firstId+1}else{const lastId=yArray[numPages-1];if(lastId>currentPageNumber)return lastId-currentPageNumber+1}break}break}case ScrollMode.HORIZONTAL:break;case ScrollMode.PAGE:case ScrollMode.VERTICAL:{if(this._spreadMode===SpreadMode.NONE)break;const parity=this._spreadMode-1;if(previous&&currentPageNumber%2!==parity)break;if(!previous&&currentPageNumber%2===parity)break;const{views}=this._getVisiblePages(),expectedId=previous?currentPageNumber-1:currentPageNumber+1;for(const{id,percent,widthPercent}of views)if(id===expectedId){if(percent>0&&100===widthPercent)return 2;break}break}}return 1}nextPage(){const currentPageNumber=this._currentPageNumber,pagesCount=this.pagesCount;if(currentPageNumber>=pagesCount)return!1;const advance=this._getPageAdvance(currentPageNumber,!1)||1;return this.currentPageNumber=Math.min(currentPageNumber+advance,pagesCount),!0}previousPage(){const currentPageNumber=this._currentPageNumber;if(currentPageNumber<=1)return!1;const advance=this._getPageAdvance(currentPageNumber,!0)||1;return this.currentPageNumber=Math.max(currentPageNumber-advance,1),!0}updateScale({drawingDelay,scaleFactor=null,steps=null,origin}){if(null===steps&&null===scaleFactor)throw new Error("Invalid updateScale options: either `steps` or `scaleFactor` must be provided.");if(!this.pdfDocument)return;let newScale=this._currentScale;if(scaleFactor>0&&1!==scaleFactor)newScale=Math.round(newScale*scaleFactor*100)/100;else if(steps){const delta=steps>0?1.1:1/1.1,round=steps>0?Math.ceil:Math.floor;steps=Math.abs(steps);do{newScale=round(10*(newScale*delta).toFixed(2))/10}while(--steps>0)}newScale=Math.max(.1,Math.min(10,newScale)),this.#setScale(newScale,{noScroll:!1,drawingDelay,origin})}increaseScale(options={}){this.updateScale({...options,steps:options.steps??1})}decreaseScale(options={}){this.updateScale({...options,steps:-(options.steps??1)})}#updateContainerHeightCss(height=this.container.clientHeight){height!==this.#previousContainerHeight&&(this.#previousContainerHeight=height,docStyle.setProperty("--viewer-container-height",`${height}px`))}#resizeObserverCallback(entries){for(const entry of entries)if(entry.target===this.container){this.#updateContainerHeightCss(Math.floor(entry.borderBoxSize[0].blockSize)),this.#containerTopLeft=null;break}}get containerTopLeft(){return this.#containerTopLeft||=[this.container.offsetTop,this.container.offsetLeft]}#cleanupSwitchAnnotationEditorMode(){this.#switchAnnotationEditorModeAC?.abort(),this.#switchAnnotationEditorModeAC=null,null!==this.#switchAnnotationEditorModeTimeoutId&&(clearTimeout(this.#switchAnnotationEditorModeTimeoutId),this.#switchAnnotationEditorModeTimeoutId=null)}get annotationEditorMode(){return this.#annotationEditorUIManager?this.#annotationEditorMode:pdf_viewer_AnnotationEditorType.DISABLE}set annotationEditorMode({mode,editId=null,isFromKeyboard=!1}){if(!this.#annotationEditorUIManager)throw new Error("The AnnotationEditor is not enabled.");if(this.#annotationEditorMode===mode)return;if(!isValidAnnotationEditorMode(mode))throw new Error(`Invalid AnnotationEditor mode: ${mode}`);if(!this.pdfDocument)return;mode===pdf_viewer_AnnotationEditorType.STAMP&&this.#mlManager?.loadModel("altText");const{eventBus}=this,updater=()=>{this.#cleanupSwitchAnnotationEditorMode(),this.#annotationEditorMode=mode,this.#annotationEditorUIManager.updateMode(mode,editId,isFromKeyboard),eventBus.dispatch("annotationeditormodechanged",{source:this,mode})};if(mode===pdf_viewer_AnnotationEditorType.NONE||this.#annotationEditorMode===pdf_viewer_AnnotationEditorType.NONE){const isEditing=mode!==pdf_viewer_AnnotationEditorType.NONE;isEditing||this.pdfDocument.annotationStorage.resetModifiedIds();for(const pageView of this._pages)pageView.toggleEditingMode(isEditing);const idsToRefresh=this.#switchToEditAnnotationMode();if(isEditing&&idsToRefresh){this.#cleanupSwitchAnnotationEditorMode(),this.#switchAnnotationEditorModeAC=new AbortController;const signal=AbortSignal.any([this.#eventAbortController.signal,this.#switchAnnotationEditorModeAC.signal]);return void eventBus._on("pagerendered",(({pageNumber})=>{idsToRefresh.delete(pageNumber),0===idsToRefresh.size&&(this.#switchAnnotationEditorModeTimeoutId=setTimeout(updater,0))}),{signal})}}updater()}refresh(noUpdate=!1,updateArgs=Object.create(null)){if(this.pdfDocument){for(const pageView of this._pages)pageView.update(updateArgs);null!==this.#scaleTimeoutId&&(clearTimeout(this.#scaleTimeoutId),this.#scaleTimeoutId=null),noUpdate||this.update()}}}class PDFSinglePageViewer extends PDFViewer{_resetView(){super._resetView(),this._scrollMode=ScrollMode.PAGE,this._spreadMode=SpreadMode.NONE}set scrollMode(mode){}_updateScrollMode(){}set spreadMode(mode){}_updateSpreadMode(){}}var __webpack_exports__AnnotationLayerBuilder=pdf_viewer_nested_webpack_exports_.AnnotationLayerBuilder,__webpack_exports__DownloadManager=pdf_viewer_nested_webpack_exports_.DownloadManager,__webpack_exports__EventBus=pdf_viewer_nested_webpack_exports_.EventBus,__webpack_exports__FindState=pdf_viewer_nested_webpack_exports_.FindState,__webpack_exports__GenericL10n=pdf_viewer_nested_webpack_exports_.GenericL10n,__webpack_exports__LinkTarget=pdf_viewer_nested_webpack_exports_.LinkTarget,__webpack_exports__PDFFindController=pdf_viewer_nested_webpack_exports_.PDFFindController,__webpack_exports__PDFHistory=pdf_viewer_nested_webpack_exports_.PDFHistory,__webpack_exports__PDFLinkService=pdf_viewer_nested_webpack_exports_.PDFLinkService,__webpack_exports__PDFPageView=pdf_viewer_nested_webpack_exports_.PDFPageView,__webpack_exports__PDFScriptingManager=pdf_viewer_nested_webpack_exports_.PDFScriptingManager,__webpack_exports__PDFSinglePageViewer=pdf_viewer_nested_webpack_exports_.PDFSinglePageViewer,__webpack_exports__PDFViewer=pdf_viewer_nested_webpack_exports_.PDFViewer,__webpack_exports__ProgressBar=pdf_viewer_nested_webpack_exports_.ProgressBar,__webpack_exports__RenderingStates=pdf_viewer_nested_webpack_exports_.RenderingStates,__webpack_exports__ScrollMode=pdf_viewer_nested_webpack_exports_.ScrollMode,__webpack_exports__SimpleLinkService=pdf_viewer_nested_webpack_exports_.SimpleLinkService,__webpack_exports__SpreadMode=pdf_viewer_nested_webpack_exports_.SpreadMode,__webpack_exports__StructTreeLayerBuilder=pdf_viewer_nested_webpack_exports_.StructTreeLayerBuilder,__webpack_exports__TextLayerBuilder=pdf_viewer_nested_webpack_exports_.TextLayerBuilder,__webpack_exports__XfaLayerBuilder=pdf_viewer_nested_webpack_exports_.XfaLayerBuilder,__webpack_exports__parseQueryString=pdf_viewer_nested_webpack_exports_.parseQueryString;const _c0=["pdfViewerContainer"];function createEventBus(pdfJsViewer,destroy$){const globalEventBus=new pdfJsViewer.EventBus;return function attachDOMEventsToEventBus(eventBus,destroy$){(0,fromEvent.R)(eventBus,"documentload").pipe((0,takeUntil.Q)(destroy$)).subscribe((()=>{const event=document.createEvent("CustomEvent");event.initCustomEvent("documentload",!0,!0,{}),window.dispatchEvent(event)})),(0,fromEvent.R)(eventBus,"pagerendered").pipe((0,takeUntil.Q)(destroy$)).subscribe((({pageNumber,cssTransform,source})=>{const event=document.createEvent("CustomEvent");event.initCustomEvent("pagerendered",!0,!0,{pageNumber,cssTransform}),source.div.dispatchEvent(event)})),(0,fromEvent.R)(eventBus,"textlayerrendered").pipe((0,takeUntil.Q)(destroy$)).subscribe((({pageNumber,source})=>{const event=document.createEvent("CustomEvent");event.initCustomEvent("textlayerrendered",!0,!0,{pageNumber}),source.textLayerDiv?.dispatchEvent(event)})),(0,fromEvent.R)(eventBus,"pagechanging").pipe((0,takeUntil.Q)(destroy$)).subscribe((({pageNumber,source})=>{const event=document.createEvent("UIEvents");event.initEvent("pagechanging",!0,!0),event.pageNumber=pageNumber,source.container.dispatchEvent(event)})),(0,fromEvent.R)(eventBus,"pagesinit").pipe((0,takeUntil.Q)(destroy$)).subscribe((({source})=>{const event=document.createEvent("CustomEvent");event.initCustomEvent("pagesinit",!0,!0,null),source.container.dispatchEvent(event)})),(0,fromEvent.R)(eventBus,"pagesloaded").pipe((0,takeUntil.Q)(destroy$)).subscribe((({pagesCount,source})=>{const event=document.createEvent("CustomEvent");event.initCustomEvent("pagesloaded",!0,!0,{pagesCount}),source.container.dispatchEvent(event)})),(0,fromEvent.R)(eventBus,"scalechange").pipe((0,takeUntil.Q)(destroy$)).subscribe((({scale,presetValue,source})=>{const event=document.createEvent("UIEvents");event.initEvent("scalechange",!0,!0),event.scale=scale,event.presetValue=presetValue,source.container.dispatchEvent(event)})),(0,fromEvent.R)(eventBus,"updateviewarea").pipe((0,takeUntil.Q)(destroy$)).subscribe((({location,source})=>{const event=document.createEvent("UIEvents");event.initEvent("updateviewarea",!0,!0),event.location=location,source.container.dispatchEvent(event)})),(0,fromEvent.R)(eventBus,"find").pipe((0,takeUntil.Q)(destroy$)).subscribe((({source,type,query,phraseSearch,caseSensitive,highlightAll,findPrevious})=>{if(source===window)return;const event=document.createEvent("CustomEvent");event.initCustomEvent("find"+type,!0,!0,{query,phraseSearch,caseSensitive,highlightAll,findPrevious}),window.dispatchEvent(event)})),(0,fromEvent.R)(eventBus,"attachmentsloaded").pipe((0,takeUntil.Q)(destroy$)).subscribe((({attachmentsCount,source})=>{const event=document.createEvent("CustomEvent");event.initCustomEvent("attachmentsloaded",!0,!0,{attachmentsCount}),source.container.dispatchEvent(event)})),(0,fromEvent.R)(eventBus,"sidebarviewchanged").pipe((0,takeUntil.Q)(destroy$)).subscribe((({view,source})=>{const event=document.createEvent("CustomEvent");event.initCustomEvent("sidebarviewchanged",!0,!0,{view}),source.outerContainer.dispatchEvent(event)})),(0,fromEvent.R)(eventBus,"pagemode").pipe((0,takeUntil.Q)(destroy$)).subscribe((({mode,source})=>{const event=document.createEvent("CustomEvent");event.initCustomEvent("pagemode",!0,!0,{mode}),source.pdfViewer.container.dispatchEvent(event)})),(0,fromEvent.R)(eventBus,"namedaction").pipe((0,takeUntil.Q)(destroy$)).subscribe((({action,source})=>{const event=document.createEvent("CustomEvent");event.initCustomEvent("namedaction",!0,!0,{action}),source.pdfViewer.container.dispatchEvent(event)})),(0,fromEvent.R)(eventBus,"presentationmodechanged").pipe((0,takeUntil.Q)(destroy$)).subscribe((({active,switchInProgress})=>{const event=document.createEvent("CustomEvent");event.initCustomEvent("presentationmodechanged",!0,!0,{active,switchInProgress}),window.dispatchEvent(event)})),(0,fromEvent.R)(eventBus,"outlineloaded").pipe((0,takeUntil.Q)(destroy$)).subscribe((({outlineCount,source})=>{const event=document.createEvent("CustomEvent");event.initCustomEvent("outlineloaded",!0,!0,{outlineCount}),source.container.dispatchEvent(event)}))}(globalEventBus,destroy$),globalEventBus}function ng2_pdf_viewer_assign(obj,prop,value){obj[prop]=value}function isSSR(){return"undefined"==typeof window}var RenderTextMode;isSSR()||ng2_pdf_viewer_assign(pdf_namespaceObject,"verbosity",__webpack_exports__VerbosityLevel.INFOS),void 0===Promise.withResolvers&&window&&(window.Promise.withResolvers=()=>{let resolve,reject;return{promise:new Promise(((res,rej)=>{resolve=res,reject=rej})),resolve,reject}}),function(RenderTextMode){RenderTextMode[RenderTextMode.DISABLED=0]="DISABLED",RenderTextMode[RenderTextMode.ENABLED=1]="ENABLED",RenderTextMode[RenderTextMode.ENHANCED=2]="ENHANCED"}(RenderTextMode||(RenderTextMode={}));class PdfViewerComponent{element;ngZone;static CSS_UNITS=96/72;static BORDER_WIDTH=9;pdfViewerContainer;eventBus;pdfLinkService;pdfFindController;pdfViewer;isVisible=!1;_cMapsUrl=void 0!==pdf_namespaceObject?`https://unpkg.com/pdfjs-dist@${__webpack_exports__version}/cmaps/`:null;_imageResourcesPath=void 0!==pdf_namespaceObject?`https://unpkg.com/pdfjs-dist@${__webpack_exports__version}/web/images/`:void 0;_renderText=!0;_renderTextMode=RenderTextMode.ENABLED;_stickToPage=!1;_originalSize=!0;_pdf;_page=1;_zoom=1;_zoomScale="page-width";_rotation=0;_showAll=!0;_canAutoResize=!0;_fitToPage=!1;_externalLinkTarget="blank";_showBorders=!1;lastLoaded;_latestScrolledPage;pageScrollTimeout=null;isInitialized=!1;loadingTask;destroy$=new Subject.B;afterLoadComplete=new core.EventEmitter;pageRendered=new core.EventEmitter;pageInitialized=new core.EventEmitter;textLayerRendered=new core.EventEmitter;onError=new core.EventEmitter;onProgress=new core.EventEmitter;pageChange=new core.EventEmitter(!0);src;set cMapsUrl(cMapsUrl){this._cMapsUrl=cMapsUrl}set page(_page){const originalPage=_page=parseInt(_page,10)||1;this._pdf&&(_page=this.getValidPageNumber(_page)),this._page=_page,originalPage!==_page&&this.pageChange.emit(_page)}set renderText(renderText){this._renderText=renderText}set renderTextMode(renderTextMode){this._renderTextMode=renderTextMode}set originalSize(originalSize){this._originalSize=originalSize}set showAll(value){this._showAll=value}set stickToPage(value){this._stickToPage=value}set zoom(value){value<=0||(this._zoom=value)}get zoom(){return this._zoom}set zoomScale(value){this._zoomScale=value}get zoomScale(){return this._zoomScale}set rotation(value){"number"==typeof value&&value%90==0?this._rotation=value:console.warn("Invalid pages rotation angle.")}set externalLinkTarget(value){this._externalLinkTarget=value}set autoresize(value){this._canAutoResize=Boolean(value)}set fitToPage(value){this._fitToPage=Boolean(value)}set showBorders(value){this._showBorders=Boolean(value)}static getLinkTarget(type){switch(type){case"blank":return __webpack_exports__LinkTarget.BLANK;case"none":return __webpack_exports__LinkTarget.NONE;case"self":return __webpack_exports__LinkTarget.SELF;case"parent":return __webpack_exports__LinkTarget.PARENT;case"top":return __webpack_exports__LinkTarget.TOP}return null}constructor(element,ngZone){if(this.element=element,this.ngZone=ngZone,isSSR())return;let pdfWorkerSrc;const pdfJsVersion=__webpack_exports__version,versionSpecificPdfWorkerUrl=window[`pdfWorkerSrc${pdfJsVersion}`];pdfWorkerSrc=versionSpecificPdfWorkerUrl||(window.hasOwnProperty("pdfWorkerSrc")&&"string"==typeof window.pdfWorkerSrc&&window.pdfWorkerSrc?window.pdfWorkerSrc:`https://cdn.jsdelivr.net/npm/pdfjs-dist@${pdfJsVersion}/legacy/build/pdf.worker.min.mjs`),ng2_pdf_viewer_assign(__webpack_exports__GlobalWorkerOptions,"workerSrc",pdfWorkerSrc)}ngAfterViewChecked(){if(this.isInitialized)return;const offset=this.pdfViewerContainer.nativeElement.offsetParent;!0!==this.isVisible||null!=offset?!1===this.isVisible&&null!=offset&&(this.isVisible=!0,setTimeout((()=>{this.initialize(),this.ngOnChanges({src:this.src})}))):this.isVisible=!1}ngOnInit(){this.initialize(),this.setupResizeListener()}ngOnDestroy(){this.clear(),this.destroy$.next(),this.loadingTask=null}ngOnChanges(changes){if(!isSSR()&&this.isVisible)if("src"in changes)this.loadPDF();else if(this._pdf){if(("renderText"in changes||"showAll"in changes)&&(this.setupViewer(),this.resetPdfDocument()),"page"in changes){const{page}=changes;if(page.currentValue===this._latestScrolledPage)return;this.pdfViewer.scrollPageIntoView({pageNumber:this._page})}this.update()}}updateSize(){(0,from.H)(this._pdf.getPage(this.pdfViewer.currentPageNumber)).pipe((0,takeUntil.Q)(this.destroy$)).subscribe({next:page=>{const rotation=this._rotation+page.rotate,viewportWidth=page.getViewport({scale:this._zoom,rotation}).width*PdfViewerComponent.CSS_UNITS;let scale=this._zoom,stickToPage=!0;if(!this._originalSize||this._fitToPage&&viewportWidth>this.pdfViewerContainer.nativeElement.clientWidth){const viewPort=page.getViewport({scale:1,rotation});scale=this.getScale(viewPort.width,viewPort.height),stickToPage=!this._stickToPage}this.pdfViewer.currentScale=scale,stickToPage&&this.pdfViewer.scrollPageIntoView({pageNumber:page.pageNumber,ignoreDestinationZoom:!0})}})}clear(){this.loadingTask&&!this.loadingTask.destroyed&&this.loadingTask.destroy(),this._pdf&&(this._latestScrolledPage=0,this._pdf.destroy(),this._pdf=void 0),this.pdfViewer&&this.pdfViewer.setDocument(null),this.pdfLinkService&&this.pdfLinkService.setDocument(null,null),this.pdfFindController&&this.pdfFindController.setDocument(null)}getPDFLinkServiceConfig(){const linkTarget=PdfViewerComponent.getLinkTarget(this._externalLinkTarget);return linkTarget?{externalLinkTarget:linkTarget}:{}}initEventBus(){this.eventBus=createEventBus(pdf_viewer_namespaceObject,this.destroy$),(0,fromEvent.R)(this.eventBus,"pagerendered").pipe((0,takeUntil.Q)(this.destroy$)).subscribe((event=>{this.pageRendered.emit(event)})),(0,fromEvent.R)(this.eventBus,"pagesinit").pipe((0,takeUntil.Q)(this.destroy$)).subscribe((event=>{this.pageInitialized.emit(event)})),(0,fromEvent.R)(this.eventBus,"pagechanging").pipe((0,takeUntil.Q)(this.destroy$)).subscribe((({pageNumber})=>{this.pageScrollTimeout&&clearTimeout(this.pageScrollTimeout),this.pageScrollTimeout=window.setTimeout((()=>{this._latestScrolledPage=pageNumber,this.pageChange.emit(pageNumber)}),100)})),(0,fromEvent.R)(this.eventBus,"textlayerrendered").pipe((0,takeUntil.Q)(this.destroy$)).subscribe((event=>{this.textLayerRendered.emit(event)}))}initPDFServices(){this.pdfLinkService=new __webpack_exports__PDFLinkService({eventBus:this.eventBus,...this.getPDFLinkServiceConfig()}),this.pdfFindController=new __webpack_exports__PDFFindController({eventBus:this.eventBus,linkService:this.pdfLinkService})}getPDFOptions(){return{eventBus:this.eventBus,container:this.element.nativeElement.querySelector("div"),removePageBorders:!this._showBorders,linkService:this.pdfLinkService,textLayerMode:this._renderText?this._renderTextMode:RenderTextMode.DISABLED,findController:this.pdfFindController,l10n:new __webpack_exports__GenericL10n("en"),imageResourcesPath:this._imageResourcesPath,annotationEditorMode:__webpack_exports__AnnotationEditorType.DISABLE}}setupViewer(){this.pdfViewer&&this.pdfViewer.setDocument(null),ng2_pdf_viewer_assign(pdf_namespaceObject,"disableTextLayer",!this._renderText),this.initPDFServices(),this._showAll?this.pdfViewer=new __webpack_exports__PDFViewer(this.getPDFOptions()):this.pdfViewer=new __webpack_exports__PDFSinglePageViewer(this.getPDFOptions()),this.pdfLinkService.setViewer(this.pdfViewer),this.pdfViewer._currentPageNumber=this._page}getValidPageNumber(page){return page<1?1:page>this._pdf.numPages?this._pdf.numPages:page}getDocumentParams(){const srcType=typeof this.src;if(!this._cMapsUrl)return this.src;const params={cMapUrl:this._cMapsUrl,cMapPacked:!0,enableXfa:!0,isEvalSupported:!1};return"string"===srcType?params.url=this.src:"object"===srcType&&(void 0!==this.src.byteLength?params.data=this.src:Object.assign(params,this.src)),params}loadPDF(){if(!this.src)return;if(this.lastLoaded===this.src)return void this.update();this.clear(),this.setupViewer(),this.loadingTask=__webpack_exports__getDocument(this.getDocumentParams()),this.loadingTask.onProgress=progressData=>{this.onProgress.emit(progressData)};const src=this.src;(0,from.H)(this.loadingTask.promise).pipe((0,takeUntil.Q)(this.destroy$)).subscribe({next:pdf=>{this._pdf=pdf,this.lastLoaded=src,this.afterLoadComplete.emit(pdf),this.resetPdfDocument(),this.update()},error:error=>{this.lastLoaded=null,this.onError.emit(error)}})}update(){this.page=this._page,this.render()}render(){if(this._page=this.getValidPageNumber(this._page),0===this._rotation&&this.pdfViewer.pagesRotation===this._rotation||this.pdfViewer.firstPagePromise?.then((()=>this.pdfViewer.pagesRotation=this._rotation)),this._stickToPage&&setTimeout((()=>{this.pdfViewer.currentPageNumber=this._page})),this.pdfViewer._pages?.length)this.updateSize();else{const sub=this.pageInitialized.subscribe((()=>{this.updateSize(),sub.unsubscribe()}))}}getScale(viewportWidth,viewportHeight){const borderSize=this._showBorders?2*PdfViewerComponent.BORDER_WIDTH:0,pdfContainerWidth=this.pdfViewerContainer.nativeElement.clientWidth-borderSize,pdfContainerHeight=this.pdfViewerContainer.nativeElement.clientHeight-borderSize;if(0===pdfContainerHeight||0===viewportHeight||0===pdfContainerWidth||0===viewportWidth)return 1;let ratio=1;switch(this._zoomScale){case"page-fit":ratio=Math.min(pdfContainerHeight/viewportHeight,pdfContainerWidth/viewportWidth);break;case"page-height":ratio=pdfContainerHeight/viewportHeight;break;default:ratio=pdfContainerWidth/viewportWidth}return this._zoom*ratio/PdfViewerComponent.CSS_UNITS}resetPdfDocument(){this.pdfLinkService.setDocument(this._pdf,null),this.pdfFindController.setDocument(this._pdf),this.pdfViewer.setDocument(this._pdf)}initialize(){!isSSR()&&this.isVisible&&(this.isInitialized=!0,this.initEventBus(),this.setupViewer())}setupResizeListener(){isSSR()||this.ngZone.runOutsideAngular((()=>{(0,fromEvent.R)(window,"resize").pipe((0,debounceTime.B)(100),(0,filter.p)((()=>this._canAutoResize&&!!this._pdf)),(0,takeUntil.Q)(this.destroy$)).subscribe((()=>{this.updateSize()}))}))}static ɵfac=function PdfViewerComponent_Factory(__ngFactoryType__){return new(__ngFactoryType__||PdfViewerComponent)(core["ɵɵdirectiveInject"](core.ElementRef),core["ɵɵdirectiveInject"](core.NgZone))};static ɵcmp=core["ɵɵdefineComponent"]({type:PdfViewerComponent,selectors:[["pdf-viewer"]],viewQuery:function PdfViewerComponent_Query(rf,ctx){if(1&rf&&core["ɵɵviewQuery"](_c0,5),2&rf){let _t;core["ɵɵqueryRefresh"](_t=core["ɵɵloadQuery"]())&&(ctx.pdfViewerContainer=_t.first)}},inputs:{src:"src",cMapsUrl:[0,"c-maps-url","cMapsUrl"],page:"page",renderText:[0,"render-text","renderText"],renderTextMode:[0,"render-text-mode","renderTextMode"],originalSize:[0,"original-size","originalSize"],showAll:[0,"show-all","showAll"],stickToPage:[0,"stick-to-page","stickToPage"],zoom:"zoom",zoomScale:[0,"zoom-scale","zoomScale"],rotation:"rotation",externalLinkTarget:[0,"external-link-target","externalLinkTarget"],autoresize:"autoresize",fitToPage:[0,"fit-to-page","fitToPage"],showBorders:[0,"show-borders","showBorders"]},outputs:{afterLoadComplete:"after-load-complete",pageRendered:"page-rendered",pageInitialized:"pages-initialized",textLayerRendered:"text-layer-rendered",onError:"error",onProgress:"on-progress",pageChange:"pageChange"},features:[core["ɵɵNgOnChangesFeature"]],decls:3,vars:0,consts:[["pdfViewerContainer",""],[1,"ng2-pdf-viewer-container"],[1,"pdfViewer"]],template:function PdfViewerComponent_Template(rf,ctx){1&rf&&(core["ɵɵelementStart"](0,"div",1,0),core["ɵɵelement"](2,"div",2),core["ɵɵelementEnd"]())},styles:['.ng2-pdf-viewer-container[_ngcontent-%COMP%]{overflow-x:auto;position:absolute;height:100%;width:100%;-webkit-overflow-scrolling:touch}[_nghost-%COMP%]{display:block;position:relative}[_nghost-%COMP%]    {--pdfViewer-padding-bottom: 0;--page-margin: 1px auto -8px;--page-border: 9px solid transparent;--spreadHorizontalWrapped-margin-LR: -3.5px;--viewer-container-height: 0;--annotation-unfocused-field-background: url("data:image/svg+xml;charset=UTF-8,<svg width=\'1px\' height=\'1px\' xmlns=\'http://www.w3.org/2000/svg\'><rect width=\'100%\' height=\'100%\' style=\'fill:rgba(0, 54, 255, 0.13);\'/></svg>");--xfa-unfocused-field-background: var( --annotation-unfocused-field-background );--page-border-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAA1ElEQVQ4jbWUWw6EIAxFy2NFs/8NzR4UJhpqLsdi5mOmSSMUOfYWqv3S0gMr4XlYH/64gZa/gN3ANYA7KAXALt4ktoQ5MI9YxqaG8bWmsIysMuT6piSQCa4whZThCu8CM4zP9YJaKci9jicPq3NcBWYoPMGUlhG7ivtkB+gVyFY75wXghOvh8t5mto1Mdim6e+MBqH6XsY+YAwjpq3vGF7weTWQptLEDVCZvPTMl5JZZsdh47FHW6qFMyvLYqjcnmdFfY9Xk/KDOlzCusX2mi/ofM7MPkzBcSp4Q1/wAAAAASUVORK5CYII=) 9 9 repeat;--scale-factor: 1;--focus-outline: solid 2px blue;--hover-outline: dashed 2px blue;--freetext-line-height: 1.35;--freetext-padding: 2px;--editorInk-editing-cursor: pointer}@media screen and (forced-colors: active){[_nghost-%COMP%]    {--pdfViewer-padding-bottom: 9px;--page-margin: 8px auto -1px;--page-border: 1px solid CanvasText;--page-border-image: none;--spreadHorizontalWrapped-margin-LR: 3.5px}}@media (forced-colors: active){[_nghost-%COMP%]    {--focus-outline: solid 3px ButtonText;--hover-outline: dashed 3px ButtonText}}[_nghost-%COMP%]     .textLayer{position:absolute;text-align:initial;inset:0;overflow:hidden;opacity:.2;line-height:1;-webkit-text-size-adjust:none;text-size-adjust:none;forced-color-adjust:none;transform-origin:0 0}[_nghost-%COMP%]     .textLayer span, [_nghost-%COMP%]     .textLayer br{color:transparent;position:absolute;white-space:pre;cursor:text;transform-origin:0% 0%}[_nghost-%COMP%]     .textLayer span.markedContent{top:0;height:0}[_nghost-%COMP%]     .textLayer .highlight{margin:-1px;padding:1px;background-color:#b400aa;border-radius:4px}[_nghost-%COMP%]     .textLayer .highlight.appended{position:initial}[_nghost-%COMP%]     .textLayer .highlight.begin{border-radius:4px 0 0 4px}[_nghost-%COMP%]     .textLayer .highlight.end{border-radius:0 4px 4px 0}[_nghost-%COMP%]     .textLayer .highlight.middle{border-radius:0}[_nghost-%COMP%]     .textLayer .highlight.selected{background-color:#006400}[_nghost-%COMP%]     .textLayer ::selection{background:rgb(0,0,255)}[_nghost-%COMP%]     .textLayer br::selection{background:transparent}[_nghost-%COMP%]     .textLayer .endOfContent{display:block;position:absolute;inset:100% 0 0;z-index:-1;cursor:default;-webkit-user-select:none;user-select:none}[_nghost-%COMP%]     .textLayer .endOfContent.active{top:0}@media (forced-colors: active){[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input:required, [_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea:required, [_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select:required, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:required, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input:required{outline:1.5px solid selectedItem}}[_nghost-%COMP%]     .annotationLayer{position:absolute;top:0;left:0;pointer-events:none;transform-origin:0 0}[_nghost-%COMP%]     .annotationLayer section{position:absolute;text-align:initial;pointer-events:auto;box-sizing:border-box;transform-origin:0 0}[_nghost-%COMP%]     .annotationLayer .linkAnnotation>a, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.pushButton>a{position:absolute;font-size:1em;top:0;left:0;width:100%;height:100%}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.pushButton>canvas{width:100%;height:100%}[_nghost-%COMP%]     .annotationLayer .linkAnnotation>a:hover, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.pushButton>a:hover{opacity:.2;background:rgb(255,255,0);box-shadow:0 2px 10px #ff0}[_nghost-%COMP%]     .annotationLayer .textAnnotation img{position:absolute;cursor:pointer;width:100%;height:100%}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input, [_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea, [_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input{background-image:var(--annotation-unfocused-field-background);border:1px solid transparent;box-sizing:border-box;font:calc(9px * var(--scale-factor)) sans-serif;height:100%;margin:0;vertical-align:top;width:100%}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input:required, [_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea:required, [_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select:required, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:required, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input:required{outline:1.5px solid red}[_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select option{padding:0}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input{border-radius:50%}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea{resize:none}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input[disabled], [_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea[disabled], [_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select[disabled], [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input[disabled], [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input[disabled]{background:none;border:1px solid transparent;cursor:not-allowed}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input:hover, [_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea:hover, [_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select:hover, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:hover, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input:hover{border:1px solid rgb(0,0,0)}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input:focus, [_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea:focus, [_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select:focus{background:none;border:1px solid transparent}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input :focus, [_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea :focus, [_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select :focus, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox :focus, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton :focus{background-image:none;background-color:transparent;outline:auto}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:before, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:after, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input:checked:before{background-color:CanvasText;content:"";display:block;position:absolute}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:before, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:after{height:80%;left:45%;width:1px}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:before{transform:rotate(45deg)}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:after{transform:rotate(-45deg)}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input:checked:before{border-radius:50%;height:50%;left:30%;top:20%;width:50%}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input.comb{font-family:monospace;padding-left:2px;padding-right:0}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input.comb:focus{width:103%}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input{-webkit-appearance:none;appearance:none}[_nghost-%COMP%]     .annotationLayer .popupTriggerArea{height:100%;width:100%}[_nghost-%COMP%]     .annotationLayer .popupWrapper{position:absolute;font-size:calc(9px * var(--scale-factor));width:100%;min-width:calc(180px * var(--scale-factor));pointer-events:none}[_nghost-%COMP%]     .annotationLayer .popup{position:absolute;max-width:calc(180px * var(--scale-factor));background-color:#ff9;box-shadow:0 calc(2px * var(--scale-factor)) calc(5px * var(--scale-factor)) #888;border-radius:calc(2px * var(--scale-factor));padding:calc(6px * var(--scale-factor));margin-left:calc(5px * var(--scale-factor));cursor:pointer;font:message-box;white-space:normal;word-wrap:break-word;pointer-events:auto}[_nghost-%COMP%]     .annotationLayer .popup>*{font-size:calc(9px * var(--scale-factor))}[_nghost-%COMP%]     .annotationLayer .popup h1{display:inline-block}[_nghost-%COMP%]     .annotationLayer .popupDate{display:inline-block;margin-left:calc(5px * var(--scale-factor))}[_nghost-%COMP%]     .annotationLayer .popupContent{border-top:1px solid rgb(51,51,51);margin-top:calc(2px * var(--scale-factor));padding-top:calc(2px * var(--scale-factor))}[_nghost-%COMP%]     .annotationLayer .richText>*{white-space:pre-wrap;font-size:calc(9px * var(--scale-factor))}[_nghost-%COMP%]     .annotationLayer .highlightAnnotation, [_nghost-%COMP%]     .annotationLayer .underlineAnnotation, [_nghost-%COMP%]     .annotationLayer .squigglyAnnotation, [_nghost-%COMP%]     .annotationLayer .strikeoutAnnotation, [_nghost-%COMP%]     .annotationLayer .freeTextAnnotation, [_nghost-%COMP%]     .annotationLayer .lineAnnotation svg line, [_nghost-%COMP%]     .annotationLayer .squareAnnotation svg rect, [_nghost-%COMP%]     .annotationLayer .circleAnnotation svg ellipse, [_nghost-%COMP%]     .annotationLayer .polylineAnnotation svg polyline, [_nghost-%COMP%]     .annotationLayer .polygonAnnotation svg polygon, [_nghost-%COMP%]     .annotationLayer .caretAnnotation, [_nghost-%COMP%]     .annotationLayer .inkAnnotation svg polyline, [_nghost-%COMP%]     .annotationLayer .stampAnnotation, [_nghost-%COMP%]     .annotationLayer .fileAttachmentAnnotation{cursor:pointer}[_nghost-%COMP%]     .annotationLayer section svg{position:absolute;width:100%;height:100%}[_nghost-%COMP%]     .annotationLayer .annotationTextContent{position:absolute;width:100%;height:100%;opacity:0;color:transparent;-webkit-user-select:none;user-select:none;pointer-events:none}[_nghost-%COMP%]     .annotationLayer .annotationTextContent span{width:100%;display:inline-block}@media (forced-colors: active){[_nghost-%COMP%]     .xfaLayer *:required{outline:1.5px solid selectedItem}}[_nghost-%COMP%]     .xfaLayer .highlight{margin:-1px;padding:1px;background-color:#efcbed;border-radius:4px}[_nghost-%COMP%]     .xfaLayer .highlight.appended{position:initial}[_nghost-%COMP%]     .xfaLayer .highlight.begin{border-radius:4px 0 0 4px}[_nghost-%COMP%]     .xfaLayer .highlight.end{border-radius:0 4px 4px 0}[_nghost-%COMP%]     .xfaLayer .highlight.middle{border-radius:0}[_nghost-%COMP%]     .xfaLayer .highlight.selected{background-color:#cbdfcb}[_nghost-%COMP%]     .xfaLayer ::selection{background:rgb(0,0,255)}[_nghost-%COMP%]     .xfaPage{overflow:hidden;position:relative}[_nghost-%COMP%]     .xfaContentarea{position:absolute}[_nghost-%COMP%]     .xfaPrintOnly{display:none}[_nghost-%COMP%]     .xfaLayer{position:absolute;text-align:initial;top:0;left:0;transform-origin:0 0;line-height:1.2}[_nghost-%COMP%]     .xfaLayer *{color:inherit;font:inherit;font-style:inherit;font-weight:inherit;font-kerning:inherit;letter-spacing:-.01px;text-align:inherit;text-decoration:inherit;box-sizing:border-box;background-color:transparent;padding:0;margin:0;pointer-events:auto;line-height:inherit}[_nghost-%COMP%]     .xfaLayer *:required{outline:1.5px solid red}[_nghost-%COMP%]     .xfaLayer div{pointer-events:none}[_nghost-%COMP%]     .xfaLayer svg{pointer-events:none}[_nghost-%COMP%]     .xfaLayer svg *{pointer-events:none}[_nghost-%COMP%]     .xfaLayer a{color:#00f}[_nghost-%COMP%]     .xfaRich li{margin-left:3em}[_nghost-%COMP%]     .xfaFont{color:#000;font-weight:400;font-kerning:none;font-size:10px;font-style:normal;letter-spacing:0;text-decoration:none;vertical-align:0}[_nghost-%COMP%]     .xfaCaption{overflow:hidden;flex:0 0 auto}[_nghost-%COMP%]     .xfaCaptionForCheckButton{overflow:hidden;flex:1 1 auto}[_nghost-%COMP%]     .xfaLabel{height:100%;width:100%}[_nghost-%COMP%]     .xfaLeft{display:flex;flex-direction:row;align-items:center}[_nghost-%COMP%]     .xfaRight{display:flex;flex-direction:row-reverse;align-items:center}[_nghost-%COMP%]     .xfaLeft>.xfaCaption, [_nghost-%COMP%]     .xfaLeft>.xfaCaptionForCheckButton, [_nghost-%COMP%]     .xfaRight>.xfaCaption, [_nghost-%COMP%]     .xfaRight>.xfaCaptionForCheckButton{max-height:100%}[_nghost-%COMP%]     .xfaTop{display:flex;flex-direction:column;align-items:flex-start}[_nghost-%COMP%]     .xfaBottom{display:flex;flex-direction:column-reverse;align-items:flex-start}[_nghost-%COMP%]     .xfaTop>.xfaCaption, [_nghost-%COMP%]     .xfaTop>.xfaCaptionForCheckButton, [_nghost-%COMP%]     .xfaBottom>.xfaCaption, [_nghost-%COMP%]     .xfaBottom>.xfaCaptionForCheckButton{width:100%}[_nghost-%COMP%]     .xfaBorder{background-color:transparent;position:absolute;pointer-events:none}[_nghost-%COMP%]     .xfaWrapped{width:100%;height:100%}[_nghost-%COMP%]     .xfaTextfield:focus, [_nghost-%COMP%]     .xfaSelect:focus{background-image:none;background-color:transparent;outline:auto;outline-offset:-1px}[_nghost-%COMP%]     .xfaCheckbox:focus, [_nghost-%COMP%]     .xfaRadio:focus{outline:auto}[_nghost-%COMP%]     .xfaTextfield, [_nghost-%COMP%]     .xfaSelect{height:100%;width:100%;flex:1 1 auto;border:none;resize:none;background-image:var(--xfa-unfocused-field-background)}[_nghost-%COMP%]     .xfaTop>.xfaTextfield, [_nghost-%COMP%]     .xfaTop>.xfaSelect, [_nghost-%COMP%]     .xfaBottom>.xfaTextfield, [_nghost-%COMP%]     .xfaBottom>.xfaSelect{flex:0 1 auto}[_nghost-%COMP%]     .xfaButton{cursor:pointer;width:100%;height:100%;border:none;text-align:center}[_nghost-%COMP%]     .xfaLink{width:100%;height:100%;position:absolute;top:0;left:0}[_nghost-%COMP%]     .xfaCheckbox, [_nghost-%COMP%]     .xfaRadio{width:100%;height:100%;flex:0 0 auto;border:none}[_nghost-%COMP%]     .xfaRich{white-space:pre-wrap;width:100%;height:100%}[_nghost-%COMP%]     .xfaImage{object-position:left top;object-fit:contain;width:100%;height:100%}[_nghost-%COMP%]     .xfaLrTb, [_nghost-%COMP%]     .xfaRlTb, [_nghost-%COMP%]     .xfaTb{display:flex;flex-direction:column;align-items:stretch}[_nghost-%COMP%]     .xfaLr{display:flex;flex-direction:row;align-items:stretch}[_nghost-%COMP%]     .xfaRl{display:flex;flex-direction:row-reverse;align-items:stretch}[_nghost-%COMP%]     .xfaTb>div{justify-content:left}[_nghost-%COMP%]     .xfaPosition{position:relative}[_nghost-%COMP%]     .xfaArea{position:relative}[_nghost-%COMP%]     .xfaValignMiddle{display:flex;align-items:center}[_nghost-%COMP%]     .xfaTable{display:flex;flex-direction:column;align-items:stretch}[_nghost-%COMP%]     .xfaTable .xfaRow{display:flex;flex-direction:row;align-items:stretch}[_nghost-%COMP%]     .xfaTable .xfaRlRow{display:flex;flex-direction:row-reverse;align-items:stretch;flex:1}[_nghost-%COMP%]     .xfaTable .xfaRlRow>div{flex:1}[_nghost-%COMP%]     .xfaNonInteractive input, [_nghost-%COMP%]     .xfaNonInteractive textarea, [_nghost-%COMP%]     .xfaDisabled input, [_nghost-%COMP%]     .xfaDisabled textarea, [_nghost-%COMP%]     .xfaReadOnly input, [_nghost-%COMP%]     .xfaReadOnly textarea{background:initial}@media print{[_nghost-%COMP%]     .xfaTextfield, [_nghost-%COMP%]     .xfaSelect{background:transparent}[_nghost-%COMP%]     .xfaSelect{-webkit-appearance:none;appearance:none;text-indent:1px;text-overflow:""}}[_nghost-%COMP%]     [data-editor-rotation="90"]{transform:rotate(90deg)}[_nghost-%COMP%]     [data-editor-rotation="180"]{transform:rotate(180deg)}[_nghost-%COMP%]     [data-editor-rotation="270"]{transform:rotate(270deg)}[_nghost-%COMP%]     .annotationEditorLayer{background:transparent;position:absolute;top:0;left:0;font-size:calc(100px * var(--scale-factor));transform-origin:0 0}[_nghost-%COMP%]     .annotationEditorLayer .selectedEditor{outline:var(--focus-outline);resize:none}[_nghost-%COMP%]     .annotationEditorLayer .freeTextEditor{position:absolute;background:transparent;border-radius:3px;padding:calc(var(--freetext-padding) * var(--scale-factor));resize:none;width:auto;height:auto;z-index:1;transform-origin:0 0;touch-action:none}[_nghost-%COMP%]     .annotationEditorLayer .freeTextEditor .internal{background:transparent;border:none;top:0;left:0;overflow:visible;white-space:nowrap;resize:none;font:10px sans-serif;line-height:var(--freetext-line-height)}[_nghost-%COMP%]     .annotationEditorLayer .freeTextEditor .overlay{position:absolute;display:none;background:transparent;top:0;left:0;width:100%;height:100%}[_nghost-%COMP%]     .annotationEditorLayer .freeTextEditor .overlay.enabled{display:block}[_nghost-%COMP%]     .annotationEditorLayer .freeTextEditor .internal:empty:before{content:attr(default-content);color:gray}[_nghost-%COMP%]     .annotationEditorLayer .freeTextEditor .internal:focus{outline:none}[_nghost-%COMP%]     .annotationEditorLayer .inkEditor.disabled{resize:none}[_nghost-%COMP%]     .annotationEditorLayer .inkEditor.disabled.selectedEditor{resize:horizontal}[_nghost-%COMP%]     .annotationEditorLayer .freeTextEditor:hover:not(.selectedEditor), [_nghost-%COMP%]     .annotationEditorLayer .inkEditor:hover:not(.selectedEditor){outline:var(--hover-outline)}[_nghost-%COMP%]     .annotationEditorLayer .inkEditor{position:absolute;background:transparent;border-radius:3px;overflow:auto;width:100%;height:100%;z-index:1;transform-origin:0 0;cursor:auto}[_nghost-%COMP%]     .annotationEditorLayer .inkEditor.editing{resize:none;cursor:var(--editorInk-editing-cursor),pointer}[_nghost-%COMP%]     .annotationEditorLayer .inkEditor .inkEditorCanvas{position:absolute;top:0;left:0;width:100%;height:100%;touch-action:none}[_nghost-%COMP%]     [data-main-rotation="90"]{transform:rotate(90deg) translateY(-100%)}[_nghost-%COMP%]     [data-main-rotation="180"]{transform:rotate(180deg) translate(-100%,-100%)}[_nghost-%COMP%]     [data-main-rotation="270"]{transform:rotate(270deg) translate(-100%)}[_nghost-%COMP%]     .pdfViewer{padding-bottom:var(--pdfViewer-padding-bottom)}[_nghost-%COMP%]     .pdfViewer .canvasWrapper{overflow:hidden}[_nghost-%COMP%]     .pdfViewer .canvasWrapper canvas{width:100%}[_nghost-%COMP%]     .pdfViewer .page{direction:ltr;width:816px;height:1056px;margin:var(--page-margin);position:relative;overflow:visible;border:var(--page-border);border-image:var(--page-border-image);background-clip:content-box;background-color:#fff}[_nghost-%COMP%]     .pdfViewer .dummyPage{position:relative;width:0;height:var(--viewer-container-height)}[_nghost-%COMP%]     .pdfViewer.removePageBorders .page{margin:0 auto 10px;border:none}[_nghost-%COMP%]     .pdfViewer.singlePageView{display:inline-block}[_nghost-%COMP%]     .pdfViewer.singlePageView .page{margin:0;border:none}[_nghost-%COMP%]     .pdfViewer.scrollHorizontal, [_nghost-%COMP%]     .pdfViewer.scrollWrapped, [_nghost-%COMP%]     .spread{margin-left:3.5px;margin-right:3.5px;text-align:center}[_nghost-%COMP%]     .pdfViewer.scrollHorizontal, [_nghost-%COMP%]     .spread{white-space:nowrap}[_nghost-%COMP%]     .pdfViewer.removePageBorders, [_nghost-%COMP%]     .pdfViewer.scrollHorizontal .spread, [_nghost-%COMP%]     .pdfViewer.scrollWrapped .spread{margin-left:0;margin-right:0}[_nghost-%COMP%]     .spread .page, [_nghost-%COMP%]     .spread .dummyPage, [_nghost-%COMP%]     .pdfViewer.scrollHorizontal .page, [_nghost-%COMP%]     .pdfViewer.scrollWrapped .page, [_nghost-%COMP%]     .pdfViewer.scrollHorizontal .spread, [_nghost-%COMP%]     .pdfViewer.scrollWrapped .spread{display:inline-block;vertical-align:middle}[_nghost-%COMP%]     .spread .page, [_nghost-%COMP%]     .pdfViewer.scrollHorizontal .page, [_nghost-%COMP%]     .pdfViewer.scrollWrapped .page{margin-left:var(--spreadHorizontalWrapped-margin-LR);margin-right:var(--spreadHorizontalWrapped-margin-LR)}[_nghost-%COMP%]     .pdfViewer.removePageBorders .spread .page, [_nghost-%COMP%]     .pdfViewer.removePageBorders.scrollHorizontal .page, [_nghost-%COMP%]     .pdfViewer.removePageBorders.scrollWrapped .page{margin-left:5px;margin-right:5px}[_nghost-%COMP%]     .pdfViewer .page canvas{margin:0;display:block}[_nghost-%COMP%]     .pdfViewer .page canvas[hidden]{display:none}[_nghost-%COMP%]     .pdfViewer .page .loadingIcon{position:absolute;display:block;inset:0;background:url(data:image/gif;base64,R0lGODlhGAAYAPQQAM7Ozvr6+uDg4LCwsOjo6I6OjsjIyJycnNjY2KioqMDAwPLy8nZ2doaGhri4uGhoaP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/ilPcHRpbWl6ZWQgd2l0aCBodHRwczovL2V6Z2lmLmNvbS9vcHRpbWl6ZQAh+QQJBwAQACwAAAAAGAAYAAAFmiAkjiTkOGVaBgjZNGSgkgKjjM8zLoI8iy+BKCdiCX8iBeMAhEEIPRXLxViYUE9CbCQoFAzFhHY3zkaT3oPvBz1zE4UBsr1eWZH4vAowOBwGAHk8AoQLfH6Agm0Ed3qOAXWOIgQKiWyFJQgDgJEpdG+WEACNEFNFmKVlVzJQk6qdkwqBoi1mebJ3ALNGeIZHtGSwNDS1RZKueCEAIfkECQcAEAAsAAAAABgAGAAABZcgJI4kpChlWgYCWRQkEKgjURgjw4zOg9CjVwuiEyEeO6CxkBC9nA+HiuUqLEyoBZI0Mx4SAFFgQCDZuguBoGv6Dtg0gvpqdhxQQDkBzuUr/4A1JwMKP39pc2mDhYCIc4GQYn6QCwCMeY91l0p6dBAEJ0OfcFRimZ91Mwt0alxxAIZyRmuAsKxDLKKvZbM1tJxmvGKRpn8hACH5BAkHABAALAAAAAAYABgAAAWhICSOJGQYZVoGAnkcJBKoI3EAY1GMCtPSosSBINKJBIwGkHdwBGGQA0OhYpEGQxNqkYzNIITBACEKKBaxxNfBeOCO4vMy0Hg8nDHFeCktkKtfNAtoS4UqAicKBj9zBAKPC4iKi4aRkISGmWWBmjUIAIyHkCUEAKCVo2WmREecVqoCgZhgP4NHrGWCj7e3szSpuxAsoVWxnp6cVV4kyZW+KSEAIfkECQcAEAAsAAAAABgAGAAABZkgJI4kBABlWgYEOQykEKgjMSDjcYxG0dKi108nEhQKQN4rCIMkCgbawjWYnSCLY2yGVSgEooBhWqsGGwxc0RtNBgoMhmJ1QgETjANYFeBKyUmBKQQIdT9JDmgPDQ6EhoKJD4sOgpWWgiwChyqEBH5hmptSoSOZgJ4kLKWkYTF7C2SaqaM/hEWygay4mYG8t6uffFuzl1iANCEAIfkECQcAEAAsAAAAABgAGAAABZ0gJI4khCBlmhKkopBCoI6LIozDMAIHO4uuBVBnOiR+I4FrCDwAZsKdQnaCLIwwmRUA8JmioprWUCjcwlwUMnAoG0qL03k2KCS8cC0UjOzDCQKBfHQFDAwFU4CCfgqFhy9+kZJWgzSKSAcPZn+BfQENDw8OljGWJAFeDoZPYTBnC1GdSXqnsoBolSulX2GyP6hgvnG0KrS3NJNhuSQhACH5BAkHABAALAAAAAAYABgAAAWaICSOJCQIZZoupGGQRKCOC0CMijIiwz2LABtQZxoMfjQhxAXszWQ7gOwECRhh0MCJJRJARTUoIHFAgbfI6uBwAJS01J/i4PClVYHvfV8lbLlIBmwFbQt+aGmChG18jXeGT4dICQxlb4g/AQUMDER9XjR6BAdiDQwINDBmkAsPDVh4cX4imw53iLKuaVqAcUsPqEiidkt6j4AzIQAh+QQJBwAQACwAAAAAGAAYAAAFmSAkjiREEGWaBiSCtCoZCMsIAKOg1LEo0KKbaKFQ9EYLoOkFuQlirNxzCQkUW9GZ0hQd4nyDAWr4G/esYSbyZFYZwu3jqiuvr8u8I2BwOAwASXh1e31/doeHC3klWnElfAlTd46MfQUGk2stCVEGBQWSdCciDg5VDAVYKoEiDQ0iBwxGcj9RDw8+qHIzebc2DJJQJK6qiKVyIQAh+QQJBwAQACwAAAAAGAAYAAAFmSAkjiS0LGWaBiRBtCoZCKgoCCMB1DF0sz6cCQDo5W62l28XAyZFpyECBv3lnCbhUqHMIo0Qg4Jbmn1jRCa4iV27TzfXGjEecOFWMN1OdvvfPGUuXSoKBw6EXokrAwcHRVU0UAeEBANAAAmUI1gNDyhjJgUHLW0iDg8FIqOnBQZrDA9TELE2rEYIDw4jta2LMpCrqld/YQpgIQAh+QQJBwAQACwAAAAAGAAYAAAFmyAkjiS0LGWaBiRBkKw6BgIqCsJcyyMe4yJajhcEml5H26o1PN2QQd3uFiv2AADlAgflIbDdZLgkABOJgep5LfWty4p4zeU+w+XsvJWXliEKDwdEBgMKYQ4PDw1qK3EDCCMAiQ5BCV0LCj+FSDQkgCgGBiYHAy2MIgoMghAHqw4HAGsNDEMFBTekdgwKI7aRB2MwkL2rVHoQoWchACH5BAkHABAALAAAAAAYABgAAAWWICSOJLQsZZoGJEGQrDoGAioKwlzLIx7jIlqOFwSaXkfbqjU83ZBB3e4WK0qrCxyU55peid0qcUwuixyNx6PhILsAcAJazXYj4lvz2MkLiFsHDAlEcABKZwwMBX8pBgoKQxAIigpBA1sLBj+PSDQkB4uSACYDlTMyBgWDEKVnl2QFBUigN61gBQYjtLV5JZ4jtlR6omMhACH5BAkHABAALAAAAAAYABgAAAWaICSOJLQsZZoGJEGQrDoGAioKwlzLIx7jIlqOFwSaXkdbidYanm7I4AjwYDh6saJuJ3JUG1mZi9srPA7EcRimJLrfJYWZUVC8TziXnEG3u/E+cIJaPAFrPQl1aQAIbRAGBZGHJQiMUQKRBkEKbQsAPZaEXQcslSYKmjMyAAdXj34ACkNEiUgDA5t+PAQHn6Ogjkuzry2DNwhuIQAh+QQFBwAQACwAAAAAGAAYAAAFnCAkjiS0LGVaBgBJEGSguo8zCsK4CPIsMg+ECCcKEH0ix6MwhJl4KiOp8UCdmrEbo6EoHpxF8A6aBBZ6vhf5dmAkkGr0CoWs21WGQ2FvsI9xC3l7B311fy93iWGKJQQOhHCAJQB6A3IqcWwJLU90i2FkUiMKlhBELEI6MwgDXRAGhQgAYD6tTqRFAJxpA6mvrqazSKJJhUWMpjlIIQA7) center no-repeat}[_nghost-%COMP%]     .pdfViewer .page .loadingIcon.notVisible{background:none}[_nghost-%COMP%]     .pdfViewer.enablePermissions .textLayer span{-webkit-user-select:none!important;user-select:none!important;cursor:not-allowed}[_nghost-%COMP%]     .pdfPresentationMode .pdfViewer{padding-bottom:0}[_nghost-%COMP%]     .pdfPresentationMode .spread{margin:0}[_nghost-%COMP%]     .pdfPresentationMode .pdfViewer .page{margin:0 auto;border:2px solid transparent}']})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](PdfViewerComponent,[{type:core.Component,args:[{selector:"pdf-viewer",template:'\n    <div #pdfViewerContainer class="ng2-pdf-viewer-container">\n      <div class="pdfViewer"></div>\n    </div>\n  ',styles:['.ng2-pdf-viewer-container{overflow-x:auto;position:absolute;height:100%;width:100%;-webkit-overflow-scrolling:touch}:host{display:block;position:relative}:host ::ng-deep{--pdfViewer-padding-bottom: 0;--page-margin: 1px auto -8px;--page-border: 9px solid transparent;--spreadHorizontalWrapped-margin-LR: -3.5px;--viewer-container-height: 0;--annotation-unfocused-field-background: url("data:image/svg+xml;charset=UTF-8,<svg width=\'1px\' height=\'1px\' xmlns=\'http://www.w3.org/2000/svg\'><rect width=\'100%\' height=\'100%\' style=\'fill:rgba(0, 54, 255, 0.13);\'/></svg>");--xfa-unfocused-field-background: var( --annotation-unfocused-field-background );--page-border-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAA1ElEQVQ4jbWUWw6EIAxFy2NFs/8NzR4UJhpqLsdi5mOmSSMUOfYWqv3S0gMr4XlYH/64gZa/gN3ANYA7KAXALt4ktoQ5MI9YxqaG8bWmsIysMuT6piSQCa4whZThCu8CM4zP9YJaKci9jicPq3NcBWYoPMGUlhG7ivtkB+gVyFY75wXghOvh8t5mto1Mdim6e+MBqH6XsY+YAwjpq3vGF7weTWQptLEDVCZvPTMl5JZZsdh47FHW6qFMyvLYqjcnmdFfY9Xk/KDOlzCusX2mi/ofM7MPkzBcSp4Q1/wAAAAASUVORK5CYII=) 9 9 repeat;--scale-factor: 1;--focus-outline: solid 2px blue;--hover-outline: dashed 2px blue;--freetext-line-height: 1.35;--freetext-padding: 2px;--editorInk-editing-cursor: pointer}@media screen and (forced-colors: active){:host ::ng-deep{--pdfViewer-padding-bottom: 9px;--page-margin: 8px auto -1px;--page-border: 1px solid CanvasText;--page-border-image: none;--spreadHorizontalWrapped-margin-LR: 3.5px}}@media (forced-colors: active){:host ::ng-deep{--focus-outline: solid 3px ButtonText;--hover-outline: dashed 3px ButtonText}}:host ::ng-deep .textLayer{position:absolute;text-align:initial;inset:0;overflow:hidden;opacity:.2;line-height:1;-webkit-text-size-adjust:none;text-size-adjust:none;forced-color-adjust:none;transform-origin:0 0}:host ::ng-deep .textLayer span,:host ::ng-deep .textLayer br{color:transparent;position:absolute;white-space:pre;cursor:text;transform-origin:0% 0%}:host ::ng-deep .textLayer span.markedContent{top:0;height:0}:host ::ng-deep .textLayer .highlight{margin:-1px;padding:1px;background-color:#b400aa;border-radius:4px}:host ::ng-deep .textLayer .highlight.appended{position:initial}:host ::ng-deep .textLayer .highlight.begin{border-radius:4px 0 0 4px}:host ::ng-deep .textLayer .highlight.end{border-radius:0 4px 4px 0}:host ::ng-deep .textLayer .highlight.middle{border-radius:0}:host ::ng-deep .textLayer .highlight.selected{background-color:#006400}:host ::ng-deep .textLayer ::selection{background:rgb(0,0,255)}:host ::ng-deep .textLayer br::selection{background:transparent}:host ::ng-deep .textLayer .endOfContent{display:block;position:absolute;inset:100% 0 0;z-index:-1;cursor:default;-webkit-user-select:none;user-select:none}:host ::ng-deep .textLayer .endOfContent.active{top:0}@media (forced-colors: active){:host ::ng-deep .annotationLayer .textWidgetAnnotation input:required,:host ::ng-deep .annotationLayer .textWidgetAnnotation textarea:required,:host ::ng-deep .annotationLayer .choiceWidgetAnnotation select:required,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.checkBox input:required,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.radioButton input:required{outline:1.5px solid selectedItem}}:host ::ng-deep .annotationLayer{position:absolute;top:0;left:0;pointer-events:none;transform-origin:0 0}:host ::ng-deep .annotationLayer section{position:absolute;text-align:initial;pointer-events:auto;box-sizing:border-box;transform-origin:0 0}:host ::ng-deep .annotationLayer .linkAnnotation>a,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.pushButton>a{position:absolute;font-size:1em;top:0;left:0;width:100%;height:100%}:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.pushButton>canvas{width:100%;height:100%}:host ::ng-deep .annotationLayer .linkAnnotation>a:hover,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.pushButton>a:hover{opacity:.2;background:rgb(255,255,0);box-shadow:0 2px 10px #ff0}:host ::ng-deep .annotationLayer .textAnnotation img{position:absolute;cursor:pointer;width:100%;height:100%}:host ::ng-deep .annotationLayer .textWidgetAnnotation input,:host ::ng-deep .annotationLayer .textWidgetAnnotation textarea,:host ::ng-deep .annotationLayer .choiceWidgetAnnotation select,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.checkBox input,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.radioButton input{background-image:var(--annotation-unfocused-field-background);border:1px solid transparent;box-sizing:border-box;font:calc(9px * var(--scale-factor)) sans-serif;height:100%;margin:0;vertical-align:top;width:100%}:host ::ng-deep .annotationLayer .textWidgetAnnotation input:required,:host ::ng-deep .annotationLayer .textWidgetAnnotation textarea:required,:host ::ng-deep .annotationLayer .choiceWidgetAnnotation select:required,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.checkBox input:required,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.radioButton input:required{outline:1.5px solid red}:host ::ng-deep .annotationLayer .choiceWidgetAnnotation select option{padding:0}:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.radioButton input{border-radius:50%}:host ::ng-deep .annotationLayer .textWidgetAnnotation textarea{resize:none}:host ::ng-deep .annotationLayer .textWidgetAnnotation input[disabled],:host ::ng-deep .annotationLayer .textWidgetAnnotation textarea[disabled],:host ::ng-deep .annotationLayer .choiceWidgetAnnotation select[disabled],:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.checkBox input[disabled],:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.radioButton input[disabled]{background:none;border:1px solid transparent;cursor:not-allowed}:host ::ng-deep .annotationLayer .textWidgetAnnotation input:hover,:host ::ng-deep .annotationLayer .textWidgetAnnotation textarea:hover,:host ::ng-deep .annotationLayer .choiceWidgetAnnotation select:hover,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.checkBox input:hover,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.radioButton input:hover{border:1px solid rgb(0,0,0)}:host ::ng-deep .annotationLayer .textWidgetAnnotation input:focus,:host ::ng-deep .annotationLayer .textWidgetAnnotation textarea:focus,:host ::ng-deep .annotationLayer .choiceWidgetAnnotation select:focus{background:none;border:1px solid transparent}:host ::ng-deep .annotationLayer .textWidgetAnnotation input :focus,:host ::ng-deep .annotationLayer .textWidgetAnnotation textarea :focus,:host ::ng-deep .annotationLayer .choiceWidgetAnnotation select :focus,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.checkBox :focus,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.radioButton :focus{background-image:none;background-color:transparent;outline:auto}:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:before,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:after,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.radioButton input:checked:before{background-color:CanvasText;content:"";display:block;position:absolute}:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:before,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:after{height:80%;left:45%;width:1px}:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:before{transform:rotate(45deg)}:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:after{transform:rotate(-45deg)}:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.radioButton input:checked:before{border-radius:50%;height:50%;left:30%;top:20%;width:50%}:host ::ng-deep .annotationLayer .textWidgetAnnotation input.comb{font-family:monospace;padding-left:2px;padding-right:0}:host ::ng-deep .annotationLayer .textWidgetAnnotation input.comb:focus{width:103%}:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.checkBox input,:host ::ng-deep .annotationLayer .buttonWidgetAnnotation.radioButton input{-webkit-appearance:none;appearance:none}:host ::ng-deep .annotationLayer .popupTriggerArea{height:100%;width:100%}:host ::ng-deep .annotationLayer .popupWrapper{position:absolute;font-size:calc(9px * var(--scale-factor));width:100%;min-width:calc(180px * var(--scale-factor));pointer-events:none}:host ::ng-deep .annotationLayer .popup{position:absolute;max-width:calc(180px * var(--scale-factor));background-color:#ff9;box-shadow:0 calc(2px * var(--scale-factor)) calc(5px * var(--scale-factor)) #888;border-radius:calc(2px * var(--scale-factor));padding:calc(6px * var(--scale-factor));margin-left:calc(5px * var(--scale-factor));cursor:pointer;font:message-box;white-space:normal;word-wrap:break-word;pointer-events:auto}:host ::ng-deep .annotationLayer .popup>*{font-size:calc(9px * var(--scale-factor))}:host ::ng-deep .annotationLayer .popup h1{display:inline-block}:host ::ng-deep .annotationLayer .popupDate{display:inline-block;margin-left:calc(5px * var(--scale-factor))}:host ::ng-deep .annotationLayer .popupContent{border-top:1px solid rgb(51,51,51);margin-top:calc(2px * var(--scale-factor));padding-top:calc(2px * var(--scale-factor))}:host ::ng-deep .annotationLayer .richText>*{white-space:pre-wrap;font-size:calc(9px * var(--scale-factor))}:host ::ng-deep .annotationLayer .highlightAnnotation,:host ::ng-deep .annotationLayer .underlineAnnotation,:host ::ng-deep .annotationLayer .squigglyAnnotation,:host ::ng-deep .annotationLayer .strikeoutAnnotation,:host ::ng-deep .annotationLayer .freeTextAnnotation,:host ::ng-deep .annotationLayer .lineAnnotation svg line,:host ::ng-deep .annotationLayer .squareAnnotation svg rect,:host ::ng-deep .annotationLayer .circleAnnotation svg ellipse,:host ::ng-deep .annotationLayer .polylineAnnotation svg polyline,:host ::ng-deep .annotationLayer .polygonAnnotation svg polygon,:host ::ng-deep .annotationLayer .caretAnnotation,:host ::ng-deep .annotationLayer .inkAnnotation svg polyline,:host ::ng-deep .annotationLayer .stampAnnotation,:host ::ng-deep .annotationLayer .fileAttachmentAnnotation{cursor:pointer}:host ::ng-deep .annotationLayer section svg{position:absolute;width:100%;height:100%}:host ::ng-deep .annotationLayer .annotationTextContent{position:absolute;width:100%;height:100%;opacity:0;color:transparent;-webkit-user-select:none;user-select:none;pointer-events:none}:host ::ng-deep .annotationLayer .annotationTextContent span{width:100%;display:inline-block}@media (forced-colors: active){:host ::ng-deep .xfaLayer *:required{outline:1.5px solid selectedItem}}:host ::ng-deep .xfaLayer .highlight{margin:-1px;padding:1px;background-color:#efcbed;border-radius:4px}:host ::ng-deep .xfaLayer .highlight.appended{position:initial}:host ::ng-deep .xfaLayer .highlight.begin{border-radius:4px 0 0 4px}:host ::ng-deep .xfaLayer .highlight.end{border-radius:0 4px 4px 0}:host ::ng-deep .xfaLayer .highlight.middle{border-radius:0}:host ::ng-deep .xfaLayer .highlight.selected{background-color:#cbdfcb}:host ::ng-deep .xfaLayer ::selection{background:rgb(0,0,255)}:host ::ng-deep .xfaPage{overflow:hidden;position:relative}:host ::ng-deep .xfaContentarea{position:absolute}:host ::ng-deep .xfaPrintOnly{display:none}:host ::ng-deep .xfaLayer{position:absolute;text-align:initial;top:0;left:0;transform-origin:0 0;line-height:1.2}:host ::ng-deep .xfaLayer *{color:inherit;font:inherit;font-style:inherit;font-weight:inherit;font-kerning:inherit;letter-spacing:-.01px;text-align:inherit;text-decoration:inherit;box-sizing:border-box;background-color:transparent;padding:0;margin:0;pointer-events:auto;line-height:inherit}:host ::ng-deep .xfaLayer *:required{outline:1.5px solid red}:host ::ng-deep .xfaLayer div{pointer-events:none}:host ::ng-deep .xfaLayer svg{pointer-events:none}:host ::ng-deep .xfaLayer svg *{pointer-events:none}:host ::ng-deep .xfaLayer a{color:#00f}:host ::ng-deep .xfaRich li{margin-left:3em}:host ::ng-deep .xfaFont{color:#000;font-weight:400;font-kerning:none;font-size:10px;font-style:normal;letter-spacing:0;text-decoration:none;vertical-align:0}:host ::ng-deep .xfaCaption{overflow:hidden;flex:0 0 auto}:host ::ng-deep .xfaCaptionForCheckButton{overflow:hidden;flex:1 1 auto}:host ::ng-deep .xfaLabel{height:100%;width:100%}:host ::ng-deep .xfaLeft{display:flex;flex-direction:row;align-items:center}:host ::ng-deep .xfaRight{display:flex;flex-direction:row-reverse;align-items:center}:host ::ng-deep .xfaLeft>.xfaCaption,:host ::ng-deep .xfaLeft>.xfaCaptionForCheckButton,:host ::ng-deep .xfaRight>.xfaCaption,:host ::ng-deep .xfaRight>.xfaCaptionForCheckButton{max-height:100%}:host ::ng-deep .xfaTop{display:flex;flex-direction:column;align-items:flex-start}:host ::ng-deep .xfaBottom{display:flex;flex-direction:column-reverse;align-items:flex-start}:host ::ng-deep .xfaTop>.xfaCaption,:host ::ng-deep .xfaTop>.xfaCaptionForCheckButton,:host ::ng-deep .xfaBottom>.xfaCaption,:host ::ng-deep .xfaBottom>.xfaCaptionForCheckButton{width:100%}:host ::ng-deep .xfaBorder{background-color:transparent;position:absolute;pointer-events:none}:host ::ng-deep .xfaWrapped{width:100%;height:100%}:host ::ng-deep .xfaTextfield:focus,:host ::ng-deep .xfaSelect:focus{background-image:none;background-color:transparent;outline:auto;outline-offset:-1px}:host ::ng-deep .xfaCheckbox:focus,:host ::ng-deep .xfaRadio:focus{outline:auto}:host ::ng-deep .xfaTextfield,:host ::ng-deep .xfaSelect{height:100%;width:100%;flex:1 1 auto;border:none;resize:none;background-image:var(--xfa-unfocused-field-background)}:host ::ng-deep .xfaTop>.xfaTextfield,:host ::ng-deep .xfaTop>.xfaSelect,:host ::ng-deep .xfaBottom>.xfaTextfield,:host ::ng-deep .xfaBottom>.xfaSelect{flex:0 1 auto}:host ::ng-deep .xfaButton{cursor:pointer;width:100%;height:100%;border:none;text-align:center}:host ::ng-deep .xfaLink{width:100%;height:100%;position:absolute;top:0;left:0}:host ::ng-deep .xfaCheckbox,:host ::ng-deep .xfaRadio{width:100%;height:100%;flex:0 0 auto;border:none}:host ::ng-deep .xfaRich{white-space:pre-wrap;width:100%;height:100%}:host ::ng-deep .xfaImage{object-position:left top;object-fit:contain;width:100%;height:100%}:host ::ng-deep .xfaLrTb,:host ::ng-deep .xfaRlTb,:host ::ng-deep .xfaTb{display:flex;flex-direction:column;align-items:stretch}:host ::ng-deep .xfaLr{display:flex;flex-direction:row;align-items:stretch}:host ::ng-deep .xfaRl{display:flex;flex-direction:row-reverse;align-items:stretch}:host ::ng-deep .xfaTb>div{justify-content:left}:host ::ng-deep .xfaPosition{position:relative}:host ::ng-deep .xfaArea{position:relative}:host ::ng-deep .xfaValignMiddle{display:flex;align-items:center}:host ::ng-deep .xfaTable{display:flex;flex-direction:column;align-items:stretch}:host ::ng-deep .xfaTable .xfaRow{display:flex;flex-direction:row;align-items:stretch}:host ::ng-deep .xfaTable .xfaRlRow{display:flex;flex-direction:row-reverse;align-items:stretch;flex:1}:host ::ng-deep .xfaTable .xfaRlRow>div{flex:1}:host ::ng-deep .xfaNonInteractive input,:host ::ng-deep .xfaNonInteractive textarea,:host ::ng-deep .xfaDisabled input,:host ::ng-deep .xfaDisabled textarea,:host ::ng-deep .xfaReadOnly input,:host ::ng-deep .xfaReadOnly textarea{background:initial}@media print{:host ::ng-deep .xfaTextfield,:host ::ng-deep .xfaSelect{background:transparent}:host ::ng-deep .xfaSelect{-webkit-appearance:none;appearance:none;text-indent:1px;text-overflow:""}}:host ::ng-deep [data-editor-rotation="90"]{transform:rotate(90deg)}:host ::ng-deep [data-editor-rotation="180"]{transform:rotate(180deg)}:host ::ng-deep [data-editor-rotation="270"]{transform:rotate(270deg)}:host ::ng-deep .annotationEditorLayer{background:transparent;position:absolute;top:0;left:0;font-size:calc(100px * var(--scale-factor));transform-origin:0 0}:host ::ng-deep .annotationEditorLayer .selectedEditor{outline:var(--focus-outline);resize:none}:host ::ng-deep .annotationEditorLayer .freeTextEditor{position:absolute;background:transparent;border-radius:3px;padding:calc(var(--freetext-padding) * var(--scale-factor));resize:none;width:auto;height:auto;z-index:1;transform-origin:0 0;touch-action:none}:host ::ng-deep .annotationEditorLayer .freeTextEditor .internal{background:transparent;border:none;top:0;left:0;overflow:visible;white-space:nowrap;resize:none;font:10px sans-serif;line-height:var(--freetext-line-height)}:host ::ng-deep .annotationEditorLayer .freeTextEditor .overlay{position:absolute;display:none;background:transparent;top:0;left:0;width:100%;height:100%}:host ::ng-deep .annotationEditorLayer .freeTextEditor .overlay.enabled{display:block}:host ::ng-deep .annotationEditorLayer .freeTextEditor .internal:empty:before{content:attr(default-content);color:gray}:host ::ng-deep .annotationEditorLayer .freeTextEditor .internal:focus{outline:none}:host ::ng-deep .annotationEditorLayer .inkEditor.disabled{resize:none}:host ::ng-deep .annotationEditorLayer .inkEditor.disabled.selectedEditor{resize:horizontal}:host ::ng-deep .annotationEditorLayer .freeTextEditor:hover:not(.selectedEditor),:host ::ng-deep .annotationEditorLayer .inkEditor:hover:not(.selectedEditor){outline:var(--hover-outline)}:host ::ng-deep .annotationEditorLayer .inkEditor{position:absolute;background:transparent;border-radius:3px;overflow:auto;width:100%;height:100%;z-index:1;transform-origin:0 0;cursor:auto}:host ::ng-deep .annotationEditorLayer .inkEditor.editing{resize:none;cursor:var(--editorInk-editing-cursor),pointer}:host ::ng-deep .annotationEditorLayer .inkEditor .inkEditorCanvas{position:absolute;top:0;left:0;width:100%;height:100%;touch-action:none}:host ::ng-deep [data-main-rotation="90"]{transform:rotate(90deg) translateY(-100%)}:host ::ng-deep [data-main-rotation="180"]{transform:rotate(180deg) translate(-100%,-100%)}:host ::ng-deep [data-main-rotation="270"]{transform:rotate(270deg) translate(-100%)}:host ::ng-deep .pdfViewer{padding-bottom:var(--pdfViewer-padding-bottom)}:host ::ng-deep .pdfViewer .canvasWrapper{overflow:hidden}:host ::ng-deep .pdfViewer .canvasWrapper canvas{width:100%}:host ::ng-deep .pdfViewer .page{direction:ltr;width:816px;height:1056px;margin:var(--page-margin);position:relative;overflow:visible;border:var(--page-border);border-image:var(--page-border-image);background-clip:content-box;background-color:#fff}:host ::ng-deep .pdfViewer .dummyPage{position:relative;width:0;height:var(--viewer-container-height)}:host ::ng-deep .pdfViewer.removePageBorders .page{margin:0 auto 10px;border:none}:host ::ng-deep .pdfViewer.singlePageView{display:inline-block}:host ::ng-deep .pdfViewer.singlePageView .page{margin:0;border:none}:host ::ng-deep .pdfViewer.scrollHorizontal,:host ::ng-deep .pdfViewer.scrollWrapped,:host ::ng-deep .spread{margin-left:3.5px;margin-right:3.5px;text-align:center}:host ::ng-deep .pdfViewer.scrollHorizontal,:host ::ng-deep .spread{white-space:nowrap}:host ::ng-deep .pdfViewer.removePageBorders,:host ::ng-deep .pdfViewer.scrollHorizontal .spread,:host ::ng-deep .pdfViewer.scrollWrapped .spread{margin-left:0;margin-right:0}:host ::ng-deep .spread .page,:host ::ng-deep .spread .dummyPage,:host ::ng-deep .pdfViewer.scrollHorizontal .page,:host ::ng-deep .pdfViewer.scrollWrapped .page,:host ::ng-deep .pdfViewer.scrollHorizontal .spread,:host ::ng-deep .pdfViewer.scrollWrapped .spread{display:inline-block;vertical-align:middle}:host ::ng-deep .spread .page,:host ::ng-deep .pdfViewer.scrollHorizontal .page,:host ::ng-deep .pdfViewer.scrollWrapped .page{margin-left:var(--spreadHorizontalWrapped-margin-LR);margin-right:var(--spreadHorizontalWrapped-margin-LR)}:host ::ng-deep .pdfViewer.removePageBorders .spread .page,:host ::ng-deep .pdfViewer.removePageBorders.scrollHorizontal .page,:host ::ng-deep .pdfViewer.removePageBorders.scrollWrapped .page{margin-left:5px;margin-right:5px}:host ::ng-deep .pdfViewer .page canvas{margin:0;display:block}:host ::ng-deep .pdfViewer .page canvas[hidden]{display:none}:host ::ng-deep .pdfViewer .page .loadingIcon{position:absolute;display:block;inset:0;background:url(data:image/gif;base64,R0lGODlhGAAYAPQQAM7Ozvr6+uDg4LCwsOjo6I6OjsjIyJycnNjY2KioqMDAwPLy8nZ2doaGhri4uGhoaP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/ilPcHRpbWl6ZWQgd2l0aCBodHRwczovL2V6Z2lmLmNvbS9vcHRpbWl6ZQAh+QQJBwAQACwAAAAAGAAYAAAFmiAkjiTkOGVaBgjZNGSgkgKjjM8zLoI8iy+BKCdiCX8iBeMAhEEIPRXLxViYUE9CbCQoFAzFhHY3zkaT3oPvBz1zE4UBsr1eWZH4vAowOBwGAHk8AoQLfH6Agm0Ed3qOAXWOIgQKiWyFJQgDgJEpdG+WEACNEFNFmKVlVzJQk6qdkwqBoi1mebJ3ALNGeIZHtGSwNDS1RZKueCEAIfkECQcAEAAsAAAAABgAGAAABZcgJI4kpChlWgYCWRQkEKgjURgjw4zOg9CjVwuiEyEeO6CxkBC9nA+HiuUqLEyoBZI0Mx4SAFFgQCDZuguBoGv6Dtg0gvpqdhxQQDkBzuUr/4A1JwMKP39pc2mDhYCIc4GQYn6QCwCMeY91l0p6dBAEJ0OfcFRimZ91Mwt0alxxAIZyRmuAsKxDLKKvZbM1tJxmvGKRpn8hACH5BAkHABAALAAAAAAYABgAAAWhICSOJGQYZVoGAnkcJBKoI3EAY1GMCtPSosSBINKJBIwGkHdwBGGQA0OhYpEGQxNqkYzNIITBACEKKBaxxNfBeOCO4vMy0Hg8nDHFeCktkKtfNAtoS4UqAicKBj9zBAKPC4iKi4aRkISGmWWBmjUIAIyHkCUEAKCVo2WmREecVqoCgZhgP4NHrGWCj7e3szSpuxAsoVWxnp6cVV4kyZW+KSEAIfkECQcAEAAsAAAAABgAGAAABZkgJI4kBABlWgYEOQykEKgjMSDjcYxG0dKi108nEhQKQN4rCIMkCgbawjWYnSCLY2yGVSgEooBhWqsGGwxc0RtNBgoMhmJ1QgETjANYFeBKyUmBKQQIdT9JDmgPDQ6EhoKJD4sOgpWWgiwChyqEBH5hmptSoSOZgJ4kLKWkYTF7C2SaqaM/hEWygay4mYG8t6uffFuzl1iANCEAIfkECQcAEAAsAAAAABgAGAAABZ0gJI4khCBlmhKkopBCoI6LIozDMAIHO4uuBVBnOiR+I4FrCDwAZsKdQnaCLIwwmRUA8JmioprWUCjcwlwUMnAoG0qL03k2KCS8cC0UjOzDCQKBfHQFDAwFU4CCfgqFhy9+kZJWgzSKSAcPZn+BfQENDw8OljGWJAFeDoZPYTBnC1GdSXqnsoBolSulX2GyP6hgvnG0KrS3NJNhuSQhACH5BAkHABAALAAAAAAYABgAAAWaICSOJCQIZZoupGGQRKCOC0CMijIiwz2LABtQZxoMfjQhxAXszWQ7gOwECRhh0MCJJRJARTUoIHFAgbfI6uBwAJS01J/i4PClVYHvfV8lbLlIBmwFbQt+aGmChG18jXeGT4dICQxlb4g/AQUMDER9XjR6BAdiDQwINDBmkAsPDVh4cX4imw53iLKuaVqAcUsPqEiidkt6j4AzIQAh+QQJBwAQACwAAAAAGAAYAAAFmSAkjiREEGWaBiSCtCoZCMsIAKOg1LEo0KKbaKFQ9EYLoOkFuQlirNxzCQkUW9GZ0hQd4nyDAWr4G/esYSbyZFYZwu3jqiuvr8u8I2BwOAwASXh1e31/doeHC3klWnElfAlTd46MfQUGk2stCVEGBQWSdCciDg5VDAVYKoEiDQ0iBwxGcj9RDw8+qHIzebc2DJJQJK6qiKVyIQAh+QQJBwAQACwAAAAAGAAYAAAFmSAkjiS0LGWaBiRBtCoZCKgoCCMB1DF0sz6cCQDo5W62l28XAyZFpyECBv3lnCbhUqHMIo0Qg4Jbmn1jRCa4iV27TzfXGjEecOFWMN1OdvvfPGUuXSoKBw6EXokrAwcHRVU0UAeEBANAAAmUI1gNDyhjJgUHLW0iDg8FIqOnBQZrDA9TELE2rEYIDw4jta2LMpCrqld/YQpgIQAh+QQJBwAQACwAAAAAGAAYAAAFmyAkjiS0LGWaBiRBkKw6BgIqCsJcyyMe4yJajhcEml5H26o1PN2QQd3uFiv2AADlAgflIbDdZLgkABOJgep5LfWty4p4zeU+w+XsvJWXliEKDwdEBgMKYQ4PDw1qK3EDCCMAiQ5BCV0LCj+FSDQkgCgGBiYHAy2MIgoMghAHqw4HAGsNDEMFBTekdgwKI7aRB2MwkL2rVHoQoWchACH5BAkHABAALAAAAAAYABgAAAWWICSOJLQsZZoGJEGQrDoGAioKwlzLIx7jIlqOFwSaXkfbqjU83ZBB3e4WK0qrCxyU55peid0qcUwuixyNx6PhILsAcAJazXYj4lvz2MkLiFsHDAlEcABKZwwMBX8pBgoKQxAIigpBA1sLBj+PSDQkB4uSACYDlTMyBgWDEKVnl2QFBUigN61gBQYjtLV5JZ4jtlR6omMhACH5BAkHABAALAAAAAAYABgAAAWaICSOJLQsZZoGJEGQrDoGAioKwlzLIx7jIlqOFwSaXkdbidYanm7I4AjwYDh6saJuJ3JUG1mZi9srPA7EcRimJLrfJYWZUVC8TziXnEG3u/E+cIJaPAFrPQl1aQAIbRAGBZGHJQiMUQKRBkEKbQsAPZaEXQcslSYKmjMyAAdXj34ACkNEiUgDA5t+PAQHn6Ogjkuzry2DNwhuIQAh+QQFBwAQACwAAAAAGAAYAAAFnCAkjiS0LGVaBgBJEGSguo8zCsK4CPIsMg+ECCcKEH0ix6MwhJl4KiOp8UCdmrEbo6EoHpxF8A6aBBZ6vhf5dmAkkGr0CoWs21WGQ2FvsI9xC3l7B311fy93iWGKJQQOhHCAJQB6A3IqcWwJLU90i2FkUiMKlhBELEI6MwgDXRAGhQgAYD6tTqRFAJxpA6mvrqazSKJJhUWMpjlIIQA7) center no-repeat}:host ::ng-deep .pdfViewer .page .loadingIcon.notVisible{background:none}:host ::ng-deep .pdfViewer.enablePermissions .textLayer span{-webkit-user-select:none!important;user-select:none!important;cursor:not-allowed}:host ::ng-deep .pdfPresentationMode .pdfViewer{padding-bottom:0}:host ::ng-deep .pdfPresentationMode .spread{margin:0}:host ::ng-deep .pdfPresentationMode .pdfViewer .page{margin:0 auto;border:2px solid transparent}\n']}]}],(function(){return[{type:core.ElementRef},{type:core.NgZone}]}),{pdfViewerContainer:[{type:core.ViewChild,args:["pdfViewerContainer"]}],afterLoadComplete:[{type:core.Output,args:["after-load-complete"]}],pageRendered:[{type:core.Output,args:["page-rendered"]}],pageInitialized:[{type:core.Output,args:["pages-initialized"]}],textLayerRendered:[{type:core.Output,args:["text-layer-rendered"]}],onError:[{type:core.Output,args:["error"]}],onProgress:[{type:core.Output,args:["on-progress"]}],pageChange:[{type:core.Output}],src:[{type:core.Input}],cMapsUrl:[{type:core.Input,args:["c-maps-url"]}],page:[{type:core.Input,args:["page"]}],renderText:[{type:core.Input,args:["render-text"]}],renderTextMode:[{type:core.Input,args:["render-text-mode"]}],originalSize:[{type:core.Input,args:["original-size"]}],showAll:[{type:core.Input,args:["show-all"]}],stickToPage:[{type:core.Input,args:["stick-to-page"]}],zoom:[{type:core.Input,args:["zoom"]}],zoomScale:[{type:core.Input,args:["zoom-scale"]}],rotation:[{type:core.Input,args:["rotation"]}],externalLinkTarget:[{type:core.Input,args:["external-link-target"]}],autoresize:[{type:core.Input,args:["autoresize"]}],fitToPage:[{type:core.Input,args:["fit-to-page"]}],showBorders:[{type:core.Input,args:["show-borders"]}]});class PdfViewerModule{static ɵfac=function PdfViewerModule_Factory(__ngFactoryType__){return new(__ngFactoryType__||PdfViewerModule)};static ɵmod=core["ɵɵdefineNgModule"]({type:PdfViewerModule,declarations:[PdfViewerComponent],exports:[PdfViewerComponent]});static ɵinj=core["ɵɵdefineInjector"]({})}("undefined"==typeof ngDevMode||ngDevMode)&&core["ɵsetClassMetadata"](PdfViewerModule,[{type:core.NgModule,args:[{declarations:[PdfViewerComponent],exports:[PdfViewerComponent]}]}],null,null)},"./node_modules/process/browser.js":module=>{var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}}}]);